(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const V of document.querySelectorAll('link[rel="modulepreload"]'))D(V);new MutationObserver(V=>{for(const K of V)if(K.type==="childList")for(const re of K.addedNodes)re.tagName==="LINK"&&re.rel==="modulepreload"&&D(re)}).observe(document,{childList:!0,subtree:!0});function S(V){const K={};return V.integrity&&(K.integrity=V.integrity),V.referrerPolicy&&(K.referrerPolicy=V.referrerPolicy),V.crossOrigin==="use-credentials"?K.credentials="include":V.crossOrigin==="anonymous"?K.credentials="omit":K.credentials="same-origin",K}function D(V){if(V.ep)return;V.ep=!0;const K=S(V);fetch(V.href,K)}})();function ix(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}var c0={exports:{}},H_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bb;function oE(){if(Bb)return H_;Bb=1;var b=Symbol.for("react.transitional.element"),m=Symbol.for("react.fragment");function S(D,V,K){var re=null;if(K!==void 0&&(re=""+K),V.key!==void 0&&(re=""+V.key),"key"in V){K={};for(var s in V)s!=="key"&&(K[s]=V[s])}else K=V;return V=K.ref,{$$typeof:b,type:D,key:re,ref:V!==void 0?V:null,props:K}}return H_.Fragment=m,H_.jsx=S,H_.jsxs=S,H_}var Nb;function lE(){return Nb||(Nb=1,c0.exports=oE()),c0.exports}var de=lE(),u0={exports:{}},En={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fb;function cE(){if(Fb)return En;Fb=1;var b=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),V=Symbol.for("react.profiler"),K=Symbol.for("react.consumer"),re=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),pe=Symbol.for("react.suspense"),Ce=Symbol.for("react.memo"),He=Symbol.for("react.lazy"),wt=Symbol.iterator;function gt(Ze){return Ze===null||typeof Ze!="object"?null:(Ze=wt&&Ze[wt]||Ze["@@iterator"],typeof Ze=="function"?Ze:null)}var Xt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},jt=Object.assign,hi={};function vi(Ze,Ft,_i){this.props=Ze,this.context=Ft,this.refs=hi,this.updater=_i||Xt}vi.prototype.isReactComponent={},vi.prototype.setState=function(Ze,Ft){if(typeof Ze!="object"&&typeof Ze!="function"&&Ze!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ze,Ft,"setState")},vi.prototype.forceUpdate=function(Ze){this.updater.enqueueForceUpdate(this,Ze,"forceUpdate")};function at(){}at.prototype=vi.prototype;function ni(Ze,Ft,_i){this.props=Ze,this.context=Ft,this.refs=hi,this.updater=_i||Xt}var qt=ni.prototype=new at;qt.constructor=ni,jt(qt,vi.prototype),qt.isPureReactComponent=!0;var $t=Array.isArray,kt={H:null,A:null,T:null,S:null,V:null},Oi=Object.prototype.hasOwnProperty;function Gt(Ze,Ft,_i,Tt,Fi,wn){return _i=wn.ref,{$$typeof:b,type:Ze,key:Ft,ref:_i!==void 0?_i:null,props:wn}}function oi(Ze,Ft){return Gt(Ze.type,Ft,void 0,void 0,void 0,Ze.props)}function tn(Ze){return typeof Ze=="object"&&Ze!==null&&Ze.$$typeof===b}function Jt(Ze){var Ft={"=":"=0",":":"=2"};return"$"+Ze.replace(/[=:]/g,function(_i){return Ft[_i]})}var ei=/\/+/g;function Vn(Ze,Ft){return typeof Ze=="object"&&Ze!==null&&Ze.key!=null?Jt(""+Ze.key):Ft.toString(36)}function fs(){}function Ss(Ze){switch(Ze.status){case"fulfilled":return Ze.value;case"rejected":throw Ze.reason;default:switch(typeof Ze.status=="string"?Ze.then(fs,fs):(Ze.status="pending",Ze.then(function(Ft){Ze.status==="pending"&&(Ze.status="fulfilled",Ze.value=Ft)},function(Ft){Ze.status==="pending"&&(Ze.status="rejected",Ze.reason=Ft)})),Ze.status){case"fulfilled":return Ze.value;case"rejected":throw Ze.reason}}throw Ze}function mi(Ze,Ft,_i,Tt,Fi){var wn=typeof Ze;(wn==="undefined"||wn==="boolean")&&(Ze=null);var Li=!1;if(Ze===null)Li=!0;else switch(wn){case"bigint":case"string":case"number":Li=!0;break;case"object":switch(Ze.$$typeof){case b:case m:Li=!0;break;case He:return Li=Ze._init,mi(Li(Ze._payload),Ft,_i,Tt,Fi)}}if(Li)return Fi=Fi(Ze),Li=Tt===""?"."+Vn(Ze,0):Tt,$t(Fi)?(_i="",Li!=null&&(_i=Li.replace(ei,"$&/")+"/"),mi(Fi,Ft,_i,"",function(Ws){return Ws})):Fi!=null&&(tn(Fi)&&(Fi=oi(Fi,_i+(Fi.key==null||Ze&&Ze.key===Fi.key?"":(""+Fi.key).replace(ei,"$&/")+"/")+Li)),Ft.push(Fi)),1;Li=0;var lr=Tt===""?".":Tt+":";if($t(Ze))for(var qn=0;qn<Ze.length;qn++)Tt=Ze[qn],wn=lr+Vn(Tt,qn),Li+=mi(Tt,Ft,_i,wn,Fi);else if(qn=gt(Ze),typeof qn=="function")for(Ze=qn.call(Ze),qn=0;!(Tt=Ze.next()).done;)Tt=Tt.value,wn=lr+Vn(Tt,qn++),Li+=mi(Tt,Ft,_i,wn,Fi);else if(wn==="object"){if(typeof Ze.then=="function")return mi(Ss(Ze),Ft,_i,Tt,Fi);throw Ft=String(Ze),Error("Objects are not valid as a React child (found: "+(Ft==="[object Object]"?"object with keys {"+Object.keys(Ze).join(", ")+"}":Ft)+"). If you meant to render a collection of children, use an array instead.")}return Li}function bt(Ze,Ft,_i){if(Ze==null)return Ze;var Tt=[],Fi=0;return mi(Ze,Tt,"","",function(wn){return Ft.call(_i,wn,Fi++)}),Tt}function ri(Ze){if(Ze._status===-1){var Ft=Ze._result;Ft=Ft(),Ft.then(function(_i){(Ze._status===0||Ze._status===-1)&&(Ze._status=1,Ze._result=_i)},function(_i){(Ze._status===0||Ze._status===-1)&&(Ze._status=2,Ze._result=_i)}),Ze._status===-1&&(Ze._status=0,Ze._result=Ft)}if(Ze._status===1)return Ze._result.default;throw Ze._result}var Ni=typeof reportError=="function"?reportError:function(Ze){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ft=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Ze=="object"&&Ze!==null&&typeof Ze.message=="string"?String(Ze.message):String(Ze),error:Ze});if(!window.dispatchEvent(Ft))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Ze);return}console.error(Ze)};function si(){}return En.Children={map:bt,forEach:function(Ze,Ft,_i){bt(Ze,function(){Ft.apply(this,arguments)},_i)},count:function(Ze){var Ft=0;return bt(Ze,function(){Ft++}),Ft},toArray:function(Ze){return bt(Ze,function(Ft){return Ft})||[]},only:function(Ze){if(!tn(Ze))throw Error("React.Children.only expected to receive a single React element child.");return Ze}},En.Component=vi,En.Fragment=S,En.Profiler=V,En.PureComponent=ni,En.StrictMode=D,En.Suspense=pe,En.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=kt,En.__COMPILER_RUNTIME={__proto__:null,c:function(Ze){return kt.H.useMemoCache(Ze)}},En.cache=function(Ze){return function(){return Ze.apply(null,arguments)}},En.cloneElement=function(Ze,Ft,_i){if(Ze==null)throw Error("The argument must be a React element, but you passed "+Ze+".");var Tt=jt({},Ze.props),Fi=Ze.key,wn=void 0;if(Ft!=null)for(Li in Ft.ref!==void 0&&(wn=void 0),Ft.key!==void 0&&(Fi=""+Ft.key),Ft)!Oi.call(Ft,Li)||Li==="key"||Li==="__self"||Li==="__source"||Li==="ref"&&Ft.ref===void 0||(Tt[Li]=Ft[Li]);var Li=arguments.length-2;if(Li===1)Tt.children=_i;else if(1<Li){for(var lr=Array(Li),qn=0;qn<Li;qn++)lr[qn]=arguments[qn+2];Tt.children=lr}return Gt(Ze.type,Fi,void 0,void 0,wn,Tt)},En.createContext=function(Ze){return Ze={$$typeof:re,_currentValue:Ze,_currentValue2:Ze,_threadCount:0,Provider:null,Consumer:null},Ze.Provider=Ze,Ze.Consumer={$$typeof:K,_context:Ze},Ze},En.createElement=function(Ze,Ft,_i){var Tt,Fi={},wn=null;if(Ft!=null)for(Tt in Ft.key!==void 0&&(wn=""+Ft.key),Ft)Oi.call(Ft,Tt)&&Tt!=="key"&&Tt!=="__self"&&Tt!=="__source"&&(Fi[Tt]=Ft[Tt]);var Li=arguments.length-2;if(Li===1)Fi.children=_i;else if(1<Li){for(var lr=Array(Li),qn=0;qn<Li;qn++)lr[qn]=arguments[qn+2];Fi.children=lr}if(Ze&&Ze.defaultProps)for(Tt in Li=Ze.defaultProps,Li)Fi[Tt]===void 0&&(Fi[Tt]=Li[Tt]);return Gt(Ze,wn,void 0,void 0,null,Fi)},En.createRef=function(){return{current:null}},En.forwardRef=function(Ze){return{$$typeof:s,render:Ze}},En.isValidElement=tn,En.lazy=function(Ze){return{$$typeof:He,_payload:{_status:-1,_result:Ze},_init:ri}},En.memo=function(Ze,Ft){return{$$typeof:Ce,type:Ze,compare:Ft===void 0?null:Ft}},En.startTransition=function(Ze){var Ft=kt.T,_i={};kt.T=_i;try{var Tt=Ze(),Fi=kt.S;Fi!==null&&Fi(_i,Tt),typeof Tt=="object"&&Tt!==null&&typeof Tt.then=="function"&&Tt.then(si,Ni)}catch(wn){Ni(wn)}finally{kt.T=Ft}},En.unstable_useCacheRefresh=function(){return kt.H.useCacheRefresh()},En.use=function(Ze){return kt.H.use(Ze)},En.useActionState=function(Ze,Ft,_i){return kt.H.useActionState(Ze,Ft,_i)},En.useCallback=function(Ze,Ft){return kt.H.useCallback(Ze,Ft)},En.useContext=function(Ze){return kt.H.useContext(Ze)},En.useDebugValue=function(){},En.useDeferredValue=function(Ze,Ft){return kt.H.useDeferredValue(Ze,Ft)},En.useEffect=function(Ze,Ft,_i){var Tt=kt.H;if(typeof _i=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Tt.useEffect(Ze,Ft)},En.useId=function(){return kt.H.useId()},En.useImperativeHandle=function(Ze,Ft,_i){return kt.H.useImperativeHandle(Ze,Ft,_i)},En.useInsertionEffect=function(Ze,Ft){return kt.H.useInsertionEffect(Ze,Ft)},En.useLayoutEffect=function(Ze,Ft){return kt.H.useLayoutEffect(Ze,Ft)},En.useMemo=function(Ze,Ft){return kt.H.useMemo(Ze,Ft)},En.useOptimistic=function(Ze,Ft){return kt.H.useOptimistic(Ze,Ft)},En.useReducer=function(Ze,Ft,_i){return kt.H.useReducer(Ze,Ft,_i)},En.useRef=function(Ze){return kt.H.useRef(Ze)},En.useState=function(Ze){return kt.H.useState(Ze)},En.useSyncExternalStore=function(Ze,Ft,_i){return kt.H.useSyncExternalStore(Ze,Ft,_i)},En.useTransition=function(){return kt.H.useTransition()},En.version="19.1.0",En}var Ub;function Wy(){return Ub||(Ub=1,u0.exports=cE()),u0.exports}var Ii=Wy();const uE=ix(Ii);var h0={exports:{}},Z_={},d0={exports:{}},f0={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vb;function hE(){return Vb||(Vb=1,function(b){function m(bt,ri){var Ni=bt.length;bt.push(ri);e:for(;0<Ni;){var si=Ni-1>>>1,Ze=bt[si];if(0<V(Ze,ri))bt[si]=ri,bt[Ni]=Ze,Ni=si;else break e}}function S(bt){return bt.length===0?null:bt[0]}function D(bt){if(bt.length===0)return null;var ri=bt[0],Ni=bt.pop();if(Ni!==ri){bt[0]=Ni;e:for(var si=0,Ze=bt.length,Ft=Ze>>>1;si<Ft;){var _i=2*(si+1)-1,Tt=bt[_i],Fi=_i+1,wn=bt[Fi];if(0>V(Tt,Ni))Fi<Ze&&0>V(wn,Tt)?(bt[si]=wn,bt[Fi]=Ni,si=Fi):(bt[si]=Tt,bt[_i]=Ni,si=_i);else if(Fi<Ze&&0>V(wn,Ni))bt[si]=wn,bt[Fi]=Ni,si=Fi;else break e}}return ri}function V(bt,ri){var Ni=bt.sortIndex-ri.sortIndex;return Ni!==0?Ni:bt.id-ri.id}if(b.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var K=performance;b.unstable_now=function(){return K.now()}}else{var re=Date,s=re.now();b.unstable_now=function(){return re.now()-s}}var pe=[],Ce=[],He=1,wt=null,gt=3,Xt=!1,jt=!1,hi=!1,vi=!1,at=typeof setTimeout=="function"?setTimeout:null,ni=typeof clearTimeout=="function"?clearTimeout:null,qt=typeof setImmediate<"u"?setImmediate:null;function $t(bt){for(var ri=S(Ce);ri!==null;){if(ri.callback===null)D(Ce);else if(ri.startTime<=bt)D(Ce),ri.sortIndex=ri.expirationTime,m(pe,ri);else break;ri=S(Ce)}}function kt(bt){if(hi=!1,$t(bt),!jt)if(S(pe)!==null)jt=!0,Oi||(Oi=!0,Vn());else{var ri=S(Ce);ri!==null&&mi(kt,ri.startTime-bt)}}var Oi=!1,Gt=-1,oi=5,tn=-1;function Jt(){return vi?!0:!(b.unstable_now()-tn<oi)}function ei(){if(vi=!1,Oi){var bt=b.unstable_now();tn=bt;var ri=!0;try{e:{jt=!1,hi&&(hi=!1,ni(Gt),Gt=-1),Xt=!0;var Ni=gt;try{t:{for($t(bt),wt=S(pe);wt!==null&&!(wt.expirationTime>bt&&Jt());){var si=wt.callback;if(typeof si=="function"){wt.callback=null,gt=wt.priorityLevel;var Ze=si(wt.expirationTime<=bt);if(bt=b.unstable_now(),typeof Ze=="function"){wt.callback=Ze,$t(bt),ri=!0;break t}wt===S(pe)&&D(pe),$t(bt)}else D(pe);wt=S(pe)}if(wt!==null)ri=!0;else{var Ft=S(Ce);Ft!==null&&mi(kt,Ft.startTime-bt),ri=!1}}break e}finally{wt=null,gt=Ni,Xt=!1}ri=void 0}}finally{ri?Vn():Oi=!1}}}var Vn;if(typeof qt=="function")Vn=function(){qt(ei)};else if(typeof MessageChannel<"u"){var fs=new MessageChannel,Ss=fs.port2;fs.port1.onmessage=ei,Vn=function(){Ss.postMessage(null)}}else Vn=function(){at(ei,0)};function mi(bt,ri){Gt=at(function(){bt(b.unstable_now())},ri)}b.unstable_IdlePriority=5,b.unstable_ImmediatePriority=1,b.unstable_LowPriority=4,b.unstable_NormalPriority=3,b.unstable_Profiling=null,b.unstable_UserBlockingPriority=2,b.unstable_cancelCallback=function(bt){bt.callback=null},b.unstable_forceFrameRate=function(bt){0>bt||125<bt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):oi=0<bt?Math.floor(1e3/bt):5},b.unstable_getCurrentPriorityLevel=function(){return gt},b.unstable_next=function(bt){switch(gt){case 1:case 2:case 3:var ri=3;break;default:ri=gt}var Ni=gt;gt=ri;try{return bt()}finally{gt=Ni}},b.unstable_requestPaint=function(){vi=!0},b.unstable_runWithPriority=function(bt,ri){switch(bt){case 1:case 2:case 3:case 4:case 5:break;default:bt=3}var Ni=gt;gt=bt;try{return ri()}finally{gt=Ni}},b.unstable_scheduleCallback=function(bt,ri,Ni){var si=b.unstable_now();switch(typeof Ni=="object"&&Ni!==null?(Ni=Ni.delay,Ni=typeof Ni=="number"&&0<Ni?si+Ni:si):Ni=si,bt){case 1:var Ze=-1;break;case 2:Ze=250;break;case 5:Ze=1073741823;break;case 4:Ze=1e4;break;default:Ze=5e3}return Ze=Ni+Ze,bt={id:He++,callback:ri,priorityLevel:bt,startTime:Ni,expirationTime:Ze,sortIndex:-1},Ni>si?(bt.sortIndex=Ni,m(Ce,bt),S(pe)===null&&bt===S(Ce)&&(hi?(ni(Gt),Gt=-1):hi=!0,mi(kt,Ni-si))):(bt.sortIndex=Ze,m(pe,bt),jt||Xt||(jt=!0,Oi||(Oi=!0,Vn()))),bt},b.unstable_shouldYield=Jt,b.unstable_wrapCallback=function(bt){var ri=gt;return function(){var Ni=gt;gt=ri;try{return bt.apply(this,arguments)}finally{gt=Ni}}}}(f0)),f0}var jb;function dE(){return jb||(jb=1,d0.exports=hE()),d0.exports}var p0={exports:{}},Ea={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qb;function fE(){if(qb)return Ea;qb=1;var b=Wy();function m(pe){var Ce="https://react.dev/errors/"+pe;if(1<arguments.length){Ce+="?args[]="+encodeURIComponent(arguments[1]);for(var He=2;He<arguments.length;He++)Ce+="&args[]="+encodeURIComponent(arguments[He])}return"Minified React error #"+pe+"; visit "+Ce+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function S(){}var D={d:{f:S,r:function(){throw Error(m(522))},D:S,C:S,L:S,m:S,X:S,S,M:S},p:0,findDOMNode:null},V=Symbol.for("react.portal");function K(pe,Ce,He){var wt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:V,key:wt==null?null:""+wt,children:pe,containerInfo:Ce,implementation:He}}var re=b.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(pe,Ce){if(pe==="font")return"";if(typeof Ce=="string")return Ce==="use-credentials"?Ce:""}return Ea.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Ea.createPortal=function(pe,Ce){var He=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ce||Ce.nodeType!==1&&Ce.nodeType!==9&&Ce.nodeType!==11)throw Error(m(299));return K(pe,Ce,null,He)},Ea.flushSync=function(pe){var Ce=re.T,He=D.p;try{if(re.T=null,D.p=2,pe)return pe()}finally{re.T=Ce,D.p=He,D.d.f()}},Ea.preconnect=function(pe,Ce){typeof pe=="string"&&(Ce?(Ce=Ce.crossOrigin,Ce=typeof Ce=="string"?Ce==="use-credentials"?Ce:"":void 0):Ce=null,D.d.C(pe,Ce))},Ea.prefetchDNS=function(pe){typeof pe=="string"&&D.d.D(pe)},Ea.preinit=function(pe,Ce){if(typeof pe=="string"&&Ce&&typeof Ce.as=="string"){var He=Ce.as,wt=s(He,Ce.crossOrigin),gt=typeof Ce.integrity=="string"?Ce.integrity:void 0,Xt=typeof Ce.fetchPriority=="string"?Ce.fetchPriority:void 0;He==="style"?D.d.S(pe,typeof Ce.precedence=="string"?Ce.precedence:void 0,{crossOrigin:wt,integrity:gt,fetchPriority:Xt}):He==="script"&&D.d.X(pe,{crossOrigin:wt,integrity:gt,fetchPriority:Xt,nonce:typeof Ce.nonce=="string"?Ce.nonce:void 0})}},Ea.preinitModule=function(pe,Ce){if(typeof pe=="string")if(typeof Ce=="object"&&Ce!==null){if(Ce.as==null||Ce.as==="script"){var He=s(Ce.as,Ce.crossOrigin);D.d.M(pe,{crossOrigin:He,integrity:typeof Ce.integrity=="string"?Ce.integrity:void 0,nonce:typeof Ce.nonce=="string"?Ce.nonce:void 0})}}else Ce==null&&D.d.M(pe)},Ea.preload=function(pe,Ce){if(typeof pe=="string"&&typeof Ce=="object"&&Ce!==null&&typeof Ce.as=="string"){var He=Ce.as,wt=s(He,Ce.crossOrigin);D.d.L(pe,He,{crossOrigin:wt,integrity:typeof Ce.integrity=="string"?Ce.integrity:void 0,nonce:typeof Ce.nonce=="string"?Ce.nonce:void 0,type:typeof Ce.type=="string"?Ce.type:void 0,fetchPriority:typeof Ce.fetchPriority=="string"?Ce.fetchPriority:void 0,referrerPolicy:typeof Ce.referrerPolicy=="string"?Ce.referrerPolicy:void 0,imageSrcSet:typeof Ce.imageSrcSet=="string"?Ce.imageSrcSet:void 0,imageSizes:typeof Ce.imageSizes=="string"?Ce.imageSizes:void 0,media:typeof Ce.media=="string"?Ce.media:void 0})}},Ea.preloadModule=function(pe,Ce){if(typeof pe=="string")if(Ce){var He=s(Ce.as,Ce.crossOrigin);D.d.m(pe,{as:typeof Ce.as=="string"&&Ce.as!=="script"?Ce.as:void 0,crossOrigin:He,integrity:typeof Ce.integrity=="string"?Ce.integrity:void 0})}else D.d.m(pe)},Ea.requestFormReset=function(pe){D.d.r(pe)},Ea.unstable_batchedUpdates=function(pe,Ce){return pe(Ce)},Ea.useFormState=function(pe,Ce,He){return re.H.useFormState(pe,Ce,He)},Ea.useFormStatus=function(){return re.H.useHostTransitionStatus()},Ea.version="19.1.0",Ea}var Gb;function pE(){if(Gb)return p0.exports;Gb=1;function b(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(b)}catch(m){console.error(m)}}return b(),p0.exports=fE(),p0.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hb;function mE(){if(Hb)return Z_;Hb=1;var b=dE(),m=Wy(),S=pE();function D(o){var f="https://react.dev/errors/"+o;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)f+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+o+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function V(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function K(o){var f=o,v=o;if(o.alternate)for(;f.return;)f=f.return;else{o=f;do f=o,(f.flags&4098)!==0&&(v=f.return),o=f.return;while(o)}return f.tag===3?v:null}function re(o){if(o.tag===13){var f=o.memoizedState;if(f===null&&(o=o.alternate,o!==null&&(f=o.memoizedState)),f!==null)return f.dehydrated}return null}function s(o){if(K(o)!==o)throw Error(D(188))}function pe(o){var f=o.alternate;if(!f){if(f=K(o),f===null)throw Error(D(188));return f!==o?null:o}for(var v=o,R=f;;){var L=v.return;if(L===null)break;var q=L.alternate;if(q===null){if(R=L.return,R!==null){v=R;continue}break}if(L.child===q.child){for(q=L.child;q;){if(q===v)return s(L),o;if(q===R)return s(L),f;q=q.sibling}throw Error(D(188))}if(v.return!==R.return)v=L,R=q;else{for(var ne=!1,ve=L.child;ve;){if(ve===v){ne=!0,v=L,R=q;break}if(ve===R){ne=!0,R=L,v=q;break}ve=ve.sibling}if(!ne){for(ve=q.child;ve;){if(ve===v){ne=!0,v=q,R=L;break}if(ve===R){ne=!0,R=q,v=L;break}ve=ve.sibling}if(!ne)throw Error(D(189))}}if(v.alternate!==R)throw Error(D(190))}if(v.tag!==3)throw Error(D(188));return v.stateNode.current===v?o:f}function Ce(o){var f=o.tag;if(f===5||f===26||f===27||f===6)return o;for(o=o.child;o!==null;){if(f=Ce(o),f!==null)return f;o=o.sibling}return null}var He=Object.assign,wt=Symbol.for("react.element"),gt=Symbol.for("react.transitional.element"),Xt=Symbol.for("react.portal"),jt=Symbol.for("react.fragment"),hi=Symbol.for("react.strict_mode"),vi=Symbol.for("react.profiler"),at=Symbol.for("react.provider"),ni=Symbol.for("react.consumer"),qt=Symbol.for("react.context"),$t=Symbol.for("react.forward_ref"),kt=Symbol.for("react.suspense"),Oi=Symbol.for("react.suspense_list"),Gt=Symbol.for("react.memo"),oi=Symbol.for("react.lazy"),tn=Symbol.for("react.activity"),Jt=Symbol.for("react.memo_cache_sentinel"),ei=Symbol.iterator;function Vn(o){return o===null||typeof o!="object"?null:(o=ei&&o[ei]||o["@@iterator"],typeof o=="function"?o:null)}var fs=Symbol.for("react.client.reference");function Ss(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===fs?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case jt:return"Fragment";case vi:return"Profiler";case hi:return"StrictMode";case kt:return"Suspense";case Oi:return"SuspenseList";case tn:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case Xt:return"Portal";case qt:return(o.displayName||"Context")+".Provider";case ni:return(o._context.displayName||"Context")+".Consumer";case $t:var f=o.render;return o=o.displayName,o||(o=f.displayName||f.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case Gt:return f=o.displayName||null,f!==null?f:Ss(o.type)||"Memo";case oi:f=o._payload,o=o._init;try{return Ss(o(f))}catch{}}return null}var mi=Array.isArray,bt=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ri=S.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ni={pending:!1,data:null,method:null,action:null},si=[],Ze=-1;function Ft(o){return{current:o}}function _i(o){0>Ze||(o.current=si[Ze],si[Ze]=null,Ze--)}function Tt(o,f){Ze++,si[Ze]=o.current,o.current=f}var Fi=Ft(null),wn=Ft(null),Li=Ft(null),lr=Ft(null);function qn(o,f){switch(Tt(Li,f),Tt(wn,o),Tt(Fi,null),f.nodeType){case 9:case 11:o=(o=f.documentElement)&&(o=o.namespaceURI)?Eg(o):0;break;default:if(o=f.tagName,f=f.namespaceURI)f=Eg(f),o=Ag(f,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}_i(Fi),Tt(Fi,o)}function Ws(){_i(Fi),_i(wn),_i(Li)}function ue(o){o.memoizedState!==null&&Tt(lr,o);var f=Fi.current,v=Ag(f,o.type);f!==v&&(Tt(wn,o),Tt(Fi,v))}function Ha(o){wn.current===o&&(_i(Fi),_i(wn)),lr.current===o&&(_i(lr),Zf._currentValue=Ni)}var Za=Object.prototype.hasOwnProperty,$a=b.unstable_scheduleCallback,Mt=b.unstable_cancelCallback,Aa=b.unstable_shouldYield,Es=b.unstable_requestPaint,jr=b.unstable_now,Gi=b.unstable_getCurrentPriorityLevel,Er=b.unstable_ImmediatePriority,Ma=b.unstable_UserBlockingPriority,Xa=b.unstable_NormalPriority,_o=b.unstable_LowPriority,kl=b.unstable_IdlePriority,Di=b.log,As=b.unstable_setDisableYieldValue,aa=null,qr=null;function fr(o){if(typeof Di=="function"&&As(o),qr&&typeof qr.setStrictMode=="function")try{qr.setStrictMode(aa,o)}catch{}}var Ar=Math.clz32?Math.clz32:Du,Wa=Math.log,Ru=Math.LN2;function Du(o){return o>>>=0,o===0?32:31-(Wa(o)/Ru|0)|0}var Ya=256,Ka=4194304;function Gr(o){var f=o&42;if(f!==0)return f;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function go(o,f,v){var R=o.pendingLanes;if(R===0)return 0;var L=0,q=o.suspendedLanes,ne=o.pingedLanes;o=o.warmLanes;var ve=R&134217727;return ve!==0?(R=ve&~q,R!==0?L=Gr(R):(ne&=ve,ne!==0?L=Gr(ne):v||(v=ve&~o,v!==0&&(L=Gr(v))))):(ve=R&~q,ve!==0?L=Gr(ve):ne!==0?L=Gr(ne):v||(v=R&~o,v!==0&&(L=Gr(v)))),L===0?0:f!==0&&f!==L&&(f&q)===0&&(q=L&-L,v=f&-f,q>=v||q===32&&(v&4194048)!==0)?f:L}function Pn(o,f){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&f)===0}function bn(o,f){switch(o){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vc(){var o=Ya;return Ya<<=1,(Ya&4194048)===0&&(Ya=256),o}function Bl(){var o=Ka;return Ka<<=1,(Ka&62914560)===0&&(Ka=4194304),o}function rs(o){for(var f=[],v=0;31>v;v++)f.push(o);return f}function Ia(o,f){o.pendingLanes|=f,f!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function zu(o,f,v,R,L,q){var ne=o.pendingLanes;o.pendingLanes=v,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=v,o.entangledLanes&=v,o.errorRecoveryDisabledLanes&=v,o.shellSuspendCounter=0;var ve=o.entanglements,Ve=o.expirationTimes,ht=o.hiddenUpdates;for(v=ne&~v;0<v;){var Rt=31-Ar(v),Bt=1<<Rt;ve[Rt]=0,Ve[Rt]=-1;var ft=ht[Rt];if(ft!==null)for(ht[Rt]=null,Rt=0;Rt<ft.length;Rt++){var _t=ft[Rt];_t!==null&&(_t.lane&=-536870913)}v&=~Bt}R!==0&&Nl(o,R,0),q!==0&&L===0&&o.tag!==0&&(o.suspendedLanes|=q&~(ne&~f))}function Nl(o,f,v){o.pendingLanes|=f,o.suspendedLanes&=~f;var R=31-Ar(f);o.entangledLanes|=f,o.entanglements[R]=o.entanglements[R]|1073741824|v&4194090}function Pu(o,f){var v=o.entangledLanes|=f;for(o=o.entanglements;v;){var R=31-Ar(v),L=1<<R;L&f|o[R]&f&&(o[R]|=f),v&=~L}}function jc(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function Fl(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function Ye(){var o=ri.p;return o!==0?o:(o=window.event,o===void 0?32:w_(o.type))}function te(o,f){var v=ri.p;try{return ri.p=o,f()}finally{ri.p=v}}var ie=Math.random().toString(36).slice(2),me="__reactFiber$"+ie,Se="__reactProps$"+ie,Ee="__reactContainer$"+ie,Re="__reactEvents$"+ie,qe="__reactListeners$"+ie,Pe="__reactHandles$"+ie,$e="__reactResources$"+ie,Je="__reactMarker$"+ie;function We(o){delete o[me],delete o[Se],delete o[Re],delete o[qe],delete o[Pe]}function pt(o){var f=o[me];if(f)return f;for(var v=o.parentNode;v;){if(f=v[Ee]||v[me]){if(v=f.alternate,f.child!==null||v!==null&&v.child!==null)for(o=Rg(o);o!==null;){if(v=o[me])return v;o=Rg(o)}return f}o=v,v=o.parentNode}return null}function Ct(o){if(o=o[me]||o[Ee]){var f=o.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return o}return null}function Pt(o){var f=o.tag;if(f===5||f===26||f===27||f===6)return o.stateNode;throw Error(D(33))}function fi(o){var f=o[$e];return f||(f=o[$e]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function ai(o){o[Je]=!0}var Ti=new Set,Ai={};function gn(o,f){Cn(o,f),Cn(o+"Capture",f)}function Cn(o,f){for(Ai[o]=f,o=0;o<f.length;o++)Ti.add(f[o])}var ki=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),cn={},un={};function mn(o){return Za.call(un,o)?!0:Za.call(cn,o)?!1:ki.test(o)?un[o]=!0:(cn[o]=!0,!1)}function Gn(o,f,v){if(mn(f))if(v===null)o.removeAttribute(f);else{switch(typeof v){case"undefined":case"function":case"symbol":o.removeAttribute(f);return;case"boolean":var R=f.toLowerCase().slice(0,5);if(R!=="data-"&&R!=="aria-"){o.removeAttribute(f);return}}o.setAttribute(f,""+v)}}function pr(o,f,v){if(v===null)o.removeAttribute(f);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(f);return}o.setAttribute(f,""+v)}}function ir(o,f,v,R){if(R===null)o.removeAttribute(v);else{switch(typeof R){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(v);return}o.setAttributeNS(f,v,""+R)}}var Us,ss;function nr(o){if(Us===void 0)try{throw Error()}catch(v){var f=v.stack.trim().match(/\n( *(at )?)/);Us=f&&f[1]||"",ss=-1<v.stack.indexOf(`
    at`)?" (<anonymous>)":-1<v.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Us+o+ss}var Mr=!1;function Go(o,f){if(!o||Mr)return"";Mr=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var R={DetermineComponentFrameRoot:function(){try{if(f){var Bt=function(){throw Error()};if(Object.defineProperty(Bt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Bt,[])}catch(_t){var ft=_t}Reflect.construct(o,[],Bt)}else{try{Bt.call()}catch(_t){ft=_t}o.call(Bt.prototype)}}else{try{throw Error()}catch(_t){ft=_t}(Bt=o())&&typeof Bt.catch=="function"&&Bt.catch(function(){})}}catch(_t){if(_t&&ft&&typeof _t.stack=="string")return[_t.stack,ft.stack]}return[null,null]}};R.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var L=Object.getOwnPropertyDescriptor(R.DetermineComponentFrameRoot,"name");L&&L.configurable&&Object.defineProperty(R.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var q=R.DetermineComponentFrameRoot(),ne=q[0],ve=q[1];if(ne&&ve){var Ve=ne.split(`
`),ht=ve.split(`
`);for(L=R=0;R<Ve.length&&!Ve[R].includes("DetermineComponentFrameRoot");)R++;for(;L<ht.length&&!ht[L].includes("DetermineComponentFrameRoot");)L++;if(R===Ve.length||L===ht.length)for(R=Ve.length-1,L=ht.length-1;1<=R&&0<=L&&Ve[R]!==ht[L];)L--;for(;1<=R&&0<=L;R--,L--)if(Ve[R]!==ht[L]){if(R!==1||L!==1)do if(R--,L--,0>L||Ve[R]!==ht[L]){var Rt=`
`+Ve[R].replace(" at new "," at ");return o.displayName&&Rt.includes("<anonymous>")&&(Rt=Rt.replace("<anonymous>",o.displayName)),Rt}while(1<=R&&0<=L);break}}}finally{Mr=!1,Error.prepareStackTrace=v}return(v=o?o.displayName||o.name:"")?nr(v):""}function oa(o){switch(o.tag){case 26:case 27:case 5:return nr(o.type);case 16:return nr("Lazy");case 13:return nr("Suspense");case 19:return nr("SuspenseList");case 0:case 15:return Go(o.type,!1);case 11:return Go(o.type.render,!1);case 1:return Go(o.type,!0);case 31:return nr("Activity");default:return""}}function Ca(o){try{var f="";do f+=oa(o),o=o.return;while(o);return f}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}function Vs(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Ou(o){var f=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function Lu(o){var f=Ou(o)?"checked":"value",v=Object.getOwnPropertyDescriptor(o.constructor.prototype,f),R=""+o[f];if(!o.hasOwnProperty(f)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var L=v.get,q=v.set;return Object.defineProperty(o,f,{configurable:!0,get:function(){return L.call(this)},set:function(ne){R=""+ne,q.call(this,ne)}}),Object.defineProperty(o,f,{enumerable:v.enumerable}),{getValue:function(){return R},setValue:function(ne){R=""+ne},stopTracking:function(){o._valueTracker=null,delete o[f]}}}}function yo(o){o._valueTracker||(o._valueTracker=Lu(o))}function Nh(o){if(!o)return!1;var f=o._valueTracker;if(!f)return!0;var v=f.getValue(),R="";return o&&(R=Ou(o)?o.checked?"true":"false":o.value),o=R,o!==v?(f.setValue(o),!0):!1}function ku(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var pp=/[\n"\\]/g;function js(o){return o.replace(pp,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function Ho(o,f,v,R,L,q,ne,ve){o.name="",ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"?o.type=ne:o.removeAttribute("type"),f!=null?ne==="number"?(f===0&&o.value===""||o.value!=f)&&(o.value=""+Vs(f)):o.value!==""+Vs(f)&&(o.value=""+Vs(f)):ne!=="submit"&&ne!=="reset"||o.removeAttribute("value"),f!=null?Ys(o,ne,Vs(f)):v!=null?Ys(o,ne,Vs(v)):R!=null&&o.removeAttribute("value"),L==null&&q!=null&&(o.defaultChecked=!!q),L!=null&&(o.checked=L&&typeof L!="function"&&typeof L!="symbol"),ve!=null&&typeof ve!="function"&&typeof ve!="symbol"&&typeof ve!="boolean"?o.name=""+Vs(ve):o.removeAttribute("name")}function qs(o,f,v,R,L,q,ne,ve){if(q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(o.type=q),f!=null||v!=null){if(!(q!=="submit"&&q!=="reset"||f!=null))return;v=v!=null?""+Vs(v):"",f=f!=null?""+Vs(f):v,ve||f===o.value||(o.value=f),o.defaultValue=f}R=R??L,R=typeof R!="function"&&typeof R!="symbol"&&!!R,o.checked=ve?o.checked:!!R,o.defaultChecked=!!R,ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"&&(o.name=ne)}function Ys(o,f,v){f==="number"&&ku(o.ownerDocument)===o||o.defaultValue===""+v||(o.defaultValue=""+v)}function Ks(o,f,v,R){if(o=o.options,f){f={};for(var L=0;L<v.length;L++)f["$"+v[L]]=!0;for(v=0;v<o.length;v++)L=f.hasOwnProperty("$"+o[v].value),o[v].selected!==L&&(o[v].selected=L),L&&R&&(o[v].defaultSelected=!0)}else{for(v=""+Vs(v),f=null,L=0;L<o.length;L++){if(o[L].value===v){o[L].selected=!0,R&&(o[L].defaultSelected=!0);return}f!==null||o[L].disabled||(f=o[L])}f!==null&&(f.selected=!0)}}function Gs(o,f,v){if(f!=null&&(f=""+Vs(f),f!==o.value&&(o.value=f),v==null)){o.defaultValue!==f&&(o.defaultValue=f);return}o.defaultValue=v!=null?""+Vs(v):""}function Ms(o,f,v,R){if(f==null){if(R!=null){if(v!=null)throw Error(D(92));if(mi(R)){if(1<R.length)throw Error(D(93));R=R[0]}v=R}v==null&&(v=""),f=v}v=Vs(f),o.defaultValue=v,R=o.textContent,R===v&&R!==""&&R!==null&&(o.value=R)}function Ra(o,f){if(f){var v=o.firstChild;if(v&&v===o.lastChild&&v.nodeType===3){v.nodeValue=f;return}}o.textContent=f}var uf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Bu(o,f,v){var R=f.indexOf("--")===0;v==null||typeof v=="boolean"||v===""?R?o.setProperty(f,""):f==="float"?o.cssFloat="":o[f]="":R?o.setProperty(f,v):typeof v!="number"||v===0||uf.has(f)?f==="float"?o.cssFloat=v:o[f]=(""+v).trim():o[f]=v+"px"}function la(o,f,v){if(f!=null&&typeof f!="object")throw Error(D(62));if(o=o.style,v!=null){for(var R in v)!v.hasOwnProperty(R)||f!=null&&f.hasOwnProperty(R)||(R.indexOf("--")===0?o.setProperty(R,""):R==="float"?o.cssFloat="":o[R]="");for(var L in f)R=f[L],f.hasOwnProperty(L)&&v[L]!==R&&Bu(o,L,R)}else for(var q in f)f.hasOwnProperty(q)&&Bu(o,q,f[q])}function as(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mp=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),hf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Is(o){return hf.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var on=null;function Nu(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Kt=null,Ul=null;function df(o){var f=Ct(o);if(f&&(o=f.stateNode)){var v=o[Se]||null;e:switch(o=f.stateNode,f.type){case"input":if(Ho(o,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name),f=v.name,v.type==="radio"&&f!=null){for(v=o;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll('input[name="'+js(""+f)+'"][type="radio"]'),f=0;f<v.length;f++){var R=v[f];if(R!==o&&R.form===o.form){var L=R[Se]||null;if(!L)throw Error(D(90));Ho(R,L.value,L.defaultValue,L.defaultValue,L.checked,L.defaultChecked,L.type,L.name)}}for(f=0;f<v.length;f++)R=v[f],R.form===o.form&&Nh(R)}break e;case"textarea":Gs(o,v.value,v.defaultValue);break e;case"select":f=v.value,f!=null&&Ks(o,!!v.multiple,f,!1)}}}var Vl=!1;function Hi(o,f,v){if(Vl)return o(f,v);Vl=!0;try{var R=o(f);return R}finally{if(Vl=!1,(Kt!==null||Ul!==null)&&(Of(),Kt&&(f=Kt,o=Ul,Ul=Kt=null,df(f),o)))for(f=0;f<o.length;f++)df(o[f])}}function ps(o,f){var v=o.stateNode;if(v===null)return null;var R=v[Se]||null;if(R===null)return null;v=R[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(o=o.type,R=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!R;break e;default:o=!1}if(o)return null;if(v&&typeof v!="function")throw Error(D(231,f,typeof v));return v}var ca=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zo=!1;if(ca)try{var Ut={};Object.defineProperty(Ut,"passive",{get:function(){Zo=!0}}),window.addEventListener("test",Ut,Ut),window.removeEventListener("test",Ut,Ut)}catch{Zo=!1}var Zi=null,Ki=null,Lr=null;function jl(){if(Lr)return Lr;var o,f=Ki,v=f.length,R,L="value"in Zi?Zi.value:Zi.textContent,q=L.length;for(o=0;o<v&&f[o]===L[o];o++);var ne=v-o;for(R=1;R<=ne&&f[v-R]===L[q-R];R++);return Lr=L.slice(o,1<R?1-R:void 0)}function Ji(o){var f=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&f===13&&(o=13)):o=f,o===10&&(o=13),32<=o||o===13?o:0}function ua(){return!0}function qc(){return!1}function xr(o){function f(v,R,L,q,ne){this._reactName=v,this._targetInst=L,this.type=R,this.nativeEvent=q,this.target=ne,this.currentTarget=null;for(var ve in o)o.hasOwnProperty(ve)&&(v=o[ve],this[ve]=v?v(q):q[ve]);return this.isDefaultPrevented=(q.defaultPrevented!=null?q.defaultPrevented:q.returnValue===!1)?ua:qc,this.isPropagationStopped=qc,this}return He(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=ua)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=ua)},persist:function(){},isPersistent:ua}),f}var cr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hn=xr(cr),Cs=He({},cr,{view:0,detail:0}),Gc=xr(Cs),Fu,$o,Xo,Wo=He({},Cs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Da,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Xo&&(Xo&&o.type==="mousemove"?(Fu=o.screenX-Xo.screenX,$o=o.screenY-Xo.screenY):$o=Fu=0,Xo=o),Fu)},movementY:function(o){return"movementY"in o?o.movementY:$o}}),Kr=xr(Wo),Ja=He({},Wo,{dataTransfer:0}),os=xr(Ja),Uu=He({},Cs,{relatedTarget:0}),Js=xr(Uu),mr=He({},cr,{animationName:0,elapsedTime:0,pseudoElement:0}),kr=xr(mr),vo=He({},cr,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),rr=xr(vo),ff=He({},cr,{data:0}),Hs=xr(ff),Hc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Yo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xo={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $m(o){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(o):(o=xo[o])?!!f[o]:!1}function Da(){return $m}var Xm=He({},Cs,{key:function(o){if(o.key){var f=Hc[o.key]||o.key;if(f!=="Unidentified")return f}return o.type==="keypress"?(o=Ji(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?Yo[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Da,charCode:function(o){return o.type==="keypress"?Ji(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?Ji(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),Fh=xr(Xm),ms=He({},Wo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_p=xr(ms),ql=He({},Cs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Da}),gp=xr(ql),Vu=He({},cr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wm=xr(Vu),Ym=He({},Wo,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),ju=xr(Ym),qu=He({},cr,{newState:0,oldState:0}),Km=xr(qu),Gl=[9,13,27,32],bo=ca&&"CompositionEvent"in window,Ko=null;ca&&"documentMode"in document&&(Ko=document.documentMode);var Jo=ca&&"TextEvent"in window&&!Ko,Uh=ca&&(!bo||Ko&&8<Ko&&11>=Ko),yp=" ",vp=!1;function pf(o,f){switch(o){case"keyup":return Gl.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xp(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Qs=!1;function zi(o,f){switch(o){case"compositionend":return xp(f);case"keypress":return f.which!==32?null:(vp=!0,yp);case"textInput":return o=f.data,o===yp&&vp?null:o;default:return null}}function Wt(o,f){if(Qs)return o==="compositionend"||!bo&&pf(o,f)?(o=jl(),Lr=Ki=Zi=null,Qs=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return Uh&&f.locale!=="ko"?null:f.data;default:return null}}var Vh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xi(o){var f=o&&o.nodeName&&o.nodeName.toLowerCase();return f==="input"?!!Vh[o.type]:f==="textarea"}function Qa(o,f,v,R){Kt?Ul?Ul.push(R):Ul=[R]:Kt=R,f=zd(f,"onChange"),0<f.length&&(v=new Hn("onChange","change",null,v,R),o.push({event:v,listeners:f}))}var eo=null,ci=null;function mf(o){Sc(o,0)}function to(o){var f=Pt(o);if(Nh(f))return o}function Hl(o,f){if(o==="change")return f}var jh=!1;if(ca){var Qo;if(ca){var Zn="oninput"in document;if(!Zn){var Zc=document.createElement("div");Zc.setAttribute("oninput","return;"),Zn=typeof Zc.oninput=="function"}Qo=Zn}else Qo=!1;jh=Qo&&(!document.documentMode||9<document.documentMode)}function vt(){eo&&(eo.detachEvent("onpropertychange",Gu),ci=eo=null)}function Gu(o){if(o.propertyName==="value"&&to(ci)){var f=[];Qa(f,ci,o,Nu(o)),Hi(mf,f)}}function wo(o,f,v){o==="focusin"?(vt(),eo=f,ci=v,eo.attachEvent("onpropertychange",Gu)):o==="focusout"&&vt()}function Jr(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return to(ci)}function bp(o,f){if(o==="click")return to(f)}function qh(o,f){if(o==="input"||o==="change")return to(f)}function To(o,f){return o===f&&(o!==0||1/o===1/f)||o!==o&&f!==f}var Qr=typeof Object.is=="function"?Object.is:To;function ha(o,f){if(Qr(o,f))return!0;if(typeof o!="object"||o===null||typeof f!="object"||f===null)return!1;var v=Object.keys(o),R=Object.keys(f);if(v.length!==R.length)return!1;for(R=0;R<v.length;R++){var L=v[R];if(!Za.call(f,L)||!Qr(o[L],f[L]))return!1}return!0}function Zl(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function $l(o,f){var v=Zl(o);o=0;for(var R;v;){if(v.nodeType===3){if(R=o+v.textContent.length,o<=f&&R>=f)return{node:v,offset:f-o};o=R}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=Zl(v)}}function wp(o,f){return o&&f?o===f?!0:o&&o.nodeType===3?!1:f&&f.nodeType===3?wp(o,f.parentNode):"contains"in o?o.contains(f):o.compareDocumentPosition?!!(o.compareDocumentPosition(f)&16):!1:!1}function Tp(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var f=ku(o.document);f instanceof o.HTMLIFrameElement;){try{var v=typeof f.contentWindow.location.href=="string"}catch{v=!1}if(v)o=f.contentWindow;else break;f=ku(o.document)}return f}function Hu(o){var f=o&&o.nodeName&&o.nodeName.toLowerCase();return f&&(f==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||f==="textarea"||o.contentEditable==="true")}var Sp=ca&&"documentMode"in document&&11>=document.documentMode,Xl=null,Gh=null,el=null,_f=!1;function tl(o,f,v){var R=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;_f||Xl==null||Xl!==ku(R)||(R=Xl,"selectionStart"in R&&Hu(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),el&&ha(el,R)||(el=R,R=zd(Gh,"onSelect"),0<R.length&&(f=new Hn("onSelect","select",null,f,v),o.push({event:f,listeners:R}),f.target=Xl)))}function Wl(o,f){var v={};return v[o.toLowerCase()]=f.toLowerCase(),v["Webkit"+o]="webkit"+f,v["Moz"+o]="moz"+f,v}var $c={animationend:Wl("Animation","AnimationEnd"),animationiteration:Wl("Animation","AnimationIteration"),animationstart:Wl("Animation","AnimationStart"),transitionrun:Wl("Transition","TransitionRun"),transitionstart:Wl("Transition","TransitionStart"),transitioncancel:Wl("Transition","TransitionCancel"),transitionend:Wl("Transition","TransitionEnd")},Xc={},gf={};ca&&(gf=document.createElement("div").style,"AnimationEvent"in window||(delete $c.animationend.animation,delete $c.animationiteration.animation,delete $c.animationstart.animation),"TransitionEvent"in window||delete $c.transitionend.transition);function za(o){if(Xc[o])return Xc[o];if(!$c[o])return o;var f=$c[o],v;for(v in f)if(f.hasOwnProperty(v)&&v in gf)return Xc[o]=f[v];return o}var da=za("animationend"),Hh=za("animationiteration"),Zu=za("animationstart"),$u=za("transitionrun"),Zh=za("transitionstart"),il=za("transitioncancel"),Xu=za("transitionend"),$h=new Map,So="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");So.push("scrollEnd");function _s(o,f){$h.set(o,f),gn(f,[o])}var Wc=new WeakMap;function gs(o,f){if(typeof o=="object"&&o!==null){var v=Wc.get(o);return v!==void 0?v:(f={value:o,source:f,stack:Ca(f)},Wc.set(o,f),f)}return{value:o,source:f,stack:Ca(f)}}var Br=[],fa=0,nl=0;function Yc(){for(var o=fa,f=nl=fa=0;f<o;){var v=Br[f];Br[f++]=null;var R=Br[f];Br[f++]=null;var L=Br[f];Br[f++]=null;var q=Br[f];if(Br[f++]=null,R!==null&&L!==null){var ne=R.pending;ne===null?L.next=L:(L.next=ne.next,ne.next=L),R.pending=L}q!==0&&Vi(v,L,q)}}function Yl(o,f,v,R){Br[fa++]=o,Br[fa++]=f,Br[fa++]=v,Br[fa++]=R,nl|=R,o.lanes|=R,o=o.alternate,o!==null&&(o.lanes|=R)}function Kl(o,f,v,R){return Yl(o,f,v,R),Wu(o)}function Rs(o,f){return Yl(o,null,null,f),Wu(o)}function Vi(o,f,v){o.lanes|=v;var R=o.alternate;R!==null&&(R.lanes|=v);for(var L=!1,q=o.return;q!==null;)q.childLanes|=v,R=q.alternate,R!==null&&(R.childLanes|=v),q.tag===22&&(o=q.stateNode,o===null||o._visibility&1||(L=!0)),o=q,q=q.return;return o.tag===3?(q=o.stateNode,L&&f!==null&&(L=31-Ar(v),o=q.hiddenUpdates,R=o[L],R===null?o[L]=[f]:R.push(f),f.lane=v|536870912),q):null}function Wu(o){if(50<bc)throw bc=0,Il=null,Error(D(185));for(var f=o.return;f!==null;)o=f,f=o.return;return o.tag===3?o.stateNode:null}var Jl={};function Kc(o,f,v,R){this.tag=o,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ds(o,f,v,R){return new Kc(o,f,v,R)}function yf(o){return o=o.prototype,!(!o||!o.isReactComponent)}function xn(o,f){var v=o.alternate;return v===null?(v=Ds(o.tag,f,o.key,o.mode),v.elementType=o.elementType,v.type=o.type,v.stateNode=o.stateNode,v.alternate=o,o.alternate=v):(v.pendingProps=f,v.type=o.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=o.flags&65011712,v.childLanes=o.childLanes,v.lanes=o.lanes,v.child=o.child,v.memoizedProps=o.memoizedProps,v.memoizedState=o.memoizedState,v.updateQueue=o.updateQueue,f=o.dependencies,v.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},v.sibling=o.sibling,v.index=o.index,v.ref=o.ref,v.refCleanup=o.refCleanup,v}function Ep(o,f){o.flags&=65011714;var v=o.alternate;return v===null?(o.childLanes=0,o.lanes=f,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=v.childLanes,o.lanes=v.lanes,o.child=v.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=v.memoizedProps,o.memoizedState=v.memoizedState,o.updateQueue=v.updateQueue,o.type=v.type,f=v.dependencies,o.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),o}function Jc(o,f,v,R,L,q){var ne=0;if(R=o,typeof o=="function")yf(o)&&(ne=1);else if(typeof o=="string")ne=Pg(o,v,Fi.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case tn:return o=Ds(31,v,f,L),o.elementType=tn,o.lanes=q,o;case jt:return Eo(v.children,L,q,f);case hi:ne=8,L|=24;break;case vi:return o=Ds(12,v,f,L|2),o.elementType=vi,o.lanes=q,o;case kt:return o=Ds(13,v,f,L),o.elementType=kt,o.lanes=q,o;case Oi:return o=Ds(19,v,f,L),o.elementType=Oi,o.lanes=q,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case at:case qt:ne=10;break e;case ni:ne=9;break e;case $t:ne=11;break e;case Gt:ne=14;break e;case oi:ne=16,R=null;break e}ne=29,v=Error(D(130,o===null?"null":typeof o,"")),R=null}return f=Ds(ne,v,f,L),f.elementType=o,f.type=R,f.lanes=q,f}function Eo(o,f,v,R){return o=Ds(7,o,R,f),o.lanes=v,o}function Yu(o,f,v){return o=Ds(6,o,null,f),o.lanes=v,o}function Ku(o,f,v){return f=Ds(4,o.children!==null?o.children:[],o.key,f),f.lanes=v,f.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},f}var Ql=[],ec=0,Xh=null,rl=0,ys=[],ea=0,Hr=null,Pa=1,pa="";function io(o,f){Ql[ec++]=rl,Ql[ec++]=Xh,Xh=o,rl=f}function Wh(o,f,v){ys[ea++]=Pa,ys[ea++]=pa,ys[ea++]=Hr,Hr=o;var R=Pa;o=pa;var L=32-Ar(R)-1;R&=~(1<<L),v+=1;var q=32-Ar(f)+L;if(30<q){var ne=L-L%5;q=(R&(1<<ne)-1).toString(32),R>>=ne,L-=ne,Pa=1<<32-Ar(f)+L|v<<L|R,pa=q+o}else Pa=1<<q|v<<L|R,pa=o}function Ju(o){o.return!==null&&(io(o,1),Wh(o,1,0))}function Qu(o){for(;o===Xh;)Xh=Ql[--ec],Ql[ec]=null,rl=Ql[--ec],Ql[ec]=null;for(;o===Hr;)Hr=ys[--ea],ys[ea]=null,pa=ys[--ea],ys[ea]=null,Pa=ys[--ea],ys[ea]=null}var es=null,ur=null,On=!1,no=null,Oa=!1,Yh=Error(D(519));function ma(o){var f=Error(D(418,""));throw ih(gs(f,o)),Yh}function Ap(o){var f=o.stateNode,v=o.type,R=o.memoizedProps;switch(f[me]=o,f[Se]=R,v){case"dialog":vn("cancel",f),vn("close",f);break;case"iframe":case"object":case"embed":vn("load",f);break;case"video":case"audio":for(v=0;v<Dd.length;v++)vn(Dd[v],f);break;case"source":vn("error",f);break;case"img":case"image":case"link":vn("error",f),vn("load",f);break;case"details":vn("toggle",f);break;case"input":vn("invalid",f),qs(f,R.value,R.defaultValue,R.checked,R.defaultChecked,R.type,R.name,!0),yo(f);break;case"select":vn("invalid",f);break;case"textarea":vn("invalid",f),Ms(f,R.value,R.defaultValue,R.children),yo(f)}v=R.children,typeof v!="string"&&typeof v!="number"&&typeof v!="bigint"||f.textContent===""+v||R.suppressHydrationWarning===!0||tm(f.textContent,v)?(R.popover!=null&&(vn("beforetoggle",f),vn("toggle",f)),R.onScroll!=null&&vn("scroll",f),R.onScrollEnd!=null&&vn("scrollend",f),R.onClick!=null&&(f.onclick=Od),f=!0):f=!1,f||ma(o)}function Mp(o){for(es=o.return;es;)switch(es.tag){case 5:case 13:Oa=!1;return;case 27:case 3:Oa=!0;return;default:es=es.return}}function eh(o){if(o!==es)return!1;if(!On)return Mp(o),On=!0,!1;var f=o.tag,v;if((v=f!==3&&f!==27)&&((v=f===5)&&(v=o.type,v=!(v!=="form"&&v!=="button")||l_(o.type,o.memoizedProps)),v=!v),v&&ur&&ma(o),Mp(o),f===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(D(317));e:{for(o=o.nextSibling,f=0;o;){if(o.nodeType===8)if(v=o.data,v==="/$"){if(f===0){ur=Ua(o.nextSibling);break e}f--}else v!=="$"&&v!=="$!"&&v!=="$?"||f++;o=o.nextSibling}ur=null}}else f===27?(f=ur,Ec(o.type)?(o=am,am=null,ur=o):ur=f):ur=es?Ua(o.stateNode.nextSibling):null;return!0}function th(){ur=es=null,On=!1}function Ip(){var o=no;return o!==null&&($i===null?$i=o:$i.push.apply($i,o),no=null),o}function ih(o){no===null?no=[o]:no.push(o)}var tc=Ft(null),Ao=null,La=null;function ta(o,f,v){Tt(tc,f._currentValue),f._currentValue=v}function ro(o){o._currentValue=tc.current,_i(tc)}function Kh(o,f,v){for(;o!==null;){var R=o.alternate;if((o.childLanes&f)!==f?(o.childLanes|=f,R!==null&&(R.childLanes|=f)):R!==null&&(R.childLanes&f)!==f&&(R.childLanes|=f),o===v)break;o=o.return}}function nh(o,f,v,R){var L=o.child;for(L!==null&&(L.return=o);L!==null;){var q=L.dependencies;if(q!==null){var ne=L.child;q=q.firstContext;e:for(;q!==null;){var ve=q;q=L;for(var Ve=0;Ve<f.length;Ve++)if(ve.context===f[Ve]){q.lanes|=v,ve=q.alternate,ve!==null&&(ve.lanes|=v),Kh(q.return,v,o),R||(ne=null);break e}q=ve.next}}else if(L.tag===18){if(ne=L.return,ne===null)throw Error(D(341));ne.lanes|=v,q=ne.alternate,q!==null&&(q.lanes|=v),Kh(ne,v,o),ne=null}else ne=L.child;if(ne!==null)ne.return=L;else for(ne=L;ne!==null;){if(ne===o){ne=null;break}if(L=ne.sibling,L!==null){L.return=ne.return,ne=L;break}ne=ne.return}L=ne}}function sl(o,f,v,R){o=null;for(var L=f,q=!1;L!==null;){if(!q){if((L.flags&524288)!==0)q=!0;else if((L.flags&262144)!==0)break}if(L.tag===10){var ne=L.alternate;if(ne===null)throw Error(D(387));if(ne=ne.memoizedProps,ne!==null){var ve=L.type;Qr(L.pendingProps.value,ne.value)||(o!==null?o.push(ve):o=[ve])}}else if(L===lr.current){if(ne=L.alternate,ne===null)throw Error(D(387));ne.memoizedState.memoizedState!==L.memoizedState.memoizedState&&(o!==null?o.push(Zf):o=[Zf])}L=L.return}o!==null&&nh(f,o,v,R),f.flags|=262144}function zs(o){for(o=o.firstContext;o!==null;){if(!Qr(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Mo(o){Ao=o,La=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function hr(o){return ic(Ao,o)}function Qc(o,f){return Ao===null&&Mo(o),ic(o,f)}function ic(o,f){var v=f._currentValue;if(f={context:f,memoizedValue:v,next:null},La===null){if(o===null)throw Error(D(308));La=f,o.dependencies={lanes:0,firstContext:f},o.flags|=524288}else La=La.next=f;return v}var Jh=typeof AbortController<"u"?AbortController:function(){var o=[],f=this.signal={aborted:!1,addEventListener:function(v,R){o.push(R)}};this.abort=function(){f.aborted=!0,o.forEach(function(v){return v()})}},Cp=b.unstable_scheduleCallback,vf=b.unstable_NormalPriority,br={$$typeof:qt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Qh(){return{controller:new Jh,data:new Map,refCount:0}}function eu(o){o.refCount--,o.refCount===0&&Cp(vf,function(){o.controller.abort()})}var Io=null,xf=0,nc=0,al=null;function ed(o,f){if(Io===null){var v=Io=[];xf=0,nc=$p(),al={status:"pending",value:void 0,then:function(R){v.push(R)}}}return xf++,f.then(td,td),f}function td(){if(--xf===0&&Io!==null){al!==null&&(al.status="fulfilled");var o=Io;Io=null,nc=0,al=null;for(var f=0;f<o.length;f++)(0,o[f])()}}function id(o,f){var v=[],R={status:"pending",value:null,reason:null,then:function(L){v.push(L)}};return o.then(function(){R.status="fulfilled",R.value=f;for(var L=0;L<v.length;L++)(0,v[L])(f)},function(L){for(R.status="rejected",R.reason=L,L=0;L<v.length;L++)(0,v[L])(void 0)}),R}var rc=bt.S;bt.S=function(o,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&ed(o,f),rc!==null&&rc(o,f)};var Co=Ft(null);function ol(){var o=Co.current;return o!==null?o:ii.pooledCache}function tu(o,f){f===null?Tt(Co,Co.current):Tt(Co,f.pool)}function rh(){var o=ol();return o===null?null:{parent:br._currentValue,pool:o}}var ll=Error(D(460)),iu=Error(D(474)),sh=Error(D(542)),nd={then:function(){}};function sc(o){return o=o.status,o==="fulfilled"||o==="rejected"}function ac(){}function Ot(o,f,v){switch(v=o[v],v===void 0?o.push(f):v!==f&&(f.then(ac,ac),f=v),f.status){case"fulfilled":return f.value;case"rejected":throw o=f.reason,Ro(o),o;default:if(typeof f.status=="string")f.then(ac,ac);else{if(o=ii,o!==null&&100<o.shellSuspendCounter)throw Error(D(482));o=f,o.status="pending",o.then(function(R){if(f.status==="pending"){var L=f;L.status="fulfilled",L.value=R}},function(R){if(f.status==="pending"){var L=f;L.status="rejected",L.reason=R}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw o=f.reason,Ro(o),o}throw oc=f,ll}}var oc=null;function rd(){if(oc===null)throw Error(D(459));var o=oc;return oc=null,o}function Ro(o){if(o===ll||o===sh)throw Error(D(483))}var Nr=!1;function Yt(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ah(o,f){o=o.updateQueue,f.updateQueue===o&&(f.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function cl(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Do(o,f,v){var R=o.updateQueue;if(R===null)return null;if(R=R.shared,(Si&2)!==0){var L=R.pending;return L===null?f.next=f:(f.next=L.next,L.next=f),R.pending=f,f=Wu(o),Vi(o,null,v),f}return Yl(o,R,f,v),Wu(o)}function ul(o,f,v){if(f=f.updateQueue,f!==null&&(f=f.shared,(v&4194048)!==0)){var R=f.lanes;R&=o.pendingLanes,v|=R,f.lanes=v,Pu(o,v)}}function oh(o,f){var v=o.updateQueue,R=o.alternate;if(R!==null&&(R=R.updateQueue,v===R)){var L=null,q=null;if(v=v.firstBaseUpdate,v!==null){do{var ne={lane:v.lane,tag:v.tag,payload:v.payload,callback:null,next:null};q===null?L=q=ne:q=q.next=ne,v=v.next}while(v!==null);q===null?L=q=f:q=q.next=f}else L=q=f;v={baseState:R.baseState,firstBaseUpdate:L,lastBaseUpdate:q,shared:R.shared,callbacks:R.callbacks},o.updateQueue=v;return}o=v.lastBaseUpdate,o===null?v.firstBaseUpdate=f:o.next=f,v.lastBaseUpdate=f}var sd=!1;function hl(){if(sd){var o=al;if(o!==null)throw o}}function lc(o,f,v,R){sd=!1;var L=o.updateQueue;Nr=!1;var q=L.firstBaseUpdate,ne=L.lastBaseUpdate,ve=L.shared.pending;if(ve!==null){L.shared.pending=null;var Ve=ve,ht=Ve.next;Ve.next=null,ne===null?q=ht:ne.next=ht,ne=Ve;var Rt=o.alternate;Rt!==null&&(Rt=Rt.updateQueue,ve=Rt.lastBaseUpdate,ve!==ne&&(ve===null?Rt.firstBaseUpdate=ht:ve.next=ht,Rt.lastBaseUpdate=Ve))}if(q!==null){var Bt=L.baseState;ne=0,Rt=ht=Ve=null,ve=q;do{var ft=ve.lane&-536870913,_t=ft!==ve.lane;if(_t?(Ht&ft)===ft:(R&ft)===ft){ft!==0&&ft===nc&&(sd=!0),Rt!==null&&(Rt=Rt.next={lane:0,tag:ve.tag,payload:ve.payload,callback:null,next:null});e:{var an=o,Qi=ve;ft=f;var er=v;switch(Qi.tag){case 1:if(an=Qi.payload,typeof an=="function"){Bt=an.call(er,Bt,ft);break e}Bt=an;break e;case 3:an.flags=an.flags&-65537|128;case 0:if(an=Qi.payload,ft=typeof an=="function"?an.call(er,Bt,ft):an,ft==null)break e;Bt=He({},Bt,ft);break e;case 2:Nr=!0}}ft=ve.callback,ft!==null&&(o.flags|=64,_t&&(o.flags|=8192),_t=L.callbacks,_t===null?L.callbacks=[ft]:_t.push(ft))}else _t={lane:ft,tag:ve.tag,payload:ve.payload,callback:ve.callback,next:null},Rt===null?(ht=Rt=_t,Ve=Bt):Rt=Rt.next=_t,ne|=ft;if(ve=ve.next,ve===null){if(ve=L.shared.pending,ve===null)break;_t=ve,ve=_t.next,_t.next=null,L.lastBaseUpdate=_t,L.shared.pending=null}}while(!0);Rt===null&&(Ve=Bt),L.baseState=Ve,L.firstBaseUpdate=ht,L.lastBaseUpdate=Rt,q===null&&(L.shared.lanes=0),Wn|=ne,o.lanes=ne,o.memoizedState=Bt}}function bf(o,f){if(typeof o!="function")throw Error(D(191,o));o.call(f)}function ad(o,f){var v=o.callbacks;if(v!==null)for(o.callbacks=null,o=0;o<v.length;o++)bf(v[o],f)}var Ps=Ft(null),nu=Ft(0);function od(o,f){o=kn,Tt(nu,o),Tt(Ps,f),kn=o|f.baseLanes}function ls(){Tt(nu,kn),Tt(Ps,Ps.current)}function so(){kn=nu.current,_i(Ps),_i(nu)}var _a=0,_n=null,Ln=null,_r=null,lh=!1,cs=!1,hn=!1,zo=0,cc=0,dl=null,ld=0;function sr(){throw Error(D(321))}function fl(o,f){if(f===null)return!1;for(var v=0;v<f.length&&v<o.length;v++)if(!Qr(o[v],f[v]))return!1;return!0}function pl(o,f,v,R,L,q){return _a=q,_n=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,bt.H=o===null||o.memoizedState===null?Sf:Ef,hn=!1,q=v(R,L),hn=!1,cs&&(q=yt(f,v,R,L)),uc(o),q}function uc(o){bt.H=xh;var f=Ln!==null&&Ln.next!==null;if(_a=0,_r=Ln=_n=null,lh=!1,cc=0,dl=null,f)throw Error(D(300));o===null||Xn||(o=o.dependencies,o!==null&&zs(o)&&(Xn=!0))}function yt(o,f,v,R){_n=o;var L=0;do{if(cs&&(dl=null),cc=0,cs=!1,25<=L)throw Error(D(301));if(L+=1,_r=Ln=null,o.updateQueue!=null){var q=o.updateQueue;q.lastEffect=null,q.events=null,q.stores=null,q.memoCache!=null&&(q.memoCache.index=0)}bt.H=zp,q=f(v,R)}while(cs);return q}function Lt(){var o=bt.H,f=o.useState()[0];return f=typeof f.then=="function"?hc(f):f,o=o.useState()[0],(Ln!==null?Ln.memoizedState:null)!==o&&(_n.flags|=1024),f}function ml(){var o=zo!==0;return zo=0,o}function Bn(o,f,v){f.updateQueue=o.updateQueue,f.flags&=-2053,o.lanes&=~v}function Fe(o){if(lh){for(o=o.memoizedState;o!==null;){var f=o.queue;f!==null&&(f.pending=null),o=o.next}lh=!1}_a=0,_r=Ln=_n=null,cs=!1,cc=zo=0,dl=null}function Os(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _r===null?_n.memoizedState=_r=o:_r=_r.next=o,_r}function gr(){if(Ln===null){var o=_n.alternate;o=o!==null?o.memoizedState:null}else o=Ln.next;var f=_r===null?_n.memoizedState:_r.next;if(f!==null)_r=f,Ln=o;else{if(o===null)throw _n.alternate===null?Error(D(467)):Error(D(310));Ln=o,o={memoizedState:Ln.memoizedState,baseState:Ln.baseState,baseQueue:Ln.baseQueue,queue:Ln.queue,next:null},_r===null?_n.memoizedState=_r=o:_r=_r.next=o}return _r}function ch(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function hc(o){var f=cc;return cc+=1,dl===null&&(dl=[]),o=Ot(dl,o,f),f=_n,(_r===null?f.memoizedState:_r.next)===null&&(f=f.alternate,bt.H=f===null||f.memoizedState===null?Sf:Ef),o}function uh(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return hc(o);if(o.$$typeof===qt)return hr(o)}throw Error(D(438,String(o)))}function cd(o){var f=null,v=_n.updateQueue;if(v!==null&&(f=v.memoCache),f==null){var R=_n.alternate;R!==null&&(R=R.updateQueue,R!==null&&(R=R.memoCache,R!=null&&(f={data:R.data.map(function(L){return L.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),v===null&&(v=ch(),_n.updateQueue=v),v.memoCache=f,v=f.data[f.index],v===void 0)for(v=f.data[f.index]=Array(o),R=0;R<o;R++)v[R]=Jt;return f.index++,v}function Zs(o,f){return typeof f=="function"?f(o):f}function ud(o){var f=gr();return wf(f,Ln,o)}function wf(o,f,v){var R=o.queue;if(R===null)throw Error(D(311));R.lastRenderedReducer=v;var L=o.baseQueue,q=R.pending;if(q!==null){if(L!==null){var ne=L.next;L.next=q.next,q.next=ne}f.baseQueue=L=q,R.pending=null}if(q=o.baseState,L===null)o.memoizedState=q;else{f=L.next;var ve=ne=null,Ve=null,ht=f,Rt=!1;do{var Bt=ht.lane&-536870913;if(Bt!==ht.lane?(Ht&Bt)===Bt:(_a&Bt)===Bt){var ft=ht.revertLane;if(ft===0)Ve!==null&&(Ve=Ve.next={lane:0,revertLane:0,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null}),Bt===nc&&(Rt=!0);else if((_a&ft)===ft){ht=ht.next,ft===nc&&(Rt=!0);continue}else Bt={lane:0,revertLane:ht.revertLane,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null},Ve===null?(ve=Ve=Bt,ne=q):Ve=Ve.next=Bt,_n.lanes|=ft,Wn|=ft;Bt=ht.action,hn&&v(q,Bt),q=ht.hasEagerState?ht.eagerState:v(q,Bt)}else ft={lane:Bt,revertLane:ht.revertLane,action:ht.action,hasEagerState:ht.hasEagerState,eagerState:ht.eagerState,next:null},Ve===null?(ve=Ve=ft,ne=q):Ve=Ve.next=ft,_n.lanes|=Bt,Wn|=Bt;ht=ht.next}while(ht!==null&&ht!==f);if(Ve===null?ne=q:Ve.next=ve,!Qr(q,o.memoizedState)&&(Xn=!0,Rt&&(v=al,v!==null)))throw v;o.memoizedState=q,o.baseState=ne,o.baseQueue=Ve,R.lastRenderedState=q}return L===null&&(R.lanes=0),[o.memoizedState,R.dispatch]}function hd(o){var f=gr(),v=f.queue;if(v===null)throw Error(D(311));v.lastRenderedReducer=o;var R=v.dispatch,L=v.pending,q=f.memoizedState;if(L!==null){v.pending=null;var ne=L=L.next;do q=o(q,ne.action),ne=ne.next;while(ne!==L);Qr(q,f.memoizedState)||(Xn=!0),f.memoizedState=q,f.baseQueue===null&&(f.baseState=q),v.lastRenderedState=q}return[q,R]}function hh(o,f,v){var R=_n,L=gr(),q=On;if(q){if(v===void 0)throw Error(D(407));v=v()}else v=f();var ne=!Qr((Ln||L).memoizedState,v);ne&&(L.memoizedState=v,Xn=!0),L=L.queue;var ve=fd.bind(null,R,L,o);if(ga(2048,8,ve,[o]),L.getSnapshot!==f||ne||_r!==null&&_r.memoizedState.tag&1){if(R.flags|=2048,yl(9,Ls(),dd.bind(null,R,L,v,f),null),ii===null)throw Error(D(349));q||(_a&124)!==0||Po(R,f,v)}return v}function Po(o,f,v){o.flags|=16384,o={getSnapshot:f,value:v},f=_n.updateQueue,f===null?(f=ch(),_n.updateQueue=f,f.stores=[o]):(v=f.stores,v===null?f.stores=[o]:v.push(o))}function dd(o,f,v,R){f.value=v,f.getSnapshot=R,_l(f)&&dh(o)}function fd(o,f,v){return v(function(){_l(f)&&dh(o)})}function _l(o){var f=o.getSnapshot;o=o.value;try{var v=f();return!Qr(o,v)}catch{return!0}}function dh(o){var f=Rs(o,2);f!==null&&Ta(f,o,2)}function gl(o){var f=Os();if(typeof o=="function"){var v=o;if(o=v(),hn){fr(!0);try{v()}finally{fr(!1)}}}return f.memoizedState=f.baseState=o,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zs,lastRenderedState:o},f}function ao(o,f,v,R){return o.baseState=v,wf(o,Ln,typeof R=="function"?R:Zs)}function Rp(o,f,v,R,L){if(cu(o))throw Error(D(485));if(o=f.action,o!==null){var q={payload:L,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ne){q.listeners.push(ne)}};bt.T!==null?v(!0):q.isTransition=!1,R(q),v=f.pending,v===null?(q.next=f.pending=q,Ir(f,q)):(q.next=v.next,f.pending=v.next=q)}}function Ir(o,f){var v=f.action,R=f.payload,L=o.state;if(f.isTransition){var q=bt.T,ne={};bt.T=ne;try{var ve=v(L,R),Ve=bt.S;Ve!==null&&Ve(ne,ve),Dp(o,f,ve)}catch(ht){Tn(o,f,ht)}finally{bt.T=q}}else try{q=v(L,R),Dp(o,f,q)}catch(ht){Tn(o,f,ht)}}function Dp(o,f,v){v!==null&&typeof v=="object"&&typeof v.then=="function"?v.then(function(R){ru(o,f,R)},function(R){return Tn(o,f,R)}):ru(o,f,v)}function ru(o,f,v){f.status="fulfilled",f.value=v,nn(f),o.state=v,f=o.pending,f!==null&&(v=f.next,v===f?o.pending=null:(v=v.next,f.next=v,Ir(o,v)))}function Tn(o,f,v){var R=o.pending;if(o.pending=null,R!==null){R=R.next;do f.status="rejected",f.reason=v,nn(f),f=f.next;while(f!==R)}o.action=null}function nn(o){o=o.listeners;for(var f=0;f<o.length;f++)(0,o[f])()}function Tf(o,f){return f}function oo(o,f){if(On){var v=ii.formState;if(v!==null){e:{var R=_n;if(On){if(ur){t:{for(var L=ur,q=Oa;L.nodeType!==8;){if(!q){L=null;break t}if(L=Ua(L.nextSibling),L===null){L=null;break t}}q=L.data,L=q==="F!"||q==="F"?L:null}if(L){ur=Ua(L.nextSibling),R=L.data==="F!";break e}}ma(R)}R=!1}R&&(f=v[0])}}return v=Os(),v.memoizedState=v.baseState=f,R={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tf,lastRenderedState:f},v.queue=R,v=vh.bind(null,_n,R),R.dispatch=v,R=gl(!1),q=lu.bind(null,_n,!1,R.queue),R=Os(),L={state:f,dispatch:null,action:o,pending:null},R.queue=L,v=Rp.bind(null,_n,L,q,v),L.dispatch=v,R.memoizedState=o,[f,v,!1]}function dc(o){var f=gr();return lo(f,Ln,o)}function lo(o,f,v){if(f=wf(o,f,Tf)[0],o=ud(Zs)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var R=hc(f)}catch(ne){throw ne===ll?sh:ne}else R=f;f=gr();var L=f.queue,q=L.dispatch;return v!==f.memoizedState&&(_n.flags|=2048,yl(9,Ls(),fc.bind(null,L,v),null)),[R,q,o]}function fc(o,f){o.action=f}function su(o){var f=gr(),v=Ln;if(v!==null)return lo(f,v,o);gr(),f=f.memoizedState,v=gr();var R=v.queue.dispatch;return v.memoizedState=o,[f,R,!1]}function yl(o,f,v,R){return o={tag:o,create:v,deps:R,inst:f,next:null},f=_n.updateQueue,f===null&&(f=ch(),_n.updateQueue=f),v=f.lastEffect,v===null?f.lastEffect=o.next=o:(R=v.next,v.next=o,o.next=R,f.lastEffect=o),o}function Ls(){return{destroy:void 0,resource:void 0}}function pd(){return gr().memoizedState}function $s(o,f,v,R){var L=Os();R=R===void 0?null:R,_n.flags|=o,L.memoizedState=yl(1|f,Ls(),v,R)}function ga(o,f,v,R){var L=gr();R=R===void 0?null:R;var q=L.memoizedState.inst;Ln!==null&&R!==null&&fl(R,Ln.memoizedState.deps)?L.memoizedState=yl(f,q,v,R):(_n.flags|=o,L.memoizedState=yl(1|f,q,v,R))}function fh(o,f){$s(8390656,8,o,f)}function ph(o,f){ga(2048,8,o,f)}function md(o,f){return ga(4,2,o,f)}function _d(o,f){return ga(4,4,o,f)}function vl(o,f){if(typeof f=="function"){o=o();var v=f(o);return function(){typeof v=="function"?v():f(null)}}if(f!=null)return o=o(),f.current=o,function(){f.current=null}}function gd(o,f,v){v=v!=null?v.concat([o]):null,ga(4,4,vl.bind(null,f,o),v)}function co(){}function yd(o,f){var v=gr();f=f===void 0?null:f;var R=v.memoizedState;return f!==null&&fl(f,R[1])?R[0]:(v.memoizedState=[o,f],o)}function au(o,f){var v=gr();f=f===void 0?null:f;var R=v.memoizedState;if(f!==null&&fl(f,R[1]))return R[0];if(R=o(),hn){fr(!0);try{o()}finally{fr(!1)}}return v.memoizedState=[R,f],R}function mh(o,f,v){return v===void 0||(_a&1073741824)!==0?o.memoizedState=f:(o.memoizedState=v,o=Md(),_n.lanes|=o,Wn|=o,v)}function vd(o,f,v,R){return Qr(v,f)?v:Ps.current!==null?(o=mh(o,v,R),Qr(o,f)||(Xn=!0),o):(_a&42)===0?(Xn=!0,o.memoizedState=v):(o=Md(),_n.lanes|=o,Wn|=o,f)}function Fr(o,f,v,R,L){var q=ri.p;ri.p=q!==0&&8>q?q:8;var ne=bt.T,ve={};bt.T=ve,lu(o,!1,f,v);try{var Ve=L(),ht=bt.S;if(ht!==null&&ht(ve,Ve),Ve!==null&&typeof Ve=="object"&&typeof Ve.then=="function"){var Rt=id(Ve,R);xl(o,f,Rt,xs(o))}else xl(o,f,R,xs(o))}catch(Bt){xl(o,f,{then:function(){},status:"rejected",reason:Bt},xs())}finally{ri.p=q,bt.T=ne}}function xd(){}function ou(o,f,v,R){if(o.tag!==5)throw Error(D(476));var L=ks(o).queue;Fr(o,L,f,Ni,v===null?xd:function(){return _h(o),v(R)})}function ks(o){var f=o.memoizedState;if(f!==null)return f;f={memoizedState:Ni,baseState:Ni,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zs,lastRenderedState:Ni},next:null};var v={};return f.next={memoizedState:v,baseState:v,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zs,lastRenderedState:v},next:null},o.memoizedState=f,o=o.alternate,o!==null&&(o.memoizedState=f),f}function _h(o){var f=ks(o).next.queue;xl(o,f,{},xs())}function gh(){return hr(Zf)}function bd(){return gr().memoizedState}function pc(){return gr().memoizedState}function yh(o){for(var f=o.return;f!==null;){switch(f.tag){case 24:case 3:var v=xs();o=cl(v);var R=Do(f,o,v);R!==null&&(Ta(R,f,v),ul(R,f,v)),f={cache:Qh()},o.payload=f;return}f=f.return}}function wd(o,f,v){var R=xs();v={lane:R,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null},cu(o)?Td(f,v):(v=Kl(o,f,v,R),v!==null&&(Ta(v,o,R),uu(v,f,R)))}function vh(o,f,v){var R=xs();xl(o,f,v,R)}function xl(o,f,v,R){var L={lane:R,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null};if(cu(o))Td(f,L);else{var q=o.alternate;if(o.lanes===0&&(q===null||q.lanes===0)&&(q=f.lastRenderedReducer,q!==null))try{var ne=f.lastRenderedState,ve=q(ne,v);if(L.hasEagerState=!0,L.eagerState=ve,Qr(ve,ne))return Yl(o,f,L,0),ii===null&&Yc(),!1}catch{}finally{}if(v=Kl(o,f,L,R),v!==null)return Ta(v,o,R),uu(v,f,R),!0}return!1}function lu(o,f,v,R){if(R={lane:2,revertLane:$p(),action:R,hasEagerState:!1,eagerState:null,next:null},cu(o)){if(f)throw Error(D(479))}else f=Kl(o,v,R,2),f!==null&&Ta(f,o,2)}function cu(o){var f=o.alternate;return o===_n||f!==null&&f===_n}function Td(o,f){cs=lh=!0;var v=o.pending;v===null?f.next=f:(f.next=v.next,v.next=f),o.pending=f}function uu(o,f,v){if((v&4194048)!==0){var R=f.lanes;R&=o.pendingLanes,v|=R,f.lanes=v,Pu(o,v)}}var xh={readContext:hr,use:uh,useCallback:sr,useContext:sr,useEffect:sr,useImperativeHandle:sr,useLayoutEffect:sr,useInsertionEffect:sr,useMemo:sr,useReducer:sr,useRef:sr,useState:sr,useDebugValue:sr,useDeferredValue:sr,useTransition:sr,useSyncExternalStore:sr,useId:sr,useHostTransitionStatus:sr,useFormState:sr,useActionState:sr,useOptimistic:sr,useMemoCache:sr,useCacheRefresh:sr},Sf={readContext:hr,use:uh,useCallback:function(o,f){return Os().memoizedState=[o,f===void 0?null:f],o},useContext:hr,useEffect:fh,useImperativeHandle:function(o,f,v){v=v!=null?v.concat([o]):null,$s(4194308,4,vl.bind(null,f,o),v)},useLayoutEffect:function(o,f){return $s(4194308,4,o,f)},useInsertionEffect:function(o,f){$s(4,2,o,f)},useMemo:function(o,f){var v=Os();f=f===void 0?null:f;var R=o();if(hn){fr(!0);try{o()}finally{fr(!1)}}return v.memoizedState=[R,f],R},useReducer:function(o,f,v){var R=Os();if(v!==void 0){var L=v(f);if(hn){fr(!0);try{v(f)}finally{fr(!1)}}}else L=f;return R.memoizedState=R.baseState=L,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:L},R.queue=o,o=o.dispatch=wd.bind(null,_n,o),[R.memoizedState,o]},useRef:function(o){var f=Os();return o={current:o},f.memoizedState=o},useState:function(o){o=gl(o);var f=o.queue,v=vh.bind(null,_n,f);return f.dispatch=v,[o.memoizedState,v]},useDebugValue:co,useDeferredValue:function(o,f){var v=Os();return mh(v,o,f)},useTransition:function(){var o=gl(!1);return o=Fr.bind(null,_n,o.queue,!0,!1),Os().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,f,v){var R=_n,L=Os();if(On){if(v===void 0)throw Error(D(407));v=v()}else{if(v=f(),ii===null)throw Error(D(349));(Ht&124)!==0||Po(R,f,v)}L.memoizedState=v;var q={value:v,getSnapshot:f};return L.queue=q,fh(fd.bind(null,R,q,o),[o]),R.flags|=2048,yl(9,Ls(),dd.bind(null,R,q,v,f),null),v},useId:function(){var o=Os(),f=ii.identifierPrefix;if(On){var v=pa,R=Pa;v=(R&~(1<<32-Ar(R)-1)).toString(32)+v,f="«"+f+"R"+v,v=zo++,0<v&&(f+="H"+v.toString(32)),f+="»"}else v=ld++,f="«"+f+"r"+v.toString(32)+"»";return o.memoizedState=f},useHostTransitionStatus:gh,useFormState:oo,useActionState:oo,useOptimistic:function(o){var f=Os();f.memoizedState=f.baseState=o;var v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=v,f=lu.bind(null,_n,!0,v),v.dispatch=f,[o,f]},useMemoCache:cd,useCacheRefresh:function(){return Os().memoizedState=yh.bind(null,_n)}},Ef={readContext:hr,use:uh,useCallback:yd,useContext:hr,useEffect:ph,useImperativeHandle:gd,useInsertionEffect:md,useLayoutEffect:_d,useMemo:au,useReducer:ud,useRef:pd,useState:function(){return ud(Zs)},useDebugValue:co,useDeferredValue:function(o,f){var v=gr();return vd(v,Ln.memoizedState,o,f)},useTransition:function(){var o=ud(Zs)[0],f=gr().memoizedState;return[typeof o=="boolean"?o:hc(o),f]},useSyncExternalStore:hh,useId:bd,useHostTransitionStatus:gh,useFormState:dc,useActionState:dc,useOptimistic:function(o,f){var v=gr();return ao(v,Ln,o,f)},useMemoCache:cd,useCacheRefresh:pc},zp={readContext:hr,use:uh,useCallback:yd,useContext:hr,useEffect:ph,useImperativeHandle:gd,useInsertionEffect:md,useLayoutEffect:_d,useMemo:au,useReducer:hd,useRef:pd,useState:function(){return hd(Zs)},useDebugValue:co,useDeferredValue:function(o,f){var v=gr();return Ln===null?mh(v,o,f):vd(v,Ln.memoizedState,o,f)},useTransition:function(){var o=hd(Zs)[0],f=gr().memoizedState;return[typeof o=="boolean"?o:hc(o),f]},useSyncExternalStore:hh,useId:bd,useHostTransitionStatus:gh,useFormState:su,useActionState:su,useOptimistic:function(o,f){var v=gr();return Ln!==null?ao(v,Ln,o,f):(v.baseState=o,[o,v.queue.dispatch])},useMemoCache:cd,useCacheRefresh:pc},mc=null,Oo=0;function bl(o){var f=Oo;return Oo+=1,mc===null&&(mc=[]),Ot(mc,o,f)}function ts(o,f){f=f.props.ref,o.ref=f!==void 0?f:null}function wl(o,f){throw f.$$typeof===wt?Error(D(525)):(o=Object.prototype.toString.call(f),Error(D(31,o==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":o)))}function Af(o){var f=o._init;return f(o._payload)}function Mf(o){function f(it,Ke){if(o){var ct=it.deletions;ct===null?(it.deletions=[Ke],it.flags|=16):ct.push(Ke)}}function v(it,Ke){if(!o)return null;for(;Ke!==null;)f(it,Ke),Ke=Ke.sibling;return null}function R(it){for(var Ke=new Map;it!==null;)it.key!==null?Ke.set(it.key,it):Ke.set(it.index,it),it=it.sibling;return Ke}function L(it,Ke){return it=xn(it,Ke),it.index=0,it.sibling=null,it}function q(it,Ke,ct){return it.index=ct,o?(ct=it.alternate,ct!==null?(ct=ct.index,ct<Ke?(it.flags|=67108866,Ke):ct):(it.flags|=67108866,Ke)):(it.flags|=1048576,Ke)}function ne(it){return o&&it.alternate===null&&(it.flags|=67108866),it}function ve(it,Ke,ct,Dt){return Ke===null||Ke.tag!==6?(Ke=Yu(ct,it.mode,Dt),Ke.return=it,Ke):(Ke=L(Ke,ct),Ke.return=it,Ke)}function Ve(it,Ke,ct,Dt){var wi=ct.type;return wi===jt?Rt(it,Ke,ct.props.children,Dt,ct.key):Ke!==null&&(Ke.elementType===wi||typeof wi=="object"&&wi!==null&&wi.$$typeof===oi&&Af(wi)===Ke.type)?(Ke=L(Ke,ct.props),ts(Ke,ct),Ke.return=it,Ke):(Ke=Jc(ct.type,ct.key,ct.props,null,it.mode,Dt),ts(Ke,ct),Ke.return=it,Ke)}function ht(it,Ke,ct,Dt){return Ke===null||Ke.tag!==4||Ke.stateNode.containerInfo!==ct.containerInfo||Ke.stateNode.implementation!==ct.implementation?(Ke=Ku(ct,it.mode,Dt),Ke.return=it,Ke):(Ke=L(Ke,ct.children||[]),Ke.return=it,Ke)}function Rt(it,Ke,ct,Dt,wi){return Ke===null||Ke.tag!==7?(Ke=Eo(ct,it.mode,Dt,wi),Ke.return=it,Ke):(Ke=L(Ke,ct),Ke.return=it,Ke)}function Bt(it,Ke,ct){if(typeof Ke=="string"&&Ke!==""||typeof Ke=="number"||typeof Ke=="bigint")return Ke=Yu(""+Ke,it.mode,ct),Ke.return=it,Ke;if(typeof Ke=="object"&&Ke!==null){switch(Ke.$$typeof){case gt:return ct=Jc(Ke.type,Ke.key,Ke.props,null,it.mode,ct),ts(ct,Ke),ct.return=it,ct;case Xt:return Ke=Ku(Ke,it.mode,ct),Ke.return=it,Ke;case oi:var Dt=Ke._init;return Ke=Dt(Ke._payload),Bt(it,Ke,ct)}if(mi(Ke)||Vn(Ke))return Ke=Eo(Ke,it.mode,ct,null),Ke.return=it,Ke;if(typeof Ke.then=="function")return Bt(it,bl(Ke),ct);if(Ke.$$typeof===qt)return Bt(it,Qc(it,Ke),ct);wl(it,Ke)}return null}function ft(it,Ke,ct,Dt){var wi=Ke!==null?Ke.key:null;if(typeof ct=="string"&&ct!==""||typeof ct=="number"||typeof ct=="bigint")return wi!==null?null:ve(it,Ke,""+ct,Dt);if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case gt:return ct.key===wi?Ve(it,Ke,ct,Dt):null;case Xt:return ct.key===wi?ht(it,Ke,ct,Dt):null;case oi:return wi=ct._init,ct=wi(ct._payload),ft(it,Ke,ct,Dt)}if(mi(ct)||Vn(ct))return wi!==null?null:Rt(it,Ke,ct,Dt,null);if(typeof ct.then=="function")return ft(it,Ke,bl(ct),Dt);if(ct.$$typeof===qt)return ft(it,Ke,Qc(it,ct),Dt);wl(it,ct)}return null}function _t(it,Ke,ct,Dt,wi){if(typeof Dt=="string"&&Dt!==""||typeof Dt=="number"||typeof Dt=="bigint")return it=it.get(ct)||null,ve(Ke,it,""+Dt,wi);if(typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case gt:return it=it.get(Dt.key===null?ct:Dt.key)||null,Ve(Ke,it,Dt,wi);case Xt:return it=it.get(Dt.key===null?ct:Dt.key)||null,ht(Ke,it,Dt,wi);case oi:var Mn=Dt._init;return Dt=Mn(Dt._payload),_t(it,Ke,ct,Dt,wi)}if(mi(Dt)||Vn(Dt))return it=it.get(ct)||null,Rt(Ke,it,Dt,wi,null);if(typeof Dt.then=="function")return _t(it,Ke,ct,bl(Dt),wi);if(Dt.$$typeof===qt)return _t(it,Ke,ct,Qc(Ke,Dt),wi);wl(Ke,Dt)}return null}function an(it,Ke,ct,Dt){for(var wi=null,Mn=null,Pi=Ke,en=Ke=0,ws=null;Pi!==null&&en<ct.length;en++){Pi.index>en?(ws=Pi,Pi=null):ws=Pi.sibling;var Nn=ft(it,Pi,ct[en],Dt);if(Nn===null){Pi===null&&(Pi=ws);break}o&&Pi&&Nn.alternate===null&&f(it,Pi),Ke=q(Nn,Ke,en),Mn===null?wi=Nn:Mn.sibling=Nn,Mn=Nn,Pi=ws}if(en===ct.length)return v(it,Pi),On&&io(it,en),wi;if(Pi===null){for(;en<ct.length;en++)Pi=Bt(it,ct[en],Dt),Pi!==null&&(Ke=q(Pi,Ke,en),Mn===null?wi=Pi:Mn.sibling=Pi,Mn=Pi);return On&&io(it,en),wi}for(Pi=R(Pi);en<ct.length;en++)ws=_t(Pi,it,en,ct[en],Dt),ws!==null&&(o&&ws.alternate!==null&&Pi.delete(ws.key===null?en:ws.key),Ke=q(ws,Ke,en),Mn===null?wi=ws:Mn.sibling=ws,Mn=ws);return o&&Pi.forEach(function(Rc){return f(it,Rc)}),On&&io(it,en),wi}function Qi(it,Ke,ct,Dt){if(ct==null)throw Error(D(151));for(var wi=null,Mn=null,Pi=Ke,en=Ke=0,ws=null,Nn=ct.next();Pi!==null&&!Nn.done;en++,Nn=ct.next()){Pi.index>en?(ws=Pi,Pi=null):ws=Pi.sibling;var Rc=ft(it,Pi,Nn.value,Dt);if(Rc===null){Pi===null&&(Pi=ws);break}o&&Pi&&Rc.alternate===null&&f(it,Pi),Ke=q(Rc,Ke,en),Mn===null?wi=Rc:Mn.sibling=Rc,Mn=Rc,Pi=ws}if(Nn.done)return v(it,Pi),On&&io(it,en),wi;if(Pi===null){for(;!Nn.done;en++,Nn=ct.next())Nn=Bt(it,Nn.value,Dt),Nn!==null&&(Ke=q(Nn,Ke,en),Mn===null?wi=Nn:Mn.sibling=Nn,Mn=Nn);return On&&io(it,en),wi}for(Pi=R(Pi);!Nn.done;en++,Nn=ct.next())Nn=_t(Pi,it,en,Nn.value,Dt),Nn!==null&&(o&&Nn.alternate!==null&&Pi.delete(Nn.key===null?en:Nn.key),Ke=q(Nn,Ke,en),Mn===null?wi=Nn:Mn.sibling=Nn,Mn=Nn);return o&&Pi.forEach(function(S_){return f(it,S_)}),On&&io(it,en),wi}function er(it,Ke,ct,Dt){if(typeof ct=="object"&&ct!==null&&ct.type===jt&&ct.key===null&&(ct=ct.props.children),typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case gt:e:{for(var wi=ct.key;Ke!==null;){if(Ke.key===wi){if(wi=ct.type,wi===jt){if(Ke.tag===7){v(it,Ke.sibling),Dt=L(Ke,ct.props.children),Dt.return=it,it=Dt;break e}}else if(Ke.elementType===wi||typeof wi=="object"&&wi!==null&&wi.$$typeof===oi&&Af(wi)===Ke.type){v(it,Ke.sibling),Dt=L(Ke,ct.props),ts(Dt,ct),Dt.return=it,it=Dt;break e}v(it,Ke);break}else f(it,Ke);Ke=Ke.sibling}ct.type===jt?(Dt=Eo(ct.props.children,it.mode,Dt,ct.key),Dt.return=it,it=Dt):(Dt=Jc(ct.type,ct.key,ct.props,null,it.mode,Dt),ts(Dt,ct),Dt.return=it,it=Dt)}return ne(it);case Xt:e:{for(wi=ct.key;Ke!==null;){if(Ke.key===wi)if(Ke.tag===4&&Ke.stateNode.containerInfo===ct.containerInfo&&Ke.stateNode.implementation===ct.implementation){v(it,Ke.sibling),Dt=L(Ke,ct.children||[]),Dt.return=it,it=Dt;break e}else{v(it,Ke);break}else f(it,Ke);Ke=Ke.sibling}Dt=Ku(ct,it.mode,Dt),Dt.return=it,it=Dt}return ne(it);case oi:return wi=ct._init,ct=wi(ct._payload),er(it,Ke,ct,Dt)}if(mi(ct))return an(it,Ke,ct,Dt);if(Vn(ct)){if(wi=Vn(ct),typeof wi!="function")throw Error(D(150));return ct=wi.call(ct),Qi(it,Ke,ct,Dt)}if(typeof ct.then=="function")return er(it,Ke,bl(ct),Dt);if(ct.$$typeof===qt)return er(it,Ke,Qc(it,ct),Dt);wl(it,ct)}return typeof ct=="string"&&ct!==""||typeof ct=="number"||typeof ct=="bigint"?(ct=""+ct,Ke!==null&&Ke.tag===6?(v(it,Ke.sibling),Dt=L(Ke,ct),Dt.return=it,it=Dt):(v(it,Ke),Dt=Yu(ct,it.mode,Dt),Dt.return=it,it=Dt),ne(it)):v(it,Ke)}return function(it,Ke,ct,Dt){try{Oo=0;var wi=er(it,Ke,ct,Dt);return mc=null,wi}catch(Pi){if(Pi===ll||Pi===sh)throw Pi;var Mn=Ds(29,Pi,null,it.mode);return Mn.lanes=Dt,Mn.return=it,Mn}finally{}}}var hu=Mf(!0),Pp=Mf(!1),dn=Ft(null),ka=null;function uo(o){var f=o.alternate;Tt(yr,yr.current&1),Tt(dn,o),ka===null&&(f===null||Ps.current!==null||f.memoizedState!==null)&&(ka=o)}function Op(o){if(o.tag===22){if(Tt(yr,yr.current),Tt(dn,o),ka===null){var f=o.alternate;f!==null&&f.memoizedState!==null&&(ka=o)}}else ya()}function ya(){Tt(yr,yr.current),Tt(dn,dn.current)}function Ba(o){_i(dn),ka===o&&(ka=null),_i(yr)}var yr=Ft(0);function _c(o){for(var f=o;f!==null;){if(f.tag===13){var v=f.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||sm(v)))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===o)break;for(;f.sibling===null;){if(f.return===null||f.return===o)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}function va(o,f,v,R){f=o.memoizedState,v=v(R,f),v=v==null?f:He({},f,v),o.memoizedState=v,o.lanes===0&&(o.updateQueue.baseState=v)}var gc={enqueueSetState:function(o,f,v){o=o._reactInternals;var R=xs(),L=cl(R);L.payload=f,v!=null&&(L.callback=v),f=Do(o,L,R),f!==null&&(Ta(f,o,R),ul(f,o,R))},enqueueReplaceState:function(o,f,v){o=o._reactInternals;var R=xs(),L=cl(R);L.tag=1,L.payload=f,v!=null&&(L.callback=v),f=Do(o,L,R),f!==null&&(Ta(f,o,R),ul(f,o,R))},enqueueForceUpdate:function(o,f){o=o._reactInternals;var v=xs(),R=cl(v);R.tag=2,f!=null&&(R.callback=f),f=Do(o,R,v),f!==null&&(Ta(f,o,v),ul(f,o,v))}};function Qn(o,f,v,R,L,q,ne){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(R,q,ne):f.prototype&&f.prototype.isPureReactComponent?!ha(v,R)||!ha(L,q):!0}function ia(o,f,v,R){o=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(v,R),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(v,R),f.state!==o&&gc.enqueueReplaceState(f,f.state,null)}function xa(o,f){var v=f;if("ref"in f){v={};for(var R in f)R!=="ref"&&(v[R]=f[R])}if(o=o.defaultProps){v===f&&(v=He({},v));for(var L in o)v[L]===void 0&&(v[L]=o[L])}return v}var Tl=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function If(o){Tl(o)}function Cf(o){console.error(o)}function du(o){Tl(o)}function fu(o,f){try{var v=o.onUncaughtError;v(f.value,{componentStack:f.stack})}catch(R){setTimeout(function(){throw R})}}function Lp(o,f,v){try{var R=o.onCaughtError;R(v.value,{componentStack:v.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(L){setTimeout(function(){throw L})}}function bh(o,f,v){return v=cl(v),v.tag=3,v.payload={element:null},v.callback=function(){fu(o,f)},v}function Sd(o){return o=cl(o),o.tag=3,o}function pu(o,f,v,R){var L=v.type.getDerivedStateFromError;if(typeof L=="function"){var q=R.value;o.payload=function(){return L(q)},o.callback=function(){Lp(f,v,R)}}var ne=v.stateNode;ne!==null&&typeof ne.componentDidCatch=="function"&&(o.callback=function(){Lp(f,v,R),typeof L!="function"&&(Dr===null?Dr=new Set([this]):Dr.add(this));var ve=R.stack;this.componentDidCatch(R.value,{componentStack:ve!==null?ve:""})})}function yc(o,f,v,R,L){if(v.flags|=32768,R!==null&&typeof R=="object"&&typeof R.then=="function"){if(f=v.alternate,f!==null&&sl(f,v,L,!0),v=dn.current,v!==null){switch(v.tag){case 13:return ka===null?Cl():v.alternate===null&&fn===0&&(fn=3),v.flags&=-257,v.flags|=65536,v.lanes=L,R===nd?v.flags|=16384:(f=v.updateQueue,f===null?v.updateQueue=new Set([R]):f.add(R),kf(o,R,L)),!1;case 22:return v.flags|=65536,R===nd?v.flags|=16384:(f=v.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([R])},v.updateQueue=f):(v=f.retryQueue,v===null?f.retryQueue=new Set([R]):v.add(R)),kf(o,R,L)),!1}throw Error(D(435,v.tag))}return kf(o,R,L),Cl(),!1}if(On)return f=dn.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=L,R!==Yh&&(o=Error(D(422),{cause:R}),ih(gs(o,v)))):(R!==Yh&&(f=Error(D(423),{cause:R}),ih(gs(f,v))),o=o.current.alternate,o.flags|=65536,L&=-L,o.lanes|=L,R=gs(R,v),L=bh(o.stateNode,R,L),oh(o,L),fn!==4&&(fn=2)),!1;var q=Error(D(520),{cause:R});if(q=gs(q,v),Wi===null?Wi=[q]:Wi.push(q),fn!==4&&(fn=2),f===null)return!0;R=gs(R,v),v=f;do{switch(v.tag){case 3:return v.flags|=65536,o=L&-L,v.lanes|=o,o=bh(v.stateNode,R,o),oh(v,o),!1;case 1:if(f=v.type,q=v.stateNode,(v.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Dr===null||!Dr.has(q))))return v.flags|=65536,L&=-L,v.lanes|=L,L=Sd(L),pu(L,o,v,R),oh(v,L),!1}v=v.return}while(v!==null);return!1}var ho=Error(D(461)),Xn=!1;function dr(o,f,v,R){f.child=o===null?Pp(f,null,v,R):hu(f,o.child,v,R)}function Sl(o,f,v,R,L){v=v.render;var q=f.ref;if("ref"in R){var ne={};for(var ve in R)ve!=="ref"&&(ne[ve]=R[ve])}else ne=R;return Mo(f),R=pl(o,f,v,ne,q,L),ve=ml(),o!==null&&!Xn?(Bn(o,f,L),vs(o,f,L)):(On&&ve&&Ju(f),f.flags|=1,dr(o,f,R,L),f.child)}function Lo(o,f,v,R,L){if(o===null){var q=v.type;return typeof q=="function"&&!yf(q)&&q.defaultProps===void 0&&v.compare===null?(f.tag=15,f.type=q,kp(o,f,q,R,L)):(o=Jc(v.type,null,R,f,f.mode,L),o.ref=f.ref,o.return=f,f.child=o)}if(q=o.child,!Df(o,L)){var ne=q.memoizedProps;if(v=v.compare,v=v!==null?v:ha,v(ne,R)&&o.ref===f.ref)return vs(o,f,L)}return f.flags|=1,o=xn(q,R),o.ref=f.ref,o.return=f,f.child=o}function kp(o,f,v,R,L){if(o!==null){var q=o.memoizedProps;if(ha(q,R)&&o.ref===f.ref)if(Xn=!1,f.pendingProps=R=q,Df(o,L))(o.flags&131072)!==0&&(Xn=!0);else return f.lanes=o.lanes,vs(o,f,L)}return Ed(o,f,v,R,L)}function Bp(o,f,v){var R=f.pendingProps,L=R.children,q=o!==null?o.memoizedState:null;if(R.mode==="hidden"){if((f.flags&128)!==0){if(R=q!==null?q.baseLanes|v:v,o!==null){for(L=f.child=o.child,q=0;L!==null;)q=q|L.lanes|L.childLanes,L=L.sibling;f.childLanes=q&~R}else f.childLanes=0,f.child=null;return Np(o,f,R,v)}if((v&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},o!==null&&tu(f,q!==null?q.cachePool:null),q!==null?od(f,q):ls(),Op(f);else return f.lanes=f.childLanes=536870912,Np(o,f,q!==null?q.baseLanes|v:v,v)}else q!==null?(tu(f,q.cachePool),od(f,q),ya(),f.memoizedState=null):(o!==null&&tu(f,null),ls(),ya());return dr(o,f,L,v),f.child}function Np(o,f,v,R){var L=ol();return L=L===null?null:{parent:br._currentValue,pool:L},f.memoizedState={baseLanes:v,cachePool:L},o!==null&&tu(f,null),ls(),Op(f),o!==null&&sl(o,f,R,!0),null}function vc(o,f){var v=f.ref;if(v===null)o!==null&&o.ref!==null&&(f.flags|=4194816);else{if(typeof v!="function"&&typeof v!="object")throw Error(D(284));(o===null||o.ref!==v)&&(f.flags|=4194816)}}function Ed(o,f,v,R,L){return Mo(f),v=pl(o,f,v,R,void 0,L),R=ml(),o!==null&&!Xn?(Bn(o,f,L),vs(o,f,L)):(On&&R&&Ju(f),f.flags|=1,dr(o,f,v,L),f.child)}function us(o,f,v,R,L,q){return Mo(f),f.updateQueue=null,v=yt(f,R,v,L),uc(o),R=ml(),o!==null&&!Xn?(Bn(o,f,q),vs(o,f,q)):(On&&R&&Ju(f),f.flags|=1,dr(o,f,v,q),f.child)}function xc(o,f,v,R,L){if(Mo(f),f.stateNode===null){var q=Jl,ne=v.contextType;typeof ne=="object"&&ne!==null&&(q=hr(ne)),q=new v(R,q),f.memoizedState=q.state!==null&&q.state!==void 0?q.state:null,q.updater=gc,f.stateNode=q,q._reactInternals=f,q=f.stateNode,q.props=R,q.state=f.memoizedState,q.refs={},Yt(f),ne=v.contextType,q.context=typeof ne=="object"&&ne!==null?hr(ne):Jl,q.state=f.memoizedState,ne=v.getDerivedStateFromProps,typeof ne=="function"&&(va(f,v,ne,R),q.state=f.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof q.getSnapshotBeforeUpdate=="function"||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(ne=q.state,typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount(),ne!==q.state&&gc.enqueueReplaceState(q,q.state,null),lc(f,R,q,L),hl(),q.state=f.memoizedState),typeof q.componentDidMount=="function"&&(f.flags|=4194308),R=!0}else if(o===null){q=f.stateNode;var ve=f.memoizedProps,Ve=xa(v,ve);q.props=Ve;var ht=q.context,Rt=v.contextType;ne=Jl,typeof Rt=="object"&&Rt!==null&&(ne=hr(Rt));var Bt=v.getDerivedStateFromProps;Rt=typeof Bt=="function"||typeof q.getSnapshotBeforeUpdate=="function",ve=f.pendingProps!==ve,Rt||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(ve||ht!==ne)&&ia(f,q,R,ne),Nr=!1;var ft=f.memoizedState;q.state=ft,lc(f,R,q,L),hl(),ht=f.memoizedState,ve||ft!==ht||Nr?(typeof Bt=="function"&&(va(f,v,Bt,R),ht=f.memoizedState),(Ve=Nr||Qn(f,v,Ve,R,ft,ht,ne))?(Rt||typeof q.UNSAFE_componentWillMount!="function"&&typeof q.componentWillMount!="function"||(typeof q.componentWillMount=="function"&&q.componentWillMount(),typeof q.UNSAFE_componentWillMount=="function"&&q.UNSAFE_componentWillMount()),typeof q.componentDidMount=="function"&&(f.flags|=4194308)):(typeof q.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=R,f.memoizedState=ht),q.props=R,q.state=ht,q.context=ne,R=Ve):(typeof q.componentDidMount=="function"&&(f.flags|=4194308),R=!1)}else{q=f.stateNode,ah(o,f),ne=f.memoizedProps,Rt=xa(v,ne),q.props=Rt,Bt=f.pendingProps,ft=q.context,ht=v.contextType,Ve=Jl,typeof ht=="object"&&ht!==null&&(Ve=hr(ht)),ve=v.getDerivedStateFromProps,(ht=typeof ve=="function"||typeof q.getSnapshotBeforeUpdate=="function")||typeof q.UNSAFE_componentWillReceiveProps!="function"&&typeof q.componentWillReceiveProps!="function"||(ne!==Bt||ft!==Ve)&&ia(f,q,R,Ve),Nr=!1,ft=f.memoizedState,q.state=ft,lc(f,R,q,L),hl();var _t=f.memoizedState;ne!==Bt||ft!==_t||Nr||o!==null&&o.dependencies!==null&&zs(o.dependencies)?(typeof ve=="function"&&(va(f,v,ve,R),_t=f.memoizedState),(Rt=Nr||Qn(f,v,Rt,R,ft,_t,Ve)||o!==null&&o.dependencies!==null&&zs(o.dependencies))?(ht||typeof q.UNSAFE_componentWillUpdate!="function"&&typeof q.componentWillUpdate!="function"||(typeof q.componentWillUpdate=="function"&&q.componentWillUpdate(R,_t,Ve),typeof q.UNSAFE_componentWillUpdate=="function"&&q.UNSAFE_componentWillUpdate(R,_t,Ve)),typeof q.componentDidUpdate=="function"&&(f.flags|=4),typeof q.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof q.componentDidUpdate!="function"||ne===o.memoizedProps&&ft===o.memoizedState||(f.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ne===o.memoizedProps&&ft===o.memoizedState||(f.flags|=1024),f.memoizedProps=R,f.memoizedState=_t),q.props=R,q.state=_t,q.context=Ve,R=Rt):(typeof q.componentDidUpdate!="function"||ne===o.memoizedProps&&ft===o.memoizedState||(f.flags|=4),typeof q.getSnapshotBeforeUpdate!="function"||ne===o.memoizedProps&&ft===o.memoizedState||(f.flags|=1024),R=!1)}return q=R,vc(o,f),R=(f.flags&128)!==0,q||R?(q=f.stateNode,v=R&&typeof v.getDerivedStateFromError!="function"?null:q.render(),f.flags|=1,o!==null&&R?(f.child=hu(f,o.child,null,L),f.child=hu(f,null,v,L)):dr(o,f,v,L),f.memoizedState=q.state,o=f.child):o=vs(o,f,L),o}function Rf(o,f,v,R){return th(),f.flags|=256,dr(o,f,v,R),f.child}var Ad={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function El(o){return{baseLanes:o,cachePool:rh()}}function mu(o,f,v){return o=o!==null?o.childLanes&~v:0,f&&(o|=Ri),o}function Xs(o,f,v){var R=f.pendingProps,L=!1,q=(f.flags&128)!==0,ne;if((ne=q)||(ne=o!==null&&o.memoizedState===null?!1:(yr.current&2)!==0),ne&&(L=!0,f.flags&=-129),ne=(f.flags&32)!==0,f.flags&=-33,o===null){if(On){if(L?uo(f):ya(),On){var ve=ur,Ve;if(Ve=ve){e:{for(Ve=ve,ve=Oa;Ve.nodeType!==8;){if(!ve){ve=null;break e}if(Ve=Ua(Ve.nextSibling),Ve===null){ve=null;break e}}ve=Ve}ve!==null?(f.memoizedState={dehydrated:ve,treeContext:Hr!==null?{id:Pa,overflow:pa}:null,retryLane:536870912,hydrationErrors:null},Ve=Ds(18,null,null,0),Ve.stateNode=ve,Ve.return=f,f.child=Ve,es=f,ur=null,Ve=!0):Ve=!1}Ve||ma(f)}if(ve=f.memoizedState,ve!==null&&(ve=ve.dehydrated,ve!==null))return sm(ve)?f.lanes=32:f.lanes=536870912,null;Ba(f)}return ve=R.children,R=R.fallback,L?(ya(),L=f.mode,ve=ko({mode:"hidden",children:ve},L),R=Eo(R,L,v,null),ve.return=f,R.return=f,ve.sibling=R,f.child=ve,L=f.child,L.memoizedState=El(v),L.childLanes=mu(o,ne,v),f.memoizedState=Ad,R):(uo(f),Bs(f,ve))}if(Ve=o.memoizedState,Ve!==null&&(ve=Ve.dehydrated,ve!==null)){if(q)f.flags&256?(uo(f),f.flags&=-257,f=Bo(o,f,v)):f.memoizedState!==null?(ya(),f.child=o.child,f.flags|=128,f=null):(ya(),L=R.fallback,ve=f.mode,R=ko({mode:"visible",children:R.children},ve),L=Eo(L,ve,v,null),L.flags|=2,R.return=f,L.return=f,R.sibling=L,f.child=R,hu(f,o.child,null,v),R=f.child,R.memoizedState=El(v),R.childLanes=mu(o,ne,v),f.memoizedState=Ad,f=L);else if(uo(f),sm(ve)){if(ne=ve.nextSibling&&ve.nextSibling.dataset,ne)var ht=ne.dgst;ne=ht,R=Error(D(419)),R.stack="",R.digest=ne,ih({value:R,source:null,stack:null}),f=Bo(o,f,v)}else if(Xn||sl(o,f,v,!1),ne=(v&o.childLanes)!==0,Xn||ne){if(ne=ii,ne!==null&&(R=v&-v,R=(R&42)!==0?1:jc(R),R=(R&(ne.suspendedLanes|v))!==0?0:R,R!==0&&R!==Ve.retryLane))throw Ve.retryLane=R,Rs(o,R),Ta(ne,o,R),ho;ve.data==="$?"||Cl(),f=Bo(o,f,v)}else ve.data==="$?"?(f.flags|=192,f.child=o.child,f=null):(o=Ve.treeContext,ur=Ua(ve.nextSibling),es=f,On=!0,no=null,Oa=!1,o!==null&&(ys[ea++]=Pa,ys[ea++]=pa,ys[ea++]=Hr,Pa=o.id,pa=o.overflow,Hr=f),f=Bs(f,R.children),f.flags|=4096);return f}return L?(ya(),L=R.fallback,ve=f.mode,Ve=o.child,ht=Ve.sibling,R=xn(Ve,{mode:"hidden",children:R.children}),R.subtreeFlags=Ve.subtreeFlags&65011712,ht!==null?L=xn(ht,L):(L=Eo(L,ve,v,null),L.flags|=2),L.return=f,R.return=f,R.sibling=L,f.child=R,R=L,L=f.child,ve=o.child.memoizedState,ve===null?ve=El(v):(Ve=ve.cachePool,Ve!==null?(ht=br._currentValue,Ve=Ve.parent!==ht?{parent:ht,pool:ht}:Ve):Ve=rh(),ve={baseLanes:ve.baseLanes|v,cachePool:Ve}),L.memoizedState=ve,L.childLanes=mu(o,ne,v),f.memoizedState=Ad,R):(uo(f),v=o.child,o=v.sibling,v=xn(v,{mode:"visible",children:R.children}),v.return=f,v.sibling=null,o!==null&&(ne=f.deletions,ne===null?(f.deletions=[o],f.flags|=16):ne.push(o)),f.child=v,f.memoizedState=null,v)}function Bs(o,f){return f=ko({mode:"visible",children:f},o.mode),f.return=o,o.child=f}function ko(o,f){return o=Ds(22,o,null,f),o.lanes=0,o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},o}function Bo(o,f,v){return hu(f,o.child,null,v),o=Bs(f,f.pendingProps.children),o.flags|=2,f.memoizedState=null,o}function Al(o,f,v){o.lanes|=f;var R=o.alternate;R!==null&&(R.lanes|=f),Kh(o.return,f,v)}function wh(o,f,v,R,L){var q=o.memoizedState;q===null?o.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:R,tail:v,tailMode:L}:(q.isBackwards=f,q.rendering=null,q.renderingStartTime=0,q.last=R,q.tail=v,q.tailMode=L)}function rn(o,f,v){var R=f.pendingProps,L=R.revealOrder,q=R.tail;if(dr(o,f,R.children,v),R=yr.current,(R&2)!==0)R=R&1|2,f.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=f.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&Al(o,v,f);else if(o.tag===19)Al(o,v,f);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===f)break e;for(;o.sibling===null;){if(o.return===null||o.return===f)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}R&=1}switch(Tt(yr,R),L){case"forwards":for(v=f.child,L=null;v!==null;)o=v.alternate,o!==null&&_c(o)===null&&(L=v),v=v.sibling;v=L,v===null?(L=f.child,f.child=null):(L=v.sibling,v.sibling=null),wh(f,!1,L,v,q);break;case"backwards":for(v=null,L=f.child,f.child=null;L!==null;){if(o=L.alternate,o!==null&&_c(o)===null){f.child=L;break}o=L.sibling,L.sibling=v,v=L,L=o}wh(f,!0,v,null,q);break;case"together":wh(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function vs(o,f,v){if(o!==null&&(f.dependencies=o.dependencies),Wn|=f.lanes,(v&f.childLanes)===0)if(o!==null){if(sl(o,f,v,!1),(v&f.childLanes)===0)return null}else return null;if(o!==null&&f.child!==o.child)throw Error(D(153));if(f.child!==null){for(o=f.child,v=xn(o,o.pendingProps),f.child=v,v.return=f;o.sibling!==null;)o=o.sibling,v=v.sibling=xn(o,o.pendingProps),v.return=f;v.sibling=null}return f.child}function Df(o,f){return(o.lanes&f)!==0?!0:(o=o.dependencies,!!(o!==null&&zs(o)))}function Jm(o,f,v){switch(f.tag){case 3:qn(f,f.stateNode.containerInfo),ta(f,br,o.memoizedState.cache),th();break;case 27:case 5:ue(f);break;case 4:qn(f,f.stateNode.containerInfo);break;case 10:ta(f,f.type,f.memoizedProps.value);break;case 13:var R=f.memoizedState;if(R!==null)return R.dehydrated!==null?(uo(f),f.flags|=128,null):(v&f.child.childLanes)!==0?Xs(o,f,v):(uo(f),o=vs(o,f,v),o!==null?o.sibling:null);uo(f);break;case 19:var L=(o.flags&128)!==0;if(R=(v&f.childLanes)!==0,R||(sl(o,f,v,!1),R=(v&f.childLanes)!==0),L){if(R)return rn(o,f,v);f.flags|=128}if(L=f.memoizedState,L!==null&&(L.rendering=null,L.tail=null,L.lastEffect=null),Tt(yr,yr.current),R)break;return null;case 22:case 23:return f.lanes=0,Bp(o,f,v);case 24:ta(f,br,o.memoizedState.cache)}return vs(o,f,v)}function Th(o,f,v){if(o!==null)if(o.memoizedProps!==f.pendingProps)Xn=!0;else{if(!Df(o,v)&&(f.flags&128)===0)return Xn=!1,Jm(o,f,v);Xn=(o.flags&131072)!==0}else Xn=!1,On&&(f.flags&1048576)!==0&&Wh(f,rl,f.index);switch(f.lanes=0,f.tag){case 16:e:{o=f.pendingProps;var R=f.elementType,L=R._init;if(R=L(R._payload),f.type=R,typeof R=="function")yf(R)?(o=xa(R,o),f.tag=1,f=xc(null,f,R,o,v)):(f.tag=0,f=Ed(null,f,R,o,v));else{if(R!=null){if(L=R.$$typeof,L===$t){f.tag=11,f=Sl(null,f,R,o,v);break e}else if(L===Gt){f.tag=14,f=Lo(null,f,R,o,v);break e}}throw f=Ss(R)||R,Error(D(306,f,""))}}return f;case 0:return Ed(o,f,f.type,f.pendingProps,v);case 1:return R=f.type,L=xa(R,f.pendingProps),xc(o,f,R,L,v);case 3:e:{if(qn(f,f.stateNode.containerInfo),o===null)throw Error(D(387));R=f.pendingProps;var q=f.memoizedState;L=q.element,ah(o,f),lc(f,R,null,v);var ne=f.memoizedState;if(R=ne.cache,ta(f,br,R),R!==q.cache&&nh(f,[br],v,!0),hl(),R=ne.element,q.isDehydrated)if(q={element:R,isDehydrated:!1,cache:ne.cache},f.updateQueue.baseState=q,f.memoizedState=q,f.flags&256){f=Rf(o,f,R,v);break e}else if(R!==L){L=gs(Error(D(424)),f),ih(L),f=Rf(o,f,R,v);break e}else{switch(o=f.stateNode.containerInfo,o.nodeType){case 9:o=o.body;break;default:o=o.nodeName==="HTML"?o.ownerDocument.body:o}for(ur=Ua(o.firstChild),es=f,On=!0,no=null,Oa=!0,v=Pp(f,null,R,v),f.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling}else{if(th(),R===L){f=vs(o,f,v);break e}dr(o,f,R,v)}f=f.child}return f;case 26:return vc(o,f),o===null?(v=m_(f.type,null,f.pendingProps,null))?f.memoizedState=v:On||(v=f.type,o=f.pendingProps,R=Ff(Li.current).createElement(v),R[me]=f,R[Se]=o,bs(R,v,o),ai(R),f.stateNode=R):f.memoizedState=m_(f.type,o.memoizedProps,f.pendingProps,o.memoizedState),null;case 27:return ue(f),o===null&&On&&(R=f.stateNode=d_(f.type,f.pendingProps,Li.current),es=f,Oa=!0,L=ur,Ec(f.type)?(am=L,ur=Ua(R.firstChild)):ur=L),dr(o,f,f.pendingProps.children,v),vc(o,f),o===null&&(f.flags|=4194304),f.child;case 5:return o===null&&On&&((L=R=ur)&&(R=Cg(R,f.type,f.pendingProps,Oa),R!==null?(f.stateNode=R,es=f,ur=Ua(R.firstChild),Oa=!1,L=!0):L=!1),L||ma(f)),ue(f),L=f.type,q=f.pendingProps,ne=o!==null?o.memoizedProps:null,R=q.children,l_(L,q)?R=null:ne!==null&&l_(L,ne)&&(f.flags|=32),f.memoizedState!==null&&(L=pl(o,f,Lt,null,null,v),Zf._currentValue=L),vc(o,f),dr(o,f,R,v),f.child;case 6:return o===null&&On&&((o=v=ur)&&(v=rm(v,f.pendingProps,Oa),v!==null?(f.stateNode=v,es=f,ur=null,o=!0):o=!1),o||ma(f)),null;case 13:return Xs(o,f,v);case 4:return qn(f,f.stateNode.containerInfo),R=f.pendingProps,o===null?f.child=hu(f,null,R,v):dr(o,f,R,v),f.child;case 11:return Sl(o,f,f.type,f.pendingProps,v);case 7:return dr(o,f,f.pendingProps,v),f.child;case 8:return dr(o,f,f.pendingProps.children,v),f.child;case 12:return dr(o,f,f.pendingProps.children,v),f.child;case 10:return R=f.pendingProps,ta(f,f.type,R.value),dr(o,f,R.children,v),f.child;case 9:return L=f.type._context,R=f.pendingProps.children,Mo(f),L=hr(L),R=R(L),f.flags|=1,dr(o,f,R,v),f.child;case 14:return Lo(o,f,f.type,f.pendingProps,v);case 15:return kp(o,f,f.type,f.pendingProps,v);case 19:return rn(o,f,v);case 31:return R=f.pendingProps,v=f.mode,R={mode:R.mode,children:R.children},o===null?(v=ko(R,v),v.ref=f.ref,f.child=v,v.return=f,f=v):(v=xn(o.child,R),v.ref=f.ref,f.child=v,v.return=f,f=v),f;case 22:return Bp(o,f,v);case 24:return Mo(f),R=hr(br),o===null?(L=ol(),L===null&&(L=ii,q=Qh(),L.pooledCache=q,q.refCount++,q!==null&&(L.pooledCacheLanes|=v),L=q),f.memoizedState={parent:R,cache:L},Yt(f),ta(f,br,L)):((o.lanes&v)!==0&&(ah(o,f),lc(f,null,null,v),hl()),L=o.memoizedState,q=f.memoizedState,L.parent!==R?(L={parent:R,cache:R},f.memoizedState=L,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=L),ta(f,br,R)):(R=q.cache,ta(f,br,R),R!==L.cache&&nh(f,[br],v,!0))),dr(o,f,f.pendingProps.children,v),f.child;case 29:throw f.pendingProps}throw Error(D(156,f.tag))}function is(o){o.flags|=4}function Zr(o,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!x_(f)){if(f=dn.current,f!==null&&((Ht&4194048)===Ht?ka!==null:(Ht&62914560)!==Ht&&(Ht&536870912)===0||f!==ka))throw oc=nd,iu;o.flags|=8192}}function Cr(o,f){f!==null&&(o.flags|=4),o.flags&16384&&(f=o.tag!==22?Bl():536870912,o.lanes|=f,Sn|=f)}function ns(o,f){if(!On)switch(o.tailMode){case"hidden":f=o.tail;for(var v=null;f!==null;)f.alternate!==null&&(v=f),f=f.sibling;v===null?o.tail=null:v.sibling=null;break;case"collapsed":v=o.tail;for(var R=null;v!==null;)v.alternate!==null&&(R=v),v=v.sibling;R===null?f||o.tail===null?o.tail=null:o.tail.sibling=null:R.sibling=null}}function yn(o){var f=o.alternate!==null&&o.alternate.child===o.child,v=0,R=0;if(f)for(var L=o.child;L!==null;)v|=L.lanes|L.childLanes,R|=L.subtreeFlags&65011712,R|=L.flags&65011712,L.return=o,L=L.sibling;else for(L=o.child;L!==null;)v|=L.lanes|L.childLanes,R|=L.subtreeFlags,R|=L.flags,L.return=o,L=L.sibling;return o.subtreeFlags|=R,o.childLanes=v,f}function zf(o,f,v){var R=f.pendingProps;switch(Qu(f),f.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yn(f),null;case 1:return yn(f),null;case 3:return v=f.stateNode,R=null,o!==null&&(R=o.memoizedState.cache),f.memoizedState.cache!==R&&(f.flags|=2048),ro(br),Ws(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(o===null||o.child===null)&&(eh(f)?is(f):o===null||o.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Ip())),yn(f),null;case 26:return v=f.memoizedState,o===null?(is(f),v!==null?(yn(f),Zr(f,v)):(yn(f),f.flags&=-16777217)):v?v!==o.memoizedState?(is(f),yn(f),Zr(f,v)):(yn(f),f.flags&=-16777217):(o.memoizedProps!==R&&is(f),yn(f),f.flags&=-16777217),null;case 27:Ha(f),v=Li.current;var L=f.type;if(o!==null&&f.stateNode!=null)o.memoizedProps!==R&&is(f);else{if(!R){if(f.stateNode===null)throw Error(D(166));return yn(f),null}o=Fi.current,eh(f)?Ap(f):(o=d_(L,R,v),f.stateNode=o,is(f))}return yn(f),null;case 5:if(Ha(f),v=f.type,o!==null&&f.stateNode!=null)o.memoizedProps!==R&&is(f);else{if(!R){if(f.stateNode===null)throw Error(D(166));return yn(f),null}if(o=Fi.current,eh(f))Ap(f);else{switch(L=Ff(Li.current),o){case 1:o=L.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:o=L.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":o=L.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":o=L.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":o=L.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof R.is=="string"?L.createElement("select",{is:R.is}):L.createElement("select"),R.multiple?o.multiple=!0:R.size&&(o.size=R.size);break;default:o=typeof R.is=="string"?L.createElement(v,{is:R.is}):L.createElement(v)}}o[me]=f,o[Se]=R;e:for(L=f.child;L!==null;){if(L.tag===5||L.tag===6)o.appendChild(L.stateNode);else if(L.tag!==4&&L.tag!==27&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===f)break e;for(;L.sibling===null;){if(L.return===null||L.return===f)break e;L=L.return}L.sibling.return=L.return,L=L.sibling}f.stateNode=o;e:switch(bs(o,v,R),v){case"button":case"input":case"select":case"textarea":o=!!R.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&is(f)}}return yn(f),f.flags&=-16777217,null;case 6:if(o&&f.stateNode!=null)o.memoizedProps!==R&&is(f);else{if(typeof R!="string"&&f.stateNode===null)throw Error(D(166));if(o=Li.current,eh(f)){if(o=f.stateNode,v=f.memoizedProps,R=null,L=es,L!==null)switch(L.tag){case 27:case 5:R=L.memoizedProps}o[me]=f,o=!!(o.nodeValue===v||R!==null&&R.suppressHydrationWarning===!0||tm(o.nodeValue,v)),o||ma(f)}else o=Ff(o).createTextNode(R),o[me]=f,f.stateNode=o}return yn(f),null;case 13:if(R=f.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(L=eh(f),R!==null&&R.dehydrated!==null){if(o===null){if(!L)throw Error(D(318));if(L=f.memoizedState,L=L!==null?L.dehydrated:null,!L)throw Error(D(317));L[me]=f}else th(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;yn(f),L=!1}else L=Ip(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=L),L=!0;if(!L)return f.flags&256?(Ba(f),f):(Ba(f),null)}if(Ba(f),(f.flags&128)!==0)return f.lanes=v,f;if(v=R!==null,o=o!==null&&o.memoizedState!==null,v){R=f.child,L=null,R.alternate!==null&&R.alternate.memoizedState!==null&&R.alternate.memoizedState.cachePool!==null&&(L=R.alternate.memoizedState.cachePool.pool);var q=null;R.memoizedState!==null&&R.memoizedState.cachePool!==null&&(q=R.memoizedState.cachePool.pool),q!==L&&(R.flags|=2048)}return v!==o&&v&&(f.child.flags|=8192),Cr(f,f.updateQueue),yn(f),null;case 4:return Ws(),o===null&&em(f.stateNode.containerInfo),yn(f),null;case 10:return ro(f.type),yn(f),null;case 19:if(_i(yr),L=f.memoizedState,L===null)return yn(f),null;if(R=(f.flags&128)!==0,q=L.rendering,q===null)if(R)ns(L,!1);else{if(fn!==0||o!==null&&(o.flags&128)!==0)for(o=f.child;o!==null;){if(q=_c(o),q!==null){for(f.flags|=128,ns(L,!1),o=q.updateQueue,f.updateQueue=o,Cr(f,o),f.subtreeFlags=0,o=v,v=f.child;v!==null;)Ep(v,o),v=v.sibling;return Tt(yr,yr.current&1|2),f.child}o=o.sibling}L.tail!==null&&jr()>ar&&(f.flags|=128,R=!0,ns(L,!1),f.lanes=4194304)}else{if(!R)if(o=_c(q),o!==null){if(f.flags|=128,R=!0,o=o.updateQueue,f.updateQueue=o,Cr(f,o),ns(L,!0),L.tail===null&&L.tailMode==="hidden"&&!q.alternate&&!On)return yn(f),null}else 2*jr()-L.renderingStartTime>ar&&v!==536870912&&(f.flags|=128,R=!0,ns(L,!1),f.lanes=4194304);L.isBackwards?(q.sibling=f.child,f.child=q):(o=L.last,o!==null?o.sibling=q:f.child=q,L.last=q)}return L.tail!==null?(f=L.tail,L.rendering=f,L.tail=f.sibling,L.renderingStartTime=jr(),f.sibling=null,o=yr.current,Tt(yr,R?o&1|2:o&1),f):(yn(f),null);case 22:case 23:return Ba(f),so(),R=f.memoizedState!==null,o!==null?o.memoizedState!==null!==R&&(f.flags|=8192):R&&(f.flags|=8192),R?(v&536870912)!==0&&(f.flags&128)===0&&(yn(f),f.subtreeFlags&6&&(f.flags|=8192)):yn(f),v=f.updateQueue,v!==null&&Cr(f,v.retryQueue),v=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(v=o.memoizedState.cachePool.pool),R=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(R=f.memoizedState.cachePool.pool),R!==v&&(f.flags|=2048),o!==null&&_i(Co),null;case 24:return v=null,o!==null&&(v=o.memoizedState.cache),f.memoizedState.cache!==v&&(f.flags|=2048),ro(br),yn(f),null;case 25:return null;case 30:return null}throw Error(D(156,f.tag))}function Ns(o,f){switch(Qu(f),f.tag){case 1:return o=f.flags,o&65536?(f.flags=o&-65537|128,f):null;case 3:return ro(br),Ws(),o=f.flags,(o&65536)!==0&&(o&128)===0?(f.flags=o&-65537|128,f):null;case 26:case 27:case 5:return Ha(f),null;case 13:if(Ba(f),o=f.memoizedState,o!==null&&o.dehydrated!==null){if(f.alternate===null)throw Error(D(340));th()}return o=f.flags,o&65536?(f.flags=o&-65537|128,f):null;case 19:return _i(yr),null;case 4:return Ws(),null;case 10:return ro(f.type),null;case 22:case 23:return Ba(f),so(),o!==null&&_i(Co),o=f.flags,o&65536?(f.flags=o&-65537|128,f):null;case 24:return ro(br),null;case 25:return null;default:return null}}function Pf(o,f){switch(Qu(f),f.tag){case 3:ro(br),Ws();break;case 26:case 27:case 5:Ha(f);break;case 4:Ws();break;case 13:Ba(f);break;case 19:_i(yr);break;case 10:ro(f.type);break;case 22:case 23:Ba(f),so(),o!==null&&_i(Co);break;case 24:ro(br)}}function ba(o,f){try{var v=f.updateQueue,R=v!==null?v.lastEffect:null;if(R!==null){var L=R.next;v=L;do{if((v.tag&o)===o){R=void 0;var q=v.create,ne=v.inst;R=q(),ne.destroy=R}v=v.next}while(v!==L)}}catch(ve){or(f,f.return,ve)}}function Ml(o,f,v){try{var R=f.updateQueue,L=R!==null?R.lastEffect:null;if(L!==null){var q=L.next;R=q;do{if((R.tag&o)===o){var ne=R.inst,ve=ne.destroy;if(ve!==void 0){ne.destroy=void 0,L=f;var Ve=v,ht=ve;try{ht()}catch(Rt){or(L,Ve,Rt)}}}R=R.next}while(R!==q)}}catch(Rt){or(f,f.return,Rt)}}function h(o){var f=o.updateQueue;if(f!==null){var v=o.stateNode;try{ad(f,v)}catch(R){or(o,o.return,R)}}}function t(o,f,v){v.props=xa(o.type,o.memoizedProps),v.state=o.memoizedState;try{v.componentWillUnmount()}catch(R){or(o,f,R)}}function n(o,f){try{var v=o.ref;if(v!==null){switch(o.tag){case 26:case 27:case 5:var R=o.stateNode;break;case 30:R=o.stateNode;break;default:R=o.stateNode}typeof v=="function"?o.refCleanup=v(R):v.current=R}}catch(L){or(o,f,L)}}function u(o,f){var v=o.ref,R=o.refCleanup;if(v!==null)if(typeof R=="function")try{R()}catch(L){or(o,f,L)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof v=="function")try{v(null)}catch(L){or(o,f,L)}else v.current=null}function p(o){var f=o.type,v=o.memoizedProps,R=o.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":v.autoFocus&&R.focus();break e;case"img":v.src?R.src=v.src:v.srcSet&&(R.srcset=v.srcSet)}}catch(L){or(o,o.return,L)}}function g(o,f,v){try{var R=o.stateNode;Sg(R,o.type,v,f),R[Se]=f}catch(L){or(o,o.return,L)}}function x(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&Ec(o.type)||o.tag===4}function C(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||x(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&Ec(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function P(o,f,v){var R=o.tag;if(R===5||R===6)o=o.stateNode,f?(v.nodeType===9?v.body:v.nodeName==="HTML"?v.ownerDocument.body:v).insertBefore(o,f):(f=v.nodeType===9?v.body:v.nodeName==="HTML"?v.ownerDocument.body:v,f.appendChild(o),v=v._reactRootContainer,v!=null||f.onclick!==null||(f.onclick=Od));else if(R!==4&&(R===27&&Ec(o.type)&&(v=o.stateNode,f=null),o=o.child,o!==null))for(P(o,f,v),o=o.sibling;o!==null;)P(o,f,v),o=o.sibling}function O(o,f,v){var R=o.tag;if(R===5||R===6)o=o.stateNode,f?v.insertBefore(o,f):v.appendChild(o);else if(R!==4&&(R===27&&Ec(o.type)&&(v=o.stateNode),o=o.child,o!==null))for(O(o,f,v),o=o.sibling;o!==null;)O(o,f,v),o=o.sibling}function k(o){var f=o.stateNode,v=o.memoizedProps;try{for(var R=o.type,L=f.attributes;L.length;)f.removeAttributeNode(L[0]);bs(f,R,v),f[me]=o,f[Se]=v}catch(q){or(o,o.return,q)}}var U=!1,F=!1,Z=!1,Y=typeof WeakSet=="function"?WeakSet:Set,X=null;function J(o,f){if(o=o.containerInfo,Nf=hm,o=Tp(o),Hu(o)){if("selectionStart"in o)var v={start:o.selectionStart,end:o.selectionEnd};else e:{v=(v=o.ownerDocument)&&v.defaultView||window;var R=v.getSelection&&v.getSelection();if(R&&R.rangeCount!==0){v=R.anchorNode;var L=R.anchorOffset,q=R.focusNode;R=R.focusOffset;try{v.nodeType,q.nodeType}catch{v=null;break e}var ne=0,ve=-1,Ve=-1,ht=0,Rt=0,Bt=o,ft=null;t:for(;;){for(var _t;Bt!==v||L!==0&&Bt.nodeType!==3||(ve=ne+L),Bt!==q||R!==0&&Bt.nodeType!==3||(Ve=ne+R),Bt.nodeType===3&&(ne+=Bt.nodeValue.length),(_t=Bt.firstChild)!==null;)ft=Bt,Bt=_t;for(;;){if(Bt===o)break t;if(ft===v&&++ht===L&&(ve=ne),ft===q&&++Rt===R&&(Ve=ne),(_t=Bt.nextSibling)!==null)break;Bt=ft,ft=Bt.parentNode}Bt=_t}v=ve===-1||Ve===-1?null:{start:ve,end:Ve}}else v=null}v=v||{start:0,end:0}}else v=null;for(mo={focusedElem:o,selectionRange:v},hm=!1,X=f;X!==null;)if(f=X,o=f.child,(f.subtreeFlags&1024)!==0&&o!==null)o.return=f,X=o;else for(;X!==null;){switch(f=X,q=f.alternate,o=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((o&1024)!==0&&q!==null){o=void 0,v=f,L=q.memoizedProps,q=q.memoizedState,R=v.stateNode;try{var an=xa(v.type,L,v.elementType===v.type);o=R.getSnapshotBeforeUpdate(an,q),R.__reactInternalSnapshotBeforeUpdate=o}catch(Qi){or(v,v.return,Qi)}}break;case 3:if((o&1024)!==0){if(o=f.stateNode.containerInfo,v=o.nodeType,v===9)Ld(o);else if(v===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":Ld(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(D(163))}if(o=f.sibling,o!==null){o.return=f.return,X=o;break}X=f.return}}function ee(o,f,v){var R=v.flags;switch(v.tag){case 0:case 11:case 15:dt(o,v),R&4&&ba(5,v);break;case 1:if(dt(o,v),R&4)if(o=v.stateNode,f===null)try{o.componentDidMount()}catch(ne){or(v,v.return,ne)}else{var L=xa(v.type,f.memoizedProps);f=f.memoizedState;try{o.componentDidUpdate(L,f,o.__reactInternalSnapshotBeforeUpdate)}catch(ne){or(v,v.return,ne)}}R&64&&h(v),R&512&&n(v,v.return);break;case 3:if(dt(o,v),R&64&&(o=v.updateQueue,o!==null)){if(f=null,v.child!==null)switch(v.child.tag){case 27:case 5:f=v.child.stateNode;break;case 1:f=v.child.stateNode}try{ad(o,f)}catch(ne){or(v,v.return,ne)}}break;case 27:f===null&&R&4&&k(v);case 26:case 5:dt(o,v),f===null&&R&4&&p(v),R&512&&n(v,v.return);break;case 12:dt(o,v);break;case 13:dt(o,v),R&4&&ge(o,v),R&64&&(o=v.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(v=ov.bind(null,v),h_(o,v))));break;case 22:if(R=v.memoizedState!==null||U,!R){f=f!==null&&f.memoizedState!==null||F,L=U;var q=F;U=R,(F=f)&&!q?et(o,v,(v.subtreeFlags&8772)!==0):dt(o,v),U=L,F=q}break;case 30:break;default:dt(o,v)}}function oe(o){var f=o.alternate;f!==null&&(o.alternate=null,oe(f)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(f=o.stateNode,f!==null&&We(f)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var fe=null,ce=!1;function xe(o,f,v){for(v=v.child;v!==null;)_e(o,f,v),v=v.sibling}function _e(o,f,v){if(qr&&typeof qr.onCommitFiberUnmount=="function")try{qr.onCommitFiberUnmount(aa,v)}catch{}switch(v.tag){case 26:F||u(v,f),xe(o,f,v),v.memoizedState?v.memoizedState.count--:v.stateNode&&(v=v.stateNode,v.parentNode.removeChild(v));break;case 27:F||u(v,f);var R=fe,L=ce;Ec(v.type)&&(fe=v.stateNode,ce=!1),xe(o,f,v),kd(v.stateNode),fe=R,ce=L;break;case 5:F||u(v,f);case 6:if(R=fe,L=ce,fe=null,xe(o,f,v),fe=R,ce=L,fe!==null)if(ce)try{(fe.nodeType===9?fe.body:fe.nodeName==="HTML"?fe.ownerDocument.body:fe).removeChild(v.stateNode)}catch(q){or(v,f,q)}else try{fe.removeChild(v.stateNode)}catch(q){or(v,f,q)}break;case 18:fe!==null&&(ce?(o=fe,u_(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,v.stateNode),Tr(o)):u_(fe,v.stateNode));break;case 4:R=fe,L=ce,fe=v.stateNode.containerInfo,ce=!0,xe(o,f,v),fe=R,ce=L;break;case 0:case 11:case 14:case 15:F||Ml(2,v,f),F||Ml(4,v,f),xe(o,f,v);break;case 1:F||(u(v,f),R=v.stateNode,typeof R.componentWillUnmount=="function"&&t(v,f,R)),xe(o,f,v);break;case 21:xe(o,f,v);break;case 22:F=(R=F)||v.memoizedState!==null,xe(o,f,v),F=R;break;default:xe(o,f,v)}}function ge(o,f){if(f.memoizedState===null&&(o=f.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{Tr(o)}catch(v){or(f,f.return,v)}}function ye(o){switch(o.tag){case 13:case 19:var f=o.stateNode;return f===null&&(f=o.stateNode=new Y),f;case 22:return o=o.stateNode,f=o._retryCache,f===null&&(f=o._retryCache=new Y),f;default:throw Error(D(435,o.tag))}}function we(o,f){var v=ye(o);f.forEach(function(R){var L=zr.bind(null,o,R);v.has(R)||(v.add(R),R.then(L,L))})}function Ae(o,f){var v=f.deletions;if(v!==null)for(var R=0;R<v.length;R++){var L=v[R],q=o,ne=f,ve=ne;e:for(;ve!==null;){switch(ve.tag){case 27:if(Ec(ve.type)){fe=ve.stateNode,ce=!1;break e}break;case 5:fe=ve.stateNode,ce=!1;break e;case 3:case 4:fe=ve.stateNode.containerInfo,ce=!0;break e}ve=ve.return}if(fe===null)throw Error(D(160));_e(q,ne,L),fe=null,ce=!1,q=L.alternate,q!==null&&(q.return=null),L.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)Be(f,o),f=f.sibling}var je=null;function Be(o,f){var v=o.alternate,R=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Ae(f,o),Qe(o),R&4&&(Ml(3,o,o.return),ba(3,o),Ml(5,o,o.return));break;case 1:Ae(f,o),Qe(o),R&512&&(F||v===null||u(v,v.return)),R&64&&U&&(o=o.updateQueue,o!==null&&(R=o.callbacks,R!==null&&(v=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=v===null?R:v.concat(R))));break;case 26:var L=je;if(Ae(f,o),Qe(o),R&512&&(F||v===null||u(v,v.return)),R&4){var q=v!==null?v.memoizedState:null;if(R=o.memoizedState,v===null)if(R===null)if(o.stateNode===null){e:{R=o.type,v=o.memoizedProps,L=L.ownerDocument||L;t:switch(R){case"title":q=L.getElementsByTagName("title")[0],(!q||q[Je]||q[me]||q.namespaceURI==="http://www.w3.org/2000/svg"||q.hasAttribute("itemprop"))&&(q=L.createElement(R),L.head.insertBefore(q,L.querySelector("head > title"))),bs(q,R,v),q[me]=o,ai(q),R=q;break e;case"link":var ne=y_("link","href",L).get(R+(v.href||""));if(ne){for(var ve=0;ve<ne.length;ve++)if(q=ne[ve],q.getAttribute("href")===(v.href==null||v.href===""?null:v.href)&&q.getAttribute("rel")===(v.rel==null?null:v.rel)&&q.getAttribute("title")===(v.title==null?null:v.title)&&q.getAttribute("crossorigin")===(v.crossOrigin==null?null:v.crossOrigin)){ne.splice(ve,1);break t}}q=L.createElement(R),bs(q,R,v),L.head.appendChild(q);break;case"meta":if(ne=y_("meta","content",L).get(R+(v.content||""))){for(ve=0;ve<ne.length;ve++)if(q=ne[ve],q.getAttribute("content")===(v.content==null?null:""+v.content)&&q.getAttribute("name")===(v.name==null?null:v.name)&&q.getAttribute("property")===(v.property==null?null:v.property)&&q.getAttribute("http-equiv")===(v.httpEquiv==null?null:v.httpEquiv)&&q.getAttribute("charset")===(v.charSet==null?null:v.charSet)){ne.splice(ve,1);break t}}q=L.createElement(R),bs(q,R,v),L.head.appendChild(q);break;default:throw Error(D(468,R))}q[me]=o,ai(q),R=q}o.stateNode=R}else v_(L,o.type,o.stateNode);else o.stateNode=qf(L,R,o.memoizedProps);else q!==R?(q===null?v.stateNode!==null&&(v=v.stateNode,v.parentNode.removeChild(v)):q.count--,R===null?v_(L,o.type,o.stateNode):qf(L,R,o.memoizedProps)):R===null&&o.stateNode!==null&&g(o,o.memoizedProps,v.memoizedProps)}break;case 27:Ae(f,o),Qe(o),R&512&&(F||v===null||u(v,v.return)),v!==null&&R&4&&g(o,o.memoizedProps,v.memoizedProps);break;case 5:if(Ae(f,o),Qe(o),R&512&&(F||v===null||u(v,v.return)),o.flags&32){L=o.stateNode;try{Ra(L,"")}catch(_t){or(o,o.return,_t)}}R&4&&o.stateNode!=null&&(L=o.memoizedProps,g(o,L,v!==null?v.memoizedProps:L)),R&1024&&(Z=!0);break;case 6:if(Ae(f,o),Qe(o),R&4){if(o.stateNode===null)throw Error(D(162));R=o.memoizedProps,v=o.stateNode;try{v.nodeValue=R}catch(_t){or(o,o.return,_t)}}break;case 3:if(jd=null,L=je,je=Bd(f.containerInfo),Ae(f,o),je=L,Qe(o),R&4&&v!==null&&v.memoizedState.isDehydrated)try{Tr(f.containerInfo)}catch(_t){or(o,o.return,_t)}Z&&(Z=!1,nt(o));break;case 4:R=je,je=Bd(o.stateNode.containerInfo),Ae(f,o),Qe(o),je=R;break;case 12:Ae(f,o),Qe(o);break;case 13:Ae(f,o),Qe(o),o.child.flags&8192&&o.memoizedState!==null!=(v!==null&&v.memoizedState!==null)&&(Rn=jr()),R&4&&(R=o.updateQueue,R!==null&&(o.updateQueue=null,we(o,R)));break;case 22:L=o.memoizedState!==null;var Ve=v!==null&&v.memoizedState!==null,ht=U,Rt=F;if(U=ht||L,F=Rt||Ve,Ae(f,o),F=Rt,U=ht,Qe(o),R&8192)e:for(f=o.stateNode,f._visibility=L?f._visibility&-2:f._visibility|1,L&&(v===null||Ve||U||F||Le(o)),v=null,f=o;;){if(f.tag===5||f.tag===26){if(v===null){Ve=v=f;try{if(q=Ve.stateNode,L)ne=q.style,typeof ne.setProperty=="function"?ne.setProperty("display","none","important"):ne.display="none";else{ve=Ve.stateNode;var Bt=Ve.memoizedProps.style,ft=Bt!=null&&Bt.hasOwnProperty("display")?Bt.display:null;ve.style.display=ft==null||typeof ft=="boolean"?"":(""+ft).trim()}}catch(_t){or(Ve,Ve.return,_t)}}}else if(f.tag===6){if(v===null){Ve=f;try{Ve.stateNode.nodeValue=L?"":Ve.memoizedProps}catch(_t){or(Ve,Ve.return,_t)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===o)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===o)break e;for(;f.sibling===null;){if(f.return===null||f.return===o)break e;v===f&&(v=null),f=f.return}v===f&&(v=null),f.sibling.return=f.return,f=f.sibling}R&4&&(R=o.updateQueue,R!==null&&(v=R.retryQueue,v!==null&&(R.retryQueue=null,we(o,v))));break;case 19:Ae(f,o),Qe(o),R&4&&(R=o.updateQueue,R!==null&&(o.updateQueue=null,we(o,R)));break;case 30:break;case 21:break;default:Ae(f,o),Qe(o)}}function Qe(o){var f=o.flags;if(f&2){try{for(var v,R=o.return;R!==null;){if(x(R)){v=R;break}R=R.return}if(v==null)throw Error(D(160));switch(v.tag){case 27:var L=v.stateNode,q=C(o);O(o,q,L);break;case 5:var ne=v.stateNode;v.flags&32&&(Ra(ne,""),v.flags&=-33);var ve=C(o);O(o,ve,ne);break;case 3:case 4:var Ve=v.stateNode.containerInfo,ht=C(o);P(o,ht,Ve);break;default:throw Error(D(161))}}catch(Rt){or(o,o.return,Rt)}o.flags&=-3}f&4096&&(o.flags&=-4097)}function nt(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var f=o;nt(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),o=o.sibling}}function dt(o,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)ee(o,f.alternate,f),f=f.sibling}function Le(o){for(o=o.child;o!==null;){var f=o;switch(f.tag){case 0:case 11:case 14:case 15:Ml(4,f,f.return),Le(f);break;case 1:u(f,f.return);var v=f.stateNode;typeof v.componentWillUnmount=="function"&&t(f,f.return,v),Le(f);break;case 27:kd(f.stateNode);case 26:case 5:u(f,f.return),Le(f);break;case 22:f.memoizedState===null&&Le(f);break;case 30:Le(f);break;default:Le(f)}o=o.sibling}}function et(o,f,v){for(v=v&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var R=f.alternate,L=o,q=f,ne=q.flags;switch(q.tag){case 0:case 11:case 15:et(L,q,v),ba(4,q);break;case 1:if(et(L,q,v),R=q,L=R.stateNode,typeof L.componentDidMount=="function")try{L.componentDidMount()}catch(ht){or(R,R.return,ht)}if(R=q,L=R.updateQueue,L!==null){var ve=R.stateNode;try{var Ve=L.shared.hiddenCallbacks;if(Ve!==null)for(L.shared.hiddenCallbacks=null,L=0;L<Ve.length;L++)bf(Ve[L],ve)}catch(ht){or(R,R.return,ht)}}v&&ne&64&&h(q),n(q,q.return);break;case 27:k(q);case 26:case 5:et(L,q,v),v&&R===null&&ne&4&&p(q),n(q,q.return);break;case 12:et(L,q,v);break;case 13:et(L,q,v),v&&ne&4&&ge(L,q);break;case 22:q.memoizedState===null&&et(L,q,v),n(q,q.return);break;case 30:break;default:et(L,q,v)}f=f.sibling}}function Oe(o,f){var v=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(v=o.memoizedState.cachePool.pool),o=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(o=f.memoizedState.cachePool.pool),o!==v&&(o!=null&&o.refCount++,v!=null&&eu(v))}function tt(o,f){o=null,f.alternate!==null&&(o=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==o&&(f.refCount++,o!=null&&eu(o))}function Xe(o,f,v,R){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)st(o,f,v,R),f=f.sibling}function st(o,f,v,R){var L=f.flags;switch(f.tag){case 0:case 11:case 15:Xe(o,f,v,R),L&2048&&ba(9,f);break;case 1:Xe(o,f,v,R);break;case 3:Xe(o,f,v,R),L&2048&&(o=null,f.alternate!==null&&(o=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==o&&(f.refCount++,o!=null&&eu(o)));break;case 12:if(L&2048){Xe(o,f,v,R),o=f.stateNode;try{var q=f.memoizedProps,ne=q.id,ve=q.onPostCommit;typeof ve=="function"&&ve(ne,f.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(Ve){or(f,f.return,Ve)}}else Xe(o,f,v,R);break;case 13:Xe(o,f,v,R);break;case 23:break;case 22:q=f.stateNode,ne=f.alternate,f.memoizedState!==null?q._visibility&2?Xe(o,f,v,R):rt(o,f):q._visibility&2?Xe(o,f,v,R):(q._visibility|=2,Ge(o,f,v,R,(f.subtreeFlags&10256)!==0)),L&2048&&Oe(ne,f);break;case 24:Xe(o,f,v,R),L&2048&&tt(f.alternate,f);break;default:Xe(o,f,v,R)}}function Ge(o,f,v,R,L){for(L=L&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var q=o,ne=f,ve=v,Ve=R,ht=ne.flags;switch(ne.tag){case 0:case 11:case 15:Ge(q,ne,ve,Ve,L),ba(8,ne);break;case 23:break;case 22:var Rt=ne.stateNode;ne.memoizedState!==null?Rt._visibility&2?Ge(q,ne,ve,Ve,L):rt(q,ne):(Rt._visibility|=2,Ge(q,ne,ve,Ve,L)),L&&ht&2048&&Oe(ne.alternate,ne);break;case 24:Ge(q,ne,ve,Ve,L),L&&ht&2048&&tt(ne.alternate,ne);break;default:Ge(q,ne,ve,Ve,L)}f=f.sibling}}function rt(o,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var v=o,R=f,L=R.flags;switch(R.tag){case 22:rt(v,R),L&2048&&Oe(R.alternate,R);break;case 24:rt(v,R),L&2048&&tt(R.alternate,R);break;default:rt(v,R)}f=f.sibling}}var St=8192;function Et(o){if(o.subtreeFlags&St)for(o=o.child;o!==null;)It(o),o=o.sibling}function It(o){switch(o.tag){case 26:Et(o),o.flags&St&&o.memoizedState!==null&&Og(je,o.memoizedState,o.memoizedProps);break;case 5:Et(o);break;case 3:case 4:var f=je;je=Bd(o.stateNode.containerInfo),Et(o),je=f;break;case 22:o.memoizedState===null&&(f=o.alternate,f!==null&&f.memoizedState!==null?(f=St,St=16777216,Et(o),St=f):Et(o));break;default:Et(o)}}function Vt(o){var f=o.alternate;if(f!==null&&(o=f.child,o!==null)){f.child=null;do f=o.sibling,o.sibling=null,o=f;while(o!==null)}}function di(o){var f=o.deletions;if((o.flags&16)!==0){if(f!==null)for(var v=0;v<f.length;v++){var R=f[v];X=R,li(R,o)}Vt(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Qt(o),o=o.sibling}function Qt(o){switch(o.tag){case 0:case 11:case 15:di(o),o.flags&2048&&Ml(9,o,o.return);break;case 3:di(o);break;case 12:di(o);break;case 22:var f=o.stateNode;o.memoizedState!==null&&f._visibility&2&&(o.return===null||o.return.tag!==13)?(f._visibility&=-3,ui(o)):di(o);break;default:di(o)}}function ui(o){var f=o.deletions;if((o.flags&16)!==0){if(f!==null)for(var v=0;v<f.length;v++){var R=f[v];X=R,li(R,o)}Vt(o)}for(o=o.child;o!==null;){switch(f=o,f.tag){case 0:case 11:case 15:Ml(8,f,f.return),ui(f);break;case 22:v=f.stateNode,v._visibility&2&&(v._visibility&=-3,ui(f));break;default:ui(f)}o=o.sibling}}function li(o,f){for(;X!==null;){var v=X;switch(v.tag){case 0:case 11:case 15:Ml(8,v,f);break;case 23:case 22:if(v.memoizedState!==null&&v.memoizedState.cachePool!==null){var R=v.memoizedState.cachePool.pool;R!=null&&R.refCount++}break;case 24:eu(v.memoizedState.cache)}if(R=v.child,R!==null)R.return=v,X=R;else e:for(v=o;X!==null;){R=X;var L=R.sibling,q=R.return;if(oe(R),R===v){X=null;break e}if(L!==null){L.return=q,X=L;break e}X=q}}}var Ui={getCacheForType:function(o){var f=hr(br),v=f.data.get(o);return v===void 0&&(v=o(),f.data.set(o,v)),v}},sn=typeof WeakMap=="function"?WeakMap:Map,Si=0,ii=null,bi=null,Ht=0,At=0,Ei=null,Xi=!1,qi=!1,jn=!1,kn=0,fn=0,Wn=0,$r=0,Xr=0,Ri=0,Sn=0,Wi=null,$i=null,Rr=!1,Rn=0,ar=1/0,na=null,Dr=null,Yn=0,wr=null,hs=null,Wr=0,Na=0,wa=null,fo=null,bc=0,Il=null;function xs(){if((Si&2)!==0&&Ht!==0)return Ht&-Ht;if(bt.T!==null){var o=nc;return o!==0?o:$p()}return Ye()}function Md(){Ri===0&&(Ri=(Ht&536870912)===0||On?Vc():536870912);var o=dn.current;return o!==null&&(o.flags|=32),Ri}function Ta(o,f,v){(o===ii&&(At===2||At===9)||o.cancelPendingCommit!==null)&&(Sh(o,0),wc(o,Ht,Ri,!1)),Ia(o,v),((Si&2)===0||o!==ii)&&(o===ii&&((Si&2)===0&&($r|=v),fn===4&&wc(o,Ht,Ri,!1)),Sa(o))}function cg(o,f,v){if((Si&6)!==0)throw Error(D(327));var R=!v&&(f&124)===0&&(f&o.expiredLanes)===0||Pn(o,f),L=R?Lf(o,f):Ur(o,f,!0),q=R;do{if(L===0){qi&&!R&&wc(o,f,0,!1);break}else{if(v=o.current.alternate,q&&!hg(v)){L=Ur(o,f,!1),q=!1;continue}if(L===2){if(q=f,o.errorRecoveryDisabledLanes&q)var ne=0;else ne=o.pendingLanes&-536870913,ne=ne!==0?ne:ne&536870912?536870912:0;if(ne!==0){f=ne;e:{var ve=o;L=Wi;var Ve=ve.current.memoizedState.isDehydrated;if(Ve&&(Sh(ve,ne).flags|=256),ne=Ur(ve,ne,!1),ne!==2){if(jn&&!Ve){ve.errorRecoveryDisabledLanes|=q,$r|=q,L=4;break e}q=$i,$i=L,q!==null&&($i===null?$i=q:$i.push.apply($i,q))}L=ne}if(q=!1,L!==2)continue}}if(L===1){Sh(o,0),wc(o,f,0,!0);break}e:{switch(R=o,q=L,q){case 0:case 1:throw Error(D(345));case 4:if((f&4194048)!==f)break;case 6:wc(R,f,Ri,!Xi);break e;case 2:$i=null;break;case 3:case 5:break;default:throw Error(D(329))}if((f&62914560)===f&&(L=Rn+300-jr(),10<L)){if(wc(R,f,Ri,!Xi),go(R,0,!0)!==0)break e;R.timeoutHandle=Mg(ug.bind(null,R,v,$i,na,Rr,f,Ri,$r,Sn,Xi,q,2,-0,0),L);break e}ug(R,v,$i,na,Rr,f,Ri,$r,Sn,Xi,q,0,-0,0)}}break}while(!0);Sa(o)}function ug(o,f,v,R,L,q,ne,ve,Ve,ht,Rt,Bt,ft,_t){if(o.timeoutHandle=-1,Bt=f.subtreeFlags,(Bt&8192||(Bt&16785408)===16785408)&&(qd={stylesheets:null,count:0,unsuspend:pv},It(f),Bt=Lg(),Bt!==null)){o.cancelPendingCommit=Bt(gu.bind(null,o,f,q,v,R,L,ne,ve,Ve,Rt,1,ft,_t)),wc(o,q,ne,!ht);return}gu(o,f,q,v,R,L,ne,ve,Ve)}function hg(o){for(var f=o;;){var v=f.tag;if((v===0||v===11||v===15)&&f.flags&16384&&(v=f.updateQueue,v!==null&&(v=v.stores,v!==null)))for(var R=0;R<v.length;R++){var L=v[R],q=L.getSnapshot;L=L.value;try{if(!Qr(q(),L))return!1}catch{return!1}}if(v=f.child,f.subtreeFlags&16384&&v!==null)v.return=f,f=v;else{if(f===o)break;for(;f.sibling===null;){if(f.return===null||f.return===o)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function wc(o,f,v,R){f&=~Xr,f&=~$r,o.suspendedLanes|=f,o.pingedLanes&=~f,R&&(o.warmLanes|=f),R=o.expirationTimes;for(var L=f;0<L;){var q=31-Ar(L),ne=1<<q;R[q]=-1,L&=~ne}v!==0&&Nl(o,v,f)}function Of(){return(Si&6)===0?(Ah(0),!1):!0}function Fp(){if(bi!==null){if(At===0)var o=bi.return;else o=bi,La=Ao=null,Fe(o),mc=null,Oo=0,o=bi;for(;o!==null;)Pf(o.alternate,o),o=o.return;bi=null}}function Sh(o,f){var v=o.timeoutHandle;v!==-1&&(o.timeoutHandle=-1,uv(v)),v=o.cancelPendingCommit,v!==null&&(o.cancelPendingCommit=null,v()),Fp(),ii=o,bi=v=xn(o.current,null),Ht=f,At=0,Ei=null,Xi=!1,qi=Pn(o,f),jn=!1,Sn=Ri=Xr=$r=Wn=fn=0,$i=Wi=null,Rr=!1,(f&8)!==0&&(f|=f&32);var R=o.entangledLanes;if(R!==0)for(o=o.entanglements,R&=f;0<R;){var L=31-Ar(R),q=1<<L;f|=o[L],R&=~q}return kn=f,Yc(),v}function Qm(o,f){_n=null,bt.H=xh,f===ll||f===sh?(f=rd(),At=3):f===iu?(f=rd(),At=4):At=f===ho?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,Ei=f,bi===null&&(fn=1,fu(o,gs(f,o.current)))}function e_(){var o=bt.H;return bt.H=xh,o===null?xh:o}function Up(){var o=bt.A;return bt.A=Ui,o}function Cl(){fn=4,Xi||(Ht&4194048)!==Ht&&dn.current!==null||(qi=!0),(Wn&134217727)===0&&($r&134217727)===0||ii===null||wc(ii,Ht,Ri,!1)}function Ur(o,f,v){var R=Si;Si|=2;var L=e_(),q=Up();(ii!==o||Ht!==f)&&(na=null,Sh(o,f)),f=!1;var ne=fn;e:do try{if(At!==0&&bi!==null){var ve=bi,Ve=Ei;switch(At){case 8:Fp(),ne=6;break e;case 3:case 2:case 9:case 6:dn.current===null&&(f=!0);var ht=At;if(At=0,Ei=null,Id(o,ve,Ve,ht),v&&qi){ne=0;break e}break;default:ht=At,At=0,Ei=null,Id(o,ve,Ve,ht)}}dg(),ne=fn;break}catch(Rt){Qm(o,Rt)}while(!0);return f&&o.shellSuspendCounter++,La=Ao=null,Si=R,bt.H=L,bt.A=q,bi===null&&(ii=null,Ht=0,Yc()),ne}function dg(){for(;bi!==null;)fg(bi)}function Lf(o,f){var v=Si;Si|=2;var R=e_(),L=Up();ii!==o||Ht!==f?(na=null,ar=jr()+500,Sh(o,f)):qi=Pn(o,f);e:do try{if(At!==0&&bi!==null){f=bi;var q=Ei;t:switch(At){case 1:At=0,Ei=null,Id(o,f,q,1);break;case 2:case 9:if(sc(q)){At=0,Ei=null,pg(f);break}f=function(){At!==2&&At!==9||ii!==o||(At=7),Sa(o)},q.then(f,f);break e;case 3:At=7;break e;case 4:At=5;break e;case 7:sc(q)?(At=0,Ei=null,pg(f)):(At=0,Ei=null,Id(o,f,q,7));break;case 5:var ne=null;switch(bi.tag){case 26:ne=bi.memoizedState;case 5:case 27:var ve=bi;if(!ne||x_(ne)){At=0,Ei=null;var Ve=ve.sibling;if(Ve!==null)bi=Ve;else{var ht=ve.return;ht!==null?(bi=ht,_u(ht)):bi=null}break t}}At=0,Ei=null,Id(o,f,q,5);break;case 6:At=0,Ei=null,Id(o,f,q,6);break;case 8:Fp(),fn=6;break e;default:throw Error(D(462))}}sv();break}catch(Rt){Qm(o,Rt)}while(!0);return La=Ao=null,bt.H=R,bt.A=L,Si=v,bi!==null?0:(ii=null,Ht=0,Yc(),fn)}function sv(){for(;bi!==null&&!Aa();)fg(bi)}function fg(o){var f=Th(o.alternate,o,kn);o.memoizedProps=o.pendingProps,f===null?_u(o):bi=f}function pg(o){var f=o,v=f.alternate;switch(f.tag){case 15:case 0:f=us(v,f,f.pendingProps,f.type,void 0,Ht);break;case 11:f=us(v,f,f.pendingProps,f.type.render,f.ref,Ht);break;case 5:Fe(f);default:Pf(v,f),f=bi=Ep(f,kn),f=Th(v,f,kn)}o.memoizedProps=o.pendingProps,f===null?_u(o):bi=f}function Id(o,f,v,R){La=Ao=null,Fe(f),mc=null,Oo=0;var L=f.return;try{if(yc(o,L,f,v,Ht)){fn=1,fu(o,gs(v,o.current)),bi=null;return}}catch(q){if(L!==null)throw bi=L,q;fn=1,fu(o,gs(v,o.current)),bi=null;return}f.flags&32768?(On||R===1?o=!0:qi||(Ht&536870912)!==0?o=!1:(Xi=o=!0,(R===2||R===9||R===3||R===6)&&(R=dn.current,R!==null&&R.tag===13&&(R.flags|=16384))),t_(f,o)):_u(f)}function _u(o){var f=o;do{if((f.flags&32768)!==0){t_(f,Xi);return}o=f.return;var v=zf(f.alternate,f,kn);if(v!==null){bi=v;return}if(f=f.sibling,f!==null){bi=f;return}bi=f=o}while(f!==null);fn===0&&(fn=5)}function t_(o,f){do{var v=Ns(o.alternate,o);if(v!==null){v.flags&=32767,bi=v;return}if(v=o.return,v!==null&&(v.flags|=32768,v.subtreeFlags=0,v.deletions=null),!f&&(o=o.sibling,o!==null)){bi=o;return}bi=o=v}while(o!==null);fn=6,bi=null}function gu(o,f,v,R,L,q,ne,ve,Ve){o.cancelPendingCommit=null;do Vp();while(Yn!==0);if((Si&6)!==0)throw Error(D(327));if(f!==null){if(f===o.current)throw Error(D(177));if(q=f.lanes|f.childLanes,q|=nl,zu(o,v,q,ne,ve,Ve),o===ii&&(bi=ii=null,Ht=0),hs=f,wr=o,Wr=v,Na=q,wa=L,fo=R,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,jp(Xa,function(){return yg(),null})):(o.callbackNode=null,o.callbackPriority=0),R=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||R){R=bt.T,bt.T=null,L=ri.p,ri.p=2,ne=Si,Si|=4;try{J(o,f,v)}finally{Si=ne,ri.p=L,bt.T=R}}Yn=1,Cd(),mg(),_g()}}function Cd(){if(Yn===1){Yn=0;var o=wr,f=hs,v=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||v){v=bt.T,bt.T=null;var R=ri.p;ri.p=2;var L=Si;Si|=4;try{Be(f,o);var q=mo,ne=Tp(o.containerInfo),ve=q.focusedElem,Ve=q.selectionRange;if(ne!==ve&&ve&&ve.ownerDocument&&wp(ve.ownerDocument.documentElement,ve)){if(Ve!==null&&Hu(ve)){var ht=Ve.start,Rt=Ve.end;if(Rt===void 0&&(Rt=ht),"selectionStart"in ve)ve.selectionStart=ht,ve.selectionEnd=Math.min(Rt,ve.value.length);else{var Bt=ve.ownerDocument||document,ft=Bt&&Bt.defaultView||window;if(ft.getSelection){var _t=ft.getSelection(),an=ve.textContent.length,Qi=Math.min(Ve.start,an),er=Ve.end===void 0?Qi:Math.min(Ve.end,an);!_t.extend&&Qi>er&&(ne=er,er=Qi,Qi=ne);var it=$l(ve,Qi),Ke=$l(ve,er);if(it&&Ke&&(_t.rangeCount!==1||_t.anchorNode!==it.node||_t.anchorOffset!==it.offset||_t.focusNode!==Ke.node||_t.focusOffset!==Ke.offset)){var ct=Bt.createRange();ct.setStart(it.node,it.offset),_t.removeAllRanges(),Qi>er?(_t.addRange(ct),_t.extend(Ke.node,Ke.offset)):(ct.setEnd(Ke.node,Ke.offset),_t.addRange(ct))}}}}for(Bt=[],_t=ve;_t=_t.parentNode;)_t.nodeType===1&&Bt.push({element:_t,left:_t.scrollLeft,top:_t.scrollTop});for(typeof ve.focus=="function"&&ve.focus(),ve=0;ve<Bt.length;ve++){var Dt=Bt[ve];Dt.element.scrollLeft=Dt.left,Dt.element.scrollTop=Dt.top}}hm=!!Nf,mo=Nf=null}finally{Si=L,ri.p=R,bt.T=v}}o.current=f,Yn=2}}function mg(){if(Yn===2){Yn=0;var o=wr,f=hs,v=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||v){v=bt.T,bt.T=null;var R=ri.p;ri.p=2;var L=Si;Si|=4;try{ee(o,f.alternate,f)}finally{Si=L,ri.p=R,bt.T=v}}Yn=3}}function _g(){if(Yn===4||Yn===3){Yn=0,Es();var o=wr,f=hs,v=Wr,R=fo;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?Yn=5:(Yn=0,hs=wr=null,gg(o,o.pendingLanes));var L=o.pendingLanes;if(L===0&&(Dr=null),Fl(v),f=f.stateNode,qr&&typeof qr.onCommitFiberRoot=="function")try{qr.onCommitFiberRoot(aa,f,void 0,(f.current.flags&128)===128)}catch{}if(R!==null){f=bt.T,L=ri.p,ri.p=2,bt.T=null;try{for(var q=o.onRecoverableError,ne=0;ne<R.length;ne++){var ve=R[ne];q(ve.value,{componentStack:ve.stack})}}finally{bt.T=f,ri.p=L}}(Wr&3)!==0&&Vp(),Sa(o),L=o.pendingLanes,(v&4194090)!==0&&(L&42)!==0?o===Il?bc++:(bc=0,Il=o):bc=0,Ah(0)}}function gg(o,f){(o.pooledCacheLanes&=f)===0&&(f=o.pooledCache,f!=null&&(o.pooledCache=null,eu(f)))}function Vp(o){return Cd(),mg(),_g(),yg()}function yg(){if(Yn!==5)return!1;var o=wr,f=Na;Na=0;var v=Fl(Wr),R=bt.T,L=ri.p;try{ri.p=32>v?32:v,bt.T=null,v=wa,wa=null;var q=wr,ne=Wr;if(Yn=0,hs=wr=null,Wr=0,(Si&6)!==0)throw Error(D(331));var ve=Si;if(Si|=4,Qt(q.current),st(q,q.current,ne,v),Si=ve,Ah(0,!1),qr&&typeof qr.onPostCommitFiberRoot=="function")try{qr.onPostCommitFiberRoot(aa,q)}catch{}return!0}finally{ri.p=L,bt.T=R,gg(o,f)}}function vg(o,f,v){f=gs(v,f),f=bh(o.stateNode,f,2),o=Do(o,f,2),o!==null&&(Ia(o,2),Sa(o))}function or(o,f,v){if(o.tag===3)vg(o,o,v);else for(;f!==null;){if(f.tag===3){vg(f,o,v);break}else if(f.tag===1){var R=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(Dr===null||!Dr.has(R))){o=gs(v,o),v=Sd(2),R=Do(f,v,2),R!==null&&(pu(v,R,f,o),Ia(R,2),Sa(R));break}}f=f.return}}function kf(o,f,v){var R=o.pingCache;if(R===null){R=o.pingCache=new sn;var L=new Set;R.set(f,L)}else L=R.get(f),L===void 0&&(L=new Set,R.set(f,L));L.has(v)||(jn=!0,L.add(v),o=av.bind(null,o,f,v),f.then(o,o))}function av(o,f,v){var R=o.pingCache;R!==null&&R.delete(f),o.pingedLanes|=o.suspendedLanes&v,o.warmLanes&=~v,ii===o&&(Ht&v)===v&&(fn===4||fn===3&&(Ht&62914560)===Ht&&300>jr()-Rn?(Si&2)===0&&Sh(o,0):Xr|=v,Sn===Ht&&(Sn=0)),Sa(o)}function Eh(o,f){f===0&&(f=Bl()),o=Rs(o,f),o!==null&&(Ia(o,f),Sa(o))}function ov(o){var f=o.memoizedState,v=0;f!==null&&(v=f.retryLane),Eh(o,v)}function zr(o,f){var v=0;switch(o.tag){case 13:var R=o.stateNode,L=o.memoizedState;L!==null&&(v=L.retryLane);break;case 19:R=o.stateNode;break;case 22:R=o.stateNode._retryCache;break;default:throw Error(D(314))}R!==null&&R.delete(f),Eh(o,v)}function jp(o,f){return $a(o,f)}var Bf=null,Tc=null,Rd=!1,yu=!1,qp=!1,vu=0;function Sa(o){o!==Tc&&o.next===null&&(Tc===null?Bf=Tc=o:Tc=Tc.next=o),yu=!0,Rd||(Rd=!0,n_())}function Ah(o,f){if(!qp&&yu){qp=!0;do for(var v=!1,R=Bf;R!==null;){if(o!==0){var L=R.pendingLanes;if(L===0)var q=0;else{var ne=R.suspendedLanes,ve=R.pingedLanes;q=(1<<31-Ar(42|o)+1)-1,q&=L&~(ne&~ve),q=q&201326741?q&201326741|1:q?q|2:0}q!==0&&(v=!0,Zp(R,q))}else q=Ht,q=go(R,R===ii?q:0,R.cancelPendingCommit!==null||R.timeoutHandle!==-1),(q&3)===0||Pn(R,q)||(v=!0,Zp(R,q));R=R.next}while(v);qp=!1}}function Gp(){xg()}function xg(){yu=Rd=!1;var o=0;vu!==0&&(cv()&&(o=vu),vu=0);for(var f=jr(),v=null,R=Bf;R!==null;){var L=R.next,q=i_(R,f);q===0?(R.next=null,v===null?Bf=L:v.next=L,L===null&&(Tc=v)):(v=R,(o!==0||(q&3)!==0)&&(yu=!0)),R=L}Ah(o)}function i_(o,f){for(var v=o.suspendedLanes,R=o.pingedLanes,L=o.expirationTimes,q=o.pendingLanes&-62914561;0<q;){var ne=31-Ar(q),ve=1<<ne,Ve=L[ne];Ve===-1?((ve&v)===0||(ve&R)!==0)&&(L[ne]=bn(ve,f)):Ve<=f&&(o.expiredLanes|=ve),q&=~ve}if(f=ii,v=Ht,v=go(o,o===f?v:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),R=o.callbackNode,v===0||o===f&&(At===2||At===9)||o.cancelPendingCommit!==null)return R!==null&&R!==null&&Mt(R),o.callbackNode=null,o.callbackPriority=0;if((v&3)===0||Pn(o,v)){if(f=v&-v,f===o.callbackPriority)return f;switch(R!==null&&Mt(R),Fl(v)){case 2:case 8:v=Ma;break;case 32:v=Xa;break;case 268435456:v=kl;break;default:v=Xa}return R=Hp.bind(null,o),v=$a(v,R),o.callbackPriority=f,o.callbackNode=v,f}return R!==null&&R!==null&&Mt(R),o.callbackPriority=2,o.callbackNode=null,2}function Hp(o,f){if(Yn!==0&&Yn!==5)return o.callbackNode=null,o.callbackPriority=0,null;var v=o.callbackNode;if(Vp()&&o.callbackNode!==v)return null;var R=Ht;return R=go(o,o===ii?R:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),R===0?null:(cg(o,R,f),i_(o,jr()),o.callbackNode!=null&&o.callbackNode===v?Hp.bind(null,o):null)}function Zp(o,f){if(Vp())return null;cg(o,f,!0)}function n_(){Ig(function(){(Si&6)!==0?$a(Er,Gp):xg()})}function $p(){return vu===0&&(vu=Vc()),vu}function Xp(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:Is(""+o)}function r_(o,f){var v=f.ownerDocument.createElement("input");return v.name=f.name,v.value=f.value,o.id&&v.setAttribute("form",o.id),f.parentNode.insertBefore(v,f),o=new FormData(o),v.parentNode.removeChild(v),o}function s_(o,f,v,R,L){if(f==="submit"&&v&&v.stateNode===L){var q=Xp((L[Se]||null).action),ne=R.submitter;ne&&(f=(f=ne[Se]||null)?Xp(f.formAction):ne.getAttribute("formAction"),f!==null&&(q=f,ne=null));var ve=new Hn("action","action",null,R,L);o.push({event:ve,listeners:[{instance:null,listener:function(){if(R.defaultPrevented){if(vu!==0){var Ve=ne?r_(L,ne):new FormData(L);ou(v,{pending:!0,data:Ve,method:L.method,action:q},null,Ve)}}else typeof q=="function"&&(ve.preventDefault(),Ve=ne?r_(L,ne):new FormData(L),ou(v,{pending:!0,data:Ve,method:L.method,action:q},q,Ve))},currentTarget:L}]})}}for(var Wp=0;Wp<So.length;Wp++){var Yp=So[Wp],Kp=Yp.toLowerCase(),bg=Yp[0].toUpperCase()+Yp.slice(1);_s(Kp,"on"+bg)}_s(da,"onAnimationEnd"),_s(Hh,"onAnimationIteration"),_s(Zu,"onAnimationStart"),_s("dblclick","onDoubleClick"),_s("focusin","onFocus"),_s("focusout","onBlur"),_s($u,"onTransitionRun"),_s(Zh,"onTransitionStart"),_s(il,"onTransitionCancel"),_s(Xu,"onTransitionEnd"),Cn("onMouseEnter",["mouseout","mouseover"]),Cn("onMouseLeave",["mouseout","mouseover"]),Cn("onPointerEnter",["pointerout","pointerover"]),Cn("onPointerLeave",["pointerout","pointerover"]),gn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),gn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),gn("onBeforeInput",["compositionend","keypress","textInput","paste"]),gn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),gn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),gn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Dd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Dd));function Sc(o,f){f=(f&4)!==0;for(var v=0;v<o.length;v++){var R=o[v],L=R.event;R=R.listeners;e:{var q=void 0;if(f)for(var ne=R.length-1;0<=ne;ne--){var ve=R[ne],Ve=ve.instance,ht=ve.currentTarget;if(ve=ve.listener,Ve!==q&&L.isPropagationStopped())break e;q=ve,L.currentTarget=ht;try{q(L)}catch(Rt){Tl(Rt)}L.currentTarget=null,q=Ve}else for(ne=0;ne<R.length;ne++){if(ve=R[ne],Ve=ve.instance,ht=ve.currentTarget,ve=ve.listener,Ve!==q&&L.isPropagationStopped())break e;q=ve,L.currentTarget=ht;try{q(L)}catch(Rt){Tl(Rt)}L.currentTarget=null,q=Ve}}}}function vn(o,f){var v=f[Re];v===void 0&&(v=f[Re]=new Set);var R=o+"__bubble";v.has(R)||(Tg(f,o,2,!1),v.add(R))}function Jp(o,f,v){var R=0;f&&(R|=4),Tg(v,o,R,f)}var Qp="_reactListening"+Math.random().toString(36).slice(2);function em(o){if(!o[Qp]){o[Qp]=!0,Ti.forEach(function(v){v!=="selectionchange"&&(wg.has(v)||Jp(v,!1,o),Jp(v,!0,o))});var f=o.nodeType===9?o:o.ownerDocument;f===null||f[Qp]||(f[Qp]=!0,Jp("selectionchange",!1,f))}}function Tg(o,f,v,R){switch(w_(f)){case 2:var L=gv;break;case 8:L=b_;break;default:L=$f}v=L.bind(null,f,v,o),L=void 0,!Zo||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(L=!0),R?L!==void 0?o.addEventListener(f,v,{capture:!0,passive:L}):o.addEventListener(f,v,!0):L!==void 0?o.addEventListener(f,v,{passive:L}):o.addEventListener(f,v,!1)}function a_(o,f,v,R,L){var q=R;if((f&1)===0&&(f&2)===0&&R!==null)e:for(;;){if(R===null)return;var ne=R.tag;if(ne===3||ne===4){var ve=R.stateNode.containerInfo;if(ve===L)break;if(ne===4)for(ne=R.return;ne!==null;){var Ve=ne.tag;if((Ve===3||Ve===4)&&ne.stateNode.containerInfo===L)return;ne=ne.return}for(;ve!==null;){if(ne=pt(ve),ne===null)return;if(Ve=ne.tag,Ve===5||Ve===6||Ve===26||Ve===27){R=q=ne;continue e}ve=ve.parentNode}}R=R.return}Hi(function(){var ht=q,Rt=Nu(v),Bt=[];e:{var ft=$h.get(o);if(ft!==void 0){var _t=Hn,an=o;switch(o){case"keypress":if(Ji(v)===0)break e;case"keydown":case"keyup":_t=Fh;break;case"focusin":an="focus",_t=Js;break;case"focusout":an="blur",_t=Js;break;case"beforeblur":case"afterblur":_t=Js;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_t=Kr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_t=os;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_t=gp;break;case da:case Hh:case Zu:_t=kr;break;case Xu:_t=Wm;break;case"scroll":case"scrollend":_t=Gc;break;case"wheel":_t=ju;break;case"copy":case"cut":case"paste":_t=rr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_t=_p;break;case"toggle":case"beforetoggle":_t=Km}var Qi=(f&4)!==0,er=!Qi&&(o==="scroll"||o==="scrollend"),it=Qi?ft!==null?ft+"Capture":null:ft;Qi=[];for(var Ke=ht,ct;Ke!==null;){var Dt=Ke;if(ct=Dt.stateNode,Dt=Dt.tag,Dt!==5&&Dt!==26&&Dt!==27||ct===null||it===null||(Dt=ps(Ke,it),Dt!=null&&Qi.push(Fa(Ke,Dt,ct))),er)break;Ke=Ke.return}0<Qi.length&&(ft=new _t(ft,an,null,v,Rt),Bt.push({event:ft,listeners:Qi}))}}if((f&7)===0){e:{if(ft=o==="mouseover"||o==="pointerover",_t=o==="mouseout"||o==="pointerout",ft&&v!==on&&(an=v.relatedTarget||v.fromElement)&&(pt(an)||an[Ee]))break e;if((_t||ft)&&(ft=Rt.window===Rt?Rt:(ft=Rt.ownerDocument)?ft.defaultView||ft.parentWindow:window,_t?(an=v.relatedTarget||v.toElement,_t=ht,an=an?pt(an):null,an!==null&&(er=K(an),Qi=an.tag,an!==er||Qi!==5&&Qi!==27&&Qi!==6)&&(an=null)):(_t=null,an=ht),_t!==an)){if(Qi=Kr,Dt="onMouseLeave",it="onMouseEnter",Ke="mouse",(o==="pointerout"||o==="pointerover")&&(Qi=_p,Dt="onPointerLeave",it="onPointerEnter",Ke="pointer"),er=_t==null?ft:Pt(_t),ct=an==null?ft:Pt(an),ft=new Qi(Dt,Ke+"leave",_t,v,Rt),ft.target=er,ft.relatedTarget=ct,Dt=null,pt(Rt)===ht&&(Qi=new Qi(it,Ke+"enter",an,v,Rt),Qi.target=ct,Qi.relatedTarget=er,Dt=Qi),er=Dt,_t&&an)t:{for(Qi=_t,it=an,Ke=0,ct=Qi;ct;ct=Pd(ct))Ke++;for(ct=0,Dt=it;Dt;Dt=Pd(Dt))ct++;for(;0<Ke-ct;)Qi=Pd(Qi),Ke--;for(;0<ct-Ke;)it=Pd(it),ct--;for(;Ke--;){if(Qi===it||it!==null&&Qi===it.alternate)break t;Qi=Pd(Qi),it=Pd(it)}Qi=null}else Qi=null;_t!==null&&o_(Bt,ft,_t,Qi,!1),an!==null&&er!==null&&o_(Bt,er,an,Qi,!0)}}e:{if(ft=ht?Pt(ht):window,_t=ft.nodeName&&ft.nodeName.toLowerCase(),_t==="select"||_t==="input"&&ft.type==="file")var wi=Hl;else if(xi(ft))if(jh)wi=qh;else{wi=Jr;var Mn=wo}else _t=ft.nodeName,!_t||_t.toLowerCase()!=="input"||ft.type!=="checkbox"&&ft.type!=="radio"?ht&&as(ht.elementType)&&(wi=Hl):wi=bp;if(wi&&(wi=wi(o,ht))){Qa(Bt,wi,v,Rt);break e}Mn&&Mn(o,ft,ht),o==="focusout"&&ht&&ft.type==="number"&&ht.memoizedProps.value!=null&&Ys(ft,"number",ft.value)}switch(Mn=ht?Pt(ht):window,o){case"focusin":(xi(Mn)||Mn.contentEditable==="true")&&(Xl=Mn,Gh=ht,el=null);break;case"focusout":el=Gh=Xl=null;break;case"mousedown":_f=!0;break;case"contextmenu":case"mouseup":case"dragend":_f=!1,tl(Bt,v,Rt);break;case"selectionchange":if(Sp)break;case"keydown":case"keyup":tl(Bt,v,Rt)}var Pi;if(bo)e:{switch(o){case"compositionstart":var en="onCompositionStart";break e;case"compositionend":en="onCompositionEnd";break e;case"compositionupdate":en="onCompositionUpdate";break e}en=void 0}else Qs?pf(o,v)&&(en="onCompositionEnd"):o==="keydown"&&v.keyCode===229&&(en="onCompositionStart");en&&(Uh&&v.locale!=="ko"&&(Qs||en!=="onCompositionStart"?en==="onCompositionEnd"&&Qs&&(Pi=jl()):(Zi=Rt,Ki="value"in Zi?Zi.value:Zi.textContent,Qs=!0)),Mn=zd(ht,en),0<Mn.length&&(en=new Hs(en,o,null,v,Rt),Bt.push({event:en,listeners:Mn}),Pi?en.data=Pi:(Pi=xp(v),Pi!==null&&(en.data=Pi)))),(Pi=Jo?zi(o,v):Wt(o,v))&&(en=zd(ht,"onBeforeInput"),0<en.length&&(Mn=new Hs("onBeforeInput","beforeinput",null,v,Rt),Bt.push({event:Mn,listeners:en}),Mn.data=Pi)),s_(Bt,o,ht,v,Rt)}Sc(Bt,f)})}function Fa(o,f,v){return{instance:o,listener:f,currentTarget:v}}function zd(o,f){for(var v=f+"Capture",R=[];o!==null;){var L=o,q=L.stateNode;if(L=L.tag,L!==5&&L!==26&&L!==27||q===null||(L=ps(o,v),L!=null&&R.unshift(Fa(o,L,q)),L=ps(o,f),L!=null&&R.push(Fa(o,L,q))),o.tag===3)return R;o=o.return}return[]}function Pd(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function o_(o,f,v,R,L){for(var q=f._reactName,ne=[];v!==null&&v!==R;){var ve=v,Ve=ve.alternate,ht=ve.stateNode;if(ve=ve.tag,Ve!==null&&Ve===R)break;ve!==5&&ve!==26&&ve!==27||ht===null||(Ve=ht,L?(ht=ps(v,q),ht!=null&&ne.unshift(Fa(v,ht,Ve))):L||(ht=ps(v,q),ht!=null&&ne.push(Fa(v,ht,Ve)))),v=v.return}ne.length!==0&&o.push({event:f,listeners:ne})}var Mh=/\r\n?/g,lv=/\u0000|\uFFFD/g;function po(o){return(typeof o=="string"?o:""+o).replace(Mh,`
`).replace(lv,"")}function tm(o,f){return f=po(f),po(o)===f}function Od(){}function Kn(o,f,v,R,L,q){switch(v){case"children":typeof R=="string"?f==="body"||f==="textarea"&&R===""||Ra(o,R):(typeof R=="number"||typeof R=="bigint")&&f!=="body"&&Ra(o,""+R);break;case"className":pr(o,"class",R);break;case"tabIndex":pr(o,"tabindex",R);break;case"dir":case"role":case"viewBox":case"width":case"height":pr(o,v,R);break;case"style":la(o,R,q);break;case"data":if(f!=="object"){pr(o,"data",R);break}case"src":case"href":if(R===""&&(f!=="a"||v!=="href")){o.removeAttribute(v);break}if(R==null||typeof R=="function"||typeof R=="symbol"||typeof R=="boolean"){o.removeAttribute(v);break}R=Is(""+R),o.setAttribute(v,R);break;case"action":case"formAction":if(typeof R=="function"){o.setAttribute(v,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof q=="function"&&(v==="formAction"?(f!=="input"&&Kn(o,f,"name",L.name,L,null),Kn(o,f,"formEncType",L.formEncType,L,null),Kn(o,f,"formMethod",L.formMethod,L,null),Kn(o,f,"formTarget",L.formTarget,L,null)):(Kn(o,f,"encType",L.encType,L,null),Kn(o,f,"method",L.method,L,null),Kn(o,f,"target",L.target,L,null)));if(R==null||typeof R=="symbol"||typeof R=="boolean"){o.removeAttribute(v);break}R=Is(""+R),o.setAttribute(v,R);break;case"onClick":R!=null&&(o.onclick=Od);break;case"onScroll":R!=null&&vn("scroll",o);break;case"onScrollEnd":R!=null&&vn("scrollend",o);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(D(61));if(v=R.__html,v!=null){if(L.children!=null)throw Error(D(60));o.innerHTML=v}}break;case"multiple":o.multiple=R&&typeof R!="function"&&typeof R!="symbol";break;case"muted":o.muted=R&&typeof R!="function"&&typeof R!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(R==null||typeof R=="function"||typeof R=="boolean"||typeof R=="symbol"){o.removeAttribute("xlink:href");break}v=Is(""+R),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",v);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":R!=null&&typeof R!="function"&&typeof R!="symbol"?o.setAttribute(v,""+R):o.removeAttribute(v);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":R&&typeof R!="function"&&typeof R!="symbol"?o.setAttribute(v,""):o.removeAttribute(v);break;case"capture":case"download":R===!0?o.setAttribute(v,""):R!==!1&&R!=null&&typeof R!="function"&&typeof R!="symbol"?o.setAttribute(v,R):o.removeAttribute(v);break;case"cols":case"rows":case"size":case"span":R!=null&&typeof R!="function"&&typeof R!="symbol"&&!isNaN(R)&&1<=R?o.setAttribute(v,R):o.removeAttribute(v);break;case"rowSpan":case"start":R==null||typeof R=="function"||typeof R=="symbol"||isNaN(R)?o.removeAttribute(v):o.setAttribute(v,R);break;case"popover":vn("beforetoggle",o),vn("toggle",o),Gn(o,"popover",R);break;case"xlinkActuate":ir(o,"http://www.w3.org/1999/xlink","xlink:actuate",R);break;case"xlinkArcrole":ir(o,"http://www.w3.org/1999/xlink","xlink:arcrole",R);break;case"xlinkRole":ir(o,"http://www.w3.org/1999/xlink","xlink:role",R);break;case"xlinkShow":ir(o,"http://www.w3.org/1999/xlink","xlink:show",R);break;case"xlinkTitle":ir(o,"http://www.w3.org/1999/xlink","xlink:title",R);break;case"xlinkType":ir(o,"http://www.w3.org/1999/xlink","xlink:type",R);break;case"xmlBase":ir(o,"http://www.w3.org/XML/1998/namespace","xml:base",R);break;case"xmlLang":ir(o,"http://www.w3.org/XML/1998/namespace","xml:lang",R);break;case"xmlSpace":ir(o,"http://www.w3.org/XML/1998/namespace","xml:space",R);break;case"is":Gn(o,"is",R);break;case"innerText":case"textContent":break;default:(!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(v=mp.get(v)||v,Gn(o,v,R))}}function im(o,f,v,R,L,q){switch(v){case"style":la(o,R,q);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(D(61));if(v=R.__html,v!=null){if(L.children!=null)throw Error(D(60));o.innerHTML=v}}break;case"children":typeof R=="string"?Ra(o,R):(typeof R=="number"||typeof R=="bigint")&&Ra(o,""+R);break;case"onScroll":R!=null&&vn("scroll",o);break;case"onScrollEnd":R!=null&&vn("scrollend",o);break;case"onClick":R!=null&&(o.onclick=Od);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ai.hasOwnProperty(v))e:{if(v[0]==="o"&&v[1]==="n"&&(L=v.endsWith("Capture"),f=v.slice(2,L?v.length-7:void 0),q=o[Se]||null,q=q!=null?q[v]:null,typeof q=="function"&&o.removeEventListener(f,q,L),typeof R=="function")){typeof q!="function"&&q!==null&&(v in o?o[v]=null:o.hasAttribute(v)&&o.removeAttribute(v)),o.addEventListener(f,R,L);break e}v in o?o[v]=R:R===!0?o.setAttribute(v,""):Gn(o,v,R)}}}function bs(o,f,v){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":vn("error",o),vn("load",o);var R=!1,L=!1,q;for(q in v)if(v.hasOwnProperty(q)){var ne=v[q];if(ne!=null)switch(q){case"src":R=!0;break;case"srcSet":L=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(D(137,f));default:Kn(o,f,q,ne,v,null)}}L&&Kn(o,f,"srcSet",v.srcSet,v,null),R&&Kn(o,f,"src",v.src,v,null);return;case"input":vn("invalid",o);var ve=q=ne=L=null,Ve=null,ht=null;for(R in v)if(v.hasOwnProperty(R)){var Rt=v[R];if(Rt!=null)switch(R){case"name":L=Rt;break;case"type":ne=Rt;break;case"checked":Ve=Rt;break;case"defaultChecked":ht=Rt;break;case"value":q=Rt;break;case"defaultValue":ve=Rt;break;case"children":case"dangerouslySetInnerHTML":if(Rt!=null)throw Error(D(137,f));break;default:Kn(o,f,R,Rt,v,null)}}qs(o,q,ve,Ve,ht,ne,L,!1),yo(o);return;case"select":vn("invalid",o),R=ne=q=null;for(L in v)if(v.hasOwnProperty(L)&&(ve=v[L],ve!=null))switch(L){case"value":q=ve;break;case"defaultValue":ne=ve;break;case"multiple":R=ve;default:Kn(o,f,L,ve,v,null)}f=q,v=ne,o.multiple=!!R,f!=null?Ks(o,!!R,f,!1):v!=null&&Ks(o,!!R,v,!0);return;case"textarea":vn("invalid",o),q=L=R=null;for(ne in v)if(v.hasOwnProperty(ne)&&(ve=v[ne],ve!=null))switch(ne){case"value":R=ve;break;case"defaultValue":L=ve;break;case"children":q=ve;break;case"dangerouslySetInnerHTML":if(ve!=null)throw Error(D(91));break;default:Kn(o,f,ne,ve,v,null)}Ms(o,R,L,q),yo(o);return;case"option":for(Ve in v)if(v.hasOwnProperty(Ve)&&(R=v[Ve],R!=null))switch(Ve){case"selected":o.selected=R&&typeof R!="function"&&typeof R!="symbol";break;default:Kn(o,f,Ve,R,v,null)}return;case"dialog":vn("beforetoggle",o),vn("toggle",o),vn("cancel",o),vn("close",o);break;case"iframe":case"object":vn("load",o);break;case"video":case"audio":for(R=0;R<Dd.length;R++)vn(Dd[R],o);break;case"image":vn("error",o),vn("load",o);break;case"details":vn("toggle",o);break;case"embed":case"source":case"link":vn("error",o),vn("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ht in v)if(v.hasOwnProperty(ht)&&(R=v[ht],R!=null))switch(ht){case"children":case"dangerouslySetInnerHTML":throw Error(D(137,f));default:Kn(o,f,ht,R,v,null)}return;default:if(as(f)){for(Rt in v)v.hasOwnProperty(Rt)&&(R=v[Rt],R!==void 0&&im(o,f,Rt,R,v,void 0));return}}for(ve in v)v.hasOwnProperty(ve)&&(R=v[ve],R!=null&&Kn(o,f,ve,R,v,null))}function Sg(o,f,v,R){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var L=null,q=null,ne=null,ve=null,Ve=null,ht=null,Rt=null;for(_t in v){var Bt=v[_t];if(v.hasOwnProperty(_t)&&Bt!=null)switch(_t){case"checked":break;case"value":break;case"defaultValue":Ve=Bt;default:R.hasOwnProperty(_t)||Kn(o,f,_t,null,R,Bt)}}for(var ft in R){var _t=R[ft];if(Bt=v[ft],R.hasOwnProperty(ft)&&(_t!=null||Bt!=null))switch(ft){case"type":q=_t;break;case"name":L=_t;break;case"checked":ht=_t;break;case"defaultChecked":Rt=_t;break;case"value":ne=_t;break;case"defaultValue":ve=_t;break;case"children":case"dangerouslySetInnerHTML":if(_t!=null)throw Error(D(137,f));break;default:_t!==Bt&&Kn(o,f,ft,_t,R,Bt)}}Ho(o,ne,ve,Ve,ht,Rt,q,L);return;case"select":_t=ne=ve=ft=null;for(q in v)if(Ve=v[q],v.hasOwnProperty(q)&&Ve!=null)switch(q){case"value":break;case"multiple":_t=Ve;default:R.hasOwnProperty(q)||Kn(o,f,q,null,R,Ve)}for(L in R)if(q=R[L],Ve=v[L],R.hasOwnProperty(L)&&(q!=null||Ve!=null))switch(L){case"value":ft=q;break;case"defaultValue":ve=q;break;case"multiple":ne=q;default:q!==Ve&&Kn(o,f,L,q,R,Ve)}f=ve,v=ne,R=_t,ft!=null?Ks(o,!!v,ft,!1):!!R!=!!v&&(f!=null?Ks(o,!!v,f,!0):Ks(o,!!v,v?[]:"",!1));return;case"textarea":_t=ft=null;for(ve in v)if(L=v[ve],v.hasOwnProperty(ve)&&L!=null&&!R.hasOwnProperty(ve))switch(ve){case"value":break;case"children":break;default:Kn(o,f,ve,null,R,L)}for(ne in R)if(L=R[ne],q=v[ne],R.hasOwnProperty(ne)&&(L!=null||q!=null))switch(ne){case"value":ft=L;break;case"defaultValue":_t=L;break;case"children":break;case"dangerouslySetInnerHTML":if(L!=null)throw Error(D(91));break;default:L!==q&&Kn(o,f,ne,L,R,q)}Gs(o,ft,_t);return;case"option":for(var an in v)if(ft=v[an],v.hasOwnProperty(an)&&ft!=null&&!R.hasOwnProperty(an))switch(an){case"selected":o.selected=!1;break;default:Kn(o,f,an,null,R,ft)}for(Ve in R)if(ft=R[Ve],_t=v[Ve],R.hasOwnProperty(Ve)&&ft!==_t&&(ft!=null||_t!=null))switch(Ve){case"selected":o.selected=ft&&typeof ft!="function"&&typeof ft!="symbol";break;default:Kn(o,f,Ve,ft,R,_t)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qi in v)ft=v[Qi],v.hasOwnProperty(Qi)&&ft!=null&&!R.hasOwnProperty(Qi)&&Kn(o,f,Qi,null,R,ft);for(ht in R)if(ft=R[ht],_t=v[ht],R.hasOwnProperty(ht)&&ft!==_t&&(ft!=null||_t!=null))switch(ht){case"children":case"dangerouslySetInnerHTML":if(ft!=null)throw Error(D(137,f));break;default:Kn(o,f,ht,ft,R,_t)}return;default:if(as(f)){for(var er in v)ft=v[er],v.hasOwnProperty(er)&&ft!==void 0&&!R.hasOwnProperty(er)&&im(o,f,er,void 0,R,ft);for(Rt in R)ft=R[Rt],_t=v[Rt],!R.hasOwnProperty(Rt)||ft===_t||ft===void 0&&_t===void 0||im(o,f,Rt,ft,R,_t);return}}for(var it in v)ft=v[it],v.hasOwnProperty(it)&&ft!=null&&!R.hasOwnProperty(it)&&Kn(o,f,it,null,R,ft);for(Bt in R)ft=R[Bt],_t=v[Bt],!R.hasOwnProperty(Bt)||ft===_t||ft==null&&_t==null||Kn(o,f,Bt,ft,R,_t)}var Nf=null,mo=null;function Ff(o){return o.nodeType===9?o:o.ownerDocument}function Eg(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ag(o,f){if(o===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&f==="foreignObject"?0:o}function l_(o,f){return o==="textarea"||o==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var c_=null;function cv(){var o=window.event;return o&&o.type==="popstate"?o===c_?!1:(c_=o,!0):(c_=null,!1)}var Mg=typeof setTimeout=="function"?setTimeout:void 0,uv=typeof clearTimeout=="function"?clearTimeout:void 0,xu=typeof Promise=="function"?Promise:void 0,Ig=typeof queueMicrotask=="function"?queueMicrotask:typeof xu<"u"?function(o){return xu.resolve(null).then(o).catch(nm)}:Mg;function nm(o){setTimeout(function(){throw o})}function Ec(o){return o==="head"}function u_(o,f){var v=f,R=0,L=0;do{var q=v.nextSibling;if(o.removeChild(v),q&&q.nodeType===8)if(v=q.data,v==="/$"){if(0<R&&8>R){v=R;var ne=o.ownerDocument;if(v&1&&kd(ne.documentElement),v&2&&kd(ne.body),v&4)for(v=ne.head,kd(v),ne=v.firstChild;ne;){var ve=ne.nextSibling,Ve=ne.nodeName;ne[Je]||Ve==="SCRIPT"||Ve==="STYLE"||Ve==="LINK"&&ne.rel.toLowerCase()==="stylesheet"||v.removeChild(ne),ne=ve}}if(L===0){o.removeChild(q),Tr(f);return}L--}else v==="$"||v==="$?"||v==="$!"?L++:R=v.charCodeAt(0)-48;else R=0;v=q}while(v);Tr(f)}function Ld(o){var f=o.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var v=f;switch(f=f.nextSibling,v.nodeName){case"HTML":case"HEAD":case"BODY":Ld(v),We(v);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(v.rel.toLowerCase()==="stylesheet")continue}o.removeChild(v)}}function Cg(o,f,v,R){for(;o.nodeType===1;){var L=v;if(o.nodeName.toLowerCase()!==f.toLowerCase()){if(!R&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(R){if(!o[Je])switch(f){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(q=o.getAttribute("rel"),q==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(q!==L.rel||o.getAttribute("href")!==(L.href==null||L.href===""?null:L.href)||o.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin)||o.getAttribute("title")!==(L.title==null?null:L.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(q=o.getAttribute("src"),(q!==(L.src==null?null:L.src)||o.getAttribute("type")!==(L.type==null?null:L.type)||o.getAttribute("crossorigin")!==(L.crossOrigin==null?null:L.crossOrigin))&&q&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(f==="input"&&o.type==="hidden"){var q=L.name==null?null:""+L.name;if(L.type==="hidden"&&o.getAttribute("name")===q)return o}else return o;if(o=Ua(o.nextSibling),o===null)break}return null}function rm(o,f,v){if(f==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!v||(o=Ua(o.nextSibling),o===null))return null;return o}function sm(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState==="complete"}function h_(o,f){var v=o.ownerDocument;if(o.data!=="$?"||v.readyState==="complete")f();else{var R=function(){f(),v.removeEventListener("DOMContentLoaded",R)};v.addEventListener("DOMContentLoaded",R),o._reactRetry=R}}function Ua(o){for(;o!=null;o=o.nextSibling){var f=o.nodeType;if(f===1||f===3)break;if(f===8){if(f=o.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return o}var am=null;function Rg(o){o=o.previousSibling;for(var f=0;o;){if(o.nodeType===8){var v=o.data;if(v==="$"||v==="$!"||v==="$?"){if(f===0)return o;f--}else v==="/$"&&f++}o=o.previousSibling}return null}function d_(o,f,v){switch(f=Ff(v),o){case"html":if(o=f.documentElement,!o)throw Error(D(452));return o;case"head":if(o=f.head,!o)throw Error(D(453));return o;case"body":if(o=f.body,!o)throw Error(D(454));return o;default:throw Error(D(451))}}function kd(o){for(var f=o.attributes;f.length;)o.removeAttributeNode(f[0]);We(o)}var Va=new Map,f_=new Set;function Bd(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var Rl=ri.d;ri.d={f:p_,r:hv,D:dv,C:zg,L:bu,m:Uf,X:om,S:Vf,M:jf};function p_(){var o=Rl.f(),f=Of();return o||f}function hv(o){var f=Ct(o);f!==null&&f.tag===5&&f.type==="form"?_h(f):Rl.r(o)}var Nd=typeof document>"u"?null:document;function Dg(o,f,v){var R=Nd;if(R&&typeof f=="string"&&f){var L=js(f);L='link[rel="'+o+'"][href="'+L+'"]',typeof v=="string"&&(L+='[crossorigin="'+v+'"]'),f_.has(L)||(f_.add(L),o={rel:o,crossOrigin:v,href:f},R.querySelector(L)===null&&(f=R.createElement("link"),bs(f,"link",o),ai(f),R.head.appendChild(f)))}}function dv(o){Rl.D(o),Dg("dns-prefetch",o,null)}function zg(o,f){Rl.C(o,f),Dg("preconnect",o,f)}function bu(o,f,v){Rl.L(o,f,v);var R=Nd;if(R&&o&&f){var L='link[rel="preload"][as="'+js(f)+'"]';f==="image"&&v&&v.imageSrcSet?(L+='[imagesrcset="'+js(v.imageSrcSet)+'"]',typeof v.imageSizes=="string"&&(L+='[imagesizes="'+js(v.imageSizes)+'"]')):L+='[href="'+js(o)+'"]';var q=L;switch(f){case"style":q=Ih(o);break;case"script":q=Ud(o)}Va.has(q)||(o=He({rel:"preload",href:f==="image"&&v&&v.imageSrcSet?void 0:o,as:f},v),Va.set(q,o),R.querySelector(L)!==null||f==="style"&&R.querySelector(Fd(q))||f==="script"&&R.querySelector(Vd(q))||(f=R.createElement("link"),bs(f,"link",o),ai(f),R.head.appendChild(f)))}}function Uf(o,f){Rl.m(o,f);var v=Nd;if(v&&o){var R=f&&typeof f.as=="string"?f.as:"script",L='link[rel="modulepreload"][as="'+js(R)+'"][href="'+js(o)+'"]',q=L;switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":q=Ud(o)}if(!Va.has(q)&&(o=He({rel:"modulepreload",href:o},f),Va.set(q,o),v.querySelector(L)===null)){switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(v.querySelector(Vd(q)))return}R=v.createElement("link"),bs(R,"link",o),ai(R),v.head.appendChild(R)}}}function Vf(o,f,v){Rl.S(o,f,v);var R=Nd;if(R&&o){var L=fi(R).hoistableStyles,q=Ih(o);f=f||"default";var ne=L.get(q);if(!ne){var ve={loading:0,preload:null};if(ne=R.querySelector(Fd(q)))ve.loading=5;else{o=He({rel:"stylesheet",href:o,"data-precedence":f},v),(v=Va.get(q))&&g_(o,v);var Ve=ne=R.createElement("link");ai(Ve),bs(Ve,"link",o),Ve._p=new Promise(function(ht,Rt){Ve.onload=ht,Ve.onerror=Rt}),Ve.addEventListener("load",function(){ve.loading|=1}),Ve.addEventListener("error",function(){ve.loading|=2}),ve.loading|=4,Gf(ne,f,R)}ne={type:"stylesheet",instance:ne,count:1,state:ve},L.set(q,ne)}}}function om(o,f){Rl.X(o,f);var v=Nd;if(v&&o){var R=fi(v).hoistableScripts,L=Ud(o),q=R.get(L);q||(q=v.querySelector(Vd(L)),q||(o=He({src:o,async:!0},f),(f=Va.get(L))&&lm(o,f),q=v.createElement("script"),ai(q),bs(q,"link",o),v.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},R.set(L,q))}}function jf(o,f){Rl.M(o,f);var v=Nd;if(v&&o){var R=fi(v).hoistableScripts,L=Ud(o),q=R.get(L);q||(q=v.querySelector(Vd(L)),q||(o=He({src:o,async:!0,type:"module"},f),(f=Va.get(L))&&lm(o,f),q=v.createElement("script"),ai(q),bs(q,"link",o),v.head.appendChild(q)),q={type:"script",instance:q,count:1,state:null},R.set(L,q))}}function m_(o,f,v,R){var L=(L=Li.current)?Bd(L):null;if(!L)throw Error(D(446));switch(o){case"meta":case"title":return null;case"style":return typeof v.precedence=="string"&&typeof v.href=="string"?(f=Ih(v.href),v=fi(L).hoistableStyles,R=v.get(f),R||(R={type:"style",instance:null,count:0,state:null},v.set(f,R)),R):{type:"void",instance:null,count:0,state:null};case"link":if(v.rel==="stylesheet"&&typeof v.href=="string"&&typeof v.precedence=="string"){o=Ih(v.href);var q=fi(L).hoistableStyles,ne=q.get(o);if(ne||(L=L.ownerDocument||L,ne={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},q.set(o,ne),(q=L.querySelector(Fd(o)))&&!q._p&&(ne.instance=q,ne.state.loading=5),Va.has(o)||(v={rel:"preload",as:"style",href:v.href,crossOrigin:v.crossOrigin,integrity:v.integrity,media:v.media,hrefLang:v.hrefLang,referrerPolicy:v.referrerPolicy},Va.set(o,v),q||fv(L,o,v,ne.state))),f&&R===null)throw Error(D(528,""));return ne}if(f&&R!==null)throw Error(D(529,""));return null;case"script":return f=v.async,v=v.src,typeof v=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=Ud(v),v=fi(L).hoistableScripts,R=v.get(f),R||(R={type:"script",instance:null,count:0,state:null},v.set(f,R)),R):{type:"void",instance:null,count:0,state:null};default:throw Error(D(444,o))}}function Ih(o){return'href="'+js(o)+'"'}function Fd(o){return'link[rel="stylesheet"]['+o+"]"}function __(o){return He({},o,{"data-precedence":o.precedence,precedence:null})}function fv(o,f,v,R){o.querySelector('link[rel="preload"][as="style"]['+f+"]")?R.loading=1:(f=o.createElement("link"),R.preload=f,f.addEventListener("load",function(){return R.loading|=1}),f.addEventListener("error",function(){return R.loading|=2}),bs(f,"link",v),ai(f),o.head.appendChild(f))}function Ud(o){return'[src="'+js(o)+'"]'}function Vd(o){return"script[async]"+o}function qf(o,f,v){if(f.count++,f.instance===null)switch(f.type){case"style":var R=o.querySelector('style[data-href~="'+js(v.href)+'"]');if(R)return f.instance=R,ai(R),R;var L=He({},v,{"data-href":v.href,"data-precedence":v.precedence,href:null,precedence:null});return R=(o.ownerDocument||o).createElement("style"),ai(R),bs(R,"style",L),Gf(R,v.precedence,o),f.instance=R;case"stylesheet":L=Ih(v.href);var q=o.querySelector(Fd(L));if(q)return f.state.loading|=4,f.instance=q,ai(q),q;R=__(v),(L=Va.get(L))&&g_(R,L),q=(o.ownerDocument||o).createElement("link"),ai(q);var ne=q;return ne._p=new Promise(function(ve,Ve){ne.onload=ve,ne.onerror=Ve}),bs(q,"link",R),f.state.loading|=4,Gf(q,v.precedence,o),f.instance=q;case"script":return q=Ud(v.src),(L=o.querySelector(Vd(q)))?(f.instance=L,ai(L),L):(R=v,(L=Va.get(q))&&(R=He({},v),lm(R,L)),o=o.ownerDocument||o,L=o.createElement("script"),ai(L),bs(L,"link",R),o.head.appendChild(L),f.instance=L);case"void":return null;default:throw Error(D(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(R=f.instance,f.state.loading|=4,Gf(R,v.precedence,o));return f.instance}function Gf(o,f,v){for(var R=v.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),L=R.length?R[R.length-1]:null,q=L,ne=0;ne<R.length;ne++){var ve=R[ne];if(ve.dataset.precedence===f)q=ve;else if(q!==L)break}q?q.parentNode.insertBefore(o,q.nextSibling):(f=v.nodeType===9?v.head:v,f.insertBefore(o,f.firstChild))}function g_(o,f){o.crossOrigin==null&&(o.crossOrigin=f.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=f.referrerPolicy),o.title==null&&(o.title=f.title)}function lm(o,f){o.crossOrigin==null&&(o.crossOrigin=f.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=f.referrerPolicy),o.integrity==null&&(o.integrity=f.integrity)}var jd=null;function y_(o,f,v){if(jd===null){var R=new Map,L=jd=new Map;L.set(v,R)}else L=jd,R=L.get(v),R||(R=new Map,L.set(v,R));if(R.has(o))return R;for(R.set(o,null),v=v.getElementsByTagName(o),L=0;L<v.length;L++){var q=v[L];if(!(q[Je]||q[me]||o==="link"&&q.getAttribute("rel")==="stylesheet")&&q.namespaceURI!=="http://www.w3.org/2000/svg"){var ne=q.getAttribute(f)||"";ne=o+ne;var ve=R.get(ne);ve?ve.push(q):R.set(ne,[q])}}return R}function v_(o,f,v){o=o.ownerDocument||o,o.head.insertBefore(v,f==="title"?o.querySelector("head > title"):null)}function Pg(o,f,v){if(v===1||f.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return o=f.disabled,typeof f.precedence=="string"&&o==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function x_(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}var qd=null;function pv(){}function Og(o,f,v){if(qd===null)throw Error(D(475));var R=qd;if(f.type==="stylesheet"&&(typeof v.media!="string"||matchMedia(v.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var L=Ih(v.href),q=o.querySelector(Fd(L));if(q){o=q._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(R.count++,R=wu.bind(R),o.then(R,R)),f.state.loading|=4,f.instance=q,ai(q);return}q=o.ownerDocument||o,v=__(v),(L=Va.get(L))&&g_(v,L),q=q.createElement("link"),ai(q);var ne=q;ne._p=new Promise(function(ve,Ve){ne.onload=ve,ne.onerror=Ve}),bs(q,"link",v),f.instance=q}R.stylesheets===null&&(R.stylesheets=new Map),R.stylesheets.set(f,o),(o=f.state.preload)&&(f.state.loading&3)===0&&(R.count++,f=wu.bind(R),o.addEventListener("load",f),o.addEventListener("error",f))}}function Lg(){if(qd===null)throw Error(D(475));var o=qd;return o.stylesheets&&o.count===0&&cm(o,o.stylesheets),0<o.count?function(f){var v=setTimeout(function(){if(o.stylesheets&&cm(o,o.stylesheets),o.unsuspend){var R=o.unsuspend;o.unsuspend=null,R()}},6e4);return o.unsuspend=f,function(){o.unsuspend=null,clearTimeout(v)}}:null}function wu(){if(this.count--,this.count===0){if(this.stylesheets)cm(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var Hf=null;function cm(o,f){o.stylesheets=null,o.unsuspend!==null&&(o.count++,Hf=new Map,f.forEach(mv,o),Hf=null,wu.call(o))}function mv(o,f){if(!(f.state.loading&4)){var v=Hf.get(o);if(v)var R=v.get(null);else{v=new Map,Hf.set(o,v);for(var L=o.querySelectorAll("link[data-precedence],style[data-precedence]"),q=0;q<L.length;q++){var ne=L[q];(ne.nodeName==="LINK"||ne.getAttribute("media")!=="not all")&&(v.set(ne.dataset.precedence,ne),R=ne)}R&&v.set(null,R)}L=f.instance,ne=L.getAttribute("data-precedence"),q=v.get(ne)||R,q===R&&v.set(null,L),v.set(ne,L),this.count++,R=wu.bind(this),L.addEventListener("load",R),L.addEventListener("error",R),q?q.parentNode.insertBefore(L,q.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(L,o.firstChild)),f.state.loading|=4}}var Zf={$$typeof:qt,Provider:null,Consumer:null,_currentValue:Ni,_currentValue2:Ni,_threadCount:0};function _v(o,f,v,R,L,q,ne,ve){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=rs(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rs(0),this.hiddenUpdates=rs(null),this.identifierPrefix=R,this.onUncaughtError=L,this.onCaughtError=q,this.onRecoverableError=ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ve,this.incompleteTransitions=new Map}function kg(o,f,v,R,L,q,ne,ve,Ve,ht,Rt,Bt){return o=new _v(o,f,v,ne,ve,Ve,ht,Bt),f=1,q===!0&&(f|=24),q=Ds(3,null,null,f),o.current=q,q.stateNode=o,f=Qh(),f.refCount++,o.pooledCache=f,f.refCount++,q.memoizedState={element:R,isDehydrated:v,cache:f},Yt(q),o}function Bg(o){return o?(o=Jl,o):Jl}function Ng(o,f,v,R,L,q){L=Bg(L),R.context===null?R.context=L:R.pendingContext=L,R=cl(f),R.payload={element:v},q=q===void 0?null:q,q!==null&&(R.callback=q),v=Do(o,R,f),v!==null&&(Ta(v,o,f),ul(v,o,f))}function Fg(o,f){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var v=o.retryLane;o.retryLane=v!==0&&v<f?v:f}}function um(o,f){Fg(o,f),(o=o.alternate)&&Fg(o,f)}function Ug(o){if(o.tag===13){var f=Rs(o,67108864);f!==null&&Ta(f,o,67108864),um(o,67108864)}}var hm=!0;function gv(o,f,v,R){var L=bt.T;bt.T=null;var q=ri.p;try{ri.p=2,$f(o,f,v,R)}finally{ri.p=q,bt.T=L}}function b_(o,f,v,R){var L=bt.T;bt.T=null;var q=ri.p;try{ri.p=8,$f(o,f,v,R)}finally{ri.p=q,bt.T=L}}function $f(o,f,v,R){if(hm){var L=dm(R);if(L===null)a_(o,f,R,Xf,v),T_(o,R);else if(yv(L,o,f,v,R))R.stopPropagation();else if(T_(o,R),f&4&&-1<Wf.indexOf(o)){for(;L!==null;){var q=Ct(L);if(q!==null)switch(q.tag){case 3:if(q=q.stateNode,q.current.memoizedState.isDehydrated){var ne=Gr(q.pendingLanes);if(ne!==0){var ve=q;for(ve.pendingLanes|=2,ve.entangledLanes|=2;ne;){var Ve=1<<31-Ar(ne);ve.entanglements[1]|=Ve,ne&=~Ve}Sa(q),(Si&6)===0&&(ar=jr()+500,Ah(0))}}break;case 13:ve=Rs(q,2),ve!==null&&Ta(ve,q,2),Of(),um(q,2)}if(q=dm(R),q===null&&a_(o,f,R,Xf,v),q===L)break;L=q}L!==null&&R.stopPropagation()}else a_(o,f,R,null,v)}}function dm(o){return o=Nu(o),fm(o)}var Xf=null;function fm(o){if(Xf=null,o=pt(o),o!==null){var f=K(o);if(f===null)o=null;else{var v=f.tag;if(v===13){if(o=re(f),o!==null)return o;o=null}else if(v===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;o=null}else f!==o&&(o=null)}}return Xf=o,null}function w_(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Gi()){case Er:return 2;case Ma:return 8;case Xa:case _o:return 32;case kl:return 268435456;default:return 32}default:return 32}}var pm=!1,Ac=null,Mc=null,Ic=null,Ch=new Map,Gd=new Map,Tu=[],Wf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function T_(o,f){switch(o){case"focusin":case"focusout":Ac=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Ic=null;break;case"pointerover":case"pointerout":Ch.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gd.delete(f.pointerId)}}function Yf(o,f,v,R,L,q){return o===null||o.nativeEvent!==q?(o={blockedOn:f,domEventName:v,eventSystemFlags:R,nativeEvent:q,targetContainers:[L]},f!==null&&(f=Ct(f),f!==null&&Ug(f)),o):(o.eventSystemFlags|=R,f=o.targetContainers,L!==null&&f.indexOf(L)===-1&&f.push(L),o)}function yv(o,f,v,R,L){switch(f){case"focusin":return Ac=Yf(Ac,o,f,v,R,L),!0;case"dragenter":return Mc=Yf(Mc,o,f,v,R,L),!0;case"mouseover":return Ic=Yf(Ic,o,f,v,R,L),!0;case"pointerover":var q=L.pointerId;return Ch.set(q,Yf(Ch.get(q)||null,o,f,v,R,L)),!0;case"gotpointercapture":return q=L.pointerId,Gd.set(q,Yf(Gd.get(q)||null,o,f,v,R,L)),!0}return!1}function Vg(o){var f=pt(o.target);if(f!==null){var v=K(f);if(v!==null){if(f=v.tag,f===13){if(f=re(v),f!==null){o.blockedOn=f,te(o.priority,function(){if(v.tag===13){var R=xs();R=jc(R);var L=Rs(v,R);L!==null&&Ta(L,v,R),um(v,R)}});return}}else if(f===3&&v.stateNode.current.memoizedState.isDehydrated){o.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}o.blockedOn=null}function mm(o){if(o.blockedOn!==null)return!1;for(var f=o.targetContainers;0<f.length;){var v=dm(o.nativeEvent);if(v===null){v=o.nativeEvent;var R=new v.constructor(v.type,v);on=R,v.target.dispatchEvent(R),on=null}else return f=Ct(v),f!==null&&Ug(f),o.blockedOn=v,!1;f.shift()}return!0}function jg(o,f,v){mm(o)&&v.delete(f)}function vv(){pm=!1,Ac!==null&&mm(Ac)&&(Ac=null),Mc!==null&&mm(Mc)&&(Mc=null),Ic!==null&&mm(Ic)&&(Ic=null),Ch.forEach(jg),Gd.forEach(jg)}function _m(o,f){o.blockedOn===f&&(o.blockedOn=null,pm||(pm=!0,b.unstable_scheduleCallback(b.unstable_NormalPriority,vv)))}var Kf=null;function qg(o){Kf!==o&&(Kf=o,b.unstable_scheduleCallback(b.unstable_NormalPriority,function(){Kf===o&&(Kf=null);for(var f=0;f<o.length;f+=3){var v=o[f],R=o[f+1],L=o[f+2];if(typeof R!="function"){if(fm(R||v)===null)continue;break}var q=Ct(v);q!==null&&(o.splice(f,3),f-=3,ou(q,{pending:!0,data:L,method:v.method,action:R},R,L))}}))}function Tr(o){function f(Ve){return _m(Ve,o)}Ac!==null&&_m(Ac,o),Mc!==null&&_m(Mc,o),Ic!==null&&_m(Ic,o),Ch.forEach(f),Gd.forEach(f);for(var v=0;v<Tu.length;v++){var R=Tu[v];R.blockedOn===o&&(R.blockedOn=null)}for(;0<Tu.length&&(v=Tu[0],v.blockedOn===null);)Vg(v),v.blockedOn===null&&Tu.shift();if(v=(o.ownerDocument||o).$$reactFormReplay,v!=null)for(R=0;R<v.length;R+=3){var L=v[R],q=v[R+1],ne=L[Se]||null;if(typeof q=="function")ne||qg(v);else if(ne){var ve=null;if(q&&q.hasAttribute("formAction")){if(L=q,ne=q[Se]||null)ve=ne.formAction;else if(fm(L)!==null)continue}else ve=ne.action;typeof ve=="function"?v[R+1]=ve:(v.splice(R,3),R-=3),qg(v)}}}function ja(o){this._internalRoot=o}Jf.prototype.render=ja.prototype.render=function(o){var f=this._internalRoot;if(f===null)throw Error(D(409));var v=f.current,R=xs();Ng(v,R,o,f,null,null)},Jf.prototype.unmount=ja.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var f=o.containerInfo;Ng(o.current,2,null,o,null,null),Of(),f[Ee]=null}};function Jf(o){this._internalRoot=o}Jf.prototype.unstable_scheduleHydration=function(o){if(o){var f=Ye();o={blockedOn:null,target:o,priority:f};for(var v=0;v<Tu.length&&f!==0&&f<Tu[v].priority;v++);Tu.splice(v,0,o),v===0&&Vg(o)}};var gm=m.version;if(gm!=="19.1.0")throw Error(D(527,gm,"19.1.0"));ri.findDOMNode=function(o){var f=o._reactInternals;if(f===void 0)throw typeof o.render=="function"?Error(D(188)):(o=Object.keys(o).join(","),Error(D(268,o)));return o=pe(f),o=o!==null?Ce(o):null,o=o===null?null:o.stateNode,o};var ym={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:bt,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cc.isDisabled&&Cc.supportsFiber)try{aa=Cc.inject(ym),qr=Cc}catch{}}return Z_.createRoot=function(o,f){if(!V(o))throw Error(D(299));var v=!1,R="",L=If,q=Cf,ne=du,ve=null;return f!=null&&(f.unstable_strictMode===!0&&(v=!0),f.identifierPrefix!==void 0&&(R=f.identifierPrefix),f.onUncaughtError!==void 0&&(L=f.onUncaughtError),f.onCaughtError!==void 0&&(q=f.onCaughtError),f.onRecoverableError!==void 0&&(ne=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(ve=f.unstable_transitionCallbacks)),f=kg(o,1,!1,null,null,v,R,L,q,ne,ve,null),o[Ee]=f.current,em(o),new ja(f)},Z_.hydrateRoot=function(o,f,v){if(!V(o))throw Error(D(299));var R=!1,L="",q=If,ne=Cf,ve=du,Ve=null,ht=null;return v!=null&&(v.unstable_strictMode===!0&&(R=!0),v.identifierPrefix!==void 0&&(L=v.identifierPrefix),v.onUncaughtError!==void 0&&(q=v.onUncaughtError),v.onCaughtError!==void 0&&(ne=v.onCaughtError),v.onRecoverableError!==void 0&&(ve=v.onRecoverableError),v.unstable_transitionCallbacks!==void 0&&(Ve=v.unstable_transitionCallbacks),v.formState!==void 0&&(ht=v.formState)),f=kg(o,1,!0,f,v??null,R,L,q,ne,ve,Ve,ht),f.context=Bg(null),v=f.current,R=xs(),R=jc(R),L=cl(R),L.callback=null,Do(v,L,R),v=R,f.current.lanes=v,Ia(f,v),Sa(f),o[Ee]=f.current,em(o),new Jf(f)},Z_.version="19.1.0",Z_}var Zb;function _E(){if(Zb)return h0.exports;Zb=1;function b(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(b)}catch(m){console.error(m)}}return b(),h0.exports=mE(),h0.exports}var gE=_E();const yE=ix(gE);var m0={exports:{}},_0={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $b;function vE(){if($b)return _0;$b=1;var b=Wy();function m(pe,Ce){return pe===Ce&&(pe!==0||1/pe===1/Ce)||pe!==pe&&Ce!==Ce}var S=typeof Object.is=="function"?Object.is:m,D=b.useSyncExternalStore,V=b.useRef,K=b.useEffect,re=b.useMemo,s=b.useDebugValue;return _0.useSyncExternalStoreWithSelector=function(pe,Ce,He,wt,gt){var Xt=V(null);if(Xt.current===null){var jt={hasValue:!1,value:null};Xt.current=jt}else jt=Xt.current;Xt=re(function(){function vi(kt){if(!at){if(at=!0,ni=kt,kt=wt(kt),gt!==void 0&&jt.hasValue){var Oi=jt.value;if(gt(Oi,kt))return qt=Oi}return qt=kt}if(Oi=qt,S(ni,kt))return Oi;var Gt=wt(kt);return gt!==void 0&&gt(Oi,Gt)?(ni=kt,Oi):(ni=kt,qt=Gt)}var at=!1,ni,qt,$t=He===void 0?null:He;return[function(){return vi(Ce())},$t===null?void 0:function(){return vi($t())}]},[Ce,He,wt,gt]);var hi=D(pe,Xt[0],Xt[1]);return K(function(){jt.hasValue=!0,jt.value=hi},[hi]),s(hi),hi},_0}var Xb;function xE(){return Xb||(Xb=1,m0.exports=vE()),m0.exports}var bE=xE();function wE(b){b()}function TE(){let b=null,m=null;return{clear(){b=null,m=null},notify(){wE(()=>{let S=b;for(;S;)S.callback(),S=S.next})},get(){const S=[];let D=b;for(;D;)S.push(D),D=D.next;return S},subscribe(S){let D=!0;const V=m={callback:S,next:null,prev:m};return V.prev?V.prev.next=V:b=V,function(){!D||b===null||(D=!1,V.next?V.next.prev=V.prev:m=V.prev,V.prev?V.prev.next=V.next:b=V.next)}}}}var Wb={notify(){},get:()=>[]};function SE(b,m){let S,D=Wb,V=0,K=!1;function re(hi){He();const vi=D.subscribe(hi);let at=!1;return()=>{at||(at=!0,vi(),wt())}}function s(){D.notify()}function pe(){jt.onStateChange&&jt.onStateChange()}function Ce(){return K}function He(){V++,S||(S=b.subscribe(pe),D=TE())}function wt(){V--,S&&V===0&&(S(),S=void 0,D.clear(),D=Wb)}function gt(){K||(K=!0,He())}function Xt(){K&&(K=!1,wt())}const jt={addNestedSub:re,notifyNestedSubs:s,handleChangeWrapper:pe,isSubscribed:Ce,trySubscribe:gt,tryUnsubscribe:Xt,getListeners:()=>D};return jt}var EE=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",AE=EE(),ME=()=>typeof navigator<"u"&&navigator.product==="ReactNative",IE=ME(),CE=()=>AE||IE?Ii.useLayoutEffect:Ii.useEffect,RE=CE(),g0=Symbol.for("react-redux-context"),y0=typeof globalThis<"u"?globalThis:{};function DE(){if(!Ii.createContext)return{};const b=y0[g0]??(y0[g0]=new Map);let m=b.get(Ii.createContext);return m||(m=Ii.createContext(null),b.set(Ii.createContext,m)),m}var of=DE();function zE(b){const{children:m,context:S,serverState:D,store:V}=b,K=Ii.useMemo(()=>{const pe=SE(V);return{store:V,subscription:pe,getServerState:D?()=>D:void 0}},[V,D]),re=Ii.useMemo(()=>V.getState(),[V]);RE(()=>{const{subscription:pe}=K;return pe.onStateChange=pe.notifyNestedSubs,pe.trySubscribe(),re!==V.getState()&&pe.notifyNestedSubs(),()=>{pe.tryUnsubscribe(),pe.onStateChange=void 0}},[K,re]);const s=S||of;return Ii.createElement(s.Provider,{value:K},m)}var PE=zE;function nx(b=of){return function(){return Ii.useContext(b)}}var Hw=nx();function Zw(b=of){const m=b===of?Hw:nx(b),S=()=>{const{store:D}=m();return D};return Object.assign(S,{withTypes:()=>S}),S}var OE=Zw();function LE(b=of){const m=b===of?OE:Zw(b),S=()=>m().dispatch;return Object.assign(S,{withTypes:()=>S}),S}var lf=LE(),kE=(b,m)=>b===m;function BE(b=of){const m=b===of?Hw:nx(b),S=(D,V={})=>{const{equalityFn:K=kE}=typeof V=="function"?{equalityFn:V}:V,re=m(),{store:s,subscription:pe,getServerState:Ce}=re;Ii.useRef(!0);const He=Ii.useCallback({[D.name](gt){return D(gt)}}[D.name],[D]),wt=bE.useSyncExternalStoreWithSelector(pe.addNestedSub,s.getState,Ce||s.getState,He,K);return Ii.useDebugValue(wt),wt};return Object.assign(S,{withTypes:()=>S}),S}var An=BE();function sa(b){return`Minified Redux error #${b}; visit https://redux.js.org/Errors?code=${b} for the full message or use the non-minified dev environment for full errors. `}var NE=typeof Symbol=="function"&&Symbol.observable||"@@observable",Yb=NE,v0=()=>Math.random().toString(36).substring(7).split("").join("."),FE={INIT:`@@redux/INIT${v0()}`,REPLACE:`@@redux/REPLACE${v0()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${v0()}`},By=FE;function rx(b){if(typeof b!="object"||b===null)return!1;let m=b;for(;Object.getPrototypeOf(m)!==null;)m=Object.getPrototypeOf(m);return Object.getPrototypeOf(b)===m||Object.getPrototypeOf(b)===null}function $w(b,m,S){if(typeof b!="function")throw new Error(sa(2));if(typeof m=="function"&&typeof S=="function"||typeof S=="function"&&typeof arguments[3]=="function")throw new Error(sa(0));if(typeof m=="function"&&typeof S>"u"&&(S=m,m=void 0),typeof S<"u"){if(typeof S!="function")throw new Error(sa(1));return S($w)(b,m)}let D=b,V=m,K=new Map,re=K,s=0,pe=!1;function Ce(){re===K&&(re=new Map,K.forEach((vi,at)=>{re.set(at,vi)}))}function He(){if(pe)throw new Error(sa(3));return V}function wt(vi){if(typeof vi!="function")throw new Error(sa(4));if(pe)throw new Error(sa(5));let at=!0;Ce();const ni=s++;return re.set(ni,vi),function(){if(at){if(pe)throw new Error(sa(6));at=!1,Ce(),re.delete(ni),K=null}}}function gt(vi){if(!rx(vi))throw new Error(sa(7));if(typeof vi.type>"u")throw new Error(sa(8));if(typeof vi.type!="string")throw new Error(sa(17));if(pe)throw new Error(sa(9));try{pe=!0,V=D(V,vi)}finally{pe=!1}return(K=re).forEach(ni=>{ni()}),vi}function Xt(vi){if(typeof vi!="function")throw new Error(sa(10));D=vi,gt({type:By.REPLACE})}function jt(){const vi=wt;return{subscribe(at){if(typeof at!="object"||at===null)throw new Error(sa(11));function ni(){const $t=at;$t.next&&$t.next(He())}return ni(),{unsubscribe:vi(ni)}},[Yb](){return this}}}return gt({type:By.INIT}),{dispatch:gt,subscribe:wt,getState:He,replaceReducer:Xt,[Yb]:jt}}function UE(b){Object.keys(b).forEach(m=>{const S=b[m];if(typeof S(void 0,{type:By.INIT})>"u")throw new Error(sa(12));if(typeof S(void 0,{type:By.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(sa(13))})}function VE(b){const m=Object.keys(b),S={};for(let K=0;K<m.length;K++){const re=m[K];typeof b[re]=="function"&&(S[re]=b[re])}const D=Object.keys(S);let V;try{UE(S)}catch(K){V=K}return function(re={},s){if(V)throw V;let pe=!1;const Ce={};for(let He=0;He<D.length;He++){const wt=D[He],gt=S[wt],Xt=re[wt],jt=gt(Xt,s);if(typeof jt>"u")throw s&&s.type,new Error(sa(14));Ce[wt]=jt,pe=pe||jt!==Xt}return pe=pe||D.length!==Object.keys(re).length,pe?Ce:re}}function Ny(...b){return b.length===0?m=>m:b.length===1?b[0]:b.reduce((m,S)=>(...D)=>m(S(...D)))}function jE(...b){return m=>(S,D)=>{const V=m(S,D);let K=()=>{throw new Error(sa(15))};const re={getState:V.getState,dispatch:(pe,...Ce)=>K(pe,...Ce)},s=b.map(pe=>pe(re));return K=Ny(...s)(V.dispatch),{...V,dispatch:K}}}function qE(b){return rx(b)&&"type"in b&&typeof b.type=="string"}var Xw=Symbol.for("immer-nothing"),Kb=Symbol.for("immer-draftable"),jo=Symbol.for("immer-state");function Nc(b,...m){throw new Error(`[Immer] minified error nr: ${b}. Full error at: https://bit.ly/3cXEKWf`)}var Um=Object.getPrototypeOf;function hp(b){return!!b&&!!b[jo]}function Lh(b){var m;return b?Ww(b)||Array.isArray(b)||!!b[Kb]||!!((m=b.constructor)!=null&&m[Kb])||Ky(b)||Jy(b):!1}var GE=Object.prototype.constructor.toString();function Ww(b){if(!b||typeof b!="object")return!1;const m=Um(b);if(m===null)return!0;const S=Object.hasOwnProperty.call(m,"constructor")&&m.constructor;return S===Object?!0:typeof S=="function"&&Function.toString.call(S)===GE}function Fy(b,m){Yy(b)===0?Reflect.ownKeys(b).forEach(S=>{m(S,b[S],b)}):b.forEach((S,D)=>m(D,S,b))}function Yy(b){const m=b[jo];return m?m.type_:Array.isArray(b)?1:Ky(b)?2:Jy(b)?3:0}function O0(b,m){return Yy(b)===2?b.has(m):Object.prototype.hasOwnProperty.call(b,m)}function Yw(b,m,S){const D=Yy(b);D===2?b.set(m,S):D===3?b.add(S):b[m]=S}function HE(b,m){return b===m?b!==0||1/b===1/m:b!==b&&m!==m}function Ky(b){return b instanceof Map}function Jy(b){return b instanceof Set}function op(b){return b.copy_||b.base_}function L0(b,m){if(Ky(b))return new Map(b);if(Jy(b))return new Set(b);if(Array.isArray(b))return Array.prototype.slice.call(b);const S=Ww(b);if(m===!0||m==="class_only"&&!S){const D=Object.getOwnPropertyDescriptors(b);delete D[jo];let V=Reflect.ownKeys(D);for(let K=0;K<V.length;K++){const re=V[K],s=D[re];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(D[re]={configurable:!0,writable:!0,enumerable:s.enumerable,value:b[re]})}return Object.create(Um(b),D)}else{const D=Um(b);if(D!==null&&S)return{...b};const V=Object.create(D);return Object.assign(V,b)}}function sx(b,m=!1){return Qy(b)||hp(b)||!Lh(b)||(Yy(b)>1&&(b.set=b.add=b.clear=b.delete=ZE),Object.freeze(b),m&&Object.entries(b).forEach(([S,D])=>sx(D,!0))),b}function ZE(){Nc(2)}function Qy(b){return Object.isFrozen(b)}var $E={};function dp(b){const m=$E[b];return m||Nc(0,b),m}var K_;function Kw(){return K_}function XE(b,m){return{drafts_:[],parent_:b,immer_:m,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Jb(b,m){m&&(dp("Patches"),b.patches_=[],b.inversePatches_=[],b.patchListener_=m)}function k0(b){B0(b),b.drafts_.forEach(WE),b.drafts_=null}function B0(b){b===K_&&(K_=b.parent_)}function Qb(b){return K_=XE(K_,b)}function WE(b){const m=b[jo];m.type_===0||m.type_===1?m.revoke_():m.revoked_=!0}function ew(b,m){m.unfinalizedDrafts_=m.drafts_.length;const S=m.drafts_[0];return b!==void 0&&b!==S?(S[jo].modified_&&(k0(m),Nc(4)),Lh(b)&&(b=Uy(m,b),m.parent_||Vy(m,b)),m.patches_&&dp("Patches").generateReplacementPatches_(S[jo].base_,b,m.patches_,m.inversePatches_)):b=Uy(m,S,[]),k0(m),m.patches_&&m.patchListener_(m.patches_,m.inversePatches_),b!==Xw?b:void 0}function Uy(b,m,S){if(Qy(m))return m;const D=m[jo];if(!D)return Fy(m,(V,K)=>tw(b,D,m,V,K,S)),m;if(D.scope_!==b)return m;if(!D.modified_)return Vy(b,D.base_,!0),D.base_;if(!D.finalized_){D.finalized_=!0,D.scope_.unfinalizedDrafts_--;const V=D.copy_;let K=V,re=!1;D.type_===3&&(K=new Set(V),V.clear(),re=!0),Fy(K,(s,pe)=>tw(b,D,V,s,pe,S,re)),Vy(b,V,!1),S&&b.patches_&&dp("Patches").generatePatches_(D,S,b.patches_,b.inversePatches_)}return D.copy_}function tw(b,m,S,D,V,K,re){if(hp(V)){const s=K&&m&&m.type_!==3&&!O0(m.assigned_,D)?K.concat(D):void 0,pe=Uy(b,V,s);if(Yw(S,D,pe),hp(pe))b.canAutoFreeze_=!1;else return}else re&&S.add(V);if(Lh(V)&&!Qy(V)){if(!b.immer_.autoFreeze_&&b.unfinalizedDrafts_<1)return;Uy(b,V),(!m||!m.scope_.parent_)&&typeof D!="symbol"&&Object.prototype.propertyIsEnumerable.call(S,D)&&Vy(b,V)}}function Vy(b,m,S=!1){!b.parent_&&b.immer_.autoFreeze_&&b.canAutoFreeze_&&sx(m,S)}function YE(b,m){const S=Array.isArray(b),D={type_:S?1:0,scope_:m?m.scope_:Kw(),modified_:!1,finalized_:!1,assigned_:{},parent_:m,base_:b,draft_:null,copy_:null,revoke_:null,isManual_:!1};let V=D,K=ax;S&&(V=[D],K=J_);const{revoke:re,proxy:s}=Proxy.revocable(V,K);return D.draft_=s,D.revoke_=re,s}var ax={get(b,m){if(m===jo)return b;const S=op(b);if(!O0(S,m))return KE(b,S,m);const D=S[m];return b.finalized_||!Lh(D)?D:D===x0(b.base_,m)?(b0(b),b.copy_[m]=F0(D,b)):D},has(b,m){return m in op(b)},ownKeys(b){return Reflect.ownKeys(op(b))},set(b,m,S){const D=Jw(op(b),m);if(D!=null&&D.set)return D.set.call(b.draft_,S),!0;if(!b.modified_){const V=x0(op(b),m),K=V==null?void 0:V[jo];if(K&&K.base_===S)return b.copy_[m]=S,b.assigned_[m]=!1,!0;if(HE(S,V)&&(S!==void 0||O0(b.base_,m)))return!0;b0(b),N0(b)}return b.copy_[m]===S&&(S!==void 0||m in b.copy_)||Number.isNaN(S)&&Number.isNaN(b.copy_[m])||(b.copy_[m]=S,b.assigned_[m]=!0),!0},deleteProperty(b,m){return x0(b.base_,m)!==void 0||m in b.base_?(b.assigned_[m]=!1,b0(b),N0(b)):delete b.assigned_[m],b.copy_&&delete b.copy_[m],!0},getOwnPropertyDescriptor(b,m){const S=op(b),D=Reflect.getOwnPropertyDescriptor(S,m);return D&&{writable:!0,configurable:b.type_!==1||m!=="length",enumerable:D.enumerable,value:S[m]}},defineProperty(){Nc(11)},getPrototypeOf(b){return Um(b.base_)},setPrototypeOf(){Nc(12)}},J_={};Fy(ax,(b,m)=>{J_[b]=function(){return arguments[0]=arguments[0][0],m.apply(this,arguments)}});J_.deleteProperty=function(b,m){return J_.set.call(this,b,m,void 0)};J_.set=function(b,m,S){return ax.set.call(this,b[0],m,S,b[0])};function x0(b,m){const S=b[jo];return(S?op(S):b)[m]}function KE(b,m,S){var V;const D=Jw(m,S);return D?"value"in D?D.value:(V=D.get)==null?void 0:V.call(b.draft_):void 0}function Jw(b,m){if(!(m in b))return;let S=Um(b);for(;S;){const D=Object.getOwnPropertyDescriptor(S,m);if(D)return D;S=Um(S)}}function N0(b){b.modified_||(b.modified_=!0,b.parent_&&N0(b.parent_))}function b0(b){b.copy_||(b.copy_=L0(b.base_,b.scope_.immer_.useStrictShallowCopy_))}var JE=class{constructor(b){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(m,S,D)=>{if(typeof m=="function"&&typeof S!="function"){const K=S;S=m;const re=this;return function(pe=K,...Ce){return re.produce(pe,He=>S.call(this,He,...Ce))}}typeof S!="function"&&Nc(6),D!==void 0&&typeof D!="function"&&Nc(7);let V;if(Lh(m)){const K=Qb(this),re=F0(m,void 0);let s=!0;try{V=S(re),s=!1}finally{s?k0(K):B0(K)}return Jb(K,D),ew(V,K)}else if(!m||typeof m!="object"){if(V=S(m),V===void 0&&(V=m),V===Xw&&(V=void 0),this.autoFreeze_&&sx(V,!0),D){const K=[],re=[];dp("Patches").generateReplacementPatches_(m,V,K,re),D(K,re)}return V}else Nc(1,m)},this.produceWithPatches=(m,S)=>{if(typeof m=="function")return(re,...s)=>this.produceWithPatches(re,pe=>m(pe,...s));let D,V;return[this.produce(m,S,(re,s)=>{D=re,V=s}),D,V]},typeof(b==null?void 0:b.autoFreeze)=="boolean"&&this.setAutoFreeze(b.autoFreeze),typeof(b==null?void 0:b.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(b.useStrictShallowCopy)}createDraft(b){Lh(b)||Nc(8),hp(b)&&(b=QE(b));const m=Qb(this),S=F0(b,void 0);return S[jo].isManual_=!0,B0(m),S}finishDraft(b,m){const S=b&&b[jo];(!S||!S.isManual_)&&Nc(9);const{scope_:D}=S;return Jb(D,m),ew(void 0,D)}setAutoFreeze(b){this.autoFreeze_=b}setUseStrictShallowCopy(b){this.useStrictShallowCopy_=b}applyPatches(b,m){let S;for(S=m.length-1;S>=0;S--){const V=m[S];if(V.path.length===0&&V.op==="replace"){b=V.value;break}}S>-1&&(m=m.slice(S+1));const D=dp("Patches").applyPatches_;return hp(b)?D(b,m):this.produce(b,V=>D(V,m))}};function F0(b,m){const S=Ky(b)?dp("MapSet").proxyMap_(b,m):Jy(b)?dp("MapSet").proxySet_(b,m):YE(b,m);return(m?m.scope_:Kw()).drafts_.push(S),S}function QE(b){return hp(b)||Nc(10,b),Qw(b)}function Qw(b){if(!Lh(b)||Qy(b))return b;const m=b[jo];let S;if(m){if(!m.modified_)return m.base_;m.finalized_=!0,S=L0(b,m.scope_.immer_.useStrictShallowCopy_)}else S=L0(b,!0);return Fy(S,(D,V)=>{Yw(S,D,Qw(V))}),m&&(m.finalized_=!1),S}var qo=new JE,eT=qo.produce;qo.produceWithPatches.bind(qo);qo.setAutoFreeze.bind(qo);qo.setUseStrictShallowCopy.bind(qo);qo.applyPatches.bind(qo);qo.createDraft.bind(qo);qo.finishDraft.bind(qo);function tT(b){return({dispatch:S,getState:D})=>V=>K=>typeof K=="function"?K(S,D,b):V(K)}var eA=tT(),tA=tT,iA=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Ny:Ny.apply(null,arguments)};function iw(b,m){function S(...D){if(m){let V=m(...D);if(!V)throw new Error(Oh(0));return{type:b,payload:V.payload,..."meta"in V&&{meta:V.meta},..."error"in V&&{error:V.error}}}return{type:b,payload:D[0]}}return S.toString=()=>`${b}`,S.type=b,S.match=D=>qE(D)&&D.type===b,S}var iT=class X_ extends Array{constructor(...m){super(...m),Object.setPrototypeOf(this,X_.prototype)}static get[Symbol.species](){return X_}concat(...m){return super.concat.apply(this,m)}prepend(...m){return m.length===1&&Array.isArray(m[0])?new X_(...m[0].concat(this)):new X_(...m.concat(this))}};function nw(b){return Lh(b)?eT(b,()=>{}):b}function rw(b,m,S){return b.has(m)?b.get(m):b.set(m,S(m)).get(m)}function nA(b){return typeof b=="boolean"}var rA=()=>function(m){const{thunk:S=!0,immutableCheck:D=!0,serializableCheck:V=!0,actionCreatorCheck:K=!0}=m??{};let re=new iT;return S&&(nA(S)?re.push(eA):re.push(tA(S.extraArgument))),re},sA="RTK_autoBatch",sw=b=>m=>{setTimeout(m,b)},aA=(b={type:"raf"})=>m=>(...S)=>{const D=m(...S);let V=!0,K=!1,re=!1;const s=new Set,pe=b.type==="tick"?queueMicrotask:b.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:sw(10):b.type==="callback"?b.queueNotification:sw(b.timeout),Ce=()=>{re=!1,K&&(K=!1,s.forEach(He=>He()))};return Object.assign({},D,{subscribe(He){const wt=()=>V&&He(),gt=D.subscribe(wt);return s.add(He),()=>{gt(),s.delete(He)}},dispatch(He){var wt;try{return V=!((wt=He==null?void 0:He.meta)!=null&&wt[sA]),K=!V,K&&(re||(re=!0,pe(Ce))),D.dispatch(He)}finally{V=!0}}})},oA=b=>function(S){const{autoBatch:D=!0}=S??{};let V=new iT(b);return D&&V.push(aA(typeof D=="object"?D:void 0)),V};function lA(b){const m=rA(),{reducer:S=void 0,middleware:D,devTools:V=!0,preloadedState:K=void 0,enhancers:re=void 0}=b||{};let s;if(typeof S=="function")s=S;else if(rx(S))s=VE(S);else throw new Error(Oh(1));let pe;typeof D=="function"?pe=D(m):pe=m();let Ce=Ny;V&&(Ce=iA({trace:!1,...typeof V=="object"&&V}));const He=jE(...pe),wt=oA(He);let gt=typeof re=="function"?re(wt):wt();const Xt=Ce(...gt);return $w(s,K,Xt)}function nT(b){const m={},S=[];let D;const V={addCase(K,re){const s=typeof K=="string"?K:K.type;if(!s)throw new Error(Oh(28));if(s in m)throw new Error(Oh(29));return m[s]=re,V},addMatcher(K,re){return S.push({matcher:K,reducer:re}),V},addDefaultCase(K){return D=K,V}};return b(V),[m,S,D]}function cA(b){return typeof b=="function"}function uA(b,m){let[S,D,V]=nT(m),K;if(cA(b))K=()=>nw(b());else{const s=nw(b);K=()=>s}function re(s=K(),pe){let Ce=[S[pe.type],...D.filter(({matcher:He})=>He(pe)).map(({reducer:He})=>He)];return Ce.filter(He=>!!He).length===0&&(Ce=[V]),Ce.reduce((He,wt)=>{if(wt)if(hp(He)){const Xt=wt(He,pe);return Xt===void 0?He:Xt}else{if(Lh(He))return eT(He,gt=>wt(gt,pe));{const gt=wt(He,pe);if(gt===void 0){if(He===null)return He;throw Error("A case reducer on a non-draftable value must not return undefined")}return gt}}return He},s)}return re.getInitialState=K,re}var hA=Symbol.for("rtk-slice-createasyncthunk");function dA(b,m){return`${b}/${m}`}function fA({creators:b}={}){var S;const m=(S=b==null?void 0:b.asyncThunk)==null?void 0:S[hA];return function(V){const{name:K,reducerPath:re=K}=V;if(!K)throw new Error(Oh(11));const s=(typeof V.reducers=="function"?V.reducers(mA()):V.reducers)||{},pe=Object.keys(s),Ce={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},He={addCase(qt,$t){const kt=typeof qt=="string"?qt:qt.type;if(!kt)throw new Error(Oh(12));if(kt in Ce.sliceCaseReducersByType)throw new Error(Oh(13));return Ce.sliceCaseReducersByType[kt]=$t,He},addMatcher(qt,$t){return Ce.sliceMatchers.push({matcher:qt,reducer:$t}),He},exposeAction(qt,$t){return Ce.actionCreators[qt]=$t,He},exposeCaseReducer(qt,$t){return Ce.sliceCaseReducersByName[qt]=$t,He}};pe.forEach(qt=>{const $t=s[qt],kt={reducerName:qt,type:dA(K,qt),createNotation:typeof V.reducers=="function"};gA($t)?vA(kt,$t,He,m):_A(kt,$t,He)});function wt(){const[qt={},$t=[],kt=void 0]=typeof V.extraReducers=="function"?nT(V.extraReducers):[V.extraReducers],Oi={...qt,...Ce.sliceCaseReducersByType};return uA(V.initialState,Gt=>{for(let oi in Oi)Gt.addCase(oi,Oi[oi]);for(let oi of Ce.sliceMatchers)Gt.addMatcher(oi.matcher,oi.reducer);for(let oi of $t)Gt.addMatcher(oi.matcher,oi.reducer);kt&&Gt.addDefaultCase(kt)})}const gt=qt=>qt,Xt=new Map;let jt;function hi(qt,$t){return jt||(jt=wt()),jt(qt,$t)}function vi(){return jt||(jt=wt()),jt.getInitialState()}function at(qt,$t=!1){function kt(Gt){let oi=Gt[qt];return typeof oi>"u"&&$t&&(oi=vi()),oi}function Oi(Gt=gt){const oi=rw(Xt,$t,()=>new WeakMap);return rw(oi,Gt,()=>{const tn={};for(const[Jt,ei]of Object.entries(V.selectors??{}))tn[Jt]=pA(ei,Gt,vi,$t);return tn})}return{reducerPath:qt,getSelectors:Oi,get selectors(){return Oi(kt)},selectSlice:kt}}const ni={name:K,reducer:hi,actions:Ce.actionCreators,caseReducers:Ce.sliceCaseReducersByName,getInitialState:vi,...at(re),injectInto(qt,{reducerPath:$t,...kt}={}){const Oi=$t??re;return qt.inject({reducerPath:Oi,reducer:hi},kt),{...ni,...at(Oi,!0)}}};return ni}}function pA(b,m,S,D){function V(K,...re){let s=m(K);return typeof s>"u"&&D&&(s=S()),b(s,...re)}return V.unwrapped=b,V}var ig=fA();function mA(){function b(m,S){return{_reducerDefinitionType:"asyncThunk",payloadCreator:m,...S}}return b.withTypes=()=>b,{reducer(m){return Object.assign({[m.name](...S){return m(...S)}}[m.name],{_reducerDefinitionType:"reducer"})},preparedReducer(m,S){return{_reducerDefinitionType:"reducerWithPrepare",prepare:m,reducer:S}},asyncThunk:b}}function _A({type:b,reducerName:m,createNotation:S},D,V){let K,re;if("reducer"in D){if(S&&!yA(D))throw new Error(Oh(17));K=D.reducer,re=D.prepare}else K=D;V.addCase(b,K).exposeCaseReducer(m,K).exposeAction(m,re?iw(b,re):iw(b))}function gA(b){return b._reducerDefinitionType==="asyncThunk"}function yA(b){return b._reducerDefinitionType==="reducerWithPrepare"}function vA({type:b,reducerName:m},S,D,V){if(!V)throw new Error(Oh(18));const{payloadCreator:K,fulfilled:re,pending:s,rejected:pe,settled:Ce,options:He}=S,wt=V(b,K,He);D.exposeAction(m,wt),re&&D.addCase(wt.fulfilled,re),s&&D.addCase(wt.pending,s),pe&&D.addCase(wt.rejected,pe),Ce&&D.addMatcher(wt.settled,Ce),D.exposeCaseReducer(m,{fulfilled:re||wy,pending:s||wy,rejected:pe||wy,settled:Ce||wy})}function wy(){}function Oh(b){return`Minified Redux Toolkit error #${b}; visit https://redux-toolkit.js.org/Errors?code=${b} for the full message or use the non-minified dev environment for full errors. `}const ox="politik404_auth",xA=(b,m=null)=>{try{return b?JSON.parse(b):m}catch(S){return console.error("Failed to parse auth data from storage:",S),m}},bA=()=>{const b=localStorage.getItem(ox);return xA(b,{username:null,isAuthenticated:!1})},wA=b=>{try{localStorage.setItem(ox,JSON.stringify(b))}catch(m){console.error("Failed to store auth data:",m)}},TA=()=>{try{localStorage.removeItem(ox)}catch(b){console.error("Failed to clear auth data:",b)}},w0=bA(),SA={isAuthenticated:w0.isAuthenticated,username:w0.username,loading:!1,error:null,lastLogin:w0.lastLogin||null},rT=ig({name:"auth",initialState:SA,reducers:{login:(b,m)=>{b.isAuthenticated=!0,b.username=m.payload,b.lastLogin=Date.now(),wA({isAuthenticated:!0,username:m.payload,lastLogin:b.lastLogin})},logout:b=>{b.isAuthenticated=!1,b.username=null,b.lastLogin=null,TA()},clearAuthError:b=>{b.error=null}}}),{login:sT,logout:cD,clearAuthError:uD}=rT.actions,EA=rT.reducer,AA=()=>{};var aw={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aT=function(b){const m=[];let S=0;for(let D=0;D<b.length;D++){let V=b.charCodeAt(D);V<128?m[S++]=V:V<2048?(m[S++]=V>>6|192,m[S++]=V&63|128):(V&64512)===55296&&D+1<b.length&&(b.charCodeAt(D+1)&64512)===56320?(V=65536+((V&1023)<<10)+(b.charCodeAt(++D)&1023),m[S++]=V>>18|240,m[S++]=V>>12&63|128,m[S++]=V>>6&63|128,m[S++]=V&63|128):(m[S++]=V>>12|224,m[S++]=V>>6&63|128,m[S++]=V&63|128)}return m},MA=function(b){const m=[];let S=0,D=0;for(;S<b.length;){const V=b[S++];if(V<128)m[D++]=String.fromCharCode(V);else if(V>191&&V<224){const K=b[S++];m[D++]=String.fromCharCode((V&31)<<6|K&63)}else if(V>239&&V<365){const K=b[S++],re=b[S++],s=b[S++],pe=((V&7)<<18|(K&63)<<12|(re&63)<<6|s&63)-65536;m[D++]=String.fromCharCode(55296+(pe>>10)),m[D++]=String.fromCharCode(56320+(pe&1023))}else{const K=b[S++],re=b[S++];m[D++]=String.fromCharCode((V&15)<<12|(K&63)<<6|re&63)}}return m.join("")},oT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(b,m){if(!Array.isArray(b))throw Error("encodeByteArray takes an array as a parameter");this.init_();const S=m?this.byteToCharMapWebSafe_:this.byteToCharMap_,D=[];for(let V=0;V<b.length;V+=3){const K=b[V],re=V+1<b.length,s=re?b[V+1]:0,pe=V+2<b.length,Ce=pe?b[V+2]:0,He=K>>2,wt=(K&3)<<4|s>>4;let gt=(s&15)<<2|Ce>>6,Xt=Ce&63;pe||(Xt=64,re||(gt=64)),D.push(S[He],S[wt],S[gt],S[Xt])}return D.join("")},encodeString(b,m){return this.HAS_NATIVE_SUPPORT&&!m?btoa(b):this.encodeByteArray(aT(b),m)},decodeString(b,m){return this.HAS_NATIVE_SUPPORT&&!m?atob(b):MA(this.decodeStringToByteArray(b,m))},decodeStringToByteArray(b,m){this.init_();const S=m?this.charToByteMapWebSafe_:this.charToByteMap_,D=[];for(let V=0;V<b.length;){const K=S[b.charAt(V++)],s=V<b.length?S[b.charAt(V)]:0;++V;const Ce=V<b.length?S[b.charAt(V)]:64;++V;const wt=V<b.length?S[b.charAt(V)]:64;if(++V,K==null||s==null||Ce==null||wt==null)throw new IA;const gt=K<<2|s>>4;if(D.push(gt),Ce!==64){const Xt=s<<4&240|Ce>>2;if(D.push(Xt),wt!==64){const jt=Ce<<6&192|wt;D.push(jt)}}}return D},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let b=0;b<this.ENCODED_VALS.length;b++)this.byteToCharMap_[b]=this.ENCODED_VALS.charAt(b),this.charToByteMap_[this.byteToCharMap_[b]]=b,this.byteToCharMapWebSafe_[b]=this.ENCODED_VALS_WEBSAFE.charAt(b),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[b]]=b,b>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(b)]=b,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(b)]=b)}}};class IA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const CA=function(b){const m=aT(b);return oT.encodeByteArray(m,!0)},lT=function(b){return CA(b).replace(/\./g,"")},cT=function(b){try{return oT.decodeString(b,!0)}catch(m){console.error("base64Decode failed: ",m)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DA=()=>RA().__FIREBASE_DEFAULTS__,zA=()=>{if(typeof process>"u"||typeof aw>"u")return;const b=aw.__FIREBASE_DEFAULTS__;if(b)return JSON.parse(b)},PA=()=>{if(typeof document>"u")return;let b;try{b=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const m=b&&cT(b[1]);return m&&JSON.parse(m)},lx=()=>{try{return AA()||DA()||zA()||PA()}catch(b){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${b}`);return}},OA=b=>{var m,S;return(S=(m=lx())===null||m===void 0?void 0:m.emulatorHosts)===null||S===void 0?void 0:S[b]},uT=()=>{var b;return(b=lx())===null||b===void 0?void 0:b.config},hT=b=>{var m;return(m=lx())===null||m===void 0?void 0:m[`_${b}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((m,S)=>{this.resolve=m,this.reject=S})}wrapCallback(m){return(S,D)=>{S?this.reject(S):this.resolve(D),typeof m=="function"&&(this.promise.catch(()=>{}),m.length===1?m(S):m(S,D))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ga(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function kA(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ga())}function BA(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function NA(){const b=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof b=="object"&&b.id!==void 0}function FA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function UA(){const b=Ga();return b.indexOf("MSIE ")>=0||b.indexOf("Trident/")>=0}function VA(){try{return typeof indexedDB=="object"}catch{return!1}}function jA(){return new Promise((b,m)=>{try{let S=!0;const D="validate-browser-context-for-indexeddb-analytics-module",V=self.indexedDB.open(D);V.onsuccess=()=>{V.result.close(),S||self.indexedDB.deleteDatabase(D),b(!0)},V.onupgradeneeded=()=>{S=!1},V.onerror=()=>{var K;m(((K=V.error)===null||K===void 0?void 0:K.message)||"")}}catch(S){m(S)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qA="FirebaseError";class cf extends Error{constructor(m,S,D){super(S),this.code=m,this.customData=D,this.name=qA,Object.setPrototypeOf(this,cf.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ng.prototype.create)}}class ng{constructor(m,S,D){this.service=m,this.serviceName=S,this.errors=D}create(m,...S){const D=S[0]||{},V=`${this.service}/${m}`,K=this.errors[m],re=K?GA(K,D):"Error",s=`${this.serviceName}: ${re} (${V}).`;return new cf(V,s,D)}}function GA(b,m){return b.replace(HA,(S,D)=>{const V=m[D];return V!=null?String(V):`<${D}?>`})}const HA=/\{\$([^}]+)}/g;function ZA(b){for(const m in b)if(Object.prototype.hasOwnProperty.call(b,m))return!1;return!0}function Vm(b,m){if(b===m)return!0;const S=Object.keys(b),D=Object.keys(m);for(const V of S){if(!D.includes(V))return!1;const K=b[V],re=m[V];if(ow(K)&&ow(re)){if(!Vm(K,re))return!1}else if(K!==re)return!1}for(const V of D)if(!S.includes(V))return!1;return!0}function ow(b){return b!==null&&typeof b=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rg(b){const m=[];for(const[S,D]of Object.entries(b))Array.isArray(D)?D.forEach(V=>{m.push(encodeURIComponent(S)+"="+encodeURIComponent(V))}):m.push(encodeURIComponent(S)+"="+encodeURIComponent(D));return m.length?"&"+m.join("&"):""}function $A(b,m){const S=new XA(b,m);return S.subscribe.bind(S)}class XA{constructor(m,S){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=S,this.task.then(()=>{m(this)}).catch(D=>{this.error(D)})}next(m){this.forEachObserver(S=>{S.next(m)})}error(m){this.forEachObserver(S=>{S.error(m)}),this.close(m)}complete(){this.forEachObserver(m=>{m.complete()}),this.close()}subscribe(m,S,D){let V;if(m===void 0&&S===void 0&&D===void 0)throw new Error("Missing Observer.");WA(m,["next","error","complete"])?V=m:V={next:m,error:S,complete:D},V.next===void 0&&(V.next=T0),V.error===void 0&&(V.error=T0),V.complete===void 0&&(V.complete=T0);const K=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?V.error(this.finalError):V.complete()}catch{}}),this.observers.push(V),K}unsubscribeOne(m){this.observers===void 0||this.observers[m]===void 0||(delete this.observers[m],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(m){if(!this.finalized)for(let S=0;S<this.observers.length;S++)this.sendOne(S,m)}sendOne(m,S){this.task.then(()=>{if(this.observers!==void 0&&this.observers[m]!==void 0)try{S(this.observers[m])}catch(D){typeof console<"u"&&console.error&&console.error(D)}})}close(m){this.finalized||(this.finalized=!0,m!==void 0&&(this.finalError=m),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function WA(b,m){if(typeof b!="object"||b===null)return!1;for(const S of m)if(S in b&&typeof b[S]=="function")return!0;return!1}function T0(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gm(b){return b&&b._delegate?b._delegate:b}class jm{constructor(m,S,D){this.name=m,this.instanceFactory=S,this.type=D,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(m){return this.instantiationMode=m,this}setMultipleInstances(m){return this.multipleInstances=m,this}setServiceProps(m){return this.serviceProps=m,this}setInstanceCreatedCallback(m){return this.onInstanceCreated=m,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lp="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YA{constructor(m,S){this.name=m,this.container=S,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(m){const S=this.normalizeInstanceIdentifier(m);if(!this.instancesDeferred.has(S)){const D=new LA;if(this.instancesDeferred.set(S,D),this.isInitialized(S)||this.shouldAutoInitialize())try{const V=this.getOrInitializeService({instanceIdentifier:S});V&&D.resolve(V)}catch{}}return this.instancesDeferred.get(S).promise}getImmediate(m){var S;const D=this.normalizeInstanceIdentifier(m==null?void 0:m.identifier),V=(S=m==null?void 0:m.optional)!==null&&S!==void 0?S:!1;if(this.isInitialized(D)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:D})}catch(K){if(V)return null;throw K}else{if(V)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(m){if(m.name!==this.name)throw Error(`Mismatching Component ${m.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=m,!!this.shouldAutoInitialize()){if(JA(m))try{this.getOrInitializeService({instanceIdentifier:lp})}catch{}for(const[S,D]of this.instancesDeferred.entries()){const V=this.normalizeInstanceIdentifier(S);try{const K=this.getOrInitializeService({instanceIdentifier:V});D.resolve(K)}catch{}}}}clearInstance(m=lp){this.instancesDeferred.delete(m),this.instancesOptions.delete(m),this.instances.delete(m)}async delete(){const m=Array.from(this.instances.values());await Promise.all([...m.filter(S=>"INTERNAL"in S).map(S=>S.INTERNAL.delete()),...m.filter(S=>"_delete"in S).map(S=>S._delete())])}isComponentSet(){return this.component!=null}isInitialized(m=lp){return this.instances.has(m)}getOptions(m=lp){return this.instancesOptions.get(m)||{}}initialize(m={}){const{options:S={}}=m,D=this.normalizeInstanceIdentifier(m.instanceIdentifier);if(this.isInitialized(D))throw Error(`${this.name}(${D}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const V=this.getOrInitializeService({instanceIdentifier:D,options:S});for(const[K,re]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(K);D===s&&re.resolve(V)}return V}onInit(m,S){var D;const V=this.normalizeInstanceIdentifier(S),K=(D=this.onInitCallbacks.get(V))!==null&&D!==void 0?D:new Set;K.add(m),this.onInitCallbacks.set(V,K);const re=this.instances.get(V);return re&&m(re,V),()=>{K.delete(m)}}invokeOnInitCallbacks(m,S){const D=this.onInitCallbacks.get(S);if(D)for(const V of D)try{V(m,S)}catch{}}getOrInitializeService({instanceIdentifier:m,options:S={}}){let D=this.instances.get(m);if(!D&&this.component&&(D=this.component.instanceFactory(this.container,{instanceIdentifier:KA(m),options:S}),this.instances.set(m,D),this.instancesOptions.set(m,S),this.invokeOnInitCallbacks(D,m),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,m,D)}catch{}return D||null}normalizeInstanceIdentifier(m=lp){return this.component?this.component.multipleInstances?m:lp:m}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function KA(b){return b===lp?void 0:b}function JA(b){return b.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QA{constructor(m){this.name=m,this.providers=new Map}addComponent(m){const S=this.getProvider(m.name);if(S.isComponentSet())throw new Error(`Component ${m.name} has already been registered with ${this.name}`);S.setComponent(m)}addOrOverwriteComponent(m){this.getProvider(m.name).isComponentSet()&&this.providers.delete(m.name),this.addComponent(m)}getProvider(m){if(this.providers.has(m))return this.providers.get(m);const S=new YA(m,this);return this.providers.set(m,S),S}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vr;(function(b){b[b.DEBUG=0]="DEBUG",b[b.VERBOSE=1]="VERBOSE",b[b.INFO=2]="INFO",b[b.WARN=3]="WARN",b[b.ERROR=4]="ERROR",b[b.SILENT=5]="SILENT"})(vr||(vr={}));const eM={debug:vr.DEBUG,verbose:vr.VERBOSE,info:vr.INFO,warn:vr.WARN,error:vr.ERROR,silent:vr.SILENT},tM=vr.INFO,iM={[vr.DEBUG]:"log",[vr.VERBOSE]:"log",[vr.INFO]:"info",[vr.WARN]:"warn",[vr.ERROR]:"error"},nM=(b,m,...S)=>{if(m<b.logLevel)return;const D=new Date().toISOString(),V=iM[m];if(V)console[V](`[${D}]  ${b.name}:`,...S);else throw new Error(`Attempted to log a message with an invalid logType (value: ${m})`)};class dT{constructor(m){this.name=m,this._logLevel=tM,this._logHandler=nM,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(m){if(!(m in vr))throw new TypeError(`Invalid value "${m}" assigned to \`logLevel\``);this._logLevel=m}setLogLevel(m){this._logLevel=typeof m=="string"?eM[m]:m}get logHandler(){return this._logHandler}set logHandler(m){if(typeof m!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=m}get userLogHandler(){return this._userLogHandler}set userLogHandler(m){this._userLogHandler=m}debug(...m){this._userLogHandler&&this._userLogHandler(this,vr.DEBUG,...m),this._logHandler(this,vr.DEBUG,...m)}log(...m){this._userLogHandler&&this._userLogHandler(this,vr.VERBOSE,...m),this._logHandler(this,vr.VERBOSE,...m)}info(...m){this._userLogHandler&&this._userLogHandler(this,vr.INFO,...m),this._logHandler(this,vr.INFO,...m)}warn(...m){this._userLogHandler&&this._userLogHandler(this,vr.WARN,...m),this._logHandler(this,vr.WARN,...m)}error(...m){this._userLogHandler&&this._userLogHandler(this,vr.ERROR,...m),this._logHandler(this,vr.ERROR,...m)}}const rM=(b,m)=>m.some(S=>b instanceof S);let lw,cw;function sM(){return lw||(lw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function aM(){return cw||(cw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const fT=new WeakMap,U0=new WeakMap,pT=new WeakMap,S0=new WeakMap,cx=new WeakMap;function oM(b){const m=new Promise((S,D)=>{const V=()=>{b.removeEventListener("success",K),b.removeEventListener("error",re)},K=()=>{S(rf(b.result)),V()},re=()=>{D(b.error),V()};b.addEventListener("success",K),b.addEventListener("error",re)});return m.then(S=>{S instanceof IDBCursor&&fT.set(S,b)}).catch(()=>{}),cx.set(m,b),m}function lM(b){if(U0.has(b))return;const m=new Promise((S,D)=>{const V=()=>{b.removeEventListener("complete",K),b.removeEventListener("error",re),b.removeEventListener("abort",re)},K=()=>{S(),V()},re=()=>{D(b.error||new DOMException("AbortError","AbortError")),V()};b.addEventListener("complete",K),b.addEventListener("error",re),b.addEventListener("abort",re)});U0.set(b,m)}let V0={get(b,m,S){if(b instanceof IDBTransaction){if(m==="done")return U0.get(b);if(m==="objectStoreNames")return b.objectStoreNames||pT.get(b);if(m==="store")return S.objectStoreNames[1]?void 0:S.objectStore(S.objectStoreNames[0])}return rf(b[m])},set(b,m,S){return b[m]=S,!0},has(b,m){return b instanceof IDBTransaction&&(m==="done"||m==="store")?!0:m in b}};function cM(b){V0=b(V0)}function uM(b){return b===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(m,...S){const D=b.call(E0(this),m,...S);return pT.set(D,m.sort?m.sort():[m]),rf(D)}:aM().includes(b)?function(...m){return b.apply(E0(this),m),rf(fT.get(this))}:function(...m){return rf(b.apply(E0(this),m))}}function hM(b){return typeof b=="function"?uM(b):(b instanceof IDBTransaction&&lM(b),rM(b,sM())?new Proxy(b,V0):b)}function rf(b){if(b instanceof IDBRequest)return oM(b);if(S0.has(b))return S0.get(b);const m=hM(b);return m!==b&&(S0.set(b,m),cx.set(m,b)),m}const E0=b=>cx.get(b);function dM(b,m,{blocked:S,upgrade:D,blocking:V,terminated:K}={}){const re=indexedDB.open(b,m),s=rf(re);return D&&re.addEventListener("upgradeneeded",pe=>{D(rf(re.result),pe.oldVersion,pe.newVersion,rf(re.transaction),pe)}),S&&re.addEventListener("blocked",pe=>S(pe.oldVersion,pe.newVersion,pe)),s.then(pe=>{K&&pe.addEventListener("close",()=>K()),V&&pe.addEventListener("versionchange",Ce=>V(Ce.oldVersion,Ce.newVersion,Ce))}).catch(()=>{}),s}const fM=["get","getKey","getAll","getAllKeys","count"],pM=["put","add","delete","clear"],A0=new Map;function uw(b,m){if(!(b instanceof IDBDatabase&&!(m in b)&&typeof m=="string"))return;if(A0.get(m))return A0.get(m);const S=m.replace(/FromIndex$/,""),D=m!==S,V=pM.includes(S);if(!(S in(D?IDBIndex:IDBObjectStore).prototype)||!(V||fM.includes(S)))return;const K=async function(re,...s){const pe=this.transaction(re,V?"readwrite":"readonly");let Ce=pe.store;return D&&(Ce=Ce.index(s.shift())),(await Promise.all([Ce[S](...s),V&&pe.done]))[0]};return A0.set(m,K),K}cM(b=>({...b,get:(m,S,D)=>uw(m,S)||b.get(m,S,D),has:(m,S)=>!!uw(m,S)||b.has(m,S)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mM{constructor(m){this.container=m}getPlatformInfoString(){return this.container.getProviders().map(S=>{if(_M(S)){const D=S.getImmediate();return`${D.library}/${D.version}`}else return null}).filter(S=>S).join(" ")}}function _M(b){const m=b.getComponent();return(m==null?void 0:m.type)==="VERSION"}const j0="@firebase/app",hw="0.11.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kh=new dT("@firebase/app"),gM="@firebase/app-compat",yM="@firebase/analytics-compat",vM="@firebase/analytics",xM="@firebase/app-check-compat",bM="@firebase/app-check",wM="@firebase/auth",TM="@firebase/auth-compat",SM="@firebase/database",EM="@firebase/data-connect",AM="@firebase/database-compat",MM="@firebase/functions",IM="@firebase/functions-compat",CM="@firebase/installations",RM="@firebase/installations-compat",DM="@firebase/messaging",zM="@firebase/messaging-compat",PM="@firebase/performance",OM="@firebase/performance-compat",LM="@firebase/remote-config",kM="@firebase/remote-config-compat",BM="@firebase/storage",NM="@firebase/storage-compat",FM="@firebase/firestore",UM="@firebase/vertexai",VM="@firebase/firestore-compat",jM="firebase",qM="11.6.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q0="[DEFAULT]",GM={[j0]:"fire-core",[gM]:"fire-core-compat",[vM]:"fire-analytics",[yM]:"fire-analytics-compat",[bM]:"fire-app-check",[xM]:"fire-app-check-compat",[wM]:"fire-auth",[TM]:"fire-auth-compat",[SM]:"fire-rtdb",[EM]:"fire-data-connect",[AM]:"fire-rtdb-compat",[MM]:"fire-fn",[IM]:"fire-fn-compat",[CM]:"fire-iid",[RM]:"fire-iid-compat",[DM]:"fire-fcm",[zM]:"fire-fcm-compat",[PM]:"fire-perf",[OM]:"fire-perf-compat",[LM]:"fire-rc",[kM]:"fire-rc-compat",[BM]:"fire-gcs",[NM]:"fire-gcs-compat",[FM]:"fire-fst",[VM]:"fire-fst-compat",[UM]:"fire-vertex","fire-js":"fire-js",[jM]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jy=new Map,HM=new Map,G0=new Map;function dw(b,m){try{b.container.addComponent(m)}catch(S){kh.debug(`Component ${m.name} failed to register with FirebaseApp ${b.name}`,S)}}function Q_(b){const m=b.name;if(G0.has(m))return kh.debug(`There were multiple attempts to register component ${m}.`),!1;G0.set(m,b);for(const S of jy.values())dw(S,b);for(const S of HM.values())dw(S,b);return!0}function mT(b,m){const S=b.container.getProvider("heartbeat").getImmediate({optional:!0});return S&&S.triggerHeartbeat(),b.container.getProvider(m)}function Au(b){return b==null?!1:b.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZM={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},sf=new ng("app","Firebase",ZM);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $M{constructor(m,S,D){this._isDeleted=!1,this._options=Object.assign({},m),this._config=Object.assign({},S),this._name=S.name,this._automaticDataCollectionEnabled=S.automaticDataCollectionEnabled,this._container=D,this.container.addComponent(new jm("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(m){this.checkDestroyed(),this._automaticDataCollectionEnabled=m}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(m){this._isDeleted=m}checkDestroyed(){if(this.isDeleted)throw sf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sg=qM;function _T(b,m={}){let S=b;typeof m!="object"&&(m={name:m});const D=Object.assign({name:q0,automaticDataCollectionEnabled:!1},m),V=D.name;if(typeof V!="string"||!V)throw sf.create("bad-app-name",{appName:String(V)});if(S||(S=uT()),!S)throw sf.create("no-options");const K=jy.get(V);if(K){if(Vm(S,K.options)&&Vm(D,K.config))return K;throw sf.create("duplicate-app",{appName:V})}const re=new QA(V);for(const pe of G0.values())re.addComponent(pe);const s=new $M(S,D,re);return jy.set(V,s),s}function XM(b=q0){const m=jy.get(b);if(!m&&b===q0&&uT())return _T();if(!m)throw sf.create("no-app",{appName:b});return m}function Lm(b,m,S){var D;let V=(D=GM[b])!==null&&D!==void 0?D:b;S&&(V+=`-${S}`);const K=V.match(/\s|\//),re=m.match(/\s|\//);if(K||re){const s=[`Unable to register library "${V}" with version "${m}":`];K&&s.push(`library name "${V}" contains illegal characters (whitespace or "/")`),K&&re&&s.push("and"),re&&s.push(`version name "${m}" contains illegal characters (whitespace or "/")`),kh.warn(s.join(" "));return}Q_(new jm(`${V}-version`,()=>({library:V,version:m}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WM="firebase-heartbeat-database",YM=1,eg="firebase-heartbeat-store";let M0=null;function gT(){return M0||(M0=dM(WM,YM,{upgrade:(b,m)=>{switch(m){case 0:try{b.createObjectStore(eg)}catch(S){console.warn(S)}}}}).catch(b=>{throw sf.create("idb-open",{originalErrorMessage:b.message})})),M0}async function KM(b){try{const S=(await gT()).transaction(eg),D=await S.objectStore(eg).get(yT(b));return await S.done,D}catch(m){if(m instanceof cf)kh.warn(m.message);else{const S=sf.create("idb-get",{originalErrorMessage:m==null?void 0:m.message});kh.warn(S.message)}}}async function fw(b,m){try{const D=(await gT()).transaction(eg,"readwrite");await D.objectStore(eg).put(m,yT(b)),await D.done}catch(S){if(S instanceof cf)kh.warn(S.message);else{const D=sf.create("idb-set",{originalErrorMessage:S==null?void 0:S.message});kh.warn(D.message)}}}function yT(b){return`${b.name}!${b.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JM=1024,QM=30;class eI{constructor(m){this.container=m,this._heartbeatsCache=null;const S=this.container.getProvider("app").getImmediate();this._storage=new iI(S),this._heartbeatsCachePromise=this._storage.read().then(D=>(this._heartbeatsCache=D,D))}async triggerHeartbeat(){var m,S;try{const V=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),K=pw();if(((m=this._heartbeatsCache)===null||m===void 0?void 0:m.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((S=this._heartbeatsCache)===null||S===void 0?void 0:S.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===K||this._heartbeatsCache.heartbeats.some(re=>re.date===K))return;if(this._heartbeatsCache.heartbeats.push({date:K,agent:V}),this._heartbeatsCache.heartbeats.length>QM){const re=nI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(re,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(D){kh.warn(D)}}async getHeartbeatsHeader(){var m;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((m=this._heartbeatsCache)===null||m===void 0?void 0:m.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const S=pw(),{heartbeatsToSend:D,unsentEntries:V}=tI(this._heartbeatsCache.heartbeats),K=lT(JSON.stringify({version:2,heartbeats:D}));return this._heartbeatsCache.lastSentHeartbeatDate=S,V.length>0?(this._heartbeatsCache.heartbeats=V,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),K}catch(S){return kh.warn(S),""}}}function pw(){return new Date().toISOString().substring(0,10)}function tI(b,m=JM){const S=[];let D=b.slice();for(const V of b){const K=S.find(re=>re.agent===V.agent);if(K){if(K.dates.push(V.date),mw(S)>m){K.dates.pop();break}}else if(S.push({agent:V.agent,dates:[V.date]}),mw(S)>m){S.pop();break}D=D.slice(1)}return{heartbeatsToSend:S,unsentEntries:D}}class iI{constructor(m){this.app=m,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return VA()?jA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const S=await KM(this.app);return S!=null&&S.heartbeats?S:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(m){var S;if(await this._canUseIndexedDBPromise){const V=await this.read();return fw(this.app,{lastSentHeartbeatDate:(S=m.lastSentHeartbeatDate)!==null&&S!==void 0?S:V.lastSentHeartbeatDate,heartbeats:m.heartbeats})}else return}async add(m){var S;if(await this._canUseIndexedDBPromise){const V=await this.read();return fw(this.app,{lastSentHeartbeatDate:(S=m.lastSentHeartbeatDate)!==null&&S!==void 0?S:V.lastSentHeartbeatDate,heartbeats:[...V.heartbeats,...m.heartbeats]})}else return}}function mw(b){return lT(JSON.stringify({version:2,heartbeats:b})).length}function nI(b){if(b.length===0)return-1;let m=0,S=b[0].date;for(let D=1;D<b.length;D++)b[D].date<S&&(S=b[D].date,m=D);return m}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rI(b){Q_(new jm("platform-logger",m=>new mM(m),"PRIVATE")),Q_(new jm("heartbeat",m=>new eI(m),"PRIVATE")),Lm(j0,hw,b),Lm(j0,hw,"esm2017"),Lm("fire-js","")}rI("");var sI="firebase",aI="11.6.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Lm(sI,aI,"app");function ux(b,m){var S={};for(var D in b)Object.prototype.hasOwnProperty.call(b,D)&&m.indexOf(D)<0&&(S[D]=b[D]);if(b!=null&&typeof Object.getOwnPropertySymbols=="function")for(var V=0,D=Object.getOwnPropertySymbols(b);V<D.length;V++)m.indexOf(D[V])<0&&Object.prototype.propertyIsEnumerable.call(b,D[V])&&(S[D[V]]=b[D[V]]);return S}function vT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const oI=vT,xT=new ng("auth","Firebase",vT());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qy=new dT("@firebase/auth");function lI(b,...m){qy.logLevel<=vr.WARN&&qy.warn(`Auth (${sg}): ${b}`,...m)}function Ay(b,...m){qy.logLevel<=vr.ERROR&&qy.error(`Auth (${sg}): ${b}`,...m)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iu(b,...m){throw dx(b,...m)}function Uc(b,...m){return dx(b,...m)}function hx(b,m,S){const D=Object.assign(Object.assign({},oI()),{[m]:S});return new ng("auth","Firebase",D).create(m,{appName:b.name})}function up(b){return hx(b,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function cI(b,m,S){const D=S;if(!(m instanceof D))throw D.name!==m.constructor.name&&Iu(b,"argument-error"),hx(b,"argument-error",`Type of ${m.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function dx(b,...m){if(typeof b!="string"){const S=m[0],D=[...m.slice(1)];return D[0]&&(D[0].appName=b.name),b._errorFactory.create(S,...D)}return xT.create(b,...m)}function pn(b,m,...S){if(!b)throw dx(m,...S)}function zh(b){const m="INTERNAL ASSERTION FAILED: "+b;throw Ay(m),new Error(m)}function Bh(b,m){b||zh(m)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H0(){var b;return typeof self<"u"&&((b=self.location)===null||b===void 0?void 0:b.href)||""}function uI(){return _w()==="http:"||_w()==="https:"}function _w(){var b;return typeof self<"u"&&((b=self.location)===null||b===void 0?void 0:b.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(uI()||NA()||"connection"in navigator)?navigator.onLine:!0}function dI(){if(typeof navigator>"u")return null;const b=navigator;return b.languages&&b.languages[0]||b.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag{constructor(m,S){this.shortDelay=m,this.longDelay=S,Bh(S>m,"Short delay should be less than long delay!"),this.isMobile=kA()||FA()}get(){return hI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fx(b,m){Bh(b.emulator,"Emulator should always be set here");const{url:S}=b.emulator;return m?`${S}${m.startsWith("/")?m.slice(1):m}`:S}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bT{static initialize(m,S,D){this.fetchImpl=m,S&&(this.headersImpl=S),D&&(this.responseImpl=D)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;zh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;zh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;zh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],mI=new ag(3e4,6e4);function px(b,m){return b.tenantId&&!m.tenantId?Object.assign(Object.assign({},m),{tenantId:b.tenantId}):m}async function Hm(b,m,S,D,V={}){return wT(b,V,async()=>{let K={},re={};D&&(m==="GET"?re=D:K={body:JSON.stringify(D)});const s=rg(Object.assign({key:b.config.apiKey},re)).slice(1),pe=await b._getAdditionalHeaders();pe["Content-Type"]="application/json",b.languageCode&&(pe["X-Firebase-Locale"]=b.languageCode);const Ce=Object.assign({method:m,headers:pe},K);return BA()||(Ce.referrerPolicy="no-referrer"),bT.fetch()(await TT(b,b.config.apiHost,S,s),Ce)})}async function wT(b,m,S){b._canInitEmulator=!1;const D=Object.assign(Object.assign({},fI),m);try{const V=new gI(b),K=await Promise.race([S(),V.promise]);V.clearNetworkTimeout();const re=await K.json();if("needConfirmation"in re)throw Ty(b,"account-exists-with-different-credential",re);if(K.ok&&!("errorMessage"in re))return re;{const s=K.ok?re.errorMessage:re.error.message,[pe,Ce]=s.split(" : ");if(pe==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ty(b,"credential-already-in-use",re);if(pe==="EMAIL_EXISTS")throw Ty(b,"email-already-in-use",re);if(pe==="USER_DISABLED")throw Ty(b,"user-disabled",re);const He=D[pe]||pe.toLowerCase().replace(/[_\s]+/g,"-");if(Ce)throw hx(b,He,Ce);Iu(b,He)}}catch(V){if(V instanceof cf)throw V;Iu(b,"network-request-failed",{message:String(V)})}}async function _I(b,m,S,D,V={}){const K=await Hm(b,m,S,D,V);return"mfaPendingCredential"in K&&Iu(b,"multi-factor-auth-required",{_serverResponse:K}),K}async function TT(b,m,S,D){const V=`${m}${S}?${D}`,K=b,re=K.config.emulator?fx(b.config,V):`${b.config.apiScheme}://${V}`;return pI.includes(S)&&(await K._persistenceManagerAvailable,K._getPersistenceType()==="COOKIE")?K._getPersistence()._getFinalTarget(re).toString():re}class gI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(m){this.auth=m,this.timer=null,this.promise=new Promise((S,D)=>{this.timer=setTimeout(()=>D(Uc(this.auth,"network-request-failed")),mI.get())})}}function Ty(b,m,S){const D={appName:b.name};S.email&&(D.email=S.email),S.phoneNumber&&(D.phoneNumber=S.phoneNumber);const V=Uc(b,m,D);return V.customData._tokenResponse=S,V}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yI(b,m){return Hm(b,"POST","/v1/accounts:delete",m)}async function Gy(b,m){return Hm(b,"POST","/v1/accounts:lookup",m)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y_(b){if(b)try{const m=new Date(Number(b));if(!isNaN(m.getTime()))return m.toUTCString()}catch{}}async function vI(b,m=!1){const S=Gm(b),D=await S.getIdToken(m),V=mx(D);pn(V&&V.exp&&V.auth_time&&V.iat,S.auth,"internal-error");const K=typeof V.firebase=="object"?V.firebase:void 0,re=K==null?void 0:K.sign_in_provider;return{claims:V,token:D,authTime:Y_(I0(V.auth_time)),issuedAtTime:Y_(I0(V.iat)),expirationTime:Y_(I0(V.exp)),signInProvider:re||null,signInSecondFactor:(K==null?void 0:K.sign_in_second_factor)||null}}function I0(b){return Number(b)*1e3}function mx(b){const[m,S,D]=b.split(".");if(m===void 0||S===void 0||D===void 0)return Ay("JWT malformed, contained fewer than 3 sections"),null;try{const V=cT(S);return V?JSON.parse(V):(Ay("Failed to decode base64 JWT payload"),null)}catch(V){return Ay("Caught error parsing JWT payload as JSON",V==null?void 0:V.toString()),null}}function gw(b){const m=mx(b);return pn(m,"internal-error"),pn(typeof m.exp<"u","internal-error"),pn(typeof m.iat<"u","internal-error"),Number(m.exp)-Number(m.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tg(b,m,S=!1){if(S)return m;try{return await m}catch(D){throw D instanceof cf&&xI(D)&&b.auth.currentUser===b&&await b.auth.signOut(),D}}function xI({code:b}){return b==="auth/user-disabled"||b==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bI{constructor(m){this.user=m,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(m){var S;if(m){const D=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),D}else{this.errorBackoff=3e4;const V=((S=this.user.stsTokenManager.expirationTime)!==null&&S!==void 0?S:0)-Date.now()-3e5;return Math.max(0,V)}}schedule(m=!1){if(!this.isRunning)return;const S=this.getInterval(m);this.timerId=setTimeout(async()=>{await this.iteration()},S)}async iteration(){try{await this.user.getIdToken(!0)}catch(m){(m==null?void 0:m.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(m,S){this.createdAt=m,this.lastLoginAt=S,this._initializeTime()}_initializeTime(){this.lastSignInTime=Y_(this.lastLoginAt),this.creationTime=Y_(this.createdAt)}_copy(m){this.createdAt=m.createdAt,this.lastLoginAt=m.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hy(b){var m;const S=b.auth,D=await b.getIdToken(),V=await tg(b,Gy(S,{idToken:D}));pn(V==null?void 0:V.users.length,S,"internal-error");const K=V.users[0];b._notifyReloadListener(K);const re=!((m=K.providerUserInfo)===null||m===void 0)&&m.length?ST(K.providerUserInfo):[],s=TI(b.providerData,re),pe=b.isAnonymous,Ce=!(b.email&&K.passwordHash)&&!(s!=null&&s.length),He=pe?Ce:!1,wt={uid:K.localId,displayName:K.displayName||null,photoURL:K.photoUrl||null,email:K.email||null,emailVerified:K.emailVerified||!1,phoneNumber:K.phoneNumber||null,tenantId:K.tenantId||null,providerData:s,metadata:new Z0(K.createdAt,K.lastLoginAt),isAnonymous:He};Object.assign(b,wt)}async function wI(b){const m=Gm(b);await Hy(m),await m.auth._persistUserIfCurrent(m),m.auth._notifyListenersIfCurrent(m)}function TI(b,m){return[...b.filter(D=>!m.some(V=>V.providerId===D.providerId)),...m]}function ST(b){return b.map(m=>{var{providerId:S}=m,D=ux(m,["providerId"]);return{providerId:S,uid:D.rawId||"",displayName:D.displayName||null,email:D.email||null,phoneNumber:D.phoneNumber||null,photoURL:D.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SI(b,m){const S=await wT(b,{},async()=>{const D=rg({grant_type:"refresh_token",refresh_token:m}).slice(1),{tokenApiHost:V,apiKey:K}=b.config,re=await TT(b,V,"/v1/token",`key=${K}`),s=await b._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",bT.fetch()(re,{method:"POST",headers:s,body:D})});return{accessToken:S.access_token,expiresIn:S.expires_in,refreshToken:S.refresh_token}}async function EI(b,m){return Hm(b,"POST","/v2/accounts:revokeToken",px(b,m))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(m){pn(m.idToken,"internal-error"),pn(typeof m.idToken<"u","internal-error"),pn(typeof m.refreshToken<"u","internal-error");const S="expiresIn"in m&&typeof m.expiresIn<"u"?Number(m.expiresIn):gw(m.idToken);this.updateTokensAndExpiration(m.idToken,m.refreshToken,S)}updateFromIdToken(m){pn(m.length!==0,"internal-error");const S=gw(m);this.updateTokensAndExpiration(m,null,S)}async getToken(m,S=!1){return!S&&this.accessToken&&!this.isExpired?this.accessToken:(pn(this.refreshToken,m,"user-token-expired"),this.refreshToken?(await this.refresh(m,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(m,S){const{accessToken:D,refreshToken:V,expiresIn:K}=await SI(m,S);this.updateTokensAndExpiration(D,V,Number(K))}updateTokensAndExpiration(m,S,D){this.refreshToken=S||null,this.accessToken=m||null,this.expirationTime=Date.now()+D*1e3}static fromJSON(m,S){const{refreshToken:D,accessToken:V,expirationTime:K}=S,re=new km;return D&&(pn(typeof D=="string","internal-error",{appName:m}),re.refreshToken=D),V&&(pn(typeof V=="string","internal-error",{appName:m}),re.accessToken=V),K&&(pn(typeof K=="number","internal-error",{appName:m}),re.expirationTime=K),re}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(m){this.accessToken=m.accessToken,this.refreshToken=m.refreshToken,this.expirationTime=m.expirationTime}_clone(){return Object.assign(new km,this.toJSON())}_performRefresh(){return zh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qd(b,m){pn(typeof b=="string"||typeof b>"u","internal-error",{appName:m})}class Fc{constructor(m){var{uid:S,auth:D,stsTokenManager:V}=m,K=ux(m,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new bI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=S,this.auth=D,this.stsTokenManager=V,this.accessToken=V.accessToken,this.displayName=K.displayName||null,this.email=K.email||null,this.emailVerified=K.emailVerified||!1,this.phoneNumber=K.phoneNumber||null,this.photoURL=K.photoURL||null,this.isAnonymous=K.isAnonymous||!1,this.tenantId=K.tenantId||null,this.providerData=K.providerData?[...K.providerData]:[],this.metadata=new Z0(K.createdAt||void 0,K.lastLoginAt||void 0)}async getIdToken(m){const S=await tg(this,this.stsTokenManager.getToken(this.auth,m));return pn(S,this.auth,"internal-error"),this.accessToken!==S&&(this.accessToken=S,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),S}getIdTokenResult(m){return vI(this,m)}reload(){return wI(this)}_assign(m){this!==m&&(pn(this.uid===m.uid,this.auth,"internal-error"),this.displayName=m.displayName,this.photoURL=m.photoURL,this.email=m.email,this.emailVerified=m.emailVerified,this.phoneNumber=m.phoneNumber,this.isAnonymous=m.isAnonymous,this.tenantId=m.tenantId,this.providerData=m.providerData.map(S=>Object.assign({},S)),this.metadata._copy(m.metadata),this.stsTokenManager._assign(m.stsTokenManager))}_clone(m){const S=new Fc(Object.assign(Object.assign({},this),{auth:m,stsTokenManager:this.stsTokenManager._clone()}));return S.metadata._copy(this.metadata),S}_onReload(m){pn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=m,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(m){this.reloadListener?this.reloadListener(m):this.reloadUserInfo=m}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(m,S=!1){let D=!1;m.idToken&&m.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(m),D=!0),S&&await Hy(this),await this.auth._persistUserIfCurrent(this),D&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Au(this.auth.app))return Promise.reject(up(this.auth));const m=await this.getIdToken();return await tg(this,yI(this.auth,{idToken:m})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(m=>Object.assign({},m)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(m,S){var D,V,K,re,s,pe,Ce,He;const wt=(D=S.displayName)!==null&&D!==void 0?D:void 0,gt=(V=S.email)!==null&&V!==void 0?V:void 0,Xt=(K=S.phoneNumber)!==null&&K!==void 0?K:void 0,jt=(re=S.photoURL)!==null&&re!==void 0?re:void 0,hi=(s=S.tenantId)!==null&&s!==void 0?s:void 0,vi=(pe=S._redirectEventId)!==null&&pe!==void 0?pe:void 0,at=(Ce=S.createdAt)!==null&&Ce!==void 0?Ce:void 0,ni=(He=S.lastLoginAt)!==null&&He!==void 0?He:void 0,{uid:qt,emailVerified:$t,isAnonymous:kt,providerData:Oi,stsTokenManager:Gt}=S;pn(qt&&Gt,m,"internal-error");const oi=km.fromJSON(this.name,Gt);pn(typeof qt=="string",m,"internal-error"),Qd(wt,m.name),Qd(gt,m.name),pn(typeof $t=="boolean",m,"internal-error"),pn(typeof kt=="boolean",m,"internal-error"),Qd(Xt,m.name),Qd(jt,m.name),Qd(hi,m.name),Qd(vi,m.name),Qd(at,m.name),Qd(ni,m.name);const tn=new Fc({uid:qt,auth:m,email:gt,emailVerified:$t,displayName:wt,isAnonymous:kt,photoURL:jt,phoneNumber:Xt,tenantId:hi,stsTokenManager:oi,createdAt:at,lastLoginAt:ni});return Oi&&Array.isArray(Oi)&&(tn.providerData=Oi.map(Jt=>Object.assign({},Jt))),vi&&(tn._redirectEventId=vi),tn}static async _fromIdTokenResponse(m,S,D=!1){const V=new km;V.updateFromServerResponse(S);const K=new Fc({uid:S.localId,auth:m,stsTokenManager:V,isAnonymous:D});return await Hy(K),K}static async _fromGetAccountInfoResponse(m,S,D){const V=S.users[0];pn(V.localId!==void 0,"internal-error");const K=V.providerUserInfo!==void 0?ST(V.providerUserInfo):[],re=!(V.email&&V.passwordHash)&&!(K!=null&&K.length),s=new km;s.updateFromIdToken(D);const pe=new Fc({uid:V.localId,auth:m,stsTokenManager:s,isAnonymous:re}),Ce={uid:V.localId,displayName:V.displayName||null,photoURL:V.photoUrl||null,email:V.email||null,emailVerified:V.emailVerified||!1,phoneNumber:V.phoneNumber||null,tenantId:V.tenantId||null,providerData:K,metadata:new Z0(V.createdAt,V.lastLoginAt),isAnonymous:!(V.email&&V.passwordHash)&&!(K!=null&&K.length)};return Object.assign(pe,Ce),pe}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yw=new Map;function Ph(b){Bh(b instanceof Function,"Expected a class definition");let m=yw.get(b);return m?(Bh(m instanceof b,"Instance stored in cache mismatched with class"),m):(m=new b,yw.set(b,m),m)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ET{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(m,S){this.storage[m]=S}async _get(m){const S=this.storage[m];return S===void 0?null:S}async _remove(m){delete this.storage[m]}_addListener(m,S){}_removeListener(m,S){}}ET.type="NONE";const vw=ET;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function My(b,m,S){return`firebase:${b}:${m}:${S}`}class Bm{constructor(m,S,D){this.persistence=m,this.auth=S,this.userKey=D;const{config:V,name:K}=this.auth;this.fullUserKey=My(this.userKey,V.apiKey,K),this.fullPersistenceKey=My("persistence",V.apiKey,K),this.boundEventHandler=S._onStorageEvent.bind(S),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(m){return this.persistence._set(this.fullUserKey,m.toJSON())}async getCurrentUser(){const m=await this.persistence._get(this.fullUserKey);if(!m)return null;if(typeof m=="string"){const S=await Gy(this.auth,{idToken:m}).catch(()=>{});return S?Fc._fromGetAccountInfoResponse(this.auth,S,m):null}return Fc._fromJSON(this.auth,m)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(m){if(this.persistence===m)return;const S=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=m,S)return this.setCurrentUser(S)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(m,S,D="authUser"){if(!S.length)return new Bm(Ph(vw),m,D);const V=(await Promise.all(S.map(async Ce=>{if(await Ce._isAvailable())return Ce}))).filter(Ce=>Ce);let K=V[0]||Ph(vw);const re=My(D,m.config.apiKey,m.name);let s=null;for(const Ce of S)try{const He=await Ce._get(re);if(He){let wt;if(typeof He=="string"){const gt=await Gy(m,{idToken:He}).catch(()=>{});if(!gt)break;wt=await Fc._fromGetAccountInfoResponse(m,gt,He)}else wt=Fc._fromJSON(m,He);Ce!==K&&(s=wt),K=Ce;break}}catch{}const pe=V.filter(Ce=>Ce._shouldAllowMigration);return!K._shouldAllowMigration||!pe.length?new Bm(K,m,D):(K=pe[0],s&&await K._set(re,s.toJSON()),await Promise.all(S.map(async Ce=>{if(Ce!==K)try{await Ce._remove(re)}catch{}})),new Bm(K,m,D))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xw(b){const m=b.toLowerCase();if(m.includes("opera/")||m.includes("opr/")||m.includes("opios/"))return"Opera";if(CT(m))return"IEMobile";if(m.includes("msie")||m.includes("trident/"))return"IE";if(m.includes("edge/"))return"Edge";if(AT(m))return"Firefox";if(m.includes("silk/"))return"Silk";if(DT(m))return"Blackberry";if(zT(m))return"Webos";if(MT(m))return"Safari";if((m.includes("chrome/")||IT(m))&&!m.includes("edge/"))return"Chrome";if(RT(m))return"Android";{const S=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,D=b.match(S);if((D==null?void 0:D.length)===2)return D[1]}return"Other"}function AT(b=Ga()){return/firefox\//i.test(b)}function MT(b=Ga()){const m=b.toLowerCase();return m.includes("safari/")&&!m.includes("chrome/")&&!m.includes("crios/")&&!m.includes("android")}function IT(b=Ga()){return/crios\//i.test(b)}function CT(b=Ga()){return/iemobile/i.test(b)}function RT(b=Ga()){return/android/i.test(b)}function DT(b=Ga()){return/blackberry/i.test(b)}function zT(b=Ga()){return/webos/i.test(b)}function _x(b=Ga()){return/iphone|ipad|ipod/i.test(b)||/macintosh/i.test(b)&&/mobile/i.test(b)}function AI(b=Ga()){var m;return _x(b)&&!!(!((m=window.navigator)===null||m===void 0)&&m.standalone)}function MI(){return UA()&&document.documentMode===10}function PT(b=Ga()){return _x(b)||RT(b)||zT(b)||DT(b)||/windows phone/i.test(b)||CT(b)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OT(b,m=[]){let S;switch(b){case"Browser":S=xw(Ga());break;case"Worker":S=`${xw(Ga())}-${b}`;break;default:S=b}const D=m.length?m.join(","):"FirebaseCore-web";return`${S}/JsCore/${sg}/${D}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class II{constructor(m){this.auth=m,this.queue=[]}pushCallback(m,S){const D=K=>new Promise((re,s)=>{try{const pe=m(K);re(pe)}catch(pe){s(pe)}});D.onAbort=S,this.queue.push(D);const V=this.queue.length-1;return()=>{this.queue[V]=()=>Promise.resolve()}}async runMiddleware(m){if(this.auth.currentUser===m)return;const S=[];try{for(const D of this.queue)await D(m),D.onAbort&&S.push(D.onAbort)}catch(D){S.reverse();for(const V of S)try{V()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:D==null?void 0:D.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CI(b,m={}){return Hm(b,"GET","/v2/passwordPolicy",px(b,m))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RI=6;class DI{constructor(m){var S,D,V,K;const re=m.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(S=re.minPasswordLength)!==null&&S!==void 0?S:RI,re.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=re.maxPasswordLength),re.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=re.containsLowercaseCharacter),re.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=re.containsUppercaseCharacter),re.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=re.containsNumericCharacter),re.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=re.containsNonAlphanumericCharacter),this.enforcementState=m.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(V=(D=m.allowedNonAlphanumericCharacters)===null||D===void 0?void 0:D.join(""))!==null&&V!==void 0?V:"",this.forceUpgradeOnSignin=(K=m.forceUpgradeOnSignin)!==null&&K!==void 0?K:!1,this.schemaVersion=m.schemaVersion}validatePassword(m){var S,D,V,K,re,s;const pe={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(m,pe),this.validatePasswordCharacterOptions(m,pe),pe.isValid&&(pe.isValid=(S=pe.meetsMinPasswordLength)!==null&&S!==void 0?S:!0),pe.isValid&&(pe.isValid=(D=pe.meetsMaxPasswordLength)!==null&&D!==void 0?D:!0),pe.isValid&&(pe.isValid=(V=pe.containsLowercaseLetter)!==null&&V!==void 0?V:!0),pe.isValid&&(pe.isValid=(K=pe.containsUppercaseLetter)!==null&&K!==void 0?K:!0),pe.isValid&&(pe.isValid=(re=pe.containsNumericCharacter)!==null&&re!==void 0?re:!0),pe.isValid&&(pe.isValid=(s=pe.containsNonAlphanumericCharacter)!==null&&s!==void 0?s:!0),pe}validatePasswordLengthOptions(m,S){const D=this.customStrengthOptions.minPasswordLength,V=this.customStrengthOptions.maxPasswordLength;D&&(S.meetsMinPasswordLength=m.length>=D),V&&(S.meetsMaxPasswordLength=m.length<=V)}validatePasswordCharacterOptions(m,S){this.updatePasswordCharacterOptionsStatuses(S,!1,!1,!1,!1);let D;for(let V=0;V<m.length;V++)D=m.charAt(V),this.updatePasswordCharacterOptionsStatuses(S,D>="a"&&D<="z",D>="A"&&D<="Z",D>="0"&&D<="9",this.allowedNonAlphanumericCharacters.includes(D))}updatePasswordCharacterOptionsStatuses(m,S,D,V,K){this.customStrengthOptions.containsLowercaseLetter&&(m.containsLowercaseLetter||(m.containsLowercaseLetter=S)),this.customStrengthOptions.containsUppercaseLetter&&(m.containsUppercaseLetter||(m.containsUppercaseLetter=D)),this.customStrengthOptions.containsNumericCharacter&&(m.containsNumericCharacter||(m.containsNumericCharacter=V)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(m.containsNonAlphanumericCharacter||(m.containsNonAlphanumericCharacter=K))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zI{constructor(m,S,D,V){this.app=m,this.heartbeatServiceProvider=S,this.appCheckServiceProvider=D,this.config=V,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new bw(this),this.idTokenSubscription=new bw(this),this.beforeStateQueue=new II(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=xT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=m.name,this.clientVersion=V.sdkClientVersion,this._persistenceManagerAvailable=new Promise(K=>this._resolvePersistenceManagerAvailable=K)}_initializeWithPersistence(m,S){return S&&(this._popupRedirectResolver=Ph(S)),this._initializationPromise=this.queue(async()=>{var D,V,K;if(!this._deleted&&(this.persistenceManager=await Bm.create(this,m),(D=this._resolvePersistenceManagerAvailable)===null||D===void 0||D.call(this),!this._deleted)){if(!((V=this._popupRedirectResolver)===null||V===void 0)&&V._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(S),this.lastNotifiedUid=((K=this.currentUser)===null||K===void 0?void 0:K.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const m=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!m)){if(this.currentUser&&m&&this.currentUser.uid===m.uid){this._currentUser._assign(m),await this.currentUser.getIdToken();return}await this._updateCurrentUser(m,!0)}}async initializeCurrentUserFromIdToken(m){try{const S=await Gy(this,{idToken:m}),D=await Fc._fromGetAccountInfoResponse(this,S,m);await this.directlySetCurrentUser(D)}catch(S){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",S),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(m){var S;if(Au(this.app)){const re=this.app.settings.authIdToken;return re?new Promise(s=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(re).then(s,s))}):this.directlySetCurrentUser(null)}const D=await this.assertedPersistence.getCurrentUser();let V=D,K=!1;if(m&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const re=(S=this.redirectUser)===null||S===void 0?void 0:S._redirectEventId,s=V==null?void 0:V._redirectEventId,pe=await this.tryRedirectSignIn(m);(!re||re===s)&&(pe!=null&&pe.user)&&(V=pe.user,K=!0)}if(!V)return this.directlySetCurrentUser(null);if(!V._redirectEventId){if(K)try{await this.beforeStateQueue.runMiddleware(V)}catch(re){V=D,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(re))}return V?this.reloadAndSetCurrentUserOrClear(V):this.directlySetCurrentUser(null)}return pn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===V._redirectEventId?this.directlySetCurrentUser(V):this.reloadAndSetCurrentUserOrClear(V)}async tryRedirectSignIn(m){let S=null;try{S=await this._popupRedirectResolver._completeRedirectFn(this,m,!0)}catch{await this._setRedirectUser(null)}return S}async reloadAndSetCurrentUserOrClear(m){try{await Hy(m)}catch(S){if((S==null?void 0:S.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(m)}useDeviceLanguage(){this.languageCode=dI()}async _delete(){this._deleted=!0}async updateCurrentUser(m){if(Au(this.app))return Promise.reject(up(this));const S=m?Gm(m):null;return S&&pn(S.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(S&&S._clone(this))}async _updateCurrentUser(m,S=!1){if(!this._deleted)return m&&pn(this.tenantId===m.tenantId,this,"tenant-id-mismatch"),S||await this.beforeStateQueue.runMiddleware(m),this.queue(async()=>{await this.directlySetCurrentUser(m),this.notifyAuthListeners()})}async signOut(){return Au(this.app)?Promise.reject(up(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(m){return Au(this.app)?Promise.reject(up(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ph(m))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(m){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const S=this._getPasswordPolicyInternal();return S.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):S.validatePassword(m)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const m=await CI(this),S=new DI(m);this.tenantId===null?this._projectPasswordPolicy=S:this._tenantPasswordPolicies[this.tenantId]=S}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(m){this._errorFactory=new ng("auth","Firebase",m())}onAuthStateChanged(m,S,D){return this.registerStateListener(this.authStateSubscription,m,S,D)}beforeAuthStateChanged(m,S){return this.beforeStateQueue.pushCallback(m,S)}onIdTokenChanged(m,S,D){return this.registerStateListener(this.idTokenSubscription,m,S,D)}authStateReady(){return new Promise((m,S)=>{if(this.currentUser)m();else{const D=this.onAuthStateChanged(()=>{D(),m()},S)}})}async revokeAccessToken(m){if(this.currentUser){const S=await this.currentUser.getIdToken(),D={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:m,idToken:S};this.tenantId!=null&&(D.tenantId=this.tenantId),await EI(this,D)}}toJSON(){var m;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(m=this._currentUser)===null||m===void 0?void 0:m.toJSON()}}async _setRedirectUser(m,S){const D=await this.getOrInitRedirectPersistenceManager(S);return m===null?D.removeCurrentUser():D.setCurrentUser(m)}async getOrInitRedirectPersistenceManager(m){if(!this.redirectPersistenceManager){const S=m&&Ph(m)||this._popupRedirectResolver;pn(S,this,"argument-error"),this.redirectPersistenceManager=await Bm.create(this,[Ph(S._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(m){var S,D;return this._isInitialized&&await this.queue(async()=>{}),((S=this._currentUser)===null||S===void 0?void 0:S._redirectEventId)===m?this._currentUser:((D=this.redirectUser)===null||D===void 0?void 0:D._redirectEventId)===m?this.redirectUser:null}async _persistUserIfCurrent(m){if(m===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(m))}_notifyListenersIfCurrent(m){m===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var m,S;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const D=(S=(m=this.currentUser)===null||m===void 0?void 0:m.uid)!==null&&S!==void 0?S:null;this.lastNotifiedUid!==D&&(this.lastNotifiedUid=D,this.authStateSubscription.next(this.currentUser))}registerStateListener(m,S,D,V){if(this._deleted)return()=>{};const K=typeof S=="function"?S:S.next.bind(S);let re=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(pn(s,this,"internal-error"),s.then(()=>{re||K(this.currentUser)}),typeof S=="function"){const pe=m.addObserver(S,D,V);return()=>{re=!0,pe()}}else{const pe=m.addObserver(S);return()=>{re=!0,pe()}}}async directlySetCurrentUser(m){this.currentUser&&this.currentUser!==m&&this._currentUser._stopProactiveRefresh(),m&&this.isProactiveRefreshEnabled&&m._startProactiveRefresh(),this.currentUser=m,m?await this.assertedPersistence.setCurrentUser(m):await this.assertedPersistence.removeCurrentUser()}queue(m){return this.operations=this.operations.then(m,m),this.operations}get assertedPersistence(){return pn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(m){!m||this.frameworks.includes(m)||(this.frameworks.push(m),this.frameworks.sort(),this.clientVersion=OT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var m;const S={"X-Client-Version":this.clientVersion};this.app.options.appId&&(S["X-Firebase-gmpid"]=this.app.options.appId);const D=await((m=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||m===void 0?void 0:m.getHeartbeatsHeader());D&&(S["X-Firebase-Client"]=D);const V=await this._getAppCheckToken();return V&&(S["X-Firebase-AppCheck"]=V),S}async _getAppCheckToken(){var m;if(Au(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const S=await((m=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||m===void 0?void 0:m.getToken());return S!=null&&S.error&&lI(`Error while retrieving App Check token: ${S.error}`),S==null?void 0:S.token}}function ev(b){return Gm(b)}class bw{constructor(m){this.auth=m,this.observer=null,this.addObserver=$A(S=>this.observer=S)}get next(){return pn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gx={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function PI(b){gx=b}function OI(b){return gx.loadJS(b)}function LI(){return gx.gapiScript}function kI(b){return`__${b}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BI(b,m){const S=mT(b,"auth");if(S.isInitialized()){const V=S.getImmediate(),K=S.getOptions();if(Vm(K,m??{}))return V;Iu(V,"already-initialized")}return S.initialize({options:m})}function NI(b,m){const S=(m==null?void 0:m.persistence)||[],D=(Array.isArray(S)?S:[S]).map(Ph);m!=null&&m.errorMap&&b._updateErrorMap(m.errorMap),b._initializeWithPersistence(D,m==null?void 0:m.popupRedirectResolver)}function FI(b,m,S){const D=ev(b);pn(/^https?:\/\//.test(m),D,"invalid-emulator-scheme");const V=!1,K=LT(m),{host:re,port:s}=UI(m),pe=s===null?"":`:${s}`,Ce={url:`${K}//${re}${pe}/`},He=Object.freeze({host:re,port:s,protocol:K.replace(":",""),options:Object.freeze({disableWarnings:V})});if(!D._canInitEmulator){pn(D.config.emulator&&D.emulatorConfig,D,"emulator-config-failed"),pn(Vm(Ce,D.config.emulator)&&Vm(He,D.emulatorConfig),D,"emulator-config-failed");return}D.config.emulator=Ce,D.emulatorConfig=He,D.settings.appVerificationDisabledForTesting=!0,VI()}function LT(b){const m=b.indexOf(":");return m<0?"":b.substr(0,m+1)}function UI(b){const m=LT(b),S=/(\/\/)?([^?#/]+)/.exec(b.substr(m.length));if(!S)return{host:"",port:null};const D=S[2].split("@").pop()||"",V=/^(\[[^\]]+\])(:|$)/.exec(D);if(V){const K=V[1];return{host:K,port:ww(D.substr(K.length+1))}}else{const[K,re]=D.split(":");return{host:K,port:ww(re)}}}function ww(b){if(!b)return null;const m=Number(b);return isNaN(m)?null:m}function VI(){function b(){const m=document.createElement("p"),S=m.style;m.innerText="Running in emulator mode. Do not use with production credentials.",S.position="fixed",S.width="100%",S.backgroundColor="#ffffff",S.border=".1em solid #000000",S.color="#b50000",S.bottom="0px",S.left="0px",S.margin="0px",S.zIndex="10000",S.textAlign="center",m.classList.add("firebase-emulator-warning"),document.body.appendChild(m)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",b):b())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kT{constructor(m,S){this.providerId=m,this.signInMethod=S}toJSON(){return zh("not implemented")}_getIdTokenResponse(m){return zh("not implemented")}_linkToIdToken(m,S){return zh("not implemented")}_getReauthenticationResolver(m){return zh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nm(b,m){return _I(b,"POST","/v1/accounts:signInWithIdp",px(b,m))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jI="http://localhost";class fp extends kT{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(m){const S=new fp(m.providerId,m.signInMethod);return m.idToken||m.accessToken?(m.idToken&&(S.idToken=m.idToken),m.accessToken&&(S.accessToken=m.accessToken),m.nonce&&!m.pendingToken&&(S.nonce=m.nonce),m.pendingToken&&(S.pendingToken=m.pendingToken)):m.oauthToken&&m.oauthTokenSecret?(S.accessToken=m.oauthToken,S.secret=m.oauthTokenSecret):Iu("argument-error"),S}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(m){const S=typeof m=="string"?JSON.parse(m):m,{providerId:D,signInMethod:V}=S,K=ux(S,["providerId","signInMethod"]);if(!D||!V)return null;const re=new fp(D,V);return re.idToken=K.idToken||void 0,re.accessToken=K.accessToken||void 0,re.secret=K.secret,re.nonce=K.nonce,re.pendingToken=K.pendingToken||null,re}_getIdTokenResponse(m){const S=this.buildRequest();return Nm(m,S)}_linkToIdToken(m,S){const D=this.buildRequest();return D.idToken=S,Nm(m,D)}_getReauthenticationResolver(m){const S=this.buildRequest();return S.autoCreate=!1,Nm(m,S)}buildRequest(){const m={requestUri:jI,returnSecureToken:!0};if(this.pendingToken)m.pendingToken=this.pendingToken;else{const S={};this.idToken&&(S.id_token=this.idToken),this.accessToken&&(S.access_token=this.accessToken),this.secret&&(S.oauth_token_secret=this.secret),S.providerId=this.providerId,this.nonce&&!this.pendingToken&&(S.nonce=this.nonce),m.postBody=rg(S)}return m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yx{constructor(m){this.providerId=m,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(m){this.defaultLanguageCode=m}setCustomParameters(m){return this.customParameters=m,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class og extends yx{constructor(){super(...arguments),this.scopes=[]}addScope(m){return this.scopes.includes(m)||this.scopes.push(m),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef extends og{constructor(){super("facebook.com")}static credential(m){return fp._fromParams({providerId:ef.PROVIDER_ID,signInMethod:ef.FACEBOOK_SIGN_IN_METHOD,accessToken:m})}static credentialFromResult(m){return ef.credentialFromTaggedObject(m)}static credentialFromError(m){return ef.credentialFromTaggedObject(m.customData||{})}static credentialFromTaggedObject({_tokenResponse:m}){if(!m||!("oauthAccessToken"in m)||!m.oauthAccessToken)return null;try{return ef.credential(m.oauthAccessToken)}catch{return null}}}ef.FACEBOOK_SIGN_IN_METHOD="facebook.com";ef.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dh extends og{constructor(){super("google.com"),this.addScope("profile")}static credential(m,S){return fp._fromParams({providerId:Dh.PROVIDER_ID,signInMethod:Dh.GOOGLE_SIGN_IN_METHOD,idToken:m,accessToken:S})}static credentialFromResult(m){return Dh.credentialFromTaggedObject(m)}static credentialFromError(m){return Dh.credentialFromTaggedObject(m.customData||{})}static credentialFromTaggedObject({_tokenResponse:m}){if(!m)return null;const{oauthIdToken:S,oauthAccessToken:D}=m;if(!S&&!D)return null;try{return Dh.credential(S,D)}catch{return null}}}Dh.GOOGLE_SIGN_IN_METHOD="google.com";Dh.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf extends og{constructor(){super("github.com")}static credential(m){return fp._fromParams({providerId:tf.PROVIDER_ID,signInMethod:tf.GITHUB_SIGN_IN_METHOD,accessToken:m})}static credentialFromResult(m){return tf.credentialFromTaggedObject(m)}static credentialFromError(m){return tf.credentialFromTaggedObject(m.customData||{})}static credentialFromTaggedObject({_tokenResponse:m}){if(!m||!("oauthAccessToken"in m)||!m.oauthAccessToken)return null;try{return tf.credential(m.oauthAccessToken)}catch{return null}}}tf.GITHUB_SIGN_IN_METHOD="github.com";tf.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf extends og{constructor(){super("twitter.com")}static credential(m,S){return fp._fromParams({providerId:nf.PROVIDER_ID,signInMethod:nf.TWITTER_SIGN_IN_METHOD,oauthToken:m,oauthTokenSecret:S})}static credentialFromResult(m){return nf.credentialFromTaggedObject(m)}static credentialFromError(m){return nf.credentialFromTaggedObject(m.customData||{})}static credentialFromTaggedObject({_tokenResponse:m}){if(!m)return null;const{oauthAccessToken:S,oauthTokenSecret:D}=m;if(!S||!D)return null;try{return nf.credential(S,D)}catch{return null}}}nf.TWITTER_SIGN_IN_METHOD="twitter.com";nf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm{constructor(m){this.user=m.user,this.providerId=m.providerId,this._tokenResponse=m._tokenResponse,this.operationType=m.operationType}static async _fromIdTokenResponse(m,S,D,V=!1){const K=await Fc._fromIdTokenResponse(m,D,V),re=Tw(D);return new qm({user:K,providerId:re,_tokenResponse:D,operationType:S})}static async _forOperation(m,S,D){await m._updateTokensIfNecessary(D,!0);const V=Tw(D);return new qm({user:m,providerId:V,_tokenResponse:D,operationType:S})}}function Tw(b){return b.providerId?b.providerId:"phoneNumber"in b?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy extends cf{constructor(m,S,D,V){var K;super(S.code,S.message),this.operationType=D,this.user=V,Object.setPrototypeOf(this,Zy.prototype),this.customData={appName:m.name,tenantId:(K=m.tenantId)!==null&&K!==void 0?K:void 0,_serverResponse:S.customData._serverResponse,operationType:D}}static _fromErrorAndOperation(m,S,D,V){return new Zy(m,S,D,V)}}function BT(b,m,S,D){return(m==="reauthenticate"?S._getReauthenticationResolver(b):S._getIdTokenResponse(b)).catch(K=>{throw K.code==="auth/multi-factor-auth-required"?Zy._fromErrorAndOperation(b,K,m,D):K})}async function qI(b,m,S=!1){const D=await tg(b,m._linkToIdToken(b.auth,await b.getIdToken()),S);return qm._forOperation(b,"link",D)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GI(b,m,S=!1){const{auth:D}=b;if(Au(D.app))return Promise.reject(up(D));const V="reauthenticate";try{const K=await tg(b,BT(D,V,m,b),S);pn(K.idToken,D,"internal-error");const re=mx(K.idToken);pn(re,D,"internal-error");const{sub:s}=re;return pn(b.uid===s,D,"user-mismatch"),qm._forOperation(b,V,K)}catch(K){throw(K==null?void 0:K.code)==="auth/user-not-found"&&Iu(D,"user-mismatch"),K}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HI(b,m,S=!1){if(Au(b.app))return Promise.reject(up(b));const D="signIn",V=await BT(b,D,m),K=await qm._fromIdTokenResponse(b,D,V);return S||await b._updateCurrentUser(K.user),K}function ZI(b,m,S,D){return Gm(b).onIdTokenChanged(m,S,D)}function $I(b,m,S){return Gm(b).beforeAuthStateChanged(m,S)}const $y="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NT{constructor(m,S){this.storageRetriever=m,this.type=S}_isAvailable(){try{return this.storage?(this.storage.setItem($y,"1"),this.storage.removeItem($y),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(m,S){return this.storage.setItem(m,JSON.stringify(S)),Promise.resolve()}_get(m){const S=this.storage.getItem(m);return Promise.resolve(S?JSON.parse(S):null)}_remove(m){return this.storage.removeItem(m),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XI=1e3,WI=10;class FT extends NT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(m,S)=>this.onStorageEvent(m,S),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=PT(),this._shouldAllowMigration=!0}forAllChangedKeys(m){for(const S of Object.keys(this.listeners)){const D=this.storage.getItem(S),V=this.localCache[S];D!==V&&m(S,V,D)}}onStorageEvent(m,S=!1){if(!m.key){this.forAllChangedKeys((re,s,pe)=>{this.notifyListeners(re,pe)});return}const D=m.key;S?this.detachListener():this.stopPolling();const V=()=>{const re=this.storage.getItem(D);!S&&this.localCache[D]===re||this.notifyListeners(D,re)},K=this.storage.getItem(D);MI()&&K!==m.newValue&&m.newValue!==m.oldValue?setTimeout(V,WI):V()}notifyListeners(m,S){this.localCache[m]=S;const D=this.listeners[m];if(D)for(const V of Array.from(D))V(S&&JSON.parse(S))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((m,S,D)=>{this.onStorageEvent(new StorageEvent("storage",{key:m,oldValue:S,newValue:D}),!0)})},XI)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(m,S){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[m]||(this.listeners[m]=new Set,this.localCache[m]=this.storage.getItem(m)),this.listeners[m].add(S)}_removeListener(m,S){this.listeners[m]&&(this.listeners[m].delete(S),this.listeners[m].size===0&&delete this.listeners[m]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(m,S){await super._set(m,S),this.localCache[m]=JSON.stringify(S)}async _get(m){const S=await super._get(m);return this.localCache[m]=JSON.stringify(S),S}async _remove(m){await super._remove(m),delete this.localCache[m]}}FT.type="LOCAL";const YI=FT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UT extends NT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(m,S){}_removeListener(m,S){}}UT.type="SESSION";const VT=UT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KI(b){return Promise.all(b.map(async m=>{try{return{fulfilled:!0,value:await m}}catch(S){return{fulfilled:!1,reason:S}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv{constructor(m){this.eventTarget=m,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(m){const S=this.receivers.find(V=>V.isListeningto(m));if(S)return S;const D=new tv(m);return this.receivers.push(D),D}isListeningto(m){return this.eventTarget===m}async handleEvent(m){const S=m,{eventId:D,eventType:V,data:K}=S.data,re=this.handlersMap[V];if(!(re!=null&&re.size))return;S.ports[0].postMessage({status:"ack",eventId:D,eventType:V});const s=Array.from(re).map(async Ce=>Ce(S.origin,K)),pe=await KI(s);S.ports[0].postMessage({status:"done",eventId:D,eventType:V,response:pe})}_subscribe(m,S){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[m]||(this.handlersMap[m]=new Set),this.handlersMap[m].add(S)}_unsubscribe(m,S){this.handlersMap[m]&&S&&this.handlersMap[m].delete(S),(!S||this.handlersMap[m].size===0)&&delete this.handlersMap[m],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}tv.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vx(b="",m=10){let S="";for(let D=0;D<m;D++)S+=Math.floor(Math.random()*10);return b+S}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JI{constructor(m){this.target=m,this.handlers=new Set}removeMessageHandler(m){m.messageChannel&&(m.messageChannel.port1.removeEventListener("message",m.onMessage),m.messageChannel.port1.close()),this.handlers.delete(m)}async _send(m,S,D=50){const V=typeof MessageChannel<"u"?new MessageChannel:null;if(!V)throw new Error("connection_unavailable");let K,re;return new Promise((s,pe)=>{const Ce=vx("",20);V.port1.start();const He=setTimeout(()=>{pe(new Error("unsupported_event"))},D);re={messageChannel:V,onMessage(wt){const gt=wt;if(gt.data.eventId===Ce)switch(gt.data.status){case"ack":clearTimeout(He),K=setTimeout(()=>{pe(new Error("timeout"))},3e3);break;case"done":clearTimeout(K),s(gt.data.response);break;default:clearTimeout(He),clearTimeout(K),pe(new Error("invalid_response"));break}}},this.handlers.add(re),V.port1.addEventListener("message",re.onMessage),this.target.postMessage({eventType:m,eventId:Ce,data:S},[V.port2])}).finally(()=>{re&&this.removeMessageHandler(re)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(){return window}function QI(b){Mu().location.href=b}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jT(){return typeof Mu().WorkerGlobalScope<"u"&&typeof Mu().importScripts=="function"}async function eC(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function tC(){var b;return((b=navigator==null?void 0:navigator.serviceWorker)===null||b===void 0?void 0:b.controller)||null}function iC(){return jT()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qT="firebaseLocalStorageDb",nC=1,Xy="firebaseLocalStorage",GT="fbase_key";class lg{constructor(m){this.request=m}toPromise(){return new Promise((m,S)=>{this.request.addEventListener("success",()=>{m(this.request.result)}),this.request.addEventListener("error",()=>{S(this.request.error)})})}}function iv(b,m){return b.transaction([Xy],m?"readwrite":"readonly").objectStore(Xy)}function rC(){const b=indexedDB.deleteDatabase(qT);return new lg(b).toPromise()}function $0(){const b=indexedDB.open(qT,nC);return new Promise((m,S)=>{b.addEventListener("error",()=>{S(b.error)}),b.addEventListener("upgradeneeded",()=>{const D=b.result;try{D.createObjectStore(Xy,{keyPath:GT})}catch(V){S(V)}}),b.addEventListener("success",async()=>{const D=b.result;D.objectStoreNames.contains(Xy)?m(D):(D.close(),await rC(),m(await $0()))})})}async function Sw(b,m,S){const D=iv(b,!0).put({[GT]:m,value:S});return new lg(D).toPromise()}async function sC(b,m){const S=iv(b,!1).get(m),D=await new lg(S).toPromise();return D===void 0?null:D.value}function Ew(b,m){const S=iv(b,!0).delete(m);return new lg(S).toPromise()}const aC=800,oC=3;class HT{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await $0(),this.db)}async _withRetries(m){let S=0;for(;;)try{const D=await this._openDb();return await m(D)}catch(D){if(S++>oC)throw D;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return jT()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=tv._getInstance(iC()),this.receiver._subscribe("keyChanged",async(m,S)=>({keyProcessed:(await this._poll()).includes(S.key)})),this.receiver._subscribe("ping",async(m,S)=>["keyChanged"])}async initializeSender(){var m,S;if(this.activeServiceWorker=await eC(),!this.activeServiceWorker)return;this.sender=new JI(this.activeServiceWorker);const D=await this.sender._send("ping",{},800);D&&!((m=D[0])===null||m===void 0)&&m.fulfilled&&!((S=D[0])===null||S===void 0)&&S.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(m){if(!(!this.sender||!this.activeServiceWorker||tC()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:m},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const m=await $0();return await Sw(m,$y,"1"),await Ew(m,$y),!0}catch{}return!1}async _withPendingWrite(m){this.pendingWrites++;try{await m()}finally{this.pendingWrites--}}async _set(m,S){return this._withPendingWrite(async()=>(await this._withRetries(D=>Sw(D,m,S)),this.localCache[m]=S,this.notifyServiceWorker(m)))}async _get(m){const S=await this._withRetries(D=>sC(D,m));return this.localCache[m]=S,S}async _remove(m){return this._withPendingWrite(async()=>(await this._withRetries(S=>Ew(S,m)),delete this.localCache[m],this.notifyServiceWorker(m)))}async _poll(){const m=await this._withRetries(V=>{const K=iv(V,!1).getAll();return new lg(K).toPromise()});if(!m)return[];if(this.pendingWrites!==0)return[];const S=[],D=new Set;if(m.length!==0)for(const{fbase_key:V,value:K}of m)D.add(V),JSON.stringify(this.localCache[V])!==JSON.stringify(K)&&(this.notifyListeners(V,K),S.push(V));for(const V of Object.keys(this.localCache))this.localCache[V]&&!D.has(V)&&(this.notifyListeners(V,null),S.push(V));return S}notifyListeners(m,S){this.localCache[m]=S;const D=this.listeners[m];if(D)for(const V of Array.from(D))V(S)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),aC)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(m,S){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[m]||(this.listeners[m]=new Set,this._get(m)),this.listeners[m].add(S)}_removeListener(m,S){this.listeners[m]&&(this.listeners[m].delete(S),this.listeners[m].size===0&&delete this.listeners[m]),Object.keys(this.listeners).length===0&&this.stopPolling()}}HT.type="LOCAL";const lC=HT;new ag(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZT(b,m){return m?Ph(m):(pn(b._popupRedirectResolver,b,"argument-error"),b._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xx extends kT{constructor(m){super("custom","custom"),this.params=m}_getIdTokenResponse(m){return Nm(m,this._buildIdpRequest())}_linkToIdToken(m,S){return Nm(m,this._buildIdpRequest(S))}_getReauthenticationResolver(m){return Nm(m,this._buildIdpRequest())}_buildIdpRequest(m){const S={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return m&&(S.idToken=m),S}}function cC(b){return HI(b.auth,new xx(b),b.bypassAuthState)}function uC(b){const{auth:m,user:S}=b;return pn(S,m,"internal-error"),GI(S,new xx(b),b.bypassAuthState)}async function hC(b){const{auth:m,user:S}=b;return pn(S,m,"internal-error"),qI(S,new xx(b),b.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $T{constructor(m,S,D,V,K=!1){this.auth=m,this.resolver=D,this.user=V,this.bypassAuthState=K,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(S)?S:[S]}execute(){return new Promise(async(m,S)=>{this.pendingPromise={resolve:m,reject:S};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(D){this.reject(D)}})}async onAuthEvent(m){const{urlResponse:S,sessionId:D,postBody:V,tenantId:K,error:re,type:s}=m;if(re){this.reject(re);return}const pe={auth:this.auth,requestUri:S,sessionId:D,tenantId:K||void 0,postBody:V||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(pe))}catch(Ce){this.reject(Ce)}}onError(m){this.reject(m)}getIdpTask(m){switch(m){case"signInViaPopup":case"signInViaRedirect":return cC;case"linkViaPopup":case"linkViaRedirect":return hC;case"reauthViaPopup":case"reauthViaRedirect":return uC;default:Iu(this.auth,"internal-error")}}resolve(m){Bh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(m),this.unregisterAndCleanUp()}reject(m){Bh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(m),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dC=new ag(2e3,1e4);async function fC(b,m,S){if(Au(b.app))return Promise.reject(Uc(b,"operation-not-supported-in-this-environment"));const D=ev(b);cI(b,m,yx);const V=ZT(D,S);return new cp(D,"signInViaPopup",m,V).executeNotNull()}class cp extends $T{constructor(m,S,D,V,K){super(m,S,V,K),this.provider=D,this.authWindow=null,this.pollId=null,cp.currentPopupAction&&cp.currentPopupAction.cancel(),cp.currentPopupAction=this}async executeNotNull(){const m=await this.execute();return pn(m,this.auth,"internal-error"),m}async onExecution(){Bh(this.filter.length===1,"Popup operations only handle one event");const m=vx();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],m),this.authWindow.associatedEvent=m,this.resolver._originValidation(this.auth).catch(S=>{this.reject(S)}),this.resolver._isIframeWebStorageSupported(this.auth,S=>{S||this.reject(Uc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var m;return((m=this.authWindow)===null||m===void 0?void 0:m.associatedEvent)||null}cancel(){this.reject(Uc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,cp.currentPopupAction=null}pollUserCancellation(){const m=()=>{var S,D;if(!((D=(S=this.authWindow)===null||S===void 0?void 0:S.window)===null||D===void 0)&&D.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Uc(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(m,dC.get())};m()}}cp.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pC="pendingRedirect",Iy=new Map;class mC extends $T{constructor(m,S,D=!1){super(m,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],S,void 0,D),this.eventId=null}async execute(){let m=Iy.get(this.auth._key());if(!m){try{const D=await _C(this.resolver,this.auth)?await super.execute():null;m=()=>Promise.resolve(D)}catch(S){m=()=>Promise.reject(S)}Iy.set(this.auth._key(),m)}return this.bypassAuthState||Iy.set(this.auth._key(),()=>Promise.resolve(null)),m()}async onAuthEvent(m){if(m.type==="signInViaRedirect")return super.onAuthEvent(m);if(m.type==="unknown"){this.resolve(null);return}if(m.eventId){const S=await this.auth._redirectUserForId(m.eventId);if(S)return this.user=S,super.onAuthEvent(m);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _C(b,m){const S=vC(m),D=yC(b);if(!await D._isAvailable())return!1;const V=await D._get(S)==="true";return await D._remove(S),V}function gC(b,m){Iy.set(b._key(),m)}function yC(b){return Ph(b._redirectPersistence)}function vC(b){return My(pC,b.config.apiKey,b.name)}async function xC(b,m,S=!1){if(Au(b.app))return Promise.reject(up(b));const D=ev(b),V=ZT(D,m),re=await new mC(D,V,S).execute();return re&&!S&&(delete re.user._redirectEventId,await D._persistUserIfCurrent(re.user),await D._setRedirectUser(null,m)),re}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bC=10*60*1e3;class wC{constructor(m){this.auth=m,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(m){this.consumers.add(m),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,m)&&(this.sendToConsumer(this.queuedRedirectEvent,m),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(m){this.consumers.delete(m)}onEvent(m){if(this.hasEventBeenHandled(m))return!1;let S=!1;return this.consumers.forEach(D=>{this.isEventForConsumer(m,D)&&(S=!0,this.sendToConsumer(m,D),this.saveEventToCache(m))}),this.hasHandledPotentialRedirect||!TC(m)||(this.hasHandledPotentialRedirect=!0,S||(this.queuedRedirectEvent=m,S=!0)),S}sendToConsumer(m,S){var D;if(m.error&&!XT(m)){const V=((D=m.error.code)===null||D===void 0?void 0:D.split("auth/")[1])||"internal-error";S.onError(Uc(this.auth,V))}else S.onAuthEvent(m)}isEventForConsumer(m,S){const D=S.eventId===null||!!m.eventId&&m.eventId===S.eventId;return S.filter.includes(m.type)&&D}hasEventBeenHandled(m){return Date.now()-this.lastProcessedEventTime>=bC&&this.cachedEventUids.clear(),this.cachedEventUids.has(Aw(m))}saveEventToCache(m){this.cachedEventUids.add(Aw(m)),this.lastProcessedEventTime=Date.now()}}function Aw(b){return[b.type,b.eventId,b.sessionId,b.tenantId].filter(m=>m).join("-")}function XT({type:b,error:m}){return b==="unknown"&&(m==null?void 0:m.code)==="auth/no-auth-event"}function TC(b){switch(b.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return XT(b);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SC(b,m={}){return Hm(b,"GET","/v1/projects",m)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EC=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,AC=/^https?/;async function MC(b){if(b.config.emulator)return;const{authorizedDomains:m}=await SC(b);for(const S of m)try{if(IC(S))return}catch{}Iu(b,"unauthorized-domain")}function IC(b){const m=H0(),{protocol:S,hostname:D}=new URL(m);if(b.startsWith("chrome-extension://")){const re=new URL(b);return re.hostname===""&&D===""?S==="chrome-extension:"&&b.replace("chrome-extension://","")===m.replace("chrome-extension://",""):S==="chrome-extension:"&&re.hostname===D}if(!AC.test(S))return!1;if(EC.test(b))return D===b;const V=b.replace(/\./g,"\\.");return new RegExp("^(.+\\."+V+"|"+V+")$","i").test(D)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CC=new ag(3e4,6e4);function Mw(){const b=Mu().___jsl;if(b!=null&&b.H){for(const m of Object.keys(b.H))if(b.H[m].r=b.H[m].r||[],b.H[m].L=b.H[m].L||[],b.H[m].r=[...b.H[m].L],b.CP)for(let S=0;S<b.CP.length;S++)b.CP[S]=null}}function RC(b){return new Promise((m,S)=>{var D,V,K;function re(){Mw(),gapi.load("gapi.iframes",{callback:()=>{m(gapi.iframes.getContext())},ontimeout:()=>{Mw(),S(Uc(b,"network-request-failed"))},timeout:CC.get()})}if(!((V=(D=Mu().gapi)===null||D===void 0?void 0:D.iframes)===null||V===void 0)&&V.Iframe)m(gapi.iframes.getContext());else if(!((K=Mu().gapi)===null||K===void 0)&&K.load)re();else{const s=kI("iframefcb");return Mu()[s]=()=>{gapi.load?re():S(Uc(b,"network-request-failed"))},OI(`${LI()}?onload=${s}`).catch(pe=>S(pe))}}).catch(m=>{throw Cy=null,m})}let Cy=null;function DC(b){return Cy=Cy||RC(b),Cy}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zC=new ag(5e3,15e3),PC="__/auth/iframe",OC="emulator/auth/iframe",LC={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},kC=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function BC(b){const m=b.config;pn(m.authDomain,b,"auth-domain-config-required");const S=m.emulator?fx(m,OC):`https://${b.config.authDomain}/${PC}`,D={apiKey:m.apiKey,appName:b.name,v:sg},V=kC.get(b.config.apiHost);V&&(D.eid=V);const K=b._getFrameworks();return K.length&&(D.fw=K.join(",")),`${S}?${rg(D).slice(1)}`}async function NC(b){const m=await DC(b),S=Mu().gapi;return pn(S,b,"internal-error"),m.open({where:document.body,url:BC(b),messageHandlersFilter:S.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:LC,dontclear:!0},D=>new Promise(async(V,K)=>{await D.restyle({setHideOnLeave:!1});const re=Uc(b,"network-request-failed"),s=Mu().setTimeout(()=>{K(re)},zC.get());function pe(){Mu().clearTimeout(s),V(D)}D.ping(pe).then(pe,()=>{K(re)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FC={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},UC=500,VC=600,jC="_blank",qC="http://localhost";class Iw{constructor(m){this.window=m,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function GC(b,m,S,D=UC,V=VC){const K=Math.max((window.screen.availHeight-V)/2,0).toString(),re=Math.max((window.screen.availWidth-D)/2,0).toString();let s="";const pe=Object.assign(Object.assign({},FC),{width:D.toString(),height:V.toString(),top:K,left:re}),Ce=Ga().toLowerCase();S&&(s=IT(Ce)?jC:S),AT(Ce)&&(m=m||qC,pe.scrollbars="yes");const He=Object.entries(pe).reduce((gt,[Xt,jt])=>`${gt}${Xt}=${jt},`,"");if(AI(Ce)&&s!=="_self")return HC(m||"",s),new Iw(null);const wt=window.open(m||"",s,He);pn(wt,b,"popup-blocked");try{wt.focus()}catch{}return new Iw(wt)}function HC(b,m){const S=document.createElement("a");S.href=b,S.target=m;const D=document.createEvent("MouseEvent");D.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),S.dispatchEvent(D)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZC="__/auth/handler",$C="emulator/auth/handler",XC=encodeURIComponent("fac");async function Cw(b,m,S,D,V,K){pn(b.config.authDomain,b,"auth-domain-config-required"),pn(b.config.apiKey,b,"invalid-api-key");const re={apiKey:b.config.apiKey,appName:b.name,authType:S,redirectUrl:D,v:sg,eventId:V};if(m instanceof yx){m.setDefaultLanguage(b.languageCode),re.providerId=m.providerId||"",ZA(m.getCustomParameters())||(re.customParameters=JSON.stringify(m.getCustomParameters()));for(const[He,wt]of Object.entries({}))re[He]=wt}if(m instanceof og){const He=m.getScopes().filter(wt=>wt!=="");He.length>0&&(re.scopes=He.join(","))}b.tenantId&&(re.tid=b.tenantId);const s=re;for(const He of Object.keys(s))s[He]===void 0&&delete s[He];const pe=await b._getAppCheckToken(),Ce=pe?`#${XC}=${encodeURIComponent(pe)}`:"";return`${WC(b)}?${rg(s).slice(1)}${Ce}`}function WC({config:b}){return b.emulator?fx(b,$C):`https://${b.authDomain}/${ZC}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C0="webStorageSupport";class YC{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=VT,this._completeRedirectFn=xC,this._overrideRedirectResult=gC}async _openPopup(m,S,D,V){var K;Bh((K=this.eventManagers[m._key()])===null||K===void 0?void 0:K.manager,"_initialize() not called before _openPopup()");const re=await Cw(m,S,D,H0(),V);return GC(m,re,vx())}async _openRedirect(m,S,D,V){await this._originValidation(m);const K=await Cw(m,S,D,H0(),V);return QI(K),new Promise(()=>{})}_initialize(m){const S=m._key();if(this.eventManagers[S]){const{manager:V,promise:K}=this.eventManagers[S];return V?Promise.resolve(V):(Bh(K,"If manager is not set, promise should be"),K)}const D=this.initAndGetManager(m);return this.eventManagers[S]={promise:D},D.catch(()=>{delete this.eventManagers[S]}),D}async initAndGetManager(m){const S=await NC(m),D=new wC(m);return S.register("authEvent",V=>(pn(V==null?void 0:V.authEvent,m,"invalid-auth-event"),{status:D.onEvent(V.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[m._key()]={manager:D},this.iframes[m._key()]=S,D}_isIframeWebStorageSupported(m,S){this.iframes[m._key()].send(C0,{type:C0},V=>{var K;const re=(K=V==null?void 0:V[0])===null||K===void 0?void 0:K[C0];re!==void 0&&S(!!re),Iu(m,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(m){const S=m._key();return this.originValidationPromises[S]||(this.originValidationPromises[S]=MC(m)),this.originValidationPromises[S]}get _shouldInitProactively(){return PT()||MT()||_x()}}const KC=YC;var Rw="@firebase/auth",Dw="1.10.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(m){this.auth=m,this.internalListeners=new Map}getUid(){var m;return this.assertAuthConfigured(),((m=this.auth.currentUser)===null||m===void 0?void 0:m.uid)||null}async getToken(m){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(m)}:null}addAuthTokenListener(m){if(this.assertAuthConfigured(),this.internalListeners.has(m))return;const S=this.auth.onIdTokenChanged(D=>{m((D==null?void 0:D.stsTokenManager.accessToken)||null)});this.internalListeners.set(m,S),this.updateProactiveRefresh()}removeAuthTokenListener(m){this.assertAuthConfigured();const S=this.internalListeners.get(m);S&&(this.internalListeners.delete(m),S(),this.updateProactiveRefresh())}assertAuthConfigured(){pn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QC(b){switch(b){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function eR(b){Q_(new jm("auth",(m,{options:S})=>{const D=m.getProvider("app").getImmediate(),V=m.getProvider("heartbeat"),K=m.getProvider("app-check-internal"),{apiKey:re,authDomain:s}=D.options;pn(re&&!re.includes(":"),"invalid-api-key",{appName:D.name});const pe={apiKey:re,authDomain:s,clientPlatform:b,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:OT(b)},Ce=new zI(D,V,K,pe);return NI(Ce,S),Ce},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((m,S,D)=>{m.getProvider("auth-internal").initialize()})),Q_(new jm("auth-internal",m=>{const S=ev(m.getProvider("auth").getImmediate());return(D=>new JC(D))(S)},"PRIVATE").setInstantiationMode("EXPLICIT")),Lm(Rw,Dw,QC(b)),Lm(Rw,Dw,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tR=5*60,iR=hT("authIdTokenMaxAge")||tR;let zw=null;const nR=b=>async m=>{const S=m&&await m.getIdTokenResult(),D=S&&(new Date().getTime()-Date.parse(S.issuedAtTime))/1e3;if(D&&D>iR)return;const V=S==null?void 0:S.token;zw!==V&&(zw=V,await fetch(b,{method:V?"POST":"DELETE",headers:V?{Authorization:`Bearer ${V}`}:{}}))};function rR(b=XM()){const m=mT(b,"auth");if(m.isInitialized())return m.getImmediate();const S=BI(b,{popupRedirectResolver:KC,persistence:[lC,YI,VT]}),D=hT("authTokenSyncURL");if(D&&typeof isSecureContext=="boolean"&&isSecureContext){const K=new URL(D,location.origin);if(location.origin===K.origin){const re=nR(K.toString());$I(S,re,()=>re(S.currentUser)),ZI(S,s=>re(s))}}const V=OA("auth");return V&&FI(S,`http://${V}`),S}function sR(){var b,m;return(m=(b=document.getElementsByTagName("head"))===null||b===void 0?void 0:b[0])!==null&&m!==void 0?m:document}PI({loadJS(b){return new Promise((m,S)=>{const D=document.createElement("script");D.setAttribute("src",b),D.onload=m,D.onerror=V=>{const K=Uc("internal-error");K.customData=V,S(K)},D.type="text/javascript",D.charset="UTF-8",sR().appendChild(D)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});eR("Browser");const aR={apiKey:"AIzaSyC0xNofnFkOy1Ig5cc74kGzuM0WcHGdj88",authDomain:"politik404-41c47.firebaseapp.com",projectId:"politik404-41c47"},oR=_T(aR),lR=rR(oR),cR=new Dh,uR=()=>fC(lR,cR),hR={rooms:[],currentRoom:null},WT=ig({name:"rooms",initialState:hR,reducers:{setRooms:(b,m)=>{b.rooms=m.payload},setCurrentRoom:(b,m)=>{b.currentRoom=m.payload},leaveRoom:b=>{b.currentRoom=null}}}),{setRooms:dR,setCurrentRoom:fR,leaveRoom:Pw}=WT.actions,pR=WT.reducer,mR={myCountry:null,players:[],onlinePlayers:[],countriesData:null,countriesCoordinates:null,selectedCountry:null},YT=ig({name:"game",initialState:mR,reducers:{setMyCountry:(b,m)=>{b.myCountry=m.payload},setPlayers:(b,m)=>{b.players=m.payload;const S=m.payload.filter(D=>typeof D=="object"?D.isOnline!==!1:!0).map(D=>{if(typeof D=="object")return D.username;if(typeof D=="string"){const V=D.match(/^(.*?)\s*\(/);return V?V[1]:D}return""}).filter(Boolean);b.onlinePlayers=S},setOnlinePlayers:(b,m)=>{b.onlinePlayers=m.payload,b.players=b.players.map(S=>{if(typeof S!="object"){const D=S.match(/^(.*?)\s*\((.*)\)$/);return D?{username:D[1],country:D[2],isOnline:S.isOnline!==!1&&b.onlinePlayers.includes(D[1])}:S}return S.username?{...S,isOnline:S.isOnline!==!1&&b.onlinePlayers.includes(S.username)}:S})},setPlayerOnlineStatus:(b,m)=>{const{username:S,isOnline:D}=m.payload;D&&!b.onlinePlayers.includes(S)?b.onlinePlayers.push(S):D||(b.onlinePlayers=b.onlinePlayers.filter(V=>V!==S)),b.players=b.players.map(V=>typeof V=="object"&&V.username===S?{...V,isOnline:D}:V)},setCountriesData:(b,m)=>{b.countriesData=m.payload},setCountriesCoordinates:(b,m)=>{b.countriesCoordinates=m.payload},setSelectedCountry:(b,m)=>{b.selectedCountry=m.payload}}}),{setMyCountry:X0,setPlayers:_R,setOnlinePlayers:gR,setPlayerOnlineStatus:yR,setCountriesData:vR,setCountriesCoordinates:bx,setSelectedCountry:Ow}=YT.actions,xR=YT.reducer,bR={publicMessages:[],privateMessages:{},currentChatMode:"public",currentPrivateRecipient:null,unreadCount:{public:0,private:{}},lastReadTimestamps:{public:Date.now(),private:{}}},KT=ig({name:"chat",initialState:bR,reducers:{addMessage:(b,m)=>{const S=m.payload,D=Date.now();if(S.isPrivate){let V="";if(typeof S.sender=="string"){const pe=S.sender.match(/.*? - (.*)/);V=pe?pe[1]:S.sender}let K=S.recipient;const re=sessionStorage.getItem("username");let s;V===re?(s=K,b.lastReadTimestamps.private[s]||(b.lastReadTimestamps.private[s]=D)):(s=V,b.unreadCount.private[s]||(b.unreadCount.private[s]=0),b.currentChatMode!==s?b.unreadCount.private[s]++:b.lastReadTimestamps.private[s]=D),b.privateMessages[s]||(b.privateMessages[s]=[]),b.privateMessages[s].push(S)}else b.publicMessages.push(S),b.currentChatMode!=="public"?b.unreadCount.public++:b.lastReadTimestamps.public=D},setChatMode:(b,m)=>{b.currentChatMode;const S=m.payload;b.currentChatMode=S,S!=="public"?(b.currentPrivateRecipient=S,b.unreadCount.private[S]&&(b.unreadCount.private[S]=0),b.lastReadTimestamps.private[S]=Date.now()):(b.currentPrivateRecipient=null,b.unreadCount.public=0,b.lastReadTimestamps.public=Date.now())},setChatHistory:(b,m)=>{const{type:S,target:D,messages:V}=m.payload,K=Date.now();if(S==="public")if(b.publicMessages=V,b.currentChatMode==="public")b.unreadCount.public=0,b.lastReadTimestamps.public=K;else{const re=b.lastReadTimestamps.public||0;b.unreadCount.public=V.filter(s=>s.timestamp>re).length}else if(S==="private"&&D)if(b.privateMessages[D]=V,b.lastReadTimestamps.private[D]||(b.lastReadTimestamps.private[D]=0),b.currentChatMode===D)b.unreadCount.private[D]=0,b.lastReadTimestamps.private[D]=K;else{const re=b.lastReadTimestamps.private[D]||0;b.unreadCount.private[D]=V.filter(s=>{let pe="";if(typeof s.sender=="string"){const Ce=s.sender.match(/.*? - (.*)/);pe=Ce?Ce[1]:s.sender}return pe===D&&s.timestamp>re}).length}},markAsRead:(b,m)=>{const{chatType:S,target:D}=m.payload,V=Date.now();S==="public"?(b.unreadCount.public=0,b.lastReadTimestamps.public=V):S==="private"&&D&&(b.unreadCount.private[D]&&(b.unreadCount.private[D]=0),b.lastReadTimestamps.private[D]=V)},clearChat:b=>{b.publicMessages=[],b.privateMessages={},b.currentChatMode="public",b.currentPrivateRecipient=null,b.unreadCount={public:0,private:{}},b.lastReadTimestamps={public:Date.now(),private:{}}}}}),{addMessage:wR,setChatMode:TR,setChatHistory:SR,markAsRead:zm,clearChat:hD}=KT.actions,ER=KT.reducer,AR={roomStates:{},lastUpdated:{},loading:!1,error:null},JT=ig({name:"countryState",initialState:AR,reducers:{initializeCountryStates:(b,m)=>{const{roomName:S,states:D,timestamp:V}=m.payload;b.roomStates[S]=D,b.lastUpdated[S]=V,b.error=null,b.loading=!1},updateCountryStates:(b,m)=>{const{roomName:S,states:D,timestamp:V}=m.payload;(!b.lastUpdated[S]||V>b.lastUpdated[S])&&(b.roomStates[S]=D,b.lastUpdated[S]=V)},updateCountryState:(b,m)=>{const{roomName:S,countryName:D,category:V,updates:K,timestamp:re}=m.payload;b.roomStates[S]&&b.roomStates[S][D]&&(!b.lastUpdated[S]||re>b.lastUpdated[S])&&(b.roomStates[S][D][V]={...b.roomStates[S][D][V],...K},b.lastUpdated[S]=re)},startLoading:b=>{b.loading=!0,b.error=null},setError:(b,m)=>{b.error=m.payload,b.loading=!1},clearRoomStates:(b,m)=>{const S=m.payload;b.roomStates[S]&&delete b.roomStates[S],b.lastUpdated[S]&&delete b.lastUpdated[S]},resetState:b=>{b.roomStates={},b.lastUpdated={},b.loading=!1,b.error=null}}}),{initializeCountryStates:MR,updateCountryStates:IR,updateCountryState:CR,startLoading:dD,setError:fD,clearRoomStates:pD,resetState:W0}=JT.actions,RR=(b,m,S)=>{var D;return((D=b.countryState.roomStates[m])==null?void 0:D[S])||null},DR=b=>b.countryState.loading,zR=(b,m)=>b.countryState.lastUpdated[m]||null,PR=JT.reducer,OR=b=>m=>S=>{const D=m(S);switch(S.type){case Eu.CONNECT:zn.connect();break;case Eu.AUTHENTICATE:zn.authenticate(S.payload);break;case Eu.GET_ROOMS:zn.getRooms();break;case Eu.CREATE_ROOM:zn.createRoom(S.payload);break;case Eu.JOIN_ROOM:zn.joinRoom(S.payload);break;case Eu.LEAVE_ROOM:zn.leaveRoom();break;case Eu.SEND_CHAT:const{content:V,isPrivate:K,recipient:re}=S.payload;zn.sendMessage(V,K,re);break;case Eu.REQUEST_CHAT_HISTORY:zn.requestPrivateHistory(S.payload);break;case Eu.REQUEST_COUNTRY:zn.requestCountry(S.payload);break;case Pm.SUBSCRIBE:zn.subscribeToCountryStates(S.payload);break;case Pm.UNSUBSCRIBE:zn.unsubscribeFromCountryStates(S.payload);break;case Pm.GET_STATE:zn.getCountryState(S.payload.roomName,S.payload.countryName);break;case Pm.UPDATE_STATE:zn.updateCountryState(S.payload.roomName,S.payload.countryName,S.payload.category,S.payload.updates);break}return D},Vr=lA({reducer:{auth:EA,rooms:pR,game:xR,chat:ER,countryState:PR},middleware:b=>b({serializableCheck:{ignoredActions:["socket/connect","socket/authenticate","error/socketError","error/connectionFailed","socket/subscribeToCountryStates","socket/unsubscribeFromCountryStates","socket/getCountryState","socket/updateCountryState"],ignoredPaths:["socket"]}}).concat(OR)}),Cu=Object.create(null);Cu.open="0";Cu.close="1";Cu.ping="2";Cu.pong="3";Cu.message="4";Cu.upgrade="5";Cu.noop="6";const Ry=Object.create(null);Object.keys(Cu).forEach(b=>{Ry[Cu[b]]=b});const Y0={type:"error",data:"parser error"},QT=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",eS=typeof ArrayBuffer=="function",tS=b=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(b):b&&b.buffer instanceof ArrayBuffer,wx=({type:b,data:m},S,D)=>QT&&m instanceof Blob?S?D(m):Lw(m,D):eS&&(m instanceof ArrayBuffer||tS(m))?S?D(m):Lw(new Blob([m]),D):D(Cu[b]+(m||"")),Lw=(b,m)=>{const S=new FileReader;return S.onload=function(){const D=S.result.split(",")[1];m("b"+(D||""))},S.readAsDataURL(b)};function kw(b){return b instanceof Uint8Array?b:b instanceof ArrayBuffer?new Uint8Array(b):new Uint8Array(b.buffer,b.byteOffset,b.byteLength)}let R0;function LR(b,m){if(QT&&b.data instanceof Blob)return b.data.arrayBuffer().then(kw).then(m);if(eS&&(b.data instanceof ArrayBuffer||tS(b.data)))return m(kw(b.data));wx(b,!1,S=>{R0||(R0=new TextEncoder),m(R0.encode(S))})}const Bw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",W_=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let b=0;b<Bw.length;b++)W_[Bw.charCodeAt(b)]=b;const kR=b=>{let m=b.length*.75,S=b.length,D,V=0,K,re,s,pe;b[b.length-1]==="="&&(m--,b[b.length-2]==="="&&m--);const Ce=new ArrayBuffer(m),He=new Uint8Array(Ce);for(D=0;D<S;D+=4)K=W_[b.charCodeAt(D)],re=W_[b.charCodeAt(D+1)],s=W_[b.charCodeAt(D+2)],pe=W_[b.charCodeAt(D+3)],He[V++]=K<<2|re>>4,He[V++]=(re&15)<<4|s>>2,He[V++]=(s&3)<<6|pe&63;return Ce},BR=typeof ArrayBuffer=="function",Tx=(b,m)=>{if(typeof b!="string")return{type:"message",data:iS(b,m)};const S=b.charAt(0);return S==="b"?{type:"message",data:NR(b.substring(1),m)}:Ry[S]?b.length>1?{type:Ry[S],data:b.substring(1)}:{type:Ry[S]}:Y0},NR=(b,m)=>{if(BR){const S=kR(b);return iS(S,m)}else return{base64:!0,data:b}},iS=(b,m)=>{switch(m){case"blob":return b instanceof Blob?b:new Blob([b]);case"arraybuffer":default:return b instanceof ArrayBuffer?b:b.buffer}},nS="",FR=(b,m)=>{const S=b.length,D=new Array(S);let V=0;b.forEach((K,re)=>{wx(K,!1,s=>{D[re]=s,++V===S&&m(D.join(nS))})})},UR=(b,m)=>{const S=b.split(nS),D=[];for(let V=0;V<S.length;V++){const K=Tx(S[V],m);if(D.push(K),K.type==="error")break}return D};function VR(){return new TransformStream({transform(b,m){LR(b,S=>{const D=S.length;let V;if(D<126)V=new Uint8Array(1),new DataView(V.buffer).setUint8(0,D);else if(D<65536){V=new Uint8Array(3);const K=new DataView(V.buffer);K.setUint8(0,126),K.setUint16(1,D)}else{V=new Uint8Array(9);const K=new DataView(V.buffer);K.setUint8(0,127),K.setBigUint64(1,BigInt(D))}b.data&&typeof b.data!="string"&&(V[0]|=128),m.enqueue(V),m.enqueue(S)})}})}let D0;function Sy(b){return b.reduce((m,S)=>m+S.length,0)}function Ey(b,m){if(b[0].length===m)return b.shift();const S=new Uint8Array(m);let D=0;for(let V=0;V<m;V++)S[V]=b[0][D++],D===b[0].length&&(b.shift(),D=0);return b.length&&D<b[0].length&&(b[0]=b[0].slice(D)),S}function jR(b,m){D0||(D0=new TextDecoder);const S=[];let D=0,V=-1,K=!1;return new TransformStream({transform(re,s){for(S.push(re);;){if(D===0){if(Sy(S)<1)break;const pe=Ey(S,1);K=(pe[0]&128)===128,V=pe[0]&127,V<126?D=3:V===126?D=1:D=2}else if(D===1){if(Sy(S)<2)break;const pe=Ey(S,2);V=new DataView(pe.buffer,pe.byteOffset,pe.length).getUint16(0),D=3}else if(D===2){if(Sy(S)<8)break;const pe=Ey(S,8),Ce=new DataView(pe.buffer,pe.byteOffset,pe.length),He=Ce.getUint32(0);if(He>Math.pow(2,21)-1){s.enqueue(Y0);break}V=He*Math.pow(2,32)+Ce.getUint32(4),D=3}else{if(Sy(S)<V)break;const pe=Ey(S,V);s.enqueue(Tx(K?pe:D0.decode(pe),m)),D=0}if(V===0||V>b){s.enqueue(Y0);break}}}})}const rS=4;function Ts(b){if(b)return qR(b)}function qR(b){for(var m in Ts.prototype)b[m]=Ts.prototype[m];return b}Ts.prototype.on=Ts.prototype.addEventListener=function(b,m){return this._callbacks=this._callbacks||{},(this._callbacks["$"+b]=this._callbacks["$"+b]||[]).push(m),this};Ts.prototype.once=function(b,m){function S(){this.off(b,S),m.apply(this,arguments)}return S.fn=m,this.on(b,S),this};Ts.prototype.off=Ts.prototype.removeListener=Ts.prototype.removeAllListeners=Ts.prototype.removeEventListener=function(b,m){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var S=this._callbacks["$"+b];if(!S)return this;if(arguments.length==1)return delete this._callbacks["$"+b],this;for(var D,V=0;V<S.length;V++)if(D=S[V],D===m||D.fn===m){S.splice(V,1);break}return S.length===0&&delete this._callbacks["$"+b],this};Ts.prototype.emit=function(b){this._callbacks=this._callbacks||{};for(var m=new Array(arguments.length-1),S=this._callbacks["$"+b],D=1;D<arguments.length;D++)m[D-1]=arguments[D];if(S){S=S.slice(0);for(var D=0,V=S.length;D<V;++D)S[D].apply(this,m)}return this};Ts.prototype.emitReserved=Ts.prototype.emit;Ts.prototype.listeners=function(b){return this._callbacks=this._callbacks||{},this._callbacks["$"+b]||[]};Ts.prototype.hasListeners=function(b){return!!this.listeners(b).length};const nv=typeof Promise=="function"&&typeof Promise.resolve=="function"?m=>Promise.resolve().then(m):(m,S)=>S(m,0),Ll=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),GR="arraybuffer";function sS(b,...m){return m.reduce((S,D)=>(b.hasOwnProperty(D)&&(S[D]=b[D]),S),{})}const HR=Ll.setTimeout,ZR=Ll.clearTimeout;function rv(b,m){m.useNativeTimers?(b.setTimeoutFn=HR.bind(Ll),b.clearTimeoutFn=ZR.bind(Ll)):(b.setTimeoutFn=Ll.setTimeout.bind(Ll),b.clearTimeoutFn=Ll.clearTimeout.bind(Ll))}const $R=1.33;function XR(b){return typeof b=="string"?WR(b):Math.ceil((b.byteLength||b.size)*$R)}function WR(b){let m=0,S=0;for(let D=0,V=b.length;D<V;D++)m=b.charCodeAt(D),m<128?S+=1:m<2048?S+=2:m<55296||m>=57344?S+=3:(D++,S+=4);return S}function aS(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function YR(b){let m="";for(let S in b)b.hasOwnProperty(S)&&(m.length&&(m+="&"),m+=encodeURIComponent(S)+"="+encodeURIComponent(b[S]));return m}function KR(b){let m={},S=b.split("&");for(let D=0,V=S.length;D<V;D++){let K=S[D].split("=");m[decodeURIComponent(K[0])]=decodeURIComponent(K[1])}return m}class JR extends Error{constructor(m,S,D){super(m),this.description=S,this.context=D,this.type="TransportError"}}class Sx extends Ts{constructor(m){super(),this.writable=!1,rv(this,m),this.opts=m,this.query=m.query,this.socket=m.socket,this.supportsBinary=!m.forceBase64}onError(m,S,D){return super.emitReserved("error",new JR(m,S,D)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(m){this.readyState==="open"&&this.write(m)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(m){const S=Tx(m,this.socket.binaryType);this.onPacket(S)}onPacket(m){super.emitReserved("packet",m)}onClose(m){this.readyState="closed",super.emitReserved("close",m)}pause(m){}createUri(m,S={}){return m+"://"+this._hostname()+this._port()+this.opts.path+this._query(S)}_hostname(){const m=this.opts.hostname;return m.indexOf(":")===-1?m:"["+m+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(m){const S=YR(m);return S.length?"?"+S:""}}class QR extends Sx{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(m){this.readyState="pausing";const S=()=>{this.readyState="paused",m()};if(this._polling||!this.writable){let D=0;this._polling&&(D++,this.once("pollComplete",function(){--D||S()})),this.writable||(D++,this.once("drain",function(){--D||S()}))}else S()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(m){const S=D=>{if(this.readyState==="opening"&&D.type==="open"&&this.onOpen(),D.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(D)};UR(m,this.socket.binaryType).forEach(S),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const m=()=>{this.write([{type:"close"}])};this.readyState==="open"?m():this.once("open",m)}write(m){this.writable=!1,FR(m,S=>{this.doWrite(S,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const m=this.opts.secure?"https":"http",S=this.query||{};return this.opts.timestampRequests!==!1&&(S[this.opts.timestampParam]=aS()),!this.supportsBinary&&!S.sid&&(S.b64=1),this.createUri(m,S)}}let oS=!1;try{oS=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const e3=oS;function t3(){}class i3 extends QR{constructor(m){if(super(m),typeof location<"u"){const S=location.protocol==="https:";let D=location.port;D||(D=S?"443":"80"),this.xd=typeof location<"u"&&m.hostname!==location.hostname||D!==m.port}}doWrite(m,S){const D=this.request({method:"POST",data:m});D.on("success",S),D.on("error",(V,K)=>{this.onError("xhr post error",V,K)})}doPoll(){const m=this.request();m.on("data",this.onData.bind(this)),m.on("error",(S,D)=>{this.onError("xhr poll error",S,D)}),this.pollXhr=m}}let Fm=class Dy extends Ts{constructor(m,S,D){super(),this.createRequest=m,rv(this,D),this._opts=D,this._method=D.method||"GET",this._uri=S,this._data=D.data!==void 0?D.data:null,this._create()}_create(){var m;const S=sS(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");S.xdomain=!!this._opts.xd;const D=this._xhr=this.createRequest(S);try{D.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){D.setDisableHeaderCheck&&D.setDisableHeaderCheck(!0);for(let V in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(V)&&D.setRequestHeader(V,this._opts.extraHeaders[V])}}catch{}if(this._method==="POST")try{D.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{D.setRequestHeader("Accept","*/*")}catch{}(m=this._opts.cookieJar)===null||m===void 0||m.addCookies(D),"withCredentials"in D&&(D.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(D.timeout=this._opts.requestTimeout),D.onreadystatechange=()=>{var V;D.readyState===3&&((V=this._opts.cookieJar)===null||V===void 0||V.parseCookies(D.getResponseHeader("set-cookie"))),D.readyState===4&&(D.status===200||D.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof D.status=="number"?D.status:0)},0))},D.send(this._data)}catch(V){this.setTimeoutFn(()=>{this._onError(V)},0);return}typeof document<"u"&&(this._index=Dy.requestsCount++,Dy.requests[this._index]=this)}_onError(m){this.emitReserved("error",m,this._xhr),this._cleanup(!0)}_cleanup(m){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=t3,m)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Dy.requests[this._index],this._xhr=null}}_onLoad(){const m=this._xhr.responseText;m!==null&&(this.emitReserved("data",m),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Fm.requestsCount=0;Fm.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Nw);else if(typeof addEventListener=="function"){const b="onpagehide"in Ll?"pagehide":"unload";addEventListener(b,Nw,!1)}}function Nw(){for(let b in Fm.requests)Fm.requests.hasOwnProperty(b)&&Fm.requests[b].abort()}const n3=function(){const b=lS({xdomain:!1});return b&&b.responseType!==null}();class r3 extends i3{constructor(m){super(m);const S=m&&m.forceBase64;this.supportsBinary=n3&&!S}request(m={}){return Object.assign(m,{xd:this.xd},this.opts),new Fm(lS,this.uri(),m)}}function lS(b){const m=b.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!m||e3))return new XMLHttpRequest}catch{}if(!m)try{return new Ll[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const cS=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class s3 extends Sx{get name(){return"websocket"}doOpen(){const m=this.uri(),S=this.opts.protocols,D=cS?{}:sS(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(D.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(m,S,D)}catch(V){return this.emitReserved("error",V)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=m=>this.onClose({description:"websocket connection closed",context:m}),this.ws.onmessage=m=>this.onData(m.data),this.ws.onerror=m=>this.onError("websocket error",m)}write(m){this.writable=!1;for(let S=0;S<m.length;S++){const D=m[S],V=S===m.length-1;wx(D,this.supportsBinary,K=>{try{this.doWrite(D,K)}catch{}V&&nv(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const m=this.opts.secure?"wss":"ws",S=this.query||{};return this.opts.timestampRequests&&(S[this.opts.timestampParam]=aS()),this.supportsBinary||(S.b64=1),this.createUri(m,S)}}const z0=Ll.WebSocket||Ll.MozWebSocket;class a3 extends s3{createSocket(m,S,D){return cS?new z0(m,S,D):S?new z0(m,S):new z0(m)}doWrite(m,S){this.ws.send(S)}}class o3 extends Sx{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(m){return this.emitReserved("error",m)}this._transport.closed.then(()=>{this.onClose()}).catch(m=>{this.onError("webtransport error",m)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(m=>{const S=jR(Number.MAX_SAFE_INTEGER,this.socket.binaryType),D=m.readable.pipeThrough(S).getReader(),V=VR();V.readable.pipeTo(m.writable),this._writer=V.writable.getWriter();const K=()=>{D.read().then(({done:s,value:pe})=>{s||(this.onPacket(pe),K())}).catch(s=>{})};K();const re={type:"open"};this.query.sid&&(re.data=`{"sid":"${this.query.sid}"}`),this._writer.write(re).then(()=>this.onOpen())})})}write(m){this.writable=!1;for(let S=0;S<m.length;S++){const D=m[S],V=S===m.length-1;this._writer.write(D).then(()=>{V&&nv(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var m;(m=this._transport)===null||m===void 0||m.close()}}const l3={websocket:a3,webtransport:o3,polling:r3},c3=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,u3=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function K0(b){if(b.length>8e3)throw"URI too long";const m=b,S=b.indexOf("["),D=b.indexOf("]");S!=-1&&D!=-1&&(b=b.substring(0,S)+b.substring(S,D).replace(/:/g,";")+b.substring(D,b.length));let V=c3.exec(b||""),K={},re=14;for(;re--;)K[u3[re]]=V[re]||"";return S!=-1&&D!=-1&&(K.source=m,K.host=K.host.substring(1,K.host.length-1).replace(/;/g,":"),K.authority=K.authority.replace("[","").replace("]","").replace(/;/g,":"),K.ipv6uri=!0),K.pathNames=h3(K,K.path),K.queryKey=d3(K,K.query),K}function h3(b,m){const S=/\/{2,9}/g,D=m.replace(S,"/").split("/");return(m.slice(0,1)=="/"||m.length===0)&&D.splice(0,1),m.slice(-1)=="/"&&D.splice(D.length-1,1),D}function d3(b,m){const S={};return m.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(D,V,K){V&&(S[V]=K)}),S}const J0=typeof addEventListener=="function"&&typeof removeEventListener=="function",zy=[];J0&&addEventListener("offline",()=>{zy.forEach(b=>b())},!1);class af extends Ts{constructor(m,S){if(super(),this.binaryType=GR,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,m&&typeof m=="object"&&(S=m,m=null),m){const D=K0(m);S.hostname=D.host,S.secure=D.protocol==="https"||D.protocol==="wss",S.port=D.port,D.query&&(S.query=D.query)}else S.host&&(S.hostname=K0(S.host).host);rv(this,S),this.secure=S.secure!=null?S.secure:typeof location<"u"&&location.protocol==="https:",S.hostname&&!S.port&&(S.port=this.secure?"443":"80"),this.hostname=S.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=S.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},S.transports.forEach(D=>{const V=D.prototype.name;this.transports.push(V),this._transportsByName[V]=D}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},S),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=KR(this.opts.query)),J0&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},zy.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(m){const S=Object.assign({},this.opts.query);S.EIO=rS,S.transport=m,this.id&&(S.sid=this.id);const D=Object.assign({},this.opts,{query:S,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[m]);return new this._transportsByName[m](D)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const m=this.opts.rememberUpgrade&&af.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const S=this.createTransport(m);S.open(),this.setTransport(S)}setTransport(m){this.transport&&this.transport.removeAllListeners(),this.transport=m,m.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",S=>this._onClose("transport close",S))}onOpen(){this.readyState="open",af.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(m){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",m),this.emitReserved("heartbeat"),m.type){case"open":this.onHandshake(JSON.parse(m.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const S=new Error("server error");S.code=m.data,this._onError(S);break;case"message":this.emitReserved("data",m.data),this.emitReserved("message",m.data);break}}onHandshake(m){this.emitReserved("handshake",m),this.id=m.sid,this.transport.query.sid=m.sid,this._pingInterval=m.pingInterval,this._pingTimeout=m.pingTimeout,this._maxPayload=m.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const m=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+m,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},m),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const m=this._getWritablePackets();this.transport.send(m),this._prevBufferLen=m.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let S=1;for(let D=0;D<this.writeBuffer.length;D++){const V=this.writeBuffer[D].data;if(V&&(S+=XR(V)),D>0&&S>this._maxPayload)return this.writeBuffer.slice(0,D);S+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const m=Date.now()>this._pingTimeoutTime;return m&&(this._pingTimeoutTime=0,nv(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),m}write(m,S,D){return this._sendPacket("message",m,S,D),this}send(m,S,D){return this._sendPacket("message",m,S,D),this}_sendPacket(m,S,D,V){if(typeof S=="function"&&(V=S,S=void 0),typeof D=="function"&&(V=D,D=null),this.readyState==="closing"||this.readyState==="closed")return;D=D||{},D.compress=D.compress!==!1;const K={type:m,data:S,options:D};this.emitReserved("packetCreate",K),this.writeBuffer.push(K),V&&this.once("flush",V),this.flush()}close(){const m=()=>{this._onClose("forced close"),this.transport.close()},S=()=>{this.off("upgrade",S),this.off("upgradeError",S),m()},D=()=>{this.once("upgrade",S),this.once("upgradeError",S)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?D():m()}):this.upgrading?D():m()),this}_onError(m){if(af.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",m),this._onClose("transport error",m)}_onClose(m,S){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),J0&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const D=zy.indexOf(this._offlineEventListener);D!==-1&&zy.splice(D,1)}this.readyState="closed",this.id=null,this.emitReserved("close",m,S),this.writeBuffer=[],this._prevBufferLen=0}}}af.protocol=rS;class f3 extends af{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let m=0;m<this._upgrades.length;m++)this._probe(this._upgrades[m])}_probe(m){let S=this.createTransport(m),D=!1;af.priorWebsocketSuccess=!1;const V=()=>{D||(S.send([{type:"ping",data:"probe"}]),S.once("packet",wt=>{if(!D)if(wt.type==="pong"&&wt.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",S),!S)return;af.priorWebsocketSuccess=S.name==="websocket",this.transport.pause(()=>{D||this.readyState!=="closed"&&(He(),this.setTransport(S),S.send([{type:"upgrade"}]),this.emitReserved("upgrade",S),S=null,this.upgrading=!1,this.flush())})}else{const gt=new Error("probe error");gt.transport=S.name,this.emitReserved("upgradeError",gt)}}))};function K(){D||(D=!0,He(),S.close(),S=null)}const re=wt=>{const gt=new Error("probe error: "+wt);gt.transport=S.name,K(),this.emitReserved("upgradeError",gt)};function s(){re("transport closed")}function pe(){re("socket closed")}function Ce(wt){S&&wt.name!==S.name&&K()}const He=()=>{S.removeListener("open",V),S.removeListener("error",re),S.removeListener("close",s),this.off("close",pe),this.off("upgrading",Ce)};S.once("open",V),S.once("error",re),S.once("close",s),this.once("close",pe),this.once("upgrading",Ce),this._upgrades.indexOf("webtransport")!==-1&&m!=="webtransport"?this.setTimeoutFn(()=>{D||S.open()},200):S.open()}onHandshake(m){this._upgrades=this._filterUpgrades(m.upgrades),super.onHandshake(m)}_filterUpgrades(m){const S=[];for(let D=0;D<m.length;D++)~this.transports.indexOf(m[D])&&S.push(m[D]);return S}}let p3=class extends f3{constructor(m,S={}){const D=typeof m=="object"?m:S;(!D.transports||D.transports&&typeof D.transports[0]=="string")&&(D.transports=(D.transports||["polling","websocket","webtransport"]).map(V=>l3[V]).filter(V=>!!V)),super(m,D)}};function m3(b,m="",S){let D=b;S=S||typeof location<"u"&&location,b==null&&(b=S.protocol+"//"+S.host),typeof b=="string"&&(b.charAt(0)==="/"&&(b.charAt(1)==="/"?b=S.protocol+b:b=S.host+b),/^(https?|wss?):\/\//.test(b)||(typeof S<"u"?b=S.protocol+"//"+b:b="https://"+b),D=K0(b)),D.port||(/^(http|ws)$/.test(D.protocol)?D.port="80":/^(http|ws)s$/.test(D.protocol)&&(D.port="443")),D.path=D.path||"/";const K=D.host.indexOf(":")!==-1?"["+D.host+"]":D.host;return D.id=D.protocol+"://"+K+":"+D.port+m,D.href=D.protocol+"://"+K+(S&&S.port===D.port?"":":"+D.port),D}const _3=typeof ArrayBuffer=="function",g3=b=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(b):b.buffer instanceof ArrayBuffer,uS=Object.prototype.toString,y3=typeof Blob=="function"||typeof Blob<"u"&&uS.call(Blob)==="[object BlobConstructor]",v3=typeof File=="function"||typeof File<"u"&&uS.call(File)==="[object FileConstructor]";function Ex(b){return _3&&(b instanceof ArrayBuffer||g3(b))||y3&&b instanceof Blob||v3&&b instanceof File}function Py(b,m){if(!b||typeof b!="object")return!1;if(Array.isArray(b)){for(let S=0,D=b.length;S<D;S++)if(Py(b[S]))return!0;return!1}if(Ex(b))return!0;if(b.toJSON&&typeof b.toJSON=="function"&&arguments.length===1)return Py(b.toJSON(),!0);for(const S in b)if(Object.prototype.hasOwnProperty.call(b,S)&&Py(b[S]))return!0;return!1}function x3(b){const m=[],S=b.data,D=b;return D.data=Q0(S,m),D.attachments=m.length,{packet:D,buffers:m}}function Q0(b,m){if(!b)return b;if(Ex(b)){const S={_placeholder:!0,num:m.length};return m.push(b),S}else if(Array.isArray(b)){const S=new Array(b.length);for(let D=0;D<b.length;D++)S[D]=Q0(b[D],m);return S}else if(typeof b=="object"&&!(b instanceof Date)){const S={};for(const D in b)Object.prototype.hasOwnProperty.call(b,D)&&(S[D]=Q0(b[D],m));return S}return b}function b3(b,m){return b.data=ex(b.data,m),delete b.attachments,b}function ex(b,m){if(!b)return b;if(b&&b._placeholder===!0){if(typeof b.num=="number"&&b.num>=0&&b.num<m.length)return m[b.num];throw new Error("illegal attachments")}else if(Array.isArray(b))for(let S=0;S<b.length;S++)b[S]=ex(b[S],m);else if(typeof b=="object")for(const S in b)Object.prototype.hasOwnProperty.call(b,S)&&(b[S]=ex(b[S],m));return b}const w3=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],T3=5;var Un;(function(b){b[b.CONNECT=0]="CONNECT",b[b.DISCONNECT=1]="DISCONNECT",b[b.EVENT=2]="EVENT",b[b.ACK=3]="ACK",b[b.CONNECT_ERROR=4]="CONNECT_ERROR",b[b.BINARY_EVENT=5]="BINARY_EVENT",b[b.BINARY_ACK=6]="BINARY_ACK"})(Un||(Un={}));class S3{constructor(m){this.replacer=m}encode(m){return(m.type===Un.EVENT||m.type===Un.ACK)&&Py(m)?this.encodeAsBinary({type:m.type===Un.EVENT?Un.BINARY_EVENT:Un.BINARY_ACK,nsp:m.nsp,data:m.data,id:m.id}):[this.encodeAsString(m)]}encodeAsString(m){let S=""+m.type;return(m.type===Un.BINARY_EVENT||m.type===Un.BINARY_ACK)&&(S+=m.attachments+"-"),m.nsp&&m.nsp!=="/"&&(S+=m.nsp+","),m.id!=null&&(S+=m.id),m.data!=null&&(S+=JSON.stringify(m.data,this.replacer)),S}encodeAsBinary(m){const S=x3(m),D=this.encodeAsString(S.packet),V=S.buffers;return V.unshift(D),V}}function Fw(b){return Object.prototype.toString.call(b)==="[object Object]"}class Ax extends Ts{constructor(m){super(),this.reviver=m}add(m){let S;if(typeof m=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");S=this.decodeString(m);const D=S.type===Un.BINARY_EVENT;D||S.type===Un.BINARY_ACK?(S.type=D?Un.EVENT:Un.ACK,this.reconstructor=new E3(S),S.attachments===0&&super.emitReserved("decoded",S)):super.emitReserved("decoded",S)}else if(Ex(m)||m.base64)if(this.reconstructor)S=this.reconstructor.takeBinaryData(m),S&&(this.reconstructor=null,super.emitReserved("decoded",S));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+m)}decodeString(m){let S=0;const D={type:Number(m.charAt(0))};if(Un[D.type]===void 0)throw new Error("unknown packet type "+D.type);if(D.type===Un.BINARY_EVENT||D.type===Un.BINARY_ACK){const K=S+1;for(;m.charAt(++S)!=="-"&&S!=m.length;);const re=m.substring(K,S);if(re!=Number(re)||m.charAt(S)!=="-")throw new Error("Illegal attachments");D.attachments=Number(re)}if(m.charAt(S+1)==="/"){const K=S+1;for(;++S&&!(m.charAt(S)===","||S===m.length););D.nsp=m.substring(K,S)}else D.nsp="/";const V=m.charAt(S+1);if(V!==""&&Number(V)==V){const K=S+1;for(;++S;){const re=m.charAt(S);if(re==null||Number(re)!=re){--S;break}if(S===m.length)break}D.id=Number(m.substring(K,S+1))}if(m.charAt(++S)){const K=this.tryParse(m.substr(S));if(Ax.isPayloadValid(D.type,K))D.data=K;else throw new Error("invalid payload")}return D}tryParse(m){try{return JSON.parse(m,this.reviver)}catch{return!1}}static isPayloadValid(m,S){switch(m){case Un.CONNECT:return Fw(S);case Un.DISCONNECT:return S===void 0;case Un.CONNECT_ERROR:return typeof S=="string"||Fw(S);case Un.EVENT:case Un.BINARY_EVENT:return Array.isArray(S)&&(typeof S[0]=="number"||typeof S[0]=="string"&&w3.indexOf(S[0])===-1);case Un.ACK:case Un.BINARY_ACK:return Array.isArray(S)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class E3{constructor(m){this.packet=m,this.buffers=[],this.reconPack=m}takeBinaryData(m){if(this.buffers.push(m),this.buffers.length===this.reconPack.attachments){const S=b3(this.reconPack,this.buffers);return this.finishedReconstruction(),S}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const A3=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Ax,Encoder:S3,get PacketType(){return Un},protocol:T3},Symbol.toStringTag,{value:"Module"}));function Bc(b,m,S){return b.on(m,S),function(){b.off(m,S)}}const M3=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class hS extends Ts{constructor(m,S,D){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=m,this.nsp=S,D&&D.auth&&(this.auth=D.auth),this._opts=Object.assign({},D),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const m=this.io;this.subs=[Bc(m,"open",this.onopen.bind(this)),Bc(m,"packet",this.onpacket.bind(this)),Bc(m,"error",this.onerror.bind(this)),Bc(m,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...m){return m.unshift("message"),this.emit.apply(this,m),this}emit(m,...S){var D,V,K;if(M3.hasOwnProperty(m))throw new Error('"'+m.toString()+'" is a reserved event name');if(S.unshift(m),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(S),this;const re={type:Un.EVENT,data:S};if(re.options={},re.options.compress=this.flags.compress!==!1,typeof S[S.length-1]=="function"){const He=this.ids++,wt=S.pop();this._registerAckCallback(He,wt),re.id=He}const s=(V=(D=this.io.engine)===null||D===void 0?void 0:D.transport)===null||V===void 0?void 0:V.writable,pe=this.connected&&!(!((K=this.io.engine)===null||K===void 0)&&K._hasPingExpired());return this.flags.volatile&&!s||(pe?(this.notifyOutgoingListeners(re),this.packet(re)):this.sendBuffer.push(re)),this.flags={},this}_registerAckCallback(m,S){var D;const V=(D=this.flags.timeout)!==null&&D!==void 0?D:this._opts.ackTimeout;if(V===void 0){this.acks[m]=S;return}const K=this.io.setTimeoutFn(()=>{delete this.acks[m];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===m&&this.sendBuffer.splice(s,1);S.call(this,new Error("operation has timed out"))},V),re=(...s)=>{this.io.clearTimeoutFn(K),S.apply(this,s)};re.withError=!0,this.acks[m]=re}emitWithAck(m,...S){return new Promise((D,V)=>{const K=(re,s)=>re?V(re):D(s);K.withError=!0,S.push(K),this.emit(m,...S)})}_addToQueue(m){let S;typeof m[m.length-1]=="function"&&(S=m.pop());const D={id:this._queueSeq++,tryCount:0,pending:!1,args:m,flags:Object.assign({fromQueue:!0},this.flags)};m.push((V,...K)=>D!==this._queue[0]?void 0:(V!==null?D.tryCount>this._opts.retries&&(this._queue.shift(),S&&S(V)):(this._queue.shift(),S&&S(null,...K)),D.pending=!1,this._drainQueue())),this._queue.push(D),this._drainQueue()}_drainQueue(m=!1){if(!this.connected||this._queue.length===0)return;const S=this._queue[0];S.pending&&!m||(S.pending=!0,S.tryCount++,this.flags=S.flags,this.emit.apply(this,S.args))}packet(m){m.nsp=this.nsp,this.io._packet(m)}onopen(){typeof this.auth=="function"?this.auth(m=>{this._sendConnectPacket(m)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(m){this.packet({type:Un.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},m):m})}onerror(m){this.connected||this.emitReserved("connect_error",m)}onclose(m,S){this.connected=!1,delete this.id,this.emitReserved("disconnect",m,S),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(m=>{if(!this.sendBuffer.some(D=>String(D.id)===m)){const D=this.acks[m];delete this.acks[m],D.withError&&D.call(this,new Error("socket has been disconnected"))}})}onpacket(m){if(m.nsp===this.nsp)switch(m.type){case Un.CONNECT:m.data&&m.data.sid?this.onconnect(m.data.sid,m.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Un.EVENT:case Un.BINARY_EVENT:this.onevent(m);break;case Un.ACK:case Un.BINARY_ACK:this.onack(m);break;case Un.DISCONNECT:this.ondisconnect();break;case Un.CONNECT_ERROR:this.destroy();const D=new Error(m.data.message);D.data=m.data.data,this.emitReserved("connect_error",D);break}}onevent(m){const S=m.data||[];m.id!=null&&S.push(this.ack(m.id)),this.connected?this.emitEvent(S):this.receiveBuffer.push(Object.freeze(S))}emitEvent(m){if(this._anyListeners&&this._anyListeners.length){const S=this._anyListeners.slice();for(const D of S)D.apply(this,m)}super.emit.apply(this,m),this._pid&&m.length&&typeof m[m.length-1]=="string"&&(this._lastOffset=m[m.length-1])}ack(m){const S=this;let D=!1;return function(...V){D||(D=!0,S.packet({type:Un.ACK,id:m,data:V}))}}onack(m){const S=this.acks[m.id];typeof S=="function"&&(delete this.acks[m.id],S.withError&&m.data.unshift(null),S.apply(this,m.data))}onconnect(m,S){this.id=m,this.recovered=S&&this._pid===S,this._pid=S,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(m=>this.emitEvent(m)),this.receiveBuffer=[],this.sendBuffer.forEach(m=>{this.notifyOutgoingListeners(m),this.packet(m)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(m=>m()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Un.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(m){return this.flags.compress=m,this}get volatile(){return this.flags.volatile=!0,this}timeout(m){return this.flags.timeout=m,this}onAny(m){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(m),this}prependAny(m){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(m),this}offAny(m){if(!this._anyListeners)return this;if(m){const S=this._anyListeners;for(let D=0;D<S.length;D++)if(m===S[D])return S.splice(D,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(m){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(m),this}prependAnyOutgoing(m){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(m),this}offAnyOutgoing(m){if(!this._anyOutgoingListeners)return this;if(m){const S=this._anyOutgoingListeners;for(let D=0;D<S.length;D++)if(m===S[D])return S.splice(D,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(m){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const S=this._anyOutgoingListeners.slice();for(const D of S)D.apply(this,m.data)}}}function Zm(b){b=b||{},this.ms=b.min||100,this.max=b.max||1e4,this.factor=b.factor||2,this.jitter=b.jitter>0&&b.jitter<=1?b.jitter:0,this.attempts=0}Zm.prototype.duration=function(){var b=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var m=Math.random(),S=Math.floor(m*this.jitter*b);b=(Math.floor(m*10)&1)==0?b-S:b+S}return Math.min(b,this.max)|0};Zm.prototype.reset=function(){this.attempts=0};Zm.prototype.setMin=function(b){this.ms=b};Zm.prototype.setMax=function(b){this.max=b};Zm.prototype.setJitter=function(b){this.jitter=b};class tx extends Ts{constructor(m,S){var D;super(),this.nsps={},this.subs=[],m&&typeof m=="object"&&(S=m,m=void 0),S=S||{},S.path=S.path||"/socket.io",this.opts=S,rv(this,S),this.reconnection(S.reconnection!==!1),this.reconnectionAttempts(S.reconnectionAttempts||1/0),this.reconnectionDelay(S.reconnectionDelay||1e3),this.reconnectionDelayMax(S.reconnectionDelayMax||5e3),this.randomizationFactor((D=S.randomizationFactor)!==null&&D!==void 0?D:.5),this.backoff=new Zm({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(S.timeout==null?2e4:S.timeout),this._readyState="closed",this.uri=m;const V=S.parser||A3;this.encoder=new V.Encoder,this.decoder=new V.Decoder,this._autoConnect=S.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(m){return arguments.length?(this._reconnection=!!m,m||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(m){return m===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=m,this)}reconnectionDelay(m){var S;return m===void 0?this._reconnectionDelay:(this._reconnectionDelay=m,(S=this.backoff)===null||S===void 0||S.setMin(m),this)}randomizationFactor(m){var S;return m===void 0?this._randomizationFactor:(this._randomizationFactor=m,(S=this.backoff)===null||S===void 0||S.setJitter(m),this)}reconnectionDelayMax(m){var S;return m===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=m,(S=this.backoff)===null||S===void 0||S.setMax(m),this)}timeout(m){return arguments.length?(this._timeout=m,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(m){if(~this._readyState.indexOf("open"))return this;this.engine=new p3(this.uri,this.opts);const S=this.engine,D=this;this._readyState="opening",this.skipReconnect=!1;const V=Bc(S,"open",function(){D.onopen(),m&&m()}),K=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),m?m(s):this.maybeReconnectOnOpen()},re=Bc(S,"error",K);if(this._timeout!==!1){const s=this._timeout,pe=this.setTimeoutFn(()=>{V(),K(new Error("timeout")),S.close()},s);this.opts.autoUnref&&pe.unref(),this.subs.push(()=>{this.clearTimeoutFn(pe)})}return this.subs.push(V),this.subs.push(re),this}connect(m){return this.open(m)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const m=this.engine;this.subs.push(Bc(m,"ping",this.onping.bind(this)),Bc(m,"data",this.ondata.bind(this)),Bc(m,"error",this.onerror.bind(this)),Bc(m,"close",this.onclose.bind(this)),Bc(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(m){try{this.decoder.add(m)}catch(S){this.onclose("parse error",S)}}ondecoded(m){nv(()=>{this.emitReserved("packet",m)},this.setTimeoutFn)}onerror(m){this.emitReserved("error",m)}socket(m,S){let D=this.nsps[m];return D?this._autoConnect&&!D.active&&D.connect():(D=new hS(this,m,S),this.nsps[m]=D),D}_destroy(m){const S=Object.keys(this.nsps);for(const D of S)if(this.nsps[D].active)return;this._close()}_packet(m){const S=this.encoder.encode(m);for(let D=0;D<S.length;D++)this.engine.write(S[D],m.options)}cleanup(){this.subs.forEach(m=>m()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(m,S){var D;this.cleanup(),(D=this.engine)===null||D===void 0||D.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",m,S),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const m=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const S=this.backoff.duration();this._reconnecting=!0;const D=this.setTimeoutFn(()=>{m.skipReconnect||(this.emitReserved("reconnect_attempt",m.backoff.attempts),!m.skipReconnect&&m.open(V=>{V?(m._reconnecting=!1,m.reconnect(),this.emitReserved("reconnect_error",V)):m.onreconnect()}))},S);this.opts.autoUnref&&D.unref(),this.subs.push(()=>{this.clearTimeoutFn(D)})}}onreconnect(){const m=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",m)}}const $_={};function Oy(b,m){typeof b=="object"&&(m=b,b=void 0),m=m||{};const S=m3(b,m.path||"/socket.io"),D=S.source,V=S.id,K=S.path,re=$_[V]&&K in $_[V].nsps,s=m.forceNew||m["force new connection"]||m.multiplex===!1||re;let pe;return s?pe=new tx(D,m):($_[V]||($_[V]=new tx(D,m)),pe=$_[V]),S.query&&!m.query&&(m.query=S.queryKey),pe.socket(S.path,m)}Object.assign(Oy,{Manager:tx,Socket:hS,io:Oy,connect:Oy});const I3=5;let Pl=null,dS=!1;const C3=()=>{if(!localStorage.getItem("clientSessionId")){const b=Math.random().toString(36).substring(2,15);localStorage.setItem("clientSessionId",b)}return localStorage.getItem("clientSessionId")},R3=()=>{if(Pl&&Pl.connected)return console.log("Reutilizando conexão de socket existente:",Pl.id),Pl;Pl&&(console.log("Desconectando instância de socket anterior"),Pl.disconnect(),Pl=null);const b="https://vps58170.publiccloud.com.br";console.log("Conectando ao servidor socket:",b);const m=C3(),D=Oy(b,{withCredentials:!0,transports:["websocket"],reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3,reconnectionDelayMax:5e3,timeout:2e4,query:{clientSessionId:m}});return Pl=D,D},kc=()=>Pl,D3=()=>{},Ly=()=>dS,Ol=b=>{dS=b},Uw=()=>I3,z3=()=>{Pl&&(Pl.disconnect(),Pl=null)},P3=(b,m)=>{b&&(b.removeAllListeners(),b.on("connect",()=>{console.log("Conectado ao servidor socket com ID:",b.id),Ol(!1);const S=sessionStorage.getItem("username");S&&(console.log("Reautenticando usuário após conexão:",S),setTimeout(()=>{b.emit("authenticate",S,{clientSessionId:sessionStorage.getItem("clientSessionId")})},300))}),b.io.on("reconnect_attempt",S=>{console.log(`Tentativa de reconexão #${S}`)}),b.io.on("reconnect",S=>{console.log(`Reconectado com sucesso após ${S} tentativas`),Ol(!1);const D=sessionStorage.getItem("username");D&&(console.log("Reautenticando após reconexão:",D),setTimeout(()=>{b.emit("authenticate",D,{clientSessionId:sessionStorage.getItem("clientSessionId")}),setTimeout(()=>{b.emit("getRooms")},500)},300))}),b.on("connect_error",S=>{console.error("Erro de conexão ao socket:",S.message),Ol(!1),D3()>=Uw()&&(console.error(`Falha após ${Uw()} tentativas. Desistindo.`),Vr.dispatch({type:"error/connectionFailed",payload:"Não foi possível conectar ao servidor. Tente novamente mais tarde."}))}),b.on("disconnect",S=>{console.log("Desconectado do servidor. Motivo:",S),Ol(!1),(S==="io server disconnect"||S==="transport close")&&setTimeout(()=>{console.log("Tentando reconectar após desconexão do servidor..."),b.connect()},2e3)}),b.on("authenticated",S=>{console.log("Autenticação bem-sucedida:",S);const D=sessionStorage.getItem("pendingRoom");D&&!Ly()?setTimeout(()=>{console.log("Retomando entrada na sala após autenticação:",D),m.joinRoom(D)},500):setTimeout(()=>{b.emit("getRooms")},300)}),b.on("roomsList",S=>{console.log("Recebida lista de salas:",S),Vr.dispatch(dR(S))}),b.on("roomJoined",S=>{console.log("Entrou na sala:",S),Ol(!1),sessionStorage.removeItem("pendingRoom"),Vr.dispatch(fR(S))}),b.on("roomLeft",()=>{console.log("Saiu da sala"),Ol(!1),Vr.dispatch(Pw()),Vr.dispatch(W0())}),b.on("roomCreated",S=>{console.log("Sala criada:",S),S.success&&b.emit("getRooms")}),b.on("roomDeleted",S=>{console.log("Sala deletada:",S),Vr.dispatch(Pw()),Vr.dispatch(W0()),S.message&&alert(S.message)}),b.on("chatMessage",S=>{console.log("Mensagem de chat recebida:",S),Vr.dispatch(wR(S))}),b.on("chatHistory",S=>{console.log("Histórico de chat recebido:",S),Vr.dispatch(SR(S))}),b.on("playersList",S=>{console.log("Lista de jogadores recebida:",S),Vr.dispatch(_R(S));const D=S.map(V=>{if(typeof V=="object"&&V.username)return V.username;if(typeof V=="string"){const K=V.match(/^(.*?)\s*\(/);return K?K[1]:V}return""}).filter(Boolean);Vr.dispatch(gR(D))}),b.on("playerOnlineStatus",({username:S,isOnline:D})=>{console.log(`Jogador ${S} agora está ${D?"online":"offline"}`),Vr.dispatch(yR({username:S,isOnline:D}))}),b.on("countryAssigned",S=>{console.log("País atribuído:",S),Vr.dispatch(X0(S)),sessionStorage.setItem("myCountry",S)}),b.on("stateRestored",S=>{console.log("Estado restaurado:",S),S&&S.country&&(Vr.dispatch(X0(S.country)),sessionStorage.setItem("myCountry",S.country))}),b.on("countryStatesInitialized",S=>{console.log("Estados de países inicializados:",S),Vr.dispatch(MR(S))}),b.on("countryStatesUpdated",S=>{Vr.dispatch(IR(S))}),b.on("countryState",S=>{console.log("Estado de país recebido:",S)}),b.on("countryStateUpdated",S=>{console.log("Estado de país atualizado:",S),Vr.dispatch(CR({roomName:S.roomName,countryName:S.countryName,category:S.category,updates:S.state[S.category],timestamp:S.timestamp}))}),b.on("error",S=>{console.error("Erro do socket:",S),(S.includes("sala")||S.includes("room"))&&(Ol(!1),sessionStorage.removeItem("pendingRoom")),S.includes("já está em uso")||S.includes("autenticação")||S.includes("desconectado")||Vr.dispatch({type:"error/socketError",payload:S})}),setInterval(()=>{b.connected&&b.emit("ping",Date.now())},3e4))},Eu={CONNECT:"socket/connect",AUTHENTICATE:"socket/authenticate",GET_ROOMS:"socket/getRooms",CREATE_ROOM:"socket/createRoom",JOIN_ROOM:"socket/joinRoom",LEAVE_ROOM:"socket/leaveRoom",SEND_CHAT:"socket/sendChatMessage",REQUEST_CHAT_HISTORY:"socket/requestPrivateHistory",REQUEST_COUNTRY:"socket/requestCountry"},Pm={SUBSCRIBE:"socket/subscribeToCountryStates",UNSUBSCRIBE:"socket/unsubscribeFromCountryStates",GET_STATE:"socket/getCountryState",UPDATE_STATE:"socket/updateCountryState"},zn={connect:()=>{const b=R3();return P3(b,zn),b},disconnect:()=>{z3()},authenticate:b=>{if(!b){console.error("Nome de usuário não fornecido para autenticação");return}const m=zn.connect();sessionStorage.setItem("username",b),Vr.dispatch(sT(b)),setTimeout(()=>{m.emit("authenticate",b,{clientSessionId:sessionStorage.getItem("clientSessionId")})},100)},getRooms:()=>{(kc()||zn.connect()).emit("getRooms")},createRoom:b=>{const m=kc()||zn.connect();typeof b=="string"&&(b={name:b,duration:30*6e4}),m.emit("createRoom",b)},joinRoom:b=>{if(Ly()){console.log("Já está tentando entrar em uma sala, ignorando solicitação");return}console.log("Tentando entrar na sala:",b),Ol(!0),sessionStorage.setItem("pendingRoom",b);const m=kc()||zn.connect();if(!m.connected){console.log("Socket não está conectado, tentando conectar primeiro"),m.connect(),setTimeout(()=>{Ly()&&(console.log("Tempo limite de tentativa de entrar na sala atingido, resetando"),Ol(!1))},1e4);return}if(!sessionStorage.getItem("username")){console.error("Usuário não autenticado, não é possível entrar na sala"),Ol(!1),sessionStorage.removeItem("pendingRoom");return}console.log(`Enviando evento joinRoom para sala ${b}`),m.emit("joinRoom",b),setTimeout(()=>{Ly()&&(console.log("Tempo limite de tentativa de entrar na sala atingido, resetando"),Ol(!1))},1e4)},leaveRoom:(b=!0)=>{Ol(!1),sessionStorage.removeItem("pendingRoom"),(kc()||zn.connect()).emit("leaveRoom",{intentional:b}),Vr.dispatch(X0(null)),sessionStorage.removeItem("myCountry"),Vr.dispatch(W0())},sendMessage:(b,m=!1,S=null)=>{const D=kc()||zn.connect(),V=sessionStorage.getItem("username");if(!V){console.error("Não é possível enviar mensagem: Nome de usuário não encontrado");return}D.emit("chatMessage",{username:V,message:b,isPrivate:m,recipient:S})},requestPrivateHistory:b=>{(kc()||zn.connect()).emit("requestPrivateHistory",b)},requestCountry:b=>{(kc()||zn.connect()).emit("requestSpecificCountry",b)},subscribeToCountryStates:b=>{(kc()||zn.connect()).emit("subscribeToCountryStates",b)},unsubscribeFromCountryStates:b=>{(kc()||zn.connect()).emit("unsubscribeFromCountryStates",b)},getCountryState:(b,m)=>{(kc()||zn.connect()).emit("getCountryState",{roomName:b,countryName:m})},updateCountryState:(b,m,S,D)=>{(kc()||zn.connect()).emit("updateCountryState",{roomName:b,countryName:m,category:S,updates:D})}},O3=()=>{const b=lf(),[m,S]=Ii.useState(!1),[D,V]=Ii.useState(null),K=s=>{console.log("Autenticando usuário:",s),b(sT(s)),zn.authenticate(s),setTimeout(()=>{zn.getRooms()},500)};Ii.useEffect(()=>{const s=sessionStorage.getItem("username");s&&(console.log("Sessão existente encontrada para:",s),S(!0),K(s),setTimeout(()=>{S(!1)},3e3))},[b]);const re=async()=>{try{S(!0),V(null);const pe=await(await uR()).user.getIdToken(),Ce=await fetch("https://vps58170.publiccloud.com.br/auth/google",{method:"POST",headers:{Authorization:`Bearer ${pe}`}});if(!Ce.ok)throw new Error("Falha ao autenticar com o servidor");const wt=(await Ce.json()).email;sessionStorage.setItem("username",wt),K(wt),setTimeout(()=>{S(!1)},3e3)}catch(s){console.error("Erro no login com Google:",s),V("Erro no login com Google. Tente novamente."),S(!1)}};return de.jsxs("div",{id:"login-screen",children:[de.jsx("h2",{children:"Politik404"}),D&&de.jsx("div",{className:"error-message",children:D}),de.jsx("div",{children:de.jsx("button",{onClick:re,disabled:m,children:m?"Processando...":"Entrar com Google"})})]})},L3=()=>{const[b,m]=Ii.useState(""),[S,D]=Ii.useState(""),[V,K]=Ii.useState(!1),[re,s]=Ii.useState(""),[pe,Ce]=Ii.useState(null),[He,wt]=Ii.useState(Date.now()),gt=lf(),Xt=An(kt=>kt.rooms.rooms),jt=An(kt=>kt.auth.username);Ii.useEffect(()=>{const kt=setInterval(()=>{wt(Date.now())},1e3);return()=>clearInterval(kt)},[]);const hi=()=>jt?(console.log("Garantindo conexão e atualizando lista de salas..."),zn.connect(),zn.authenticate(jt),setTimeout(()=>{zn.getRooms()},500),!0):(console.warn("Usuário não está autenticado na tela de salas"),!1);Ii.useEffect(()=>{if(!jt){console.warn("Usuário não está autenticado na tela de salas");return}console.log("Inicializando RoomPage para usuário:",jt),K(!0),hi(),setTimeout(()=>{K(!1)},2e3);const kt=setInterval(()=>{re||zn.getRooms()},3e4);return()=>clearInterval(kt)},[gt,jt]),Ii.useEffect(()=>{re&&pe&&Date.now()-pe>1e4&&(console.log(`Tempo limite para entrar na sala ${re} atingido.`),K(!1),s(""),Ce(null),alert(`Não foi possível entrar na sala ${re}. Por favor, tente novamente.`))},[re,pe]);const vi=()=>{if(!b.trim()||!S){alert("Por favor, preencha o nome da sala e a duração!");return}const kt=S?parseInt(S):30;if(isNaN(kt)||kt<1||kt>90){alert("Por favor, insira uma duração válida entre 1 e 90 minutos!");return}K(!0),console.log(`Iniciando criação da sala: ${b}`),zn.createRoom({name:b,duration:kt*6e4}),m(""),D(""),setTimeout(()=>{zn.getRooms(),K(!1)},2e3)},at=kt=>{if(V||re){console.log("Ignorando clique enquanto já está processando...");return}console.log(`Tentando entrar na sala: ${kt}`),K(!0),s(kt),Ce(Date.now()),zn.joinRoom(kt)},ni=kt=>{kt.key==="Enter"&&!V&&vi()},qt=kt=>{const Oi=Math.floor(kt/1e3),Gt=Math.floor(Oi/60),oi=Oi%60;return`${Gt.toString().padStart(2,"0")}:${oi.toString().padStart(2,"0")}`},$t=kt=>re===kt;return jt?de.jsxs("div",{id:"room-selection-screen",children:[de.jsx("h2",{children:"Politik404"}),de.jsx("div",{className:"user-info",children:de.jsxs("p",{children:["Logado como: ",jt]})}),de.jsxs("div",{className:"room-actions",children:[de.jsxs("div",{children:[de.jsx("input",{type:"text",id:"room-name",value:b,onChange:kt=>m(kt.target.value),onKeyPress:ni,placeholder:"Nome da partida",disabled:V||re}),de.jsx("input",{type:"number",value:S,onChange:kt=>D(parseInt(kt.target.value)),min:"1",max:"90",placeholder:"Duração (minutos)",disabled:V||re})]}),de.jsx("button",{id:"create-room-button",onClick:vi,disabled:V||re||!b.trim(),children:V&&!re?"Criando...":"Criar Partida"})]}),de.jsxs("div",{className:"room-list-container",children:[de.jsxs("h3",{children:["Partidas Disponíveis",V&&!re&&" (Carregando...)",re&&` (Entrando em ${re}...)`]}),de.jsx("ul",{id:"room-list",children:Xt.length===0?de.jsx("li",{className:"no-rooms",children:V&&!re?"Carregando partidas...":`Nenhuma partida disponível.
Crie uma nova!`}):[...Xt].sort((kt,Oi)=>{const Gt=new Date(kt.createdAt).getTime();return new Date(Oi.createdAt).getTime()-Gt}).map(kt=>{const Oi=kt.expiresAt?Math.max(0,kt.expiresAt-He):0,Gt=kt.duration||0,oi=Oi===0&&kt.expiresAt>0;return de.jsxs("li",{className:`room-item ${oi?"room-expired":""}`,children:[de.jsxs("div",{className:"room-details",children:[de.jsxs("h4",{children:[kt.name," - ",qt(Gt)," - Restante: ",qt(Oi)]}),de.jsxs("p",{children:["Criador: ",kt.owner]}),de.jsxs("p",{children:["Jogadores: ",kt.playerCount]})]}),de.jsx("button",{className:"join-room-btn",onClick:()=>at(kt.name),disabled:V||re,children:oi?"Visualizar":$t(kt.name)?"Entrando...":"Entrar"})]},kt.name)})})]}),de.jsx("div",{className:"debug-info",style:{display:"none"},children:de.jsx("pre",{children:JSON.stringify({username:jt,roomsCount:Xt.length,joiningRoom:re,loading:V},null,2)})})]}):de.jsxs("div",{id:"room-selection-screen",children:[de.jsx("h2",{children:"Politik404"}),de.jsx("p",{children:"Você precisa estar autenticado para acessar as partidas."})]})},k3=({hasUnreadMessagesFrom:b})=>{const[m,S]=Ii.useState(""),D=Ii.useRef(null),V=lf(),K=An(at=>at.auth.username),re=An(at=>at.chat.publicMessages),s=An(at=>at.chat.privateMessages),pe=An(at=>at.chat.currentChatMode),Ce=An(at=>at.game.players),He=An(at=>at.chat.unreadCount),wt=pe==="public"?re:s[pe]||[];Ii.useEffect(()=>{D.current&&(D.current.scrollTop=D.current.scrollHeight)},[wt]),Ii.useEffect(()=>{V(zm(pe==="public"?{chatType:"public"}:{chatType:"private",target:pe}))},[pe,V]);const gt=()=>{m.trim()&&(zn.sendMessage(m,pe!=="public",pe!=="public"?pe:null),S(""))},Xt=at=>{at.key==="Enter"&&gt()},jt=at=>{V(zm(at==="public"?{chatType:"public"}:{chatType:"private",target:at})),V(TR(at)),at!=="public"&&(!s[at]||s[at].length===0)&&zn.requestPrivateHistory(at)},hi=()=>Ce?Ce.filter(at=>{if(typeof at=="object")return at.username!==K;if(typeof at=="string"){const ni=at.match(/^(.*?)\s*\(/);return ni&&ni[1]!==K}return!1}).map(at=>{if(typeof at=="object")return{username:at.username,isOnline:at.isOnline!==!1};if(typeof at=="string"){const ni=at.match(/^(.*?)\s*\(/);return{username:ni?ni[1]:at,isOnline:!0}}return null}).filter(Boolean):[],vi=()=>He.public>0&&pe!=="public";return de.jsxs("div",{className:"chat-section",children:[de.jsxs("h4",{id:"you",children:["Você: ",K]}),de.jsxs("ul",{id:"player-list",children:[de.jsxs("li",{className:`chat-option ${pe==="public"?"active":""}`,onClick:()=>jt("public"),children:["Público",vi()&&de.jsx("span",{className:"player-message-badge",title:"Novas mensagens públicas",children:"•"})]}),hi().map((at,ni)=>de.jsxs("li",{className:`chat-option ${pe===at.username?"active":""}`,onClick:()=>jt(at.username),children:[at.username," ",!at.isOnline&&de.jsx("span",{className:"offline-status",children:"(offline)"}),b&&b(at.username)&&de.jsx("span",{className:"player-message-badge",title:"Nova mensagem privada",children:"•"})]},ni))]}),de.jsxs("div",{id:"chat-container",children:[de.jsx("div",{id:"chat-header",children:pe==="public"?"Chat Público":`Chat Privado com ${pe}`}),de.jsx("div",{id:"chat-messages",ref:D,children:wt.map((at,ni)=>{let qt=at.sender;if(typeof qt=="string"){const $t=qt.match(/.*? - (.*)/);$t&&(qt=$t[1])}return de.jsxs("div",{className:`message ${qt===K?"self":"other"} ${at.isPrivate?"private":""}`,children:[de.jsxs("span",{children:[at.timestamp?new Date(at.timestamp).toLocaleTimeString():""," ",at.isPrivate?"(Privado)":""," ",at.sender]}),at.content]},ni)})}),de.jsxs("div",{className:"chat-sendgroup",children:[de.jsx("input",{type:"text",id:"chat-input",placeholder:`Mensagem ${pe==="public"?"pública":`para ${pe}`}...`,value:m,onChange:at=>S(at.target.value),onKeyPress:Xt}),de.jsx("button",{id:"chat-send",onClick:gt,children:"Send"})]})]})]})},B3=({roomName:b,countryName:m})=>{const S=lf(),D=An(He=>He.rooms.currentRoom),V=An(He=>He.game.myCountry),K=An(DR),re=b||(D==null?void 0:D.name)||null,s=m||V||null,pe=An(He=>RR(He,re,s)),Ce=An(He=>zR(He,re));return Ii.useEffect(()=>{if(re)return S({type:Pm.SUBSCRIBE,payload:re}),()=>{S({type:Pm.UNSUBSCRIBE,payload:re})}},[re,S]),!re||!s?de.jsx("div",{className:"country-state-display no-data",children:de.jsx("p",{children:"Selecione uma partida e um país para ver seus indicadores."})}):K&&!pe?de.jsx("div",{className:"country-state-display loading",children:de.jsx("p",{children:"Carregando indicadores..."})}):pe?de.jsxs("div",{className:"country-state-display",children:[de.jsxs("div",{className:"last-updated",children:["Última atualização: ",Ce?new Date(Ce).toLocaleTimeString():"N/A"]}),de.jsxs("div",{className:"state-section economy-section",children:[de.jsx("h3",{children:"Economia"}),de.jsxs("div",{className:"indicator",children:[de.jsx("span",{className:"indicator-label",children:"PIB:"}),de.jsxs("span",{className:"indicator-value",children:[pe.economy.gdp.value," ",pe.economy.gdp.unit]})]}),de.jsxs("div",{className:"indicator",children:[de.jsx("span",{className:"indicator-label",children:"Tesouro:"}),de.jsxs("span",{className:"indicator-value",children:[pe.economy.treasury.value," ",pe.economy.treasury.unit]})]})]}),de.jsxs("div",{className:"state-section defense-section",children:[de.jsx("h3",{children:"Defesa"}),de.jsxs("div",{className:"indicator",children:[de.jsx("span",{className:"indicator-label",children:"Marinha:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:"progress-fill",style:{width:`${pe.defense.navy}%`}})}),de.jsxs("span",{className:"indicator-value",children:[pe.defense.navy,"%"]})]}),de.jsxs("div",{className:"indicator",children:[de.jsx("span",{className:"indicator-label",children:"Exército:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:"progress-fill",style:{width:`${pe.defense.army}%`}})}),de.jsxs("span",{className:"indicator-value",children:[pe.defense.army,"%"]})]}),de.jsxs("div",{className:"indicator",children:[de.jsx("span",{className:"indicator-label",children:"Aeronáutica:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:"progress-fill",style:{width:`${pe.defense.airforce}%`}})}),de.jsxs("span",{className:"indicator-value",children:[pe.defense.airforce,"%"]})]})]}),de.jsxs("div",{className:"state-section commerce-section",children:[de.jsx("h3",{children:"Comércio"}),de.jsxs("div",{className:"indicator",children:[de.jsx("span",{className:"indicator-label",children:"Exportação:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:"progress-fill",style:{width:`${pe.commerce.exports}%`}})}),de.jsxs("span",{className:"indicator-value",children:[pe.commerce.exports,"%"]})]}),de.jsxs("div",{className:"indicator",children:[de.jsx("span",{className:"indicator-label",children:"Importação:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:"progress-fill",style:{width:`${pe.commerce.imports}%`}})}),de.jsxs("span",{className:"indicator-value",children:[pe.commerce.imports,"%"]})]})]}),de.jsxs("div",{className:"state-section politics-section",children:[de.jsx("h3",{children:"Política"}),de.jsxs("div",{className:"indicator",children:[de.jsx("span",{className:"indicator-label",children:"Parlamento:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:"progress-fill",style:{width:`${pe.politics.parliament}%`}})}),de.jsxs("span",{className:"indicator-value",children:[pe.politics.parliament,"%"]})]}),de.jsxs("div",{className:"indicator",children:[de.jsx("span",{className:"indicator-label",children:"Imprensa:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:"progress-fill",style:{width:`${pe.politics.media}%`}})}),de.jsxs("span",{className:"indicator-value",children:[pe.politics.media,"%"]})]}),de.jsxs("div",{className:"indicator",children:[de.jsx("span",{className:"indicator-label",children:"Oposição:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:"progress-fill",style:{width:`${pe.politics.opposition}%`}})}),de.jsxs("span",{className:"indicator-value",children:[pe.politics.opposition,"%"]})]})]})]}):de.jsx("div",{className:"country-state-display no-data",children:de.jsx("p",{children:"Não há dados disponíveis para este país."})})},N3=()=>{var s;const b=An(pe=>pe.game.selectedCountry),m=An(pe=>pe.game.countriesData),S=An(pe=>pe.game.players),D=An(pe=>pe.rooms.currentRoom),V=()=>{if(!b||!S||S.length===0)return null;const pe=S.find(Ce=>{if(typeof Ce=="object"&&Ce.country===b)return!0;if(typeof Ce=="string"){const He=Ce.match(/^(.*) \((.*)\)$/);return He&&He[2]===b}return!1});if(!pe)return null;if(typeof pe=="object")return pe.username;if(typeof pe=="string"){const Ce=pe.match(/^(.*) \((.*)\)$/);return Ce?Ce[1]:null}return null};if(!b||!m||!m[b])return de.jsx("div",{className:"country-not-selected",children:de.jsx("p",{children:"Selecione um país no mapa para ver detalhes."})});const K=m[b],re=V();return de.jsxs("div",{className:"country-details",children:[de.jsx("h3",{children:K.name}),re&&de.jsxs("p",{className:"player-name",children:["Controlado por: ",re]}),D&&de.jsx(B3,{roomName:D.name,countryName:b}),de.jsxs("div",{className:"country-info",children:[de.jsxs("div",{className:"country-stats",children:[de.jsxs("p",{children:[de.jsx("strong",{children:"População:"})," ",(s=K.population)==null?void 0:s.toLocaleString()," habitantes"]}),K.hdi&&de.jsxs("p",{children:[de.jsx("strong",{children:"IDH:"})," ",K.hdi]})]}),K.borders&&K.borders.length>0&&de.jsxs("div",{className:"borders-section",children:[de.jsx("h4",{children:"Fronteiras"}),de.jsx("ul",{className:"borders-list",children:K.borders.map((pe,Ce)=>de.jsxs("li",{className:pe.enabled?"enabled":"disabled",children:[pe.country,de.jsxs("span",{className:"border-type",children:["(",pe.type,")"]}),de.jsx("span",{className:"border-status",children:pe.enabled?"✓ Aberta":"✕ Fechada"})]},Ce))})]})]})]})},F3=({onExitRoom:b,onClose:m,isActive:S})=>{const[D,V]=Ii.useState("chat"),K=lf(),re=An(Xt=>Xt.rooms.currentRoom),s=An(Xt=>Xt.game.selectedCountry),pe=An(Xt=>Xt.chat.currentChatMode),Ce=An(Xt=>Xt.chat.unreadCount);Ii.useEffect(()=>{s&&V("country")},[s]);const He=()=>{V("chat"),K(zm(pe==="public"?{chatType:"public"}:{chatType:"private",target:pe}))},wt=()=>Ce.public>0?!0:Ce.private?Object.values(Ce.private).some(Xt=>Xt>0):!1,gt=Xt=>Ce.private&&Ce.private[Xt]>0;return de.jsxs("div",{id:"sideview",className:S?"active":"",children:[de.jsx("button",{className:"close-button",onClick:m,children:de.jsx("span",{className:"material-icons",children:"chevron_right"})}),de.jsx("h2",{className:"sidebar-title",children:"Politik404"}),de.jsxs("div",{className:"tabs",children:[de.jsx("div",{className:`tab ${D==="ranking"?"active":""}`,onClick:()=>V("ranking"),children:de.jsx("span",{className:"material-icons",children:"leaderboard"})}),de.jsxs("div",{className:`tab ${D==="chat"?"active":""}`,onClick:He,children:[de.jsx("span",{className:"material-icons",children:"chat"}),wt()&&de.jsx("span",{className:"chat-badge",title:"Novas mensagens",children:"•"})]}),de.jsx("div",{className:`tab ${D==="country"?"active":""}`,onClick:()=>V("country"),children:de.jsx("span",{className:"material-icons",children:"map"})}),de.jsx("div",{className:`tab ${D==="info"?"active":""}`,onClick:()=>V("info"),children:de.jsx("span",{className:"material-icons",children:"info"})})]}),de.jsx("div",{id:"country",className:`tab-content ${D==="country"?"active":""}`,children:de.jsx(N3,{})}),de.jsxs("div",{id:"ranking",className:`tab-content ${D==="ranking"?"active":""}`,children:[de.jsx("h4",{children:"Líderes:"}),de.jsxs("ul",{children:[de.jsxs("li",{children:["1. Brasil ",de.jsx("br",{})," usuário: email@gmail.com"]}),de.jsxs("li",{children:["2. Indonésia ",de.jsx("br",{})," usuário:  email@gmail.com"]}),de.jsxs("li",{children:["3. Canadá ",de.jsx("br",{})," usuário:  email@gmail.com"]}),de.jsxs("li",{children:["4. Japão ",de.jsx("br",{})," usuário:  email@gmail.com"]}),de.jsxs("li",{children:["5. Nigéria ",de.jsx("br",{})," usuário:  email@gmail.com"]}),de.jsxs("li",{children:["6. França ",de.jsx("br",{})," usuário:  email@gmail.com"]})]})]}),D==="chat"&&de.jsx("div",{id:"chat",className:"tab-content active",children:de.jsx(k3,{hasUnreadMessagesFrom:gt})}),de.jsxs("div",{id:"info",className:`tab-content ${D==="info"?"active":""}`,children:[de.jsx("h4",{children:"Países:"}),de.jsx("p",{children:"O jogo possui 30 nações ativas que participam do confronto global por expansão de mercados."}),de.jsx("h4",{children:"Objetivo:"}),de.jsx("p",{children:"Expandir seu mercado para o exterior e atrapalhar a expansão de mercados dos outros países. O cálculo base de evolução de mercado é o crescimento percentual de comércio."}),de.jsx("h4",{children:"Informações da Partida"}),de.jsxs("div",{id:"room-details",children:[de.jsxs("p",{children:[de.jsx("strong",{children:"Nome da partida:"})," ",de.jsx("span",{id:"room-name-display",children:re==null?void 0:re.name})]}),de.jsxs("p",{children:[de.jsx("strong",{children:"Criador:"})," ",de.jsx("span",{id:"room-owner-display",children:re==null?void 0:re.owner})]}),de.jsxs("p",{children:[de.jsx("strong",{children:"Jogadores:"})," ",de.jsx("span",{id:"room-players-count",children:re==null?void 0:re.playerCount})]}),de.jsxs("p",{children:[de.jsx("strong",{children:"Criada em:"})," ",de.jsx("span",{id:"room-created-at",children:(re==null?void 0:re.createdAt)&&new Date(re.createdAt).toLocaleString("pt-BR")})]}),de.jsx("div",{className:"room-info",children:de.jsx("button",{id:"exit-room-button",onClick:b,children:"Sair da Partida"})})]}),de.jsx("div",{id:"room-admin-controls"})]})]})},U3=()=>{var Xt,jt,hi,vi,at,ni;const b=An(qt=>qt.game.myCountry),m=An(qt=>qt.game.countriesData),[S,D]=Ii.useState(5),[V,K]=Ii.useState(25),[re,s]=Ii.useState(30),pe=qt=>{D(parseFloat(qt))},Ce=qt=>{K(parseInt(qt))},He=qt=>{s(parseInt(qt))},gt=!b||!m||!m[b]?null:m[b].economy||null;return gt?de.jsxs("div",{className:"economy-panel",children:[de.jsxs("div",{className:"economy-controls",children:[de.jsxs("div",{className:"control-group",children:[de.jsxs("label",{children:["Taxa de Juros: ",de.jsxs("span",{className:"current-value",children:[S,"%"]})]}),de.jsxs("div",{className:"slider-container",children:[de.jsx("input",{type:"range",min:"0",max:"20",step:"0.25",value:S,onChange:qt=>pe(qt.target.value)}),de.jsx("button",{disabled:S===gt.interestRate,children:"Aplicar"})]})]}),de.jsxs("div",{className:"control-group",children:[de.jsxs("label",{children:["Carga Tributária: ",de.jsxs("span",{className:"current-value",children:[V,"%"]})]}),de.jsxs("div",{className:"slider-container",children:[de.jsx("input",{type:"range",min:"5",max:"50",step:"1",value:V,onChange:qt=>Ce(qt.target.value)}),de.jsx("button",{disabled:V===gt.taxBurden,children:"Aplicar"})]})]}),de.jsxs("div",{className:"control-group",children:[de.jsxs("label",{children:["Serviços Públicos: ",de.jsxs("span",{className:"current-value",children:[re,"%"]})]}),de.jsxs("div",{className:"slider-container",children:[de.jsx("input",{type:"range",min:"10",max:"60",step:"1",value:re,onChange:qt=>He(qt.target.value)}),de.jsx("button",{disabled:re===gt.publicServices,children:"Aplicar"})]})]}),de.jsx("button",{className:"action-btn",children:"Emitir título de dívida"})]}),de.jsx("br",{}),de.jsxs("div",{className:"economy-overview",children:[de.jsxs("div",{className:"stat-group",children:[de.jsx("span",{children:"PIB:"}),((Xt=gt.gdp)==null?void 0:Xt.value)||0," ",((jt=gt.gdp)==null?void 0:jt.unit)||"bilhões",de.jsxs("span",{className:`stat-value ${gt.gdpGrowth>=0?"positive":"negative"}`,children:[gt.gdpGrowth>=0?"+":"",gt.gdpGrowth||0,"%"]})]}),de.jsxs("div",{className:"stat-group",children:[de.jsxs("div",{className:"stat",children:[de.jsx("span",{className:"stat-label",children:"Inflação:"}),de.jsxs("span",{className:`stat-value ${gt.inflation<=3?"positive":"negative"}`,children:[gt.inflation||0,"%"]})]}),de.jsxs("div",{className:"stat",children:[de.jsx("span",{className:"stat-label",children:"Desemprego:"}),de.jsxs("span",{className:`stat-value ${gt.unemployment<=5?"positive":"negative"}`,children:[gt.unemployment||0,"%"]})]})]}),de.jsxs("div",{className:"stat-group",children:[de.jsxs("div",{className:"stat",children:[de.jsx("span",{className:"stat-label",children:"Tesouro:"}),de.jsxs("span",{className:"stat-value",children:[((hi=gt.treasury)==null?void 0:hi.value)||0," ",((vi=gt.treasury)==null?void 0:vi.unit)||"bilhões"]})]}),de.jsxs("div",{className:"stat",children:[de.jsx("span",{className:"stat-label",children:"Dívida Pública:"}),de.jsxs("span",{className:`stat-value ${gt.publicDebtToGdp<=60?"positive":"negative"}`,children:[((at=gt.publicDebt)==null?void 0:at.value)||0," ",((ni=gt.publicDebt)==null?void 0:ni.unit)||"bilhões","(",gt.publicDebtToGdp||0,"% do PIB)"]})]})]}),de.jsx("div",{className:"stat-group",children:de.jsxs("div",{className:"stat",children:[de.jsx("span",{className:"stat-label",children:"Popularidade:"}),de.jsxs("span",{className:`stat-value ${gt.popularity>=50?"positive":"negative"}`,children:[gt.popularity||0,"%"]})]})})]})]}):de.jsxs("div",{className:"economy-panel loading",children:[de.jsx("h3",{children:"Economia"}),de.jsx("p",{children:"Carregando dados econômicos..."})]})},V3=()=>{const b=An(pe=>pe.game.myCountry),m=An(pe=>pe.game.countriesData),[S,D]=Ii.useState(""),V=()=>{if(m&&m[b]&&m[b].politics){const pe=m[b].politics;return{parliament:pe.parliamentSupport||50,media:pe.mediaSupport||50,popularity:pe.popularity||50}}return{parliament:50,media:50,popularity:50}},K=()=>{if(m&&m[b]&&m[b].politics){const pe=m[b].politics;return{protests:pe.protests?pe.protests.value:0,opposition:pe.opposition?pe.opposition.strength:0}}return{protests:0,opposition:0}},re=V(),s=K();return de.jsxs("div",{className:"politics-panel",children:[de.jsx("div",{className:"domestic-actions",children:de.jsxs("div",{className:"action-buttons",children:[de.jsx("button",{className:"action-btn",children:"Propaganda Patriótica"}),de.jsx("button",{className:"action-btn",children:"Reprimir Protestos"}),de.jsx("button",{className:"action-btn",children:"Subornar Parlamento"})]})}),de.jsxs("div",{className:"approval-section",children:[de.jsx("h4",{children:"Aprovação"}),de.jsxs("div",{className:"approval-bars",children:[de.jsxs("div",{className:"approval-item",children:[de.jsx("span",{children:"Parlamento:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:`progress-fill ${re.parliament>=60?"high":re.parliament>=40?"medium":"low"}`,style:{width:`${re.parliament}%`}})}),de.jsxs("span",{children:[re.parliament,"%"]})]}),de.jsxs("div",{className:"approval-item",children:[de.jsx("span",{children:"Mídia:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:`progress-fill ${re.media>=60?"high":re.media>=40?"medium":"low"}`,style:{width:`${re.media}%`}})}),de.jsxs("span",{children:[re.media,"%"]})]}),de.jsxs("div",{className:"approval-item",children:[de.jsx("span",{children:"Popularidade:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:`progress-fill ${re.popularity>=60?"high":re.popularity>=40?"medium":"low"}`,style:{width:`${re.popularity}%`}})}),de.jsxs("span",{children:[re.popularity,"%"]})]})]})]}),de.jsxs("div",{className:"instability-section",children:[de.jsx("h4",{children:"Instabilidade Política"}),de.jsxs("div",{className:"instability-info",children:[de.jsxs("div",{className:"instability-item",children:[de.jsx("span",{children:"Protestos:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:`progress-fill ${s.protests<=2?"low":s.protests<=5?"medium":"high"}`,style:{width:`${s.protests*10}%`}})}),de.jsxs("span",{children:[s.protests," por mês"]})]}),de.jsxs("div",{className:"instability-item",children:[de.jsx("span",{children:"Força da Oposição:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:`progress-fill ${s.opposition<=20?"low":s.opposition<=50?"medium":"high"}`,style:{width:`${s.opposition}%`}})}),de.jsxs("span",{children:[s.opposition,"%"]})]})]})]})]})},j3=()=>{const b=An(V=>{var K;return((K=V.game)==null?void 0:K.myCountry)||"Seu País"}),m=An(V=>{var K;return((K=V.game)==null?void 0:K.players)||[]}),[S,D]=Ii.useState("");return!b||b==="Seu País"?de.jsxs("div",{className:"trade-panel",children:[de.jsx("h3",{children:"Comércio Internacional"}),de.jsx("p",{children:"Selecione um país para gerenciar o comércio."})]}):de.jsxs("div",{className:"trade-panel",children:[de.jsx("h4",{children:"Exportação "}),de.jsxs("div",{className:"form-section",children:[de.jsx("div",{className:"form-row",children:de.jsx("label",{children:de.jsxs("select",{name:"targetCountry",value:S,onChange:V=>D(V.target.value),children:[de.jsx("option",{value:"",children:"Selecione um país"}),m.filter(V=>typeof V=="object"?V.username!==sessionStorage.getItem("username"):!1).map(V=>typeof V=="object"?V.country:null).filter(Boolean).map((V,K)=>de.jsx("option",{value:V,children:V},K))]})})}),de.jsx("div",{className:"form-actions",children:de.jsx("button",{disabled:!S,children:"Criar acordo exportação"})})]}),de.jsx("h4",{children:"Importação "}),de.jsxs("div",{className:"form-section",children:[de.jsx("div",{className:"form-row",children:de.jsx("label",{children:de.jsxs("select",{name:"targetCountry",value:S,onChange:V=>D(V.target.value),children:[de.jsx("option",{value:"",children:"Selecione um país"}),m.filter(V=>typeof V=="object"?V.username!==sessionStorage.getItem("username"):!1).map(V=>typeof V=="object"?V.country:null).filter(Boolean).map((V,K)=>de.jsx("option",{value:V,children:V},K))]})})}),de.jsx("div",{className:"form-actions",children:de.jsx("button",{disabled:!S,children:"Criar acordo importação"})})]}),de.jsxs("div",{className:"agreements-list",children:[de.jsx("h4",{children:"Acordos de Importação Ativos"}),de.jsx("div",{className:"no-data",children:de.jsx("p",{children:"Nenhum acordo de importação ativo"})})]})]})},q3=()=>{const b=An(Xt=>Xt.game.myCountry),m=An(Xt=>Xt.game.countriesData),[S,D]=Ii.useState(""),[V,K]=Ii.useState("army"),[re,s]=Ii.useState(10),[pe,Ce]=Ii.useState("attack"),He=()=>m&&m[b]&&m[b].defense?{army:m[b].defense.army||0,navy:m[b].defense.navy||0,airforce:m[b].defense.airforce||0,missiles:m[b].defense.missiles||0,nuclear:m[b].defense.nuclearCapability||!1}:{army:0,navy:0,airforce:0,missiles:0,nuclear:!1},wt=()=>m?Object.keys(m).filter(Xt=>Xt!==b):[],gt=He();return b?de.jsxs("div",{className:"defense-panel",children:[de.jsxs("div",{className:"forces-section",children:[de.jsx("h4",{children:"Forças Armadas"}),de.jsxs("div",{className:"defense-bars",children:[de.jsxs("div",{className:"defense-stat",children:[de.jsx("span",{children:"Exército:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:`progress-fill ${gt.army>=70?"high":gt.army>=40?"medium":"low"}`,style:{width:`${gt.army}%`}})}),de.jsxs("span",{children:[gt.army,"%"]})]}),de.jsxs("div",{className:"defense-stat",children:[de.jsx("span",{children:"Marinha:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:`progress-fill ${gt.navy>=70?"high":gt.navy>=40?"medium":"low"}`,style:{width:`${gt.navy}%`}})}),de.jsxs("span",{children:[gt.navy,"%"]})]}),de.jsxs("div",{className:"defense-stat",children:[de.jsx("span",{children:"Força Aérea:"}),de.jsx("div",{className:"progress-bar",children:de.jsx("div",{className:`progress-fill ${gt.airforce>=70?"high":gt.airforce>=40?"medium":"low"}`,style:{width:`${gt.airforce}%`}})}),de.jsxs("span",{children:[gt.airforce,"%"]})]})]}),de.jsxs("div",{className:"nuclear-status",children:[de.jsx("span",{children:"Capacidade Nuclear:"}),de.jsx("span",{className:gt.nuclear?"status-yes":"status-no",children:gt.nuclear?"Sim":"Não"})]})]}),de.jsxs("div",{className:"investment-section",children:[de.jsxs("div",{className:"form-group",children:[de.jsx("h4",{children:"Investimento Militar"}),de.jsxs("select",{value:V,onChange:Xt=>K(Xt.target.value),children:[de.jsx("option",{value:"army",children:"Exército"}),de.jsx("option",{value:"navy",children:"Marinha"}),de.jsx("option",{value:"airforce",children:"Aeronáutica"})]})]}),de.jsxs("div",{className:"form-group",children:[de.jsxs("label",{children:["Selecionar Investimento: ",de.jsxs("span",{children:[re,"%"]})]}),de.jsx("input",{type:"range",min:"5",max:"50",step:"1",value:re,onChange:Xt=>s(parseInt(Xt.target.value))})]}),de.jsx("button",{className:"action-btn",children:"Investir"})]}),de.jsx("br",{}),de.jsxs("div",{className:"war-section",children:[de.jsx("h4",{children:"Ações de Guerra"}),de.jsxs("div",{className:"form-group",children:[de.jsx("label",{children:"País Alvo:"}),de.jsxs("select",{value:S,onChange:Xt=>D(Xt.target.value),children:[de.jsx("option",{value:"",children:"Selecione um país"}),wt().map((Xt,jt)=>de.jsx("option",{value:Xt,children:Xt},jt))]})]}),de.jsxs("div",{className:"form-group",children:[de.jsx("label",{children:"Estratégia:"}),de.jsxs("select",{value:pe,onChange:Xt=>Ce(Xt.target.value),children:[de.jsx("option",{value:"attack",children:"Ataque Bélico"}),de.jsx("option",{value:"sabotage",children:"Sabotagem Comercial"}),de.jsx("option",{value:"regime",children:"Mudança de Regime"}),de.jsx("option",{value:"disinformation",children:"Desinformação"})]})]}),de.jsx("button",{className:"action-btn danger",disabled:!S,children:"Iniciar Ação"})]})]}):de.jsxs("div",{className:"defense-panel loading",children:[de.jsx("h3",{children:"Militar"}),de.jsx("p",{children:"Selecione um país para ver informações militares"})]})},G3=({onClose:b,isActive:m,myCountry:S})=>{const[D,V]=Ii.useState("economy");return de.jsxs("div",{id:"sidetools",className:m?"active":"",children:[de.jsx("button",{className:"close-button",onClick:b,children:de.jsx("span",{className:"material-icons",children:"chevron_left"})}),de.jsx("h2",{id:"player-country-display",className:"sidebar-title",children:S||"País não selecionado"}),de.jsxs("div",{className:"tabs",children:[de.jsx("div",{className:`tab ${D==="economy"?"active":""}`,onClick:()=>V("economy"),title:"Economia",children:de.jsx("span",{className:"material-icons",children:"monetization_on"})}),de.jsx("div",{className:`tab ${D==="politics"?"active":""}`,onClick:()=>V("politics"),title:"Política",children:de.jsx("span",{className:"material-icons",children:"account_balance"})}),de.jsx("div",{className:`tab ${D==="trade"?"active":""}`,onClick:()=>V("trade"),title:"Comércio",children:de.jsx("span",{className:"material-icons",children:"directions_boat"})}),de.jsx("div",{className:`tab ${D==="defense"?"active":""}`,onClick:()=>V("defense"),title:"Militar",children:de.jsx("span",{className:"material-icons",children:"military_tech"})})]}),de.jsxs("div",{className:"tab-contents",children:[de.jsx("div",{className:`tab-content ${D==="economy"?"active":""}`,children:de.jsx(U3,{})}),de.jsx("div",{className:`tab-content ${D==="politics"?"active":""}`,children:de.jsx(V3,{})}),de.jsx("div",{className:`tab-content ${D==="trade"?"active":""}`,children:de.jsx(j3,{})}),de.jsx("div",{className:`tab-content ${D==="defense"?"active":""}`,children:de.jsx(q3,{})})]})]})};var ky={exports:{}},H3=ky.exports,Vw;function Z3(){return Vw||(Vw=1,function(b,m){(function(S,D){b.exports=D()})(H3,function(){var S,D,V;function K(s,pe){if(!S)S=pe;else if(!D)D=pe;else{var Ce="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+S+")(sharedChunk); ("+D+")(sharedChunk); self.onerror = null;",He={};S(He),V=pe(He),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(V.workerUrl=window.URL.createObjectURL(new Blob([Ce],{type:"text/javascript"})))}}K(["exports"],function(s){function pe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ce,He={},wt={};function gt(){if(Ce)return wt;Ce=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.setMatrixArrayType=function(c){wt.ARRAY_TYPE=e=c},wt.toRadian=function(c){return c*a},wt.equals=function(c,l){return Math.abs(c-l)<=r*Math.max(1,Math.abs(c),Math.abs(l))},wt.RANDOM=wt.ARRAY_TYPE=wt.EPSILON=void 0;var r=1e-6;wt.EPSILON=r;var e=typeof Float32Array<"u"?Float32Array:Array;wt.ARRAY_TYPE=e;var i=Math.random;wt.RANDOM=i;var a=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var c=0,l=arguments.length;l--;)c+=arguments[l]*arguments[l];return Math.sqrt(c)}),wt}var Xt,jt={};function hi(){if(Xt)return jt;function r(l){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},r(l)}Xt=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.create=function(){var l=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},jt.clone=function(l){var d=new e.ARRAY_TYPE(4);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d},jt.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l},jt.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l},jt.fromValues=function(l,d,y,w){var A=new e.ARRAY_TYPE(4);return A[0]=l,A[1]=d,A[2]=y,A[3]=w,A},jt.set=function(l,d,y,w,A){return l[0]=d,l[1]=y,l[2]=w,l[3]=A,l},jt.transpose=function(l,d){if(l===d){var y=d[1];l[1]=d[2],l[2]=y}else l[0]=d[0],l[1]=d[2],l[2]=d[1],l[3]=d[3];return l},jt.invert=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=y*_-A*w;return T?(l[0]=_*(T=1/T),l[1]=-w*T,l[2]=-A*T,l[3]=y*T,l):null},jt.adjoint=function(l,d){var y=d[0];return l[0]=d[3],l[1]=-d[1],l[2]=-d[2],l[3]=y,l},jt.determinant=function(l){return l[0]*l[3]-l[2]*l[1]},jt.multiply=a,jt.rotate=function(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],I=Math.sin(y),E=Math.cos(y);return l[0]=w*E+_*I,l[1]=A*E+T*I,l[2]=w*-I+_*E,l[3]=A*-I+T*E,l},jt.scale=function(l,d,y){var w=d[1],A=d[2],_=d[3],T=y[0],I=y[1];return l[0]=d[0]*T,l[1]=w*T,l[2]=A*I,l[3]=_*I,l},jt.fromRotation=function(l,d){var y=Math.sin(d),w=Math.cos(d);return l[0]=w,l[1]=y,l[2]=-y,l[3]=w,l},jt.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=d[1],l},jt.str=function(l){return"mat2("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")"},jt.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},jt.LDU=function(l,d,y,w){return l[2]=w[2]/w[0],y[0]=w[0],y[1]=w[1],y[3]=w[3]-l[2]*y[1],[l,d,y]},jt.add=function(l,d,y){return l[0]=d[0]+y[0],l[1]=d[1]+y[1],l[2]=d[2]+y[2],l[3]=d[3]+y[3],l},jt.subtract=c,jt.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]},jt.equals=function(l,d){var y=l[0],w=l[1],A=l[2],_=l[3],T=d[0],I=d[1],E=d[2],M=d[3];return Math.abs(y-T)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(T))&&Math.abs(w-I)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(I))&&Math.abs(A-E)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(E))&&Math.abs(_-M)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(M))},jt.multiplyScalar=function(l,d,y){return l[0]=d[0]*y,l[1]=d[1]*y,l[2]=d[2]*y,l[3]=d[3]*y,l},jt.multiplyScalarAndAdd=function(l,d,y,w){return l[0]=d[0]+y[0]*w,l[1]=d[1]+y[1]*w,l[2]=d[2]+y[2]*w,l[3]=d[3]+y[3]*w,l},jt.sub=jt.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||r(l)!=="object"&&typeof l!="function")return{default:l};var y=i(void 0);if(y&&y.has(l))return y.get(l);var w={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in l)if(_!=="default"&&Object.prototype.hasOwnProperty.call(l,_)){var T=A?Object.getOwnPropertyDescriptor(l,_):null;T&&(T.get||T.set)?Object.defineProperty(w,_,T):w[_]=l[_]}return w.default=l,y&&y.set(l,w),w}(gt());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,y=new WeakMap;return(i=function(w){return w?y:d})(l)}function a(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],I=y[0],E=y[1],M=y[2],z=y[3];return l[0]=w*I+_*E,l[1]=A*I+T*E,l[2]=w*M+_*z,l[3]=A*M+T*z,l}function c(l,d,y){return l[0]=d[0]-y[0],l[1]=d[1]-y[1],l[2]=d[2]-y[2],l[3]=d[3]-y[3],l}return jt.mul=a,jt.sub=c,jt}var vi,at={};function ni(){if(vi)return at;function r(l){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},r(l)}vi=1,Object.defineProperty(at,"__esModule",{value:!0}),at.create=function(){var l=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[4]=0,l[5]=0),l[0]=1,l[3]=1,l},at.clone=function(l){var d=new e.ARRAY_TYPE(6);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[4]=l[4],d[5]=l[5],d},at.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l},at.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l},at.fromValues=function(l,d,y,w,A,_){var T=new e.ARRAY_TYPE(6);return T[0]=l,T[1]=d,T[2]=y,T[3]=w,T[4]=A,T[5]=_,T},at.set=function(l,d,y,w,A,_,T){return l[0]=d,l[1]=y,l[2]=w,l[3]=A,l[4]=_,l[5]=T,l},at.invert=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=d[4],I=d[5],E=y*_-w*A;return E?(l[0]=_*(E=1/E),l[1]=-w*E,l[2]=-A*E,l[3]=y*E,l[4]=(A*I-_*T)*E,l[5]=(w*T-y*I)*E,l):null},at.determinant=function(l){return l[0]*l[3]-l[1]*l[2]},at.multiply=a,at.rotate=function(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],I=d[4],E=d[5],M=Math.sin(y),z=Math.cos(y);return l[0]=w*z+_*M,l[1]=A*z+T*M,l[2]=w*-M+_*z,l[3]=A*-M+T*z,l[4]=I,l[5]=E,l},at.scale=function(l,d,y){var w=d[1],A=d[2],_=d[3],T=d[4],I=d[5],E=y[0],M=y[1];return l[0]=d[0]*E,l[1]=w*E,l[2]=A*M,l[3]=_*M,l[4]=T,l[5]=I,l},at.translate=function(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],I=d[4],E=d[5],M=y[0],z=y[1];return l[0]=w,l[1]=A,l[2]=_,l[3]=T,l[4]=w*M+_*z+I,l[5]=A*M+T*z+E,l},at.fromRotation=function(l,d){var y=Math.sin(d),w=Math.cos(d);return l[0]=w,l[1]=y,l[2]=-y,l[3]=w,l[4]=0,l[5]=0,l},at.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=d[1],l[4]=0,l[5]=0,l},at.fromTranslation=function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=d[0],l[5]=d[1],l},at.str=function(l){return"mat2d("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+")"},at.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],1)},at.add=function(l,d,y){return l[0]=d[0]+y[0],l[1]=d[1]+y[1],l[2]=d[2]+y[2],l[3]=d[3]+y[3],l[4]=d[4]+y[4],l[5]=d[5]+y[5],l},at.subtract=c,at.multiplyScalar=function(l,d,y){return l[0]=d[0]*y,l[1]=d[1]*y,l[2]=d[2]*y,l[3]=d[3]*y,l[4]=d[4]*y,l[5]=d[5]*y,l},at.multiplyScalarAndAdd=function(l,d,y,w){return l[0]=d[0]+y[0]*w,l[1]=d[1]+y[1]*w,l[2]=d[2]+y[2]*w,l[3]=d[3]+y[3]*w,l[4]=d[4]+y[4]*w,l[5]=d[5]+y[5]*w,l},at.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]&&l[4]===d[4]&&l[5]===d[5]},at.equals=function(l,d){var y=l[0],w=l[1],A=l[2],_=l[3],T=l[4],I=l[5],E=d[0],M=d[1],z=d[2],B=d[3],N=d[4],H=d[5];return Math.abs(y-E)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(E))&&Math.abs(w-M)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(M))&&Math.abs(A-z)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(z))&&Math.abs(_-B)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(B))&&Math.abs(T-N)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(N))&&Math.abs(I-H)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(H))},at.sub=at.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||r(l)!=="object"&&typeof l!="function")return{default:l};var y=i(void 0);if(y&&y.has(l))return y.get(l);var w={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in l)if(_!=="default"&&Object.prototype.hasOwnProperty.call(l,_)){var T=A?Object.getOwnPropertyDescriptor(l,_):null;T&&(T.get||T.set)?Object.defineProperty(w,_,T):w[_]=l[_]}return w.default=l,y&&y.set(l,w),w}(gt());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,y=new WeakMap;return(i=function(w){return w?y:d})(l)}function a(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],I=d[4],E=d[5],M=y[0],z=y[1],B=y[2],N=y[3],H=y[4],G=y[5];return l[0]=w*M+_*z,l[1]=A*M+T*z,l[2]=w*B+_*N,l[3]=A*B+T*N,l[4]=w*H+_*G+I,l[5]=A*H+T*G+E,l}function c(l,d,y){return l[0]=d[0]-y[0],l[1]=d[1]-y[1],l[2]=d[2]-y[2],l[3]=d[3]-y[3],l[4]=d[4]-y[4],l[5]=d[5]-y[5],l}return at.mul=a,at.sub=c,at}var qt,$t={};function kt(){if(qt)return $t;function r(l){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},r(l)}qt=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.create=function(){var l=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l},$t.fromMat4=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[4],l[4]=d[5],l[5]=d[6],l[6]=d[8],l[7]=d[9],l[8]=d[10],l},$t.clone=function(l){var d=new e.ARRAY_TYPE(9);return d[0]=l[0],d[1]=l[1],d[2]=l[2],d[3]=l[3],d[4]=l[4],d[5]=l[5],d[6]=l[6],d[7]=l[7],d[8]=l[8],d},$t.copy=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=d[2],l[3]=d[3],l[4]=d[4],l[5]=d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l},$t.fromValues=function(l,d,y,w,A,_,T,I,E){var M=new e.ARRAY_TYPE(9);return M[0]=l,M[1]=d,M[2]=y,M[3]=w,M[4]=A,M[5]=_,M[6]=T,M[7]=I,M[8]=E,M},$t.set=function(l,d,y,w,A,_,T,I,E,M){return l[0]=d,l[1]=y,l[2]=w,l[3]=A,l[4]=_,l[5]=T,l[6]=I,l[7]=E,l[8]=M,l},$t.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},$t.transpose=function(l,d){if(l===d){var y=d[1],w=d[2],A=d[5];l[1]=d[3],l[2]=d[6],l[3]=y,l[5]=d[7],l[6]=w,l[7]=A}else l[0]=d[0],l[1]=d[3],l[2]=d[6],l[3]=d[1],l[4]=d[4],l[5]=d[7],l[6]=d[2],l[7]=d[5],l[8]=d[8];return l},$t.invert=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=d[4],I=d[5],E=d[6],M=d[7],z=d[8],B=z*T-I*M,N=-z*_+I*E,H=M*_-T*E,G=y*B+w*N+A*H;return G?(l[0]=B*(G=1/G),l[1]=(-z*w+A*M)*G,l[2]=(I*w-A*T)*G,l[3]=N*G,l[4]=(z*y-A*E)*G,l[5]=(-I*y+A*_)*G,l[6]=H*G,l[7]=(-M*y+w*E)*G,l[8]=(T*y-w*_)*G,l):null},$t.adjoint=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=d[4],I=d[5],E=d[6],M=d[7],z=d[8];return l[0]=T*z-I*M,l[1]=A*M-w*z,l[2]=w*I-A*T,l[3]=I*E-_*z,l[4]=y*z-A*E,l[5]=A*_-y*I,l[6]=_*M-T*E,l[7]=w*E-y*M,l[8]=y*T-w*_,l},$t.determinant=function(l){var d=l[3],y=l[4],w=l[5],A=l[6],_=l[7],T=l[8];return l[0]*(T*y-w*_)+l[1]*(-T*d+w*A)+l[2]*(_*d-y*A)},$t.multiply=a,$t.translate=function(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],I=d[4],E=d[5],M=d[6],z=d[7],B=d[8],N=y[0],H=y[1];return l[0]=w,l[1]=A,l[2]=_,l[3]=T,l[4]=I,l[5]=E,l[6]=N*w+H*T+M,l[7]=N*A+H*I+z,l[8]=N*_+H*E+B,l},$t.rotate=function(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],I=d[4],E=d[5],M=d[6],z=d[7],B=d[8],N=Math.sin(y),H=Math.cos(y);return l[0]=H*w+N*T,l[1]=H*A+N*I,l[2]=H*_+N*E,l[3]=H*T-N*w,l[4]=H*I-N*A,l[5]=H*E-N*_,l[6]=M,l[7]=z,l[8]=B,l},$t.scale=function(l,d,y){var w=y[0],A=y[1];return l[0]=w*d[0],l[1]=w*d[1],l[2]=w*d[2],l[3]=A*d[3],l[4]=A*d[4],l[5]=A*d[5],l[6]=d[6],l[7]=d[7],l[8]=d[8],l},$t.fromTranslation=function(l,d){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=d[0],l[7]=d[1],l[8]=1,l},$t.fromRotation=function(l,d){var y=Math.sin(d),w=Math.cos(d);return l[0]=w,l[1]=y,l[2]=0,l[3]=-y,l[4]=w,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},$t.fromScaling=function(l,d){return l[0]=d[0],l[1]=0,l[2]=0,l[3]=0,l[4]=d[1],l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},$t.fromMat2d=function(l,d){return l[0]=d[0],l[1]=d[1],l[2]=0,l[3]=d[2],l[4]=d[3],l[5]=0,l[6]=d[4],l[7]=d[5],l[8]=1,l},$t.fromQuat=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=y+y,I=w+w,E=A+A,M=y*T,z=w*T,B=w*I,N=A*T,H=A*I,G=A*E,j=_*T,$=_*I,W=_*E;return l[0]=1-B-G,l[3]=z-W,l[6]=N+$,l[1]=z+W,l[4]=1-M-G,l[7]=H-j,l[2]=N-$,l[5]=H+j,l[8]=1-M-B,l},$t.normalFromMat4=function(l,d){var y=d[0],w=d[1],A=d[2],_=d[3],T=d[4],I=d[5],E=d[6],M=d[7],z=d[8],B=d[9],N=d[10],H=d[11],G=d[12],j=d[13],$=d[14],W=d[15],Q=y*I-w*T,le=y*E-A*T,se=y*M-_*T,ae=w*E-A*I,be=w*M-_*I,he=A*M-_*E,Te=z*j-B*G,Ie=z*$-N*G,Me=z*W-H*G,ze=B*$-N*j,De=B*W-H*j,Ne=N*W-H*$,ke=Q*Ne-le*De+se*ze+ae*Me-be*Ie+he*Te;return ke?(l[0]=(I*Ne-E*De+M*ze)*(ke=1/ke),l[1]=(E*Me-T*Ne-M*Ie)*ke,l[2]=(T*De-I*Me+M*Te)*ke,l[3]=(A*De-w*Ne-_*ze)*ke,l[4]=(y*Ne-A*Me+_*Ie)*ke,l[5]=(w*Me-y*De-_*Te)*ke,l[6]=(j*he-$*be+W*ae)*ke,l[7]=($*se-G*he-W*le)*ke,l[8]=(G*be-j*se+W*Q)*ke,l):null},$t.projection=function(l,d,y){return l[0]=2/d,l[1]=0,l[2]=0,l[3]=0,l[4]=-2/y,l[5]=0,l[6]=-1,l[7]=1,l[8]=1,l},$t.str=function(l){return"mat3("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+", "+l[6]+", "+l[7]+", "+l[8]+")"},$t.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8])},$t.add=function(l,d,y){return l[0]=d[0]+y[0],l[1]=d[1]+y[1],l[2]=d[2]+y[2],l[3]=d[3]+y[3],l[4]=d[4]+y[4],l[5]=d[5]+y[5],l[6]=d[6]+y[6],l[7]=d[7]+y[7],l[8]=d[8]+y[8],l},$t.subtract=c,$t.multiplyScalar=function(l,d,y){return l[0]=d[0]*y,l[1]=d[1]*y,l[2]=d[2]*y,l[3]=d[3]*y,l[4]=d[4]*y,l[5]=d[5]*y,l[6]=d[6]*y,l[7]=d[7]*y,l[8]=d[8]*y,l},$t.multiplyScalarAndAdd=function(l,d,y,w){return l[0]=d[0]+y[0]*w,l[1]=d[1]+y[1]*w,l[2]=d[2]+y[2]*w,l[3]=d[3]+y[3]*w,l[4]=d[4]+y[4]*w,l[5]=d[5]+y[5]*w,l[6]=d[6]+y[6]*w,l[7]=d[7]+y[7]*w,l[8]=d[8]+y[8]*w,l},$t.exactEquals=function(l,d){return l[0]===d[0]&&l[1]===d[1]&&l[2]===d[2]&&l[3]===d[3]&&l[4]===d[4]&&l[5]===d[5]&&l[6]===d[6]&&l[7]===d[7]&&l[8]===d[8]},$t.equals=function(l,d){var y=l[0],w=l[1],A=l[2],_=l[3],T=l[4],I=l[5],E=l[6],M=l[7],z=l[8],B=d[0],N=d[1],H=d[2],G=d[3],j=d[4],$=d[5],W=d[6],Q=d[7],le=d[8];return Math.abs(y-B)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(w-N)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(N))&&Math.abs(A-H)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(H))&&Math.abs(_-G)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(G))&&Math.abs(T-j)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(j))&&Math.abs(I-$)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs($))&&Math.abs(E-W)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(W))&&Math.abs(M-Q)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(Q))&&Math.abs(z-le)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(le))},$t.sub=$t.mul=void 0;var e=function(l,d){if(l&&l.__esModule)return l;if(l===null||r(l)!=="object"&&typeof l!="function")return{default:l};var y=i(void 0);if(y&&y.has(l))return y.get(l);var w={},A=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in l)if(_!=="default"&&Object.prototype.hasOwnProperty.call(l,_)){var T=A?Object.getOwnPropertyDescriptor(l,_):null;T&&(T.get||T.set)?Object.defineProperty(w,_,T):w[_]=l[_]}return w.default=l,y&&y.set(l,w),w}(gt());function i(l){if(typeof WeakMap!="function")return null;var d=new WeakMap,y=new WeakMap;return(i=function(w){return w?y:d})(l)}function a(l,d,y){var w=d[0],A=d[1],_=d[2],T=d[3],I=d[4],E=d[5],M=d[6],z=d[7],B=d[8],N=y[0],H=y[1],G=y[2],j=y[3],$=y[4],W=y[5],Q=y[6],le=y[7],se=y[8];return l[0]=N*w+H*T+G*M,l[1]=N*A+H*I+G*z,l[2]=N*_+H*E+G*B,l[3]=j*w+$*T+W*M,l[4]=j*A+$*I+W*z,l[5]=j*_+$*E+W*B,l[6]=Q*w+le*T+se*M,l[7]=Q*A+le*I+se*z,l[8]=Q*_+le*E+se*B,l}function c(l,d,y){return l[0]=d[0]-y[0],l[1]=d[1]-y[1],l[2]=d[2]-y[2],l[3]=d[3]-y[3],l[4]=d[4]-y[4],l[5]=d[5]-y[5],l[6]=d[6]-y[6],l[7]=d[7]-y[7],l[8]=d[8]-y[8],l}return $t.mul=a,$t.sub=c,$t}var Oi,Gt={};function oi(){if(Oi)return Gt;function r(_){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},r(_)}Oi=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=function(){var _=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},Gt.clone=function(_){var T=new e.ARRAY_TYPE(16);return T[0]=_[0],T[1]=_[1],T[2]=_[2],T[3]=_[3],T[4]=_[4],T[5]=_[5],T[6]=_[6],T[7]=_[7],T[8]=_[8],T[9]=_[9],T[10]=_[10],T[11]=_[11],T[12]=_[12],T[13]=_[13],T[14]=_[14],T[15]=_[15],T},Gt.copy=function(_,T){return _[0]=T[0],_[1]=T[1],_[2]=T[2],_[3]=T[3],_[4]=T[4],_[5]=T[5],_[6]=T[6],_[7]=T[7],_[8]=T[8],_[9]=T[9],_[10]=T[10],_[11]=T[11],_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15],_},Gt.fromValues=function(_,T,I,E,M,z,B,N,H,G,j,$,W,Q,le,se){var ae=new e.ARRAY_TYPE(16);return ae[0]=_,ae[1]=T,ae[2]=I,ae[3]=E,ae[4]=M,ae[5]=z,ae[6]=B,ae[7]=N,ae[8]=H,ae[9]=G,ae[10]=j,ae[11]=$,ae[12]=W,ae[13]=Q,ae[14]=le,ae[15]=se,ae},Gt.set=function(_,T,I,E,M,z,B,N,H,G,j,$,W,Q,le,se,ae){return _[0]=T,_[1]=I,_[2]=E,_[3]=M,_[4]=z,_[5]=B,_[6]=N,_[7]=H,_[8]=G,_[9]=j,_[10]=$,_[11]=W,_[12]=Q,_[13]=le,_[14]=se,_[15]=ae,_},Gt.identity=a,Gt.transpose=function(_,T){if(_===T){var I=T[1],E=T[2],M=T[3],z=T[6],B=T[7],N=T[11];_[1]=T[4],_[2]=T[8],_[3]=T[12],_[4]=I,_[6]=T[9],_[7]=T[13],_[8]=E,_[9]=z,_[11]=T[14],_[12]=M,_[13]=B,_[14]=N}else _[0]=T[0],_[1]=T[4],_[2]=T[8],_[3]=T[12],_[4]=T[1],_[5]=T[5],_[6]=T[9],_[7]=T[13],_[8]=T[2],_[9]=T[6],_[10]=T[10],_[11]=T[14],_[12]=T[3],_[13]=T[7],_[14]=T[11],_[15]=T[15];return _},Gt.invert=function(_,T){var I=T[0],E=T[1],M=T[2],z=T[3],B=T[4],N=T[5],H=T[6],G=T[7],j=T[8],$=T[9],W=T[10],Q=T[11],le=T[12],se=T[13],ae=T[14],be=T[15],he=I*N-E*B,Te=I*H-M*B,Ie=I*G-z*B,Me=E*H-M*N,ze=E*G-z*N,De=M*G-z*H,Ne=j*se-$*le,ke=j*ae-W*le,Ue=j*be-Q*le,lt=$*ae-W*se,ot=$*be-Q*se,Nt=W*be-Q*ae,mt=he*Nt-Te*ot+Ie*lt+Me*Ue-ze*ke+De*Ne;return mt?(_[0]=(N*Nt-H*ot+G*lt)*(mt=1/mt),_[1]=(M*ot-E*Nt-z*lt)*mt,_[2]=(se*De-ae*ze+be*Me)*mt,_[3]=(W*ze-$*De-Q*Me)*mt,_[4]=(H*Ue-B*Nt-G*ke)*mt,_[5]=(I*Nt-M*Ue+z*ke)*mt,_[6]=(ae*Ie-le*De-be*Te)*mt,_[7]=(j*De-W*Ie+Q*Te)*mt,_[8]=(B*ot-N*Ue+G*Ne)*mt,_[9]=(E*Ue-I*ot-z*Ne)*mt,_[10]=(le*ze-se*Ie+be*he)*mt,_[11]=($*Ie-j*ze-Q*he)*mt,_[12]=(N*ke-B*lt-H*Ne)*mt,_[13]=(I*lt-E*ke+M*Ne)*mt,_[14]=(se*Te-le*Me-ae*he)*mt,_[15]=(j*Me-$*Te+W*he)*mt,_):null},Gt.adjoint=function(_,T){var I=T[0],E=T[1],M=T[2],z=T[3],B=T[4],N=T[5],H=T[6],G=T[7],j=T[8],$=T[9],W=T[10],Q=T[11],le=T[12],se=T[13],ae=T[14],be=T[15];return _[0]=N*(W*be-Q*ae)-$*(H*be-G*ae)+se*(H*Q-G*W),_[1]=-(E*(W*be-Q*ae)-$*(M*be-z*ae)+se*(M*Q-z*W)),_[2]=E*(H*be-G*ae)-N*(M*be-z*ae)+se*(M*G-z*H),_[3]=-(E*(H*Q-G*W)-N*(M*Q-z*W)+$*(M*G-z*H)),_[4]=-(B*(W*be-Q*ae)-j*(H*be-G*ae)+le*(H*Q-G*W)),_[5]=I*(W*be-Q*ae)-j*(M*be-z*ae)+le*(M*Q-z*W),_[6]=-(I*(H*be-G*ae)-B*(M*be-z*ae)+le*(M*G-z*H)),_[7]=I*(H*Q-G*W)-B*(M*Q-z*W)+j*(M*G-z*H),_[8]=B*($*be-Q*se)-j*(N*be-G*se)+le*(N*Q-G*$),_[9]=-(I*($*be-Q*se)-j*(E*be-z*se)+le*(E*Q-z*$)),_[10]=I*(N*be-G*se)-B*(E*be-z*se)+le*(E*G-z*N),_[11]=-(I*(N*Q-G*$)-B*(E*Q-z*$)+j*(E*G-z*N)),_[12]=-(B*($*ae-W*se)-j*(N*ae-H*se)+le*(N*W-H*$)),_[13]=I*($*ae-W*se)-j*(E*ae-M*se)+le*(E*W-M*$),_[14]=-(I*(N*ae-H*se)-B*(E*ae-M*se)+le*(E*H-M*N)),_[15]=I*(N*W-H*$)-B*(E*W-M*$)+j*(E*H-M*N),_},Gt.determinant=function(_){var T=_[0],I=_[1],E=_[2],M=_[3],z=_[4],B=_[5],N=_[6],H=_[7],G=_[8],j=_[9],$=_[10],W=_[11],Q=_[12],le=_[13],se=_[14],ae=_[15];return(T*B-I*z)*($*ae-W*se)-(T*N-E*z)*(j*ae-W*le)+(T*H-M*z)*(j*se-$*le)+(I*N-E*B)*(G*ae-W*Q)-(I*H-M*B)*(G*se-$*Q)+(E*H-M*N)*(G*le-j*Q)},Gt.multiply=c,Gt.translate=function(_,T,I){var E,M,z,B,N,H,G,j,$,W,Q,le,se=I[0],ae=I[1],be=I[2];return T===_?(_[12]=T[0]*se+T[4]*ae+T[8]*be+T[12],_[13]=T[1]*se+T[5]*ae+T[9]*be+T[13],_[14]=T[2]*se+T[6]*ae+T[10]*be+T[14],_[15]=T[3]*se+T[7]*ae+T[11]*be+T[15]):(M=T[1],z=T[2],B=T[3],N=T[4],H=T[5],G=T[6],j=T[7],$=T[8],W=T[9],Q=T[10],le=T[11],_[0]=E=T[0],_[1]=M,_[2]=z,_[3]=B,_[4]=N,_[5]=H,_[6]=G,_[7]=j,_[8]=$,_[9]=W,_[10]=Q,_[11]=le,_[12]=E*se+N*ae+$*be+T[12],_[13]=M*se+H*ae+W*be+T[13],_[14]=z*se+G*ae+Q*be+T[14],_[15]=B*se+j*ae+le*be+T[15]),_},Gt.scale=function(_,T,I){var E=I[0],M=I[1],z=I[2];return _[0]=T[0]*E,_[1]=T[1]*E,_[2]=T[2]*E,_[3]=T[3]*E,_[4]=T[4]*M,_[5]=T[5]*M,_[6]=T[6]*M,_[7]=T[7]*M,_[8]=T[8]*z,_[9]=T[9]*z,_[10]=T[10]*z,_[11]=T[11]*z,_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15],_},Gt.rotate=function(_,T,I,E){var M,z,B,N,H,G,j,$,W,Q,le,se,ae,be,he,Te,Ie,Me,ze,De,Ne,ke,Ue,lt,ot=E[0],Nt=E[1],mt=E[2],xt=Math.hypot(ot,Nt,mt);return xt<e.EPSILON?null:(ot*=xt=1/xt,Nt*=xt,mt*=xt,M=Math.sin(I),z=Math.cos(I),H=T[1],G=T[2],j=T[3],W=T[5],Q=T[6],le=T[7],ae=T[9],be=T[10],he=T[11],Te=ot*ot*(B=1-z)+z,ze=ot*Nt*B-mt*M,De=Nt*Nt*B+z,Ne=mt*Nt*B+ot*M,ke=ot*mt*B+Nt*M,Ue=Nt*mt*B-ot*M,lt=mt*mt*B+z,_[0]=(N=T[0])*Te+($=T[4])*(Ie=Nt*ot*B+mt*M)+(se=T[8])*(Me=mt*ot*B-Nt*M),_[1]=H*Te+W*Ie+ae*Me,_[2]=G*Te+Q*Ie+be*Me,_[3]=j*Te+le*Ie+he*Me,_[4]=N*ze+$*De+se*Ne,_[5]=H*ze+W*De+ae*Ne,_[6]=G*ze+Q*De+be*Ne,_[7]=j*ze+le*De+he*Ne,_[8]=N*ke+$*Ue+se*lt,_[9]=H*ke+W*Ue+ae*lt,_[10]=G*ke+Q*Ue+be*lt,_[11]=j*ke+le*Ue+he*lt,T!==_&&(_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15]),_)},Gt.rotateX=function(_,T,I){var E=Math.sin(I),M=Math.cos(I),z=T[4],B=T[5],N=T[6],H=T[7],G=T[8],j=T[9],$=T[10],W=T[11];return T!==_&&(_[0]=T[0],_[1]=T[1],_[2]=T[2],_[3]=T[3],_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15]),_[4]=z*M+G*E,_[5]=B*M+j*E,_[6]=N*M+$*E,_[7]=H*M+W*E,_[8]=G*M-z*E,_[9]=j*M-B*E,_[10]=$*M-N*E,_[11]=W*M-H*E,_},Gt.rotateY=function(_,T,I){var E=Math.sin(I),M=Math.cos(I),z=T[0],B=T[1],N=T[2],H=T[3],G=T[8],j=T[9],$=T[10],W=T[11];return T!==_&&(_[4]=T[4],_[5]=T[5],_[6]=T[6],_[7]=T[7],_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15]),_[0]=z*M-G*E,_[1]=B*M-j*E,_[2]=N*M-$*E,_[3]=H*M-W*E,_[8]=z*E+G*M,_[9]=B*E+j*M,_[10]=N*E+$*M,_[11]=H*E+W*M,_},Gt.rotateZ=function(_,T,I){var E=Math.sin(I),M=Math.cos(I),z=T[0],B=T[1],N=T[2],H=T[3],G=T[4],j=T[5],$=T[6],W=T[7];return T!==_&&(_[8]=T[8],_[9]=T[9],_[10]=T[10],_[11]=T[11],_[12]=T[12],_[13]=T[13],_[14]=T[14],_[15]=T[15]),_[0]=z*M+G*E,_[1]=B*M+j*E,_[2]=N*M+$*E,_[3]=H*M+W*E,_[4]=G*M-z*E,_[5]=j*M-B*E,_[6]=$*M-N*E,_[7]=W*M-H*E,_},Gt.fromTranslation=function(_,T){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=T[0],_[13]=T[1],_[14]=T[2],_[15]=1,_},Gt.fromScaling=function(_,T){return _[0]=T[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=T[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=T[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Gt.fromRotation=function(_,T,I){var E,M,z,B=I[0],N=I[1],H=I[2],G=Math.hypot(B,N,H);return G<e.EPSILON?null:(B*=G=1/G,N*=G,H*=G,E=Math.sin(T),M=Math.cos(T),_[0]=B*B*(z=1-M)+M,_[1]=N*B*z+H*E,_[2]=H*B*z-N*E,_[3]=0,_[4]=B*N*z-H*E,_[5]=N*N*z+M,_[6]=H*N*z+B*E,_[7]=0,_[8]=B*H*z+N*E,_[9]=N*H*z-B*E,_[10]=H*H*z+M,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)},Gt.fromXRotation=function(_,T){var I=Math.sin(T),E=Math.cos(T);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=E,_[6]=I,_[7]=0,_[8]=0,_[9]=-I,_[10]=E,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Gt.fromYRotation=function(_,T){var I=Math.sin(T),E=Math.cos(T);return _[0]=E,_[1]=0,_[2]=-I,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=I,_[9]=0,_[10]=E,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Gt.fromZRotation=function(_,T){var I=Math.sin(T),E=Math.cos(T);return _[0]=E,_[1]=I,_[2]=0,_[3]=0,_[4]=-I,_[5]=E,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Gt.fromRotationTranslation=l,Gt.fromQuat2=function(_,T){var I=new e.ARRAY_TYPE(3),E=-T[0],M=-T[1],z=-T[2],B=T[3],N=T[4],H=T[5],G=T[6],j=T[7],$=E*E+M*M+z*z+B*B;return $>0?(I[0]=2*(N*B+j*E+H*z-G*M)/$,I[1]=2*(H*B+j*M+G*E-N*z)/$,I[2]=2*(G*B+j*z+N*M-H*E)/$):(I[0]=2*(N*B+j*E+H*z-G*M),I[1]=2*(H*B+j*M+G*E-N*z),I[2]=2*(G*B+j*z+N*M-H*E)),l(_,T,I),_},Gt.getTranslation=function(_,T){return _[0]=T[12],_[1]=T[13],_[2]=T[14],_},Gt.getScaling=d,Gt.getRotation=function(_,T){var I=new e.ARRAY_TYPE(3);d(I,T);var E=1/I[0],M=1/I[1],z=1/I[2],B=T[0]*E,N=T[1]*M,H=T[2]*z,G=T[4]*E,j=T[5]*M,$=T[6]*z,W=T[8]*E,Q=T[9]*M,le=T[10]*z,se=B+j+le,ae=0;return se>0?(ae=2*Math.sqrt(se+1),_[3]=.25*ae,_[0]=($-Q)/ae,_[1]=(W-H)/ae,_[2]=(N-G)/ae):B>j&&B>le?(ae=2*Math.sqrt(1+B-j-le),_[3]=($-Q)/ae,_[0]=.25*ae,_[1]=(N+G)/ae,_[2]=(W+H)/ae):j>le?(ae=2*Math.sqrt(1+j-B-le),_[3]=(W-H)/ae,_[0]=(N+G)/ae,_[1]=.25*ae,_[2]=($+Q)/ae):(ae=2*Math.sqrt(1+le-B-j),_[3]=(N-G)/ae,_[0]=(W+H)/ae,_[1]=($+Q)/ae,_[2]=.25*ae),_},Gt.fromRotationTranslationScale=function(_,T,I,E){var M=T[0],z=T[1],B=T[2],N=T[3],H=M+M,G=z+z,j=B+B,$=M*H,W=M*G,Q=M*j,le=z*G,se=z*j,ae=B*j,be=N*H,he=N*G,Te=N*j,Ie=E[0],Me=E[1],ze=E[2];return _[0]=(1-(le+ae))*Ie,_[1]=(W+Te)*Ie,_[2]=(Q-he)*Ie,_[3]=0,_[4]=(W-Te)*Me,_[5]=(1-($+ae))*Me,_[6]=(se+be)*Me,_[7]=0,_[8]=(Q+he)*ze,_[9]=(se-be)*ze,_[10]=(1-($+le))*ze,_[11]=0,_[12]=I[0],_[13]=I[1],_[14]=I[2],_[15]=1,_},Gt.fromRotationTranslationScaleOrigin=function(_,T,I,E,M){var z=T[0],B=T[1],N=T[2],H=T[3],G=z+z,j=B+B,$=N+N,W=z*G,Q=z*j,le=z*$,se=B*j,ae=B*$,be=N*$,he=H*G,Te=H*j,Ie=H*$,Me=E[0],ze=E[1],De=E[2],Ne=M[0],ke=M[1],Ue=M[2],lt=(1-(se+be))*Me,ot=(Q+Ie)*Me,Nt=(le-Te)*Me,mt=(Q-Ie)*ze,xt=(1-(W+be))*ze,ut=(ae+he)*ze,ti=(le+Te)*De,zt=(ae-he)*De,Zt=(1-(W+se))*De;return _[0]=lt,_[1]=ot,_[2]=Nt,_[3]=0,_[4]=mt,_[5]=xt,_[6]=ut,_[7]=0,_[8]=ti,_[9]=zt,_[10]=Zt,_[11]=0,_[12]=I[0]+Ne-(lt*Ne+mt*ke+ti*Ue),_[13]=I[1]+ke-(ot*Ne+xt*ke+zt*Ue),_[14]=I[2]+Ue-(Nt*Ne+ut*ke+Zt*Ue),_[15]=1,_},Gt.fromQuat=function(_,T){var I=T[0],E=T[1],M=T[2],z=T[3],B=I+I,N=E+E,H=M+M,G=I*B,j=E*B,$=E*N,W=M*B,Q=M*N,le=M*H,se=z*B,ae=z*N,be=z*H;return _[0]=1-$-le,_[1]=j+be,_[2]=W-ae,_[3]=0,_[4]=j-be,_[5]=1-G-le,_[6]=Q+se,_[7]=0,_[8]=W+ae,_[9]=Q-se,_[10]=1-G-$,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Gt.frustum=function(_,T,I,E,M,z,B){var N=1/(I-T),H=1/(M-E),G=1/(z-B);return _[0]=2*z*N,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*z*H,_[6]=0,_[7]=0,_[8]=(I+T)*N,_[9]=(M+E)*H,_[10]=(B+z)*G,_[11]=-1,_[12]=0,_[13]=0,_[14]=B*z*2*G,_[15]=0,_},Gt.perspectiveNO=y,Gt.perspectiveZO=function(_,T,I,E,M){var z,B=1/Math.tan(T/2);return _[0]=B/I,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,M!=null&&M!==1/0?(_[10]=M*(z=1/(E-M)),_[14]=M*E*z):(_[10]=-1,_[14]=-E),_},Gt.perspectiveFromFieldOfView=function(_,T,I,E){var M=Math.tan(T.upDegrees*Math.PI/180),z=Math.tan(T.downDegrees*Math.PI/180),B=Math.tan(T.leftDegrees*Math.PI/180),N=Math.tan(T.rightDegrees*Math.PI/180),H=2/(B+N),G=2/(M+z);return _[0]=H,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=G,_[6]=0,_[7]=0,_[8]=-(B-N)*H*.5,_[9]=(M-z)*G*.5,_[10]=E/(I-E),_[11]=-1,_[12]=0,_[13]=0,_[14]=E*I/(I-E),_[15]=0,_},Gt.orthoNO=w,Gt.orthoZO=function(_,T,I,E,M,z,B){var N=1/(T-I),H=1/(E-M),G=1/(z-B);return _[0]=-2*N,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*H,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=G,_[11]=0,_[12]=(T+I)*N,_[13]=(M+E)*H,_[14]=z*G,_[15]=1,_},Gt.lookAt=function(_,T,I,E){var M,z,B,N,H,G,j,$,W,Q,le=T[0],se=T[1],ae=T[2],be=E[0],he=E[1],Te=E[2],Ie=I[0],Me=I[1],ze=I[2];return Math.abs(le-Ie)<e.EPSILON&&Math.abs(se-Me)<e.EPSILON&&Math.abs(ae-ze)<e.EPSILON?a(_):(j=le-Ie,$=se-Me,W=ae-ze,M=he*(W*=Q=1/Math.hypot(j,$,W))-Te*($*=Q),z=Te*(j*=Q)-be*W,B=be*$-he*j,(Q=Math.hypot(M,z,B))?(M*=Q=1/Q,z*=Q,B*=Q):(M=0,z=0,B=0),N=$*B-W*z,H=W*M-j*B,G=j*z-$*M,(Q=Math.hypot(N,H,G))?(N*=Q=1/Q,H*=Q,G*=Q):(N=0,H=0,G=0),_[0]=M,_[1]=N,_[2]=j,_[3]=0,_[4]=z,_[5]=H,_[6]=$,_[7]=0,_[8]=B,_[9]=G,_[10]=W,_[11]=0,_[12]=-(M*le+z*se+B*ae),_[13]=-(N*le+H*se+G*ae),_[14]=-(j*le+$*se+W*ae),_[15]=1,_)},Gt.targetTo=function(_,T,I,E){var M=T[0],z=T[1],B=T[2],N=E[0],H=E[1],G=E[2],j=M-I[0],$=z-I[1],W=B-I[2],Q=j*j+$*$+W*W;Q>0&&(j*=Q=1/Math.sqrt(Q),$*=Q,W*=Q);var le=H*W-G*$,se=G*j-N*W,ae=N*$-H*j;return(Q=le*le+se*se+ae*ae)>0&&(le*=Q=1/Math.sqrt(Q),se*=Q,ae*=Q),_[0]=le,_[1]=se,_[2]=ae,_[3]=0,_[4]=$*ae-W*se,_[5]=W*le-j*ae,_[6]=j*se-$*le,_[7]=0,_[8]=j,_[9]=$,_[10]=W,_[11]=0,_[12]=M,_[13]=z,_[14]=B,_[15]=1,_},Gt.str=function(_){return"mat4("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+", "+_[4]+", "+_[5]+", "+_[6]+", "+_[7]+", "+_[8]+", "+_[9]+", "+_[10]+", "+_[11]+", "+_[12]+", "+_[13]+", "+_[14]+", "+_[15]+")"},Gt.frob=function(_){return Math.hypot(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])},Gt.add=function(_,T,I){return _[0]=T[0]+I[0],_[1]=T[1]+I[1],_[2]=T[2]+I[2],_[3]=T[3]+I[3],_[4]=T[4]+I[4],_[5]=T[5]+I[5],_[6]=T[6]+I[6],_[7]=T[7]+I[7],_[8]=T[8]+I[8],_[9]=T[9]+I[9],_[10]=T[10]+I[10],_[11]=T[11]+I[11],_[12]=T[12]+I[12],_[13]=T[13]+I[13],_[14]=T[14]+I[14],_[15]=T[15]+I[15],_},Gt.subtract=A,Gt.multiplyScalar=function(_,T,I){return _[0]=T[0]*I,_[1]=T[1]*I,_[2]=T[2]*I,_[3]=T[3]*I,_[4]=T[4]*I,_[5]=T[5]*I,_[6]=T[6]*I,_[7]=T[7]*I,_[8]=T[8]*I,_[9]=T[9]*I,_[10]=T[10]*I,_[11]=T[11]*I,_[12]=T[12]*I,_[13]=T[13]*I,_[14]=T[14]*I,_[15]=T[15]*I,_},Gt.multiplyScalarAndAdd=function(_,T,I,E){return _[0]=T[0]+I[0]*E,_[1]=T[1]+I[1]*E,_[2]=T[2]+I[2]*E,_[3]=T[3]+I[3]*E,_[4]=T[4]+I[4]*E,_[5]=T[5]+I[5]*E,_[6]=T[6]+I[6]*E,_[7]=T[7]+I[7]*E,_[8]=T[8]+I[8]*E,_[9]=T[9]+I[9]*E,_[10]=T[10]+I[10]*E,_[11]=T[11]+I[11]*E,_[12]=T[12]+I[12]*E,_[13]=T[13]+I[13]*E,_[14]=T[14]+I[14]*E,_[15]=T[15]+I[15]*E,_},Gt.exactEquals=function(_,T){return _[0]===T[0]&&_[1]===T[1]&&_[2]===T[2]&&_[3]===T[3]&&_[4]===T[4]&&_[5]===T[5]&&_[6]===T[6]&&_[7]===T[7]&&_[8]===T[8]&&_[9]===T[9]&&_[10]===T[10]&&_[11]===T[11]&&_[12]===T[12]&&_[13]===T[13]&&_[14]===T[14]&&_[15]===T[15]},Gt.equals=function(_,T){var I=_[0],E=_[1],M=_[2],z=_[3],B=_[4],N=_[5],H=_[6],G=_[7],j=_[8],$=_[9],W=_[10],Q=_[11],le=_[12],se=_[13],ae=_[14],be=_[15],he=T[0],Te=T[1],Ie=T[2],Me=T[3],ze=T[4],De=T[5],Ne=T[6],ke=T[7],Ue=T[8],lt=T[9],ot=T[10],Nt=T[11],mt=T[12],xt=T[13],ut=T[14],ti=T[15];return Math.abs(I-he)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(he))&&Math.abs(E-Te)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Te))&&Math.abs(M-Ie)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ie))&&Math.abs(z-Me)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(Me))&&Math.abs(B-ze)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(ze))&&Math.abs(N-De)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(De))&&Math.abs(H-Ne)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ne))&&Math.abs(G-ke)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(ke))&&Math.abs(j-Ue)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(Ue))&&Math.abs($-lt)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(lt))&&Math.abs(W-ot)<=e.EPSILON*Math.max(1,Math.abs(W),Math.abs(ot))&&Math.abs(Q-Nt)<=e.EPSILON*Math.max(1,Math.abs(Q),Math.abs(Nt))&&Math.abs(le-mt)<=e.EPSILON*Math.max(1,Math.abs(le),Math.abs(mt))&&Math.abs(se-xt)<=e.EPSILON*Math.max(1,Math.abs(se),Math.abs(xt))&&Math.abs(ae-ut)<=e.EPSILON*Math.max(1,Math.abs(ae),Math.abs(ut))&&Math.abs(be-ti)<=e.EPSILON*Math.max(1,Math.abs(be),Math.abs(ti))},Gt.sub=Gt.mul=Gt.ortho=Gt.perspective=void 0;var e=function(_,T){if(_&&_.__esModule)return _;if(_===null||r(_)!=="object"&&typeof _!="function")return{default:_};var I=i(void 0);if(I&&I.has(_))return I.get(_);var E={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var z in _)if(z!=="default"&&Object.prototype.hasOwnProperty.call(_,z)){var B=M?Object.getOwnPropertyDescriptor(_,z):null;B&&(B.get||B.set)?Object.defineProperty(E,z,B):E[z]=_[z]}return E.default=_,I&&I.set(_,E),E}(gt());function i(_){if(typeof WeakMap!="function")return null;var T=new WeakMap,I=new WeakMap;return(i=function(E){return E?I:T})(_)}function a(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function c(_,T,I){var E=T[0],M=T[1],z=T[2],B=T[3],N=T[4],H=T[5],G=T[6],j=T[7],$=T[8],W=T[9],Q=T[10],le=T[11],se=T[12],ae=T[13],be=T[14],he=T[15],Te=I[0],Ie=I[1],Me=I[2],ze=I[3];return _[0]=Te*E+Ie*N+Me*$+ze*se,_[1]=Te*M+Ie*H+Me*W+ze*ae,_[2]=Te*z+Ie*G+Me*Q+ze*be,_[3]=Te*B+Ie*j+Me*le+ze*he,_[4]=(Te=I[4])*E+(Ie=I[5])*N+(Me=I[6])*$+(ze=I[7])*se,_[5]=Te*M+Ie*H+Me*W+ze*ae,_[6]=Te*z+Ie*G+Me*Q+ze*be,_[7]=Te*B+Ie*j+Me*le+ze*he,_[8]=(Te=I[8])*E+(Ie=I[9])*N+(Me=I[10])*$+(ze=I[11])*se,_[9]=Te*M+Ie*H+Me*W+ze*ae,_[10]=Te*z+Ie*G+Me*Q+ze*be,_[11]=Te*B+Ie*j+Me*le+ze*he,_[12]=(Te=I[12])*E+(Ie=I[13])*N+(Me=I[14])*$+(ze=I[15])*se,_[13]=Te*M+Ie*H+Me*W+ze*ae,_[14]=Te*z+Ie*G+Me*Q+ze*be,_[15]=Te*B+Ie*j+Me*le+ze*he,_}function l(_,T,I){var E=T[0],M=T[1],z=T[2],B=T[3],N=E+E,H=M+M,G=z+z,j=E*N,$=E*H,W=E*G,Q=M*H,le=M*G,se=z*G,ae=B*N,be=B*H,he=B*G;return _[0]=1-(Q+se),_[1]=$+he,_[2]=W-be,_[3]=0,_[4]=$-he,_[5]=1-(j+se),_[6]=le+ae,_[7]=0,_[8]=W+be,_[9]=le-ae,_[10]=1-(j+Q),_[11]=0,_[12]=I[0],_[13]=I[1],_[14]=I[2],_[15]=1,_}function d(_,T){var I=T[4],E=T[5],M=T[6],z=T[8],B=T[9],N=T[10];return _[0]=Math.hypot(T[0],T[1],T[2]),_[1]=Math.hypot(I,E,M),_[2]=Math.hypot(z,B,N),_}function y(_,T,I,E,M){var z,B=1/Math.tan(T/2);return _[0]=B/I,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,M!=null&&M!==1/0?(_[10]=(M+E)*(z=1/(E-M)),_[14]=2*M*E*z):(_[10]=-1,_[14]=-2*E),_}function w(_,T,I,E,M,z,B){var N=1/(T-I),H=1/(E-M),G=1/(z-B);return _[0]=-2*N,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*H,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*G,_[11]=0,_[12]=(T+I)*N,_[13]=(M+E)*H,_[14]=(B+z)*G,_[15]=1,_}function A(_,T,I){return _[0]=T[0]-I[0],_[1]=T[1]-I[1],_[2]=T[2]-I[2],_[3]=T[3]-I[3],_[4]=T[4]-I[4],_[5]=T[5]-I[5],_[6]=T[6]-I[6],_[7]=T[7]-I[7],_[8]=T[8]-I[8],_[9]=T[9]-I[9],_[10]=T[10]-I[10],_[11]=T[11]-I[11],_[12]=T[12]-I[12],_[13]=T[13]-I[13],_[14]=T[14]-I[14],_[15]=T[15]-I[15],_}return Gt.perspective=y,Gt.ortho=w,Gt.mul=c,Gt.sub=A,Gt}var tn,Jt={},ei={};function Vn(){if(tn)return ei;function r(M){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(z){return typeof z}:function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},r(M)}tn=1,Object.defineProperty(ei,"__esModule",{value:!0}),ei.create=a,ei.clone=function(M){var z=new e.ARRAY_TYPE(3);return z[0]=M[0],z[1]=M[1],z[2]=M[2],z},ei.length=c,ei.fromValues=function(M,z,B){var N=new e.ARRAY_TYPE(3);return N[0]=M,N[1]=z,N[2]=B,N},ei.copy=function(M,z){return M[0]=z[0],M[1]=z[1],M[2]=z[2],M},ei.set=function(M,z,B,N){return M[0]=z,M[1]=B,M[2]=N,M},ei.add=function(M,z,B){return M[0]=z[0]+B[0],M[1]=z[1]+B[1],M[2]=z[2]+B[2],M},ei.subtract=l,ei.multiply=d,ei.divide=y,ei.ceil=function(M,z){return M[0]=Math.ceil(z[0]),M[1]=Math.ceil(z[1]),M[2]=Math.ceil(z[2]),M},ei.floor=function(M,z){return M[0]=Math.floor(z[0]),M[1]=Math.floor(z[1]),M[2]=Math.floor(z[2]),M},ei.min=function(M,z,B){return M[0]=Math.min(z[0],B[0]),M[1]=Math.min(z[1],B[1]),M[2]=Math.min(z[2],B[2]),M},ei.max=function(M,z,B){return M[0]=Math.max(z[0],B[0]),M[1]=Math.max(z[1],B[1]),M[2]=Math.max(z[2],B[2]),M},ei.round=function(M,z){return M[0]=Math.round(z[0]),M[1]=Math.round(z[1]),M[2]=Math.round(z[2]),M},ei.scale=function(M,z,B){return M[0]=z[0]*B,M[1]=z[1]*B,M[2]=z[2]*B,M},ei.scaleAndAdd=function(M,z,B,N){return M[0]=z[0]+B[0]*N,M[1]=z[1]+B[1]*N,M[2]=z[2]+B[2]*N,M},ei.distance=w,ei.squaredDistance=A,ei.squaredLength=_,ei.negate=function(M,z){return M[0]=-z[0],M[1]=-z[1],M[2]=-z[2],M},ei.inverse=function(M,z){return M[0]=1/z[0],M[1]=1/z[1],M[2]=1/z[2],M},ei.normalize=function(M,z){var B=z[0],N=z[1],H=z[2],G=B*B+N*N+H*H;return G>0&&(G=1/Math.sqrt(G)),M[0]=z[0]*G,M[1]=z[1]*G,M[2]=z[2]*G,M},ei.dot=T,ei.cross=function(M,z,B){var N=z[0],H=z[1],G=z[2],j=B[0],$=B[1],W=B[2];return M[0]=H*W-G*$,M[1]=G*j-N*W,M[2]=N*$-H*j,M},ei.lerp=function(M,z,B,N){var H=z[0],G=z[1],j=z[2];return M[0]=H+N*(B[0]-H),M[1]=G+N*(B[1]-G),M[2]=j+N*(B[2]-j),M},ei.hermite=function(M,z,B,N,H,G){var j=G*G,$=j*(2*G-3)+1,W=j*(G-2)+G,Q=j*(G-1),le=j*(3-2*G);return M[0]=z[0]*$+B[0]*W+N[0]*Q+H[0]*le,M[1]=z[1]*$+B[1]*W+N[1]*Q+H[1]*le,M[2]=z[2]*$+B[2]*W+N[2]*Q+H[2]*le,M},ei.bezier=function(M,z,B,N,H,G){var j=1-G,$=j*j,W=G*G,Q=$*j,le=3*G*$,se=3*W*j,ae=W*G;return M[0]=z[0]*Q+B[0]*le+N[0]*se+H[0]*ae,M[1]=z[1]*Q+B[1]*le+N[1]*se+H[1]*ae,M[2]=z[2]*Q+B[2]*le+N[2]*se+H[2]*ae,M},ei.random=function(M,z){z=z||1;var B=2*e.RANDOM()*Math.PI,N=2*e.RANDOM()-1,H=Math.sqrt(1-N*N)*z;return M[0]=Math.cos(B)*H,M[1]=Math.sin(B)*H,M[2]=N*z,M},ei.transformMat4=function(M,z,B){var N=z[0],H=z[1],G=z[2],j=B[3]*N+B[7]*H+B[11]*G+B[15];return M[0]=(B[0]*N+B[4]*H+B[8]*G+B[12])/(j=j||1),M[1]=(B[1]*N+B[5]*H+B[9]*G+B[13])/j,M[2]=(B[2]*N+B[6]*H+B[10]*G+B[14])/j,M},ei.transformMat3=function(M,z,B){var N=z[0],H=z[1],G=z[2];return M[0]=N*B[0]+H*B[3]+G*B[6],M[1]=N*B[1]+H*B[4]+G*B[7],M[2]=N*B[2]+H*B[5]+G*B[8],M},ei.transformQuat=function(M,z,B){var N=B[0],H=B[1],G=B[2],j=z[0],$=z[1],W=z[2],Q=H*W-G*$,le=G*j-N*W,se=N*$-H*j,ae=H*se-G*le,be=G*Q-N*se,he=N*le-H*Q,Te=2*B[3];return le*=Te,se*=Te,be*=2,he*=2,M[0]=j+(Q*=Te)+(ae*=2),M[1]=$+le+be,M[2]=W+se+he,M},ei.rotateX=function(M,z,B,N){var H=[],G=[];return H[0]=z[0]-B[0],H[1]=z[1]-B[1],H[2]=z[2]-B[2],G[0]=H[0],G[1]=H[1]*Math.cos(N)-H[2]*Math.sin(N),G[2]=H[1]*Math.sin(N)+H[2]*Math.cos(N),M[0]=G[0]+B[0],M[1]=G[1]+B[1],M[2]=G[2]+B[2],M},ei.rotateY=function(M,z,B,N){var H=[],G=[];return H[0]=z[0]-B[0],H[1]=z[1]-B[1],H[2]=z[2]-B[2],G[0]=H[2]*Math.sin(N)+H[0]*Math.cos(N),G[1]=H[1],G[2]=H[2]*Math.cos(N)-H[0]*Math.sin(N),M[0]=G[0]+B[0],M[1]=G[1]+B[1],M[2]=G[2]+B[2],M},ei.rotateZ=function(M,z,B,N){var H=[],G=[];return H[0]=z[0]-B[0],H[1]=z[1]-B[1],H[2]=z[2]-B[2],G[0]=H[0]*Math.cos(N)-H[1]*Math.sin(N),G[1]=H[0]*Math.sin(N)+H[1]*Math.cos(N),G[2]=H[2],M[0]=G[0]+B[0],M[1]=G[1]+B[1],M[2]=G[2]+B[2],M},ei.angle=function(M,z){var B=M[0],N=M[1],H=M[2],G=z[0],j=z[1],$=z[2],W=Math.sqrt(B*B+N*N+H*H)*Math.sqrt(G*G+j*j+$*$),Q=W&&T(M,z)/W;return Math.acos(Math.min(Math.max(Q,-1),1))},ei.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M},ei.str=function(M){return"vec3("+M[0]+", "+M[1]+", "+M[2]+")"},ei.exactEquals=function(M,z){return M[0]===z[0]&&M[1]===z[1]&&M[2]===z[2]},ei.equals=function(M,z){var B=M[0],N=M[1],H=M[2],G=z[0],j=z[1],$=z[2];return Math.abs(B-G)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(G))&&Math.abs(N-j)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(j))&&Math.abs(H-$)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs($))},ei.forEach=ei.sqrLen=ei.len=ei.sqrDist=ei.dist=ei.div=ei.mul=ei.sub=void 0;var e=function(M,z){if(M&&M.__esModule)return M;if(M===null||r(M)!=="object"&&typeof M!="function")return{default:M};var B=i(void 0);if(B&&B.has(M))return B.get(M);var N={},H=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in M)if(G!=="default"&&Object.prototype.hasOwnProperty.call(M,G)){var j=H?Object.getOwnPropertyDescriptor(M,G):null;j&&(j.get||j.set)?Object.defineProperty(N,G,j):N[G]=M[G]}return N.default=M,B&&B.set(M,N),N}(gt());function i(M){if(typeof WeakMap!="function")return null;var z=new WeakMap,B=new WeakMap;return(i=function(N){return N?B:z})(M)}function a(){var M=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0),M}function c(M){return Math.hypot(M[0],M[1],M[2])}function l(M,z,B){return M[0]=z[0]-B[0],M[1]=z[1]-B[1],M[2]=z[2]-B[2],M}function d(M,z,B){return M[0]=z[0]*B[0],M[1]=z[1]*B[1],M[2]=z[2]*B[2],M}function y(M,z,B){return M[0]=z[0]/B[0],M[1]=z[1]/B[1],M[2]=z[2]/B[2],M}function w(M,z){return Math.hypot(z[0]-M[0],z[1]-M[1],z[2]-M[2])}function A(M,z){var B=z[0]-M[0],N=z[1]-M[1],H=z[2]-M[2];return B*B+N*N+H*H}function _(M){var z=M[0],B=M[1],N=M[2];return z*z+B*B+N*N}function T(M,z){return M[0]*z[0]+M[1]*z[1]+M[2]*z[2]}ei.sub=l,ei.mul=d,ei.div=y,ei.dist=w,ei.sqrDist=A,ei.len=c,ei.sqrLen=_;var I,E=(I=a(),function(M,z,B,N,H,G){var j,$;for(z||(z=3),B||(B=0),$=N?Math.min(N*z+B,M.length):M.length,j=B;j<$;j+=z)I[0]=M[j],I[1]=M[j+1],I[2]=M[j+2],H(I,I,G),M[j]=I[0],M[j+1]=I[1],M[j+2]=I[2];return M});return ei.forEach=E,ei}var fs,Ss,mi={};function bt(){if(fs)return mi;function r(E){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},r(E)}fs=1,Object.defineProperty(mi,"__esModule",{value:!0}),mi.create=a,mi.clone=function(E){var M=new e.ARRAY_TYPE(4);return M[0]=E[0],M[1]=E[1],M[2]=E[2],M[3]=E[3],M},mi.fromValues=function(E,M,z,B){var N=new e.ARRAY_TYPE(4);return N[0]=E,N[1]=M,N[2]=z,N[3]=B,N},mi.copy=function(E,M){return E[0]=M[0],E[1]=M[1],E[2]=M[2],E[3]=M[3],E},mi.set=function(E,M,z,B,N){return E[0]=M,E[1]=z,E[2]=B,E[3]=N,E},mi.add=function(E,M,z){return E[0]=M[0]+z[0],E[1]=M[1]+z[1],E[2]=M[2]+z[2],E[3]=M[3]+z[3],E},mi.subtract=c,mi.multiply=l,mi.divide=d,mi.ceil=function(E,M){return E[0]=Math.ceil(M[0]),E[1]=Math.ceil(M[1]),E[2]=Math.ceil(M[2]),E[3]=Math.ceil(M[3]),E},mi.floor=function(E,M){return E[0]=Math.floor(M[0]),E[1]=Math.floor(M[1]),E[2]=Math.floor(M[2]),E[3]=Math.floor(M[3]),E},mi.min=function(E,M,z){return E[0]=Math.min(M[0],z[0]),E[1]=Math.min(M[1],z[1]),E[2]=Math.min(M[2],z[2]),E[3]=Math.min(M[3],z[3]),E},mi.max=function(E,M,z){return E[0]=Math.max(M[0],z[0]),E[1]=Math.max(M[1],z[1]),E[2]=Math.max(M[2],z[2]),E[3]=Math.max(M[3],z[3]),E},mi.round=function(E,M){return E[0]=Math.round(M[0]),E[1]=Math.round(M[1]),E[2]=Math.round(M[2]),E[3]=Math.round(M[3]),E},mi.scale=function(E,M,z){return E[0]=M[0]*z,E[1]=M[1]*z,E[2]=M[2]*z,E[3]=M[3]*z,E},mi.scaleAndAdd=function(E,M,z,B){return E[0]=M[0]+z[0]*B,E[1]=M[1]+z[1]*B,E[2]=M[2]+z[2]*B,E[3]=M[3]+z[3]*B,E},mi.distance=y,mi.squaredDistance=w,mi.length=A,mi.squaredLength=_,mi.negate=function(E,M){return E[0]=-M[0],E[1]=-M[1],E[2]=-M[2],E[3]=-M[3],E},mi.inverse=function(E,M){return E[0]=1/M[0],E[1]=1/M[1],E[2]=1/M[2],E[3]=1/M[3],E},mi.normalize=function(E,M){var z=M[0],B=M[1],N=M[2],H=M[3],G=z*z+B*B+N*N+H*H;return G>0&&(G=1/Math.sqrt(G)),E[0]=z*G,E[1]=B*G,E[2]=N*G,E[3]=H*G,E},mi.dot=function(E,M){return E[0]*M[0]+E[1]*M[1]+E[2]*M[2]+E[3]*M[3]},mi.cross=function(E,M,z,B){var N=z[0]*B[1]-z[1]*B[0],H=z[0]*B[2]-z[2]*B[0],G=z[0]*B[3]-z[3]*B[0],j=z[1]*B[2]-z[2]*B[1],$=z[1]*B[3]-z[3]*B[1],W=z[2]*B[3]-z[3]*B[2],Q=M[0],le=M[1],se=M[2],ae=M[3];return E[0]=le*W-se*$+ae*j,E[1]=-Q*W+se*G-ae*H,E[2]=Q*$-le*G+ae*N,E[3]=-Q*j+le*H-se*N,E},mi.lerp=function(E,M,z,B){var N=M[0],H=M[1],G=M[2],j=M[3];return E[0]=N+B*(z[0]-N),E[1]=H+B*(z[1]-H),E[2]=G+B*(z[2]-G),E[3]=j+B*(z[3]-j),E},mi.random=function(E,M){var z,B,N,H,G,j;M=M||1;do G=(z=2*e.RANDOM()-1)*z+(B=2*e.RANDOM()-1)*B;while(G>=1);do j=(N=2*e.RANDOM()-1)*N+(H=2*e.RANDOM()-1)*H;while(j>=1);var $=Math.sqrt((1-G)/j);return E[0]=M*z,E[1]=M*B,E[2]=M*N*$,E[3]=M*H*$,E},mi.transformMat4=function(E,M,z){var B=M[0],N=M[1],H=M[2],G=M[3];return E[0]=z[0]*B+z[4]*N+z[8]*H+z[12]*G,E[1]=z[1]*B+z[5]*N+z[9]*H+z[13]*G,E[2]=z[2]*B+z[6]*N+z[10]*H+z[14]*G,E[3]=z[3]*B+z[7]*N+z[11]*H+z[15]*G,E},mi.transformQuat=function(E,M,z){var B=M[0],N=M[1],H=M[2],G=z[0],j=z[1],$=z[2],W=z[3],Q=W*B+j*H-$*N,le=W*N+$*B-G*H,se=W*H+G*N-j*B,ae=-G*B-j*N-$*H;return E[0]=Q*W+ae*-G+le*-$-se*-j,E[1]=le*W+ae*-j+se*-G-Q*-$,E[2]=se*W+ae*-$+Q*-j-le*-G,E[3]=M[3],E},mi.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=0,E},mi.str=function(E){return"vec4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+")"},mi.exactEquals=function(E,M){return E[0]===M[0]&&E[1]===M[1]&&E[2]===M[2]&&E[3]===M[3]},mi.equals=function(E,M){var z=E[0],B=E[1],N=E[2],H=E[3],G=M[0],j=M[1],$=M[2],W=M[3];return Math.abs(z-G)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(G))&&Math.abs(B-j)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(j))&&Math.abs(N-$)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs($))&&Math.abs(H-W)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(W))},mi.forEach=mi.sqrLen=mi.len=mi.sqrDist=mi.dist=mi.div=mi.mul=mi.sub=void 0;var e=function(E,M){if(E&&E.__esModule)return E;if(E===null||r(E)!=="object"&&typeof E!="function")return{default:E};var z=i(void 0);if(z&&z.has(E))return z.get(E);var B={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in E)if(H!=="default"&&Object.prototype.hasOwnProperty.call(E,H)){var G=N?Object.getOwnPropertyDescriptor(E,H):null;G&&(G.get||G.set)?Object.defineProperty(B,H,G):B[H]=E[H]}return B.default=E,z&&z.set(E,B),B}(gt());function i(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,z=new WeakMap;return(i=function(B){return B?z:M})(E)}function a(){var E=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[3]=0),E}function c(E,M,z){return E[0]=M[0]-z[0],E[1]=M[1]-z[1],E[2]=M[2]-z[2],E[3]=M[3]-z[3],E}function l(E,M,z){return E[0]=M[0]*z[0],E[1]=M[1]*z[1],E[2]=M[2]*z[2],E[3]=M[3]*z[3],E}function d(E,M,z){return E[0]=M[0]/z[0],E[1]=M[1]/z[1],E[2]=M[2]/z[2],E[3]=M[3]/z[3],E}function y(E,M){return Math.hypot(M[0]-E[0],M[1]-E[1],M[2]-E[2],M[3]-E[3])}function w(E,M){var z=M[0]-E[0],B=M[1]-E[1],N=M[2]-E[2],H=M[3]-E[3];return z*z+B*B+N*N+H*H}function A(E){return Math.hypot(E[0],E[1],E[2],E[3])}function _(E){var M=E[0],z=E[1],B=E[2],N=E[3];return M*M+z*z+B*B+N*N}mi.sub=c,mi.mul=l,mi.div=d,mi.dist=y,mi.sqrDist=w,mi.len=A,mi.sqrLen=_;var T,I=(T=a(),function(E,M,z,B,N,H){var G,j;for(M||(M=4),z||(z=0),j=B?Math.min(B*M+z,E.length):E.length,G=z;G<j;G+=M)T[0]=E[G],T[1]=E[G+1],T[2]=E[G+2],T[3]=E[G+3],N(T,T,H),E[G]=T[0],E[G+1]=T[1],E[G+2]=T[2],E[G+3]=T[3];return E});return mi.forEach=I,mi}function ri(){if(Ss)return Jt;function r(he){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Te){return typeof Te}:function(Te){return Te&&typeof Symbol=="function"&&Te.constructor===Symbol&&Te!==Symbol.prototype?"symbol":typeof Te},r(he)}Ss=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=y,Jt.identity=function(he){return he[0]=0,he[1]=0,he[2]=0,he[3]=1,he},Jt.setAxisAngle=w,Jt.getAxisAngle=function(he,Te){var Ie=2*Math.acos(Te[3]),Me=Math.sin(Ie/2);return Me>e.EPSILON?(he[0]=Te[0]/Me,he[1]=Te[1]/Me,he[2]=Te[2]/Me):(he[0]=1,he[1]=0,he[2]=0),Ie},Jt.getAngle=function(he,Te){var Ie=z(he,Te);return Math.acos(2*Ie*Ie-1)},Jt.multiply=A,Jt.rotateX=function(he,Te,Ie){Ie*=.5;var Me=Te[0],ze=Te[1],De=Te[2],Ne=Te[3],ke=Math.sin(Ie),Ue=Math.cos(Ie);return he[0]=Me*Ue+Ne*ke,he[1]=ze*Ue+De*ke,he[2]=De*Ue-ze*ke,he[3]=Ne*Ue-Me*ke,he},Jt.rotateY=function(he,Te,Ie){Ie*=.5;var Me=Te[0],ze=Te[1],De=Te[2],Ne=Te[3],ke=Math.sin(Ie),Ue=Math.cos(Ie);return he[0]=Me*Ue-De*ke,he[1]=ze*Ue+Ne*ke,he[2]=De*Ue+Me*ke,he[3]=Ne*Ue-ze*ke,he},Jt.rotateZ=function(he,Te,Ie){Ie*=.5;var Me=Te[0],ze=Te[1],De=Te[2],Ne=Te[3],ke=Math.sin(Ie),Ue=Math.cos(Ie);return he[0]=Me*Ue+ze*ke,he[1]=ze*Ue-Me*ke,he[2]=De*Ue+Ne*ke,he[3]=Ne*Ue-De*ke,he},Jt.calculateW=function(he,Te){var Ie=Te[0],Me=Te[1],ze=Te[2];return he[0]=Ie,he[1]=Me,he[2]=ze,he[3]=Math.sqrt(Math.abs(1-Ie*Ie-Me*Me-ze*ze)),he},Jt.exp=_,Jt.ln=T,Jt.pow=function(he,Te,Ie){return T(he,Te),M(he,he,Ie),_(he,he),he},Jt.slerp=I,Jt.random=function(he){var Te=e.RANDOM(),Ie=e.RANDOM(),Me=e.RANDOM(),ze=Math.sqrt(1-Te),De=Math.sqrt(Te);return he[0]=ze*Math.sin(2*Math.PI*Ie),he[1]=ze*Math.cos(2*Math.PI*Ie),he[2]=De*Math.sin(2*Math.PI*Me),he[3]=De*Math.cos(2*Math.PI*Me),he},Jt.invert=function(he,Te){var Ie=Te[0],Me=Te[1],ze=Te[2],De=Te[3],Ne=Ie*Ie+Me*Me+ze*ze+De*De,ke=Ne?1/Ne:0;return he[0]=-Ie*ke,he[1]=-Me*ke,he[2]=-ze*ke,he[3]=De*ke,he},Jt.conjugate=function(he,Te){return he[0]=-Te[0],he[1]=-Te[1],he[2]=-Te[2],he[3]=Te[3],he},Jt.fromMat3=E,Jt.fromEuler=function(he,Te,Ie,Me){var ze=.5*Math.PI/180;Te*=ze,Ie*=ze,Me*=ze;var De=Math.sin(Te),Ne=Math.cos(Te),ke=Math.sin(Ie),Ue=Math.cos(Ie),lt=Math.sin(Me),ot=Math.cos(Me);return he[0]=De*Ue*ot-Ne*ke*lt,he[1]=Ne*ke*ot+De*Ue*lt,he[2]=Ne*Ue*lt-De*ke*ot,he[3]=Ne*Ue*ot+De*ke*lt,he},Jt.str=function(he){return"quat("+he[0]+", "+he[1]+", "+he[2]+", "+he[3]+")"},Jt.setAxes=Jt.sqlerp=Jt.rotationTo=Jt.equals=Jt.exactEquals=Jt.normalize=Jt.sqrLen=Jt.squaredLength=Jt.len=Jt.length=Jt.lerp=Jt.dot=Jt.scale=Jt.mul=Jt.add=Jt.set=Jt.copy=Jt.fromValues=Jt.clone=void 0;var e=d(gt()),i=d(kt()),a=d(Vn()),c=d(bt());function l(he){if(typeof WeakMap!="function")return null;var Te=new WeakMap,Ie=new WeakMap;return(l=function(Me){return Me?Ie:Te})(he)}function d(he,Te){if(he&&he.__esModule)return he;if(he===null||r(he)!=="object"&&typeof he!="function")return{default:he};var Ie=l(Te);if(Ie&&Ie.has(he))return Ie.get(he);var Me={},ze=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var De in he)if(De!=="default"&&Object.prototype.hasOwnProperty.call(he,De)){var Ne=ze?Object.getOwnPropertyDescriptor(he,De):null;Ne&&(Ne.get||Ne.set)?Object.defineProperty(Me,De,Ne):Me[De]=he[De]}return Me.default=he,Ie&&Ie.set(he,Me),Me}function y(){var he=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(he[0]=0,he[1]=0,he[2]=0),he[3]=1,he}function w(he,Te,Ie){Ie*=.5;var Me=Math.sin(Ie);return he[0]=Me*Te[0],he[1]=Me*Te[1],he[2]=Me*Te[2],he[3]=Math.cos(Ie),he}function A(he,Te,Ie){var Me=Te[0],ze=Te[1],De=Te[2],Ne=Te[3],ke=Ie[0],Ue=Ie[1],lt=Ie[2],ot=Ie[3];return he[0]=Me*ot+Ne*ke+ze*lt-De*Ue,he[1]=ze*ot+Ne*Ue+De*ke-Me*lt,he[2]=De*ot+Ne*lt+Me*Ue-ze*ke,he[3]=Ne*ot-Me*ke-ze*Ue-De*lt,he}function _(he,Te){var Ie=Te[0],Me=Te[1],ze=Te[2],De=Te[3],Ne=Math.sqrt(Ie*Ie+Me*Me+ze*ze),ke=Math.exp(De),Ue=Ne>0?ke*Math.sin(Ne)/Ne:0;return he[0]=Ie*Ue,he[1]=Me*Ue,he[2]=ze*Ue,he[3]=ke*Math.cos(Ne),he}function T(he,Te){var Ie=Te[0],Me=Te[1],ze=Te[2],De=Te[3],Ne=Math.sqrt(Ie*Ie+Me*Me+ze*ze),ke=Ne>0?Math.atan2(Ne,De)/Ne:0;return he[0]=Ie*ke,he[1]=Me*ke,he[2]=ze*ke,he[3]=.5*Math.log(Ie*Ie+Me*Me+ze*ze+De*De),he}function I(he,Te,Ie,Me){var ze,De,Ne,ke,Ue,lt=Te[0],ot=Te[1],Nt=Te[2],mt=Te[3],xt=Ie[0],ut=Ie[1],ti=Ie[2],zt=Ie[3];return(De=lt*xt+ot*ut+Nt*ti+mt*zt)<0&&(De=-De,xt=-xt,ut=-ut,ti=-ti,zt=-zt),1-De>e.EPSILON?(ze=Math.acos(De),Ne=Math.sin(ze),ke=Math.sin((1-Me)*ze)/Ne,Ue=Math.sin(Me*ze)/Ne):(ke=1-Me,Ue=Me),he[0]=ke*lt+Ue*xt,he[1]=ke*ot+Ue*ut,he[2]=ke*Nt+Ue*ti,he[3]=ke*mt+Ue*zt,he}function E(he,Te){var Ie,Me=Te[0]+Te[4]+Te[8];if(Me>0)Ie=Math.sqrt(Me+1),he[3]=.5*Ie,he[0]=(Te[5]-Te[7])*(Ie=.5/Ie),he[1]=(Te[6]-Te[2])*Ie,he[2]=(Te[1]-Te[3])*Ie;else{var ze=0;Te[4]>Te[0]&&(ze=1),Te[8]>Te[3*ze+ze]&&(ze=2);var De=(ze+1)%3,Ne=(ze+2)%3;Ie=Math.sqrt(Te[3*ze+ze]-Te[3*De+De]-Te[3*Ne+Ne]+1),he[ze]=.5*Ie,he[3]=(Te[3*De+Ne]-Te[3*Ne+De])*(Ie=.5/Ie),he[De]=(Te[3*De+ze]+Te[3*ze+De])*Ie,he[Ne]=(Te[3*Ne+ze]+Te[3*ze+Ne])*Ie}return he}Jt.clone=c.clone,Jt.fromValues=c.fromValues,Jt.copy=c.copy,Jt.set=c.set,Jt.add=c.add,Jt.mul=A;var M=c.scale;Jt.scale=M;var z=c.dot;Jt.dot=z,Jt.lerp=c.lerp;var B=c.length;Jt.length=B,Jt.len=B;var N=c.squaredLength;Jt.squaredLength=N,Jt.sqrLen=N;var H=c.normalize;Jt.normalize=H,Jt.exactEquals=c.exactEquals,Jt.equals=c.equals;var G,j,$,W=(G=a.create(),j=a.fromValues(1,0,0),$=a.fromValues(0,1,0),function(he,Te,Ie){var Me=a.dot(Te,Ie);return Me<-.999999?(a.cross(G,j,Te),a.len(G)<1e-6&&a.cross(G,$,Te),a.normalize(G,G),w(he,G,Math.PI),he):Me>.999999?(he[0]=0,he[1]=0,he[2]=0,he[3]=1,he):(a.cross(G,Te,Ie),he[0]=G[0],he[1]=G[1],he[2]=G[2],he[3]=1+Me,H(he,he))});Jt.rotationTo=W;var Q,le,se=(Q=y(),le=y(),function(he,Te,Ie,Me,ze,De){return I(Q,Te,ze,De),I(le,Ie,Me,De),I(he,Q,le,2*De*(1-De)),he});Jt.sqlerp=se;var ae,be=(ae=i.create(),function(he,Te,Ie,Me){return ae[0]=Ie[0],ae[3]=Ie[1],ae[6]=Ie[2],ae[1]=Me[0],ae[4]=Me[1],ae[7]=Me[2],ae[2]=-Te[0],ae[5]=-Te[1],ae[8]=-Te[2],H(he,E(he,ae))});return Jt.setAxes=be,Jt}var Ni,si={};function Ze(){if(Ni)return si;function r(I){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},r(I)}Ni=1,Object.defineProperty(si,"__esModule",{value:!0}),si.create=function(){var I=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(I[0]=0,I[1]=0,I[2]=0,I[4]=0,I[5]=0,I[6]=0,I[7]=0),I[3]=1,I},si.clone=function(I){var E=new e.ARRAY_TYPE(8);return E[0]=I[0],E[1]=I[1],E[2]=I[2],E[3]=I[3],E[4]=I[4],E[5]=I[5],E[6]=I[6],E[7]=I[7],E},si.fromValues=function(I,E,M,z,B,N,H,G){var j=new e.ARRAY_TYPE(8);return j[0]=I,j[1]=E,j[2]=M,j[3]=z,j[4]=B,j[5]=N,j[6]=H,j[7]=G,j},si.fromRotationTranslationValues=function(I,E,M,z,B,N,H){var G=new e.ARRAY_TYPE(8);G[0]=I,G[1]=E,G[2]=M,G[3]=z;var j=.5*B,$=.5*N,W=.5*H;return G[4]=j*z+$*M-W*E,G[5]=$*z+W*I-j*M,G[6]=W*z+j*E-$*I,G[7]=-j*I-$*E-W*M,G},si.fromRotationTranslation=d,si.fromTranslation=function(I,E){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=.5*E[0],I[5]=.5*E[1],I[6]=.5*E[2],I[7]=0,I},si.fromRotation=function(I,E){return I[0]=E[0],I[1]=E[1],I[2]=E[2],I[3]=E[3],I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},si.fromMat4=function(I,E){var M=i.create();a.getRotation(M,E);var z=new e.ARRAY_TYPE(3);return a.getTranslation(z,E),d(I,M,z),I},si.copy=y,si.identity=function(I){return I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=0,I[5]=0,I[6]=0,I[7]=0,I},si.set=function(I,E,M,z,B,N,H,G,j){return I[0]=E,I[1]=M,I[2]=z,I[3]=B,I[4]=N,I[5]=H,I[6]=G,I[7]=j,I},si.getDual=function(I,E){return I[0]=E[4],I[1]=E[5],I[2]=E[6],I[3]=E[7],I},si.setDual=function(I,E){return I[4]=E[0],I[5]=E[1],I[6]=E[2],I[7]=E[3],I},si.getTranslation=function(I,E){var M=E[4],z=E[5],B=E[6],N=E[7],H=-E[0],G=-E[1],j=-E[2],$=E[3];return I[0]=2*(M*$+N*H+z*j-B*G),I[1]=2*(z*$+N*G+B*H-M*j),I[2]=2*(B*$+N*j+M*G-z*H),I},si.translate=function(I,E,M){var z=E[0],B=E[1],N=E[2],H=E[3],G=.5*M[0],j=.5*M[1],$=.5*M[2],W=E[4],Q=E[5],le=E[6],se=E[7];return I[0]=z,I[1]=B,I[2]=N,I[3]=H,I[4]=H*G+B*$-N*j+W,I[5]=H*j+N*G-z*$+Q,I[6]=H*$+z*j-B*G+le,I[7]=-z*G-B*j-N*$+se,I},si.rotateX=function(I,E,M){var z=-E[0],B=-E[1],N=-E[2],H=E[3],G=E[4],j=E[5],$=E[6],W=E[7],Q=G*H+W*z+j*N-$*B,le=j*H+W*B+$*z-G*N,se=$*H+W*N+G*B-j*z,ae=W*H-G*z-j*B-$*N;return i.rotateX(I,E,M),I[4]=Q*(H=I[3])+ae*(z=I[0])+le*(N=I[2])-se*(B=I[1]),I[5]=le*H+ae*B+se*z-Q*N,I[6]=se*H+ae*N+Q*B-le*z,I[7]=ae*H-Q*z-le*B-se*N,I},si.rotateY=function(I,E,M){var z=-E[0],B=-E[1],N=-E[2],H=E[3],G=E[4],j=E[5],$=E[6],W=E[7],Q=G*H+W*z+j*N-$*B,le=j*H+W*B+$*z-G*N,se=$*H+W*N+G*B-j*z,ae=W*H-G*z-j*B-$*N;return i.rotateY(I,E,M),I[4]=Q*(H=I[3])+ae*(z=I[0])+le*(N=I[2])-se*(B=I[1]),I[5]=le*H+ae*B+se*z-Q*N,I[6]=se*H+ae*N+Q*B-le*z,I[7]=ae*H-Q*z-le*B-se*N,I},si.rotateZ=function(I,E,M){var z=-E[0],B=-E[1],N=-E[2],H=E[3],G=E[4],j=E[5],$=E[6],W=E[7],Q=G*H+W*z+j*N-$*B,le=j*H+W*B+$*z-G*N,se=$*H+W*N+G*B-j*z,ae=W*H-G*z-j*B-$*N;return i.rotateZ(I,E,M),I[4]=Q*(H=I[3])+ae*(z=I[0])+le*(N=I[2])-se*(B=I[1]),I[5]=le*H+ae*B+se*z-Q*N,I[6]=se*H+ae*N+Q*B-le*z,I[7]=ae*H-Q*z-le*B-se*N,I},si.rotateByQuatAppend=function(I,E,M){var z=M[0],B=M[1],N=M[2],H=M[3],G=E[0],j=E[1],$=E[2],W=E[3];return I[0]=G*H+W*z+j*N-$*B,I[1]=j*H+W*B+$*z-G*N,I[2]=$*H+W*N+G*B-j*z,I[3]=W*H-G*z-j*B-$*N,I[4]=(G=E[4])*H+(W=E[7])*z+(j=E[5])*N-($=E[6])*B,I[5]=j*H+W*B+$*z-G*N,I[6]=$*H+W*N+G*B-j*z,I[7]=W*H-G*z-j*B-$*N,I},si.rotateByQuatPrepend=function(I,E,M){var z=E[0],B=E[1],N=E[2],H=E[3],G=M[0],j=M[1],$=M[2],W=M[3];return I[0]=z*W+H*G+B*$-N*j,I[1]=B*W+H*j+N*G-z*$,I[2]=N*W+H*$+z*j-B*G,I[3]=H*W-z*G-B*j-N*$,I[4]=z*(W=M[7])+H*(G=M[4])+B*($=M[6])-N*(j=M[5]),I[5]=B*W+H*j+N*G-z*$,I[6]=N*W+H*$+z*j-B*G,I[7]=H*W-z*G-B*j-N*$,I},si.rotateAroundAxis=function(I,E,M,z){if(Math.abs(z)<e.EPSILON)return y(I,E);var B=Math.hypot(M[0],M[1],M[2]);z*=.5;var N=Math.sin(z),H=N*M[0]/B,G=N*M[1]/B,j=N*M[2]/B,$=Math.cos(z),W=E[0],Q=E[1],le=E[2],se=E[3];I[0]=W*$+se*H+Q*j-le*G,I[1]=Q*$+se*G+le*H-W*j,I[2]=le*$+se*j+W*G-Q*H,I[3]=se*$-W*H-Q*G-le*j;var ae=E[4],be=E[5],he=E[6],Te=E[7];return I[4]=ae*$+Te*H+be*j-he*G,I[5]=be*$+Te*G+he*H-ae*j,I[6]=he*$+Te*j+ae*G-be*H,I[7]=Te*$-ae*H-be*G-he*j,I},si.add=function(I,E,M){return I[0]=E[0]+M[0],I[1]=E[1]+M[1],I[2]=E[2]+M[2],I[3]=E[3]+M[3],I[4]=E[4]+M[4],I[5]=E[5]+M[5],I[6]=E[6]+M[6],I[7]=E[7]+M[7],I},si.multiply=w,si.scale=function(I,E,M){return I[0]=E[0]*M,I[1]=E[1]*M,I[2]=E[2]*M,I[3]=E[3]*M,I[4]=E[4]*M,I[5]=E[5]*M,I[6]=E[6]*M,I[7]=E[7]*M,I},si.lerp=function(I,E,M,z){var B=1-z;return A(E,M)<0&&(z=-z),I[0]=E[0]*B+M[0]*z,I[1]=E[1]*B+M[1]*z,I[2]=E[2]*B+M[2]*z,I[3]=E[3]*B+M[3]*z,I[4]=E[4]*B+M[4]*z,I[5]=E[5]*B+M[5]*z,I[6]=E[6]*B+M[6]*z,I[7]=E[7]*B+M[7]*z,I},si.invert=function(I,E){var M=T(E);return I[0]=-E[0]/M,I[1]=-E[1]/M,I[2]=-E[2]/M,I[3]=E[3]/M,I[4]=-E[4]/M,I[5]=-E[5]/M,I[6]=-E[6]/M,I[7]=E[7]/M,I},si.conjugate=function(I,E){return I[0]=-E[0],I[1]=-E[1],I[2]=-E[2],I[3]=E[3],I[4]=-E[4],I[5]=-E[5],I[6]=-E[6],I[7]=E[7],I},si.normalize=function(I,E){var M=T(E);if(M>0){M=Math.sqrt(M);var z=E[0]/M,B=E[1]/M,N=E[2]/M,H=E[3]/M,G=E[4],j=E[5],$=E[6],W=E[7],Q=z*G+B*j+N*$+H*W;I[0]=z,I[1]=B,I[2]=N,I[3]=H,I[4]=(G-z*Q)/M,I[5]=(j-B*Q)/M,I[6]=($-N*Q)/M,I[7]=(W-H*Q)/M}return I},si.str=function(I){return"quat2("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+")"},si.exactEquals=function(I,E){return I[0]===E[0]&&I[1]===E[1]&&I[2]===E[2]&&I[3]===E[3]&&I[4]===E[4]&&I[5]===E[5]&&I[6]===E[6]&&I[7]===E[7]},si.equals=function(I,E){var M=I[0],z=I[1],B=I[2],N=I[3],H=I[4],G=I[5],j=I[6],$=I[7],W=E[0],Q=E[1],le=E[2],se=E[3],ae=E[4],be=E[5],he=E[6],Te=E[7];return Math.abs(M-W)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(W))&&Math.abs(z-Q)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(Q))&&Math.abs(B-le)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(le))&&Math.abs(N-se)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(se))&&Math.abs(H-ae)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(ae))&&Math.abs(G-be)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(be))&&Math.abs(j-he)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(he))&&Math.abs($-Te)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(Te))},si.sqrLen=si.squaredLength=si.len=si.length=si.dot=si.mul=si.setReal=si.getReal=void 0;var e=l(gt()),i=l(ri()),a=l(oi());function c(I){if(typeof WeakMap!="function")return null;var E=new WeakMap,M=new WeakMap;return(c=function(z){return z?M:E})(I)}function l(I,E){if(I&&I.__esModule)return I;if(I===null||r(I)!=="object"&&typeof I!="function")return{default:I};var M=c(E);if(M&&M.has(I))return M.get(I);var z={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var N in I)if(N!=="default"&&Object.prototype.hasOwnProperty.call(I,N)){var H=B?Object.getOwnPropertyDescriptor(I,N):null;H&&(H.get||H.set)?Object.defineProperty(z,N,H):z[N]=I[N]}return z.default=I,M&&M.set(I,z),z}function d(I,E,M){var z=.5*M[0],B=.5*M[1],N=.5*M[2],H=E[0],G=E[1],j=E[2],$=E[3];return I[0]=H,I[1]=G,I[2]=j,I[3]=$,I[4]=z*$+B*j-N*G,I[5]=B*$+N*H-z*j,I[6]=N*$+z*G-B*H,I[7]=-z*H-B*G-N*j,I}function y(I,E){return I[0]=E[0],I[1]=E[1],I[2]=E[2],I[3]=E[3],I[4]=E[4],I[5]=E[5],I[6]=E[6],I[7]=E[7],I}function w(I,E,M){var z=E[0],B=E[1],N=E[2],H=E[3],G=M[4],j=M[5],$=M[6],W=M[7],Q=E[4],le=E[5],se=E[6],ae=E[7],be=M[0],he=M[1],Te=M[2],Ie=M[3];return I[0]=z*Ie+H*be+B*Te-N*he,I[1]=B*Ie+H*he+N*be-z*Te,I[2]=N*Ie+H*Te+z*he-B*be,I[3]=H*Ie-z*be-B*he-N*Te,I[4]=z*W+H*G+B*$-N*j+Q*Ie+ae*be+le*Te-se*he,I[5]=B*W+H*j+N*G-z*$+le*Ie+ae*he+se*be-Q*Te,I[6]=N*W+H*$+z*j-B*G+se*Ie+ae*Te+Q*he-le*be,I[7]=H*W-z*G-B*j-N*$+ae*Ie-Q*be-le*he-se*Te,I}si.getReal=i.copy,si.setReal=i.copy,si.mul=w;var A=i.dot;si.dot=A;var _=i.length;si.length=_,si.len=_;var T=i.squaredLength;return si.squaredLength=T,si.sqrLen=T,si}var Ft,_i,Tt={};function Fi(){if(Ft)return Tt;function r(E){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},r(E)}Ft=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.create=a,Tt.clone=function(E){var M=new e.ARRAY_TYPE(2);return M[0]=E[0],M[1]=E[1],M},Tt.fromValues=function(E,M){var z=new e.ARRAY_TYPE(2);return z[0]=E,z[1]=M,z},Tt.copy=function(E,M){return E[0]=M[0],E[1]=M[1],E},Tt.set=function(E,M,z){return E[0]=M,E[1]=z,E},Tt.add=function(E,M,z){return E[0]=M[0]+z[0],E[1]=M[1]+z[1],E},Tt.subtract=c,Tt.multiply=l,Tt.divide=d,Tt.ceil=function(E,M){return E[0]=Math.ceil(M[0]),E[1]=Math.ceil(M[1]),E},Tt.floor=function(E,M){return E[0]=Math.floor(M[0]),E[1]=Math.floor(M[1]),E},Tt.min=function(E,M,z){return E[0]=Math.min(M[0],z[0]),E[1]=Math.min(M[1],z[1]),E},Tt.max=function(E,M,z){return E[0]=Math.max(M[0],z[0]),E[1]=Math.max(M[1],z[1]),E},Tt.round=function(E,M){return E[0]=Math.round(M[0]),E[1]=Math.round(M[1]),E},Tt.scale=function(E,M,z){return E[0]=M[0]*z,E[1]=M[1]*z,E},Tt.scaleAndAdd=function(E,M,z,B){return E[0]=M[0]+z[0]*B,E[1]=M[1]+z[1]*B,E},Tt.distance=y,Tt.squaredDistance=w,Tt.length=A,Tt.squaredLength=_,Tt.negate=function(E,M){return E[0]=-M[0],E[1]=-M[1],E},Tt.inverse=function(E,M){return E[0]=1/M[0],E[1]=1/M[1],E},Tt.normalize=function(E,M){var z=M[0],B=M[1],N=z*z+B*B;return N>0&&(N=1/Math.sqrt(N)),E[0]=M[0]*N,E[1]=M[1]*N,E},Tt.dot=function(E,M){return E[0]*M[0]+E[1]*M[1]},Tt.cross=function(E,M,z){var B=M[0]*z[1]-M[1]*z[0];return E[0]=E[1]=0,E[2]=B,E},Tt.lerp=function(E,M,z,B){var N=M[0],H=M[1];return E[0]=N+B*(z[0]-N),E[1]=H+B*(z[1]-H),E},Tt.random=function(E,M){M=M||1;var z=2*e.RANDOM()*Math.PI;return E[0]=Math.cos(z)*M,E[1]=Math.sin(z)*M,E},Tt.transformMat2=function(E,M,z){var B=M[0],N=M[1];return E[0]=z[0]*B+z[2]*N,E[1]=z[1]*B+z[3]*N,E},Tt.transformMat2d=function(E,M,z){var B=M[0],N=M[1];return E[0]=z[0]*B+z[2]*N+z[4],E[1]=z[1]*B+z[3]*N+z[5],E},Tt.transformMat3=function(E,M,z){var B=M[0],N=M[1];return E[0]=z[0]*B+z[3]*N+z[6],E[1]=z[1]*B+z[4]*N+z[7],E},Tt.transformMat4=function(E,M,z){var B=M[0],N=M[1];return E[0]=z[0]*B+z[4]*N+z[12],E[1]=z[1]*B+z[5]*N+z[13],E},Tt.rotate=function(E,M,z,B){var N=M[0]-z[0],H=M[1]-z[1],G=Math.sin(B),j=Math.cos(B);return E[0]=N*j-H*G+z[0],E[1]=N*G+H*j+z[1],E},Tt.angle=function(E,M){var z=E[0],B=E[1],N=M[0],H=M[1],G=Math.sqrt(z*z+B*B)*Math.sqrt(N*N+H*H);return Math.acos(Math.min(Math.max(G&&(z*N+B*H)/G,-1),1))},Tt.zero=function(E){return E[0]=0,E[1]=0,E},Tt.str=function(E){return"vec2("+E[0]+", "+E[1]+")"},Tt.exactEquals=function(E,M){return E[0]===M[0]&&E[1]===M[1]},Tt.equals=function(E,M){var z=E[0],B=E[1],N=M[0],H=M[1];return Math.abs(z-N)<=e.EPSILON*Math.max(1,Math.abs(z),Math.abs(N))&&Math.abs(B-H)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(H))},Tt.forEach=Tt.sqrLen=Tt.sqrDist=Tt.dist=Tt.div=Tt.mul=Tt.sub=Tt.len=void 0;var e=function(E,M){if(E&&E.__esModule)return E;if(E===null||r(E)!=="object"&&typeof E!="function")return{default:E};var z=i(void 0);if(z&&z.has(E))return z.get(E);var B={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in E)if(H!=="default"&&Object.prototype.hasOwnProperty.call(E,H)){var G=N?Object.getOwnPropertyDescriptor(E,H):null;G&&(G.get||G.set)?Object.defineProperty(B,H,G):B[H]=E[H]}return B.default=E,z&&z.set(E,B),B}(gt());function i(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,z=new WeakMap;return(i=function(B){return B?z:M})(E)}function a(){var E=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0),E}function c(E,M,z){return E[0]=M[0]-z[0],E[1]=M[1]-z[1],E}function l(E,M,z){return E[0]=M[0]*z[0],E[1]=M[1]*z[1],E}function d(E,M,z){return E[0]=M[0]/z[0],E[1]=M[1]/z[1],E}function y(E,M){return Math.hypot(M[0]-E[0],M[1]-E[1])}function w(E,M){var z=M[0]-E[0],B=M[1]-E[1];return z*z+B*B}function A(E){return Math.hypot(E[0],E[1])}function _(E){var M=E[0],z=E[1];return M*M+z*z}Tt.len=A,Tt.sub=c,Tt.mul=l,Tt.div=d,Tt.dist=y,Tt.sqrDist=w,Tt.sqrLen=_;var T,I=(T=a(),function(E,M,z,B,N,H){var G,j;for(M||(M=2),z||(z=0),j=B?Math.min(B*M+z,E.length):E.length,G=z;G<j;G+=M)T[0]=E[G],T[1]=E[G+1],N(T,T,H),E[G]=T[0],E[G+1]=T[1];return E});return Tt.forEach=I,Tt}function wn(){if(_i)return He;function r(E){return r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},r(E)}_i=1,Object.defineProperty(He,"__esModule",{value:!0}),He.vec4=He.vec3=He.vec2=He.quat2=He.quat=He.mat4=He.mat3=He.mat2d=He.mat2=He.glMatrix=void 0;var e=I(gt());He.glMatrix=e;var i=I(hi());He.mat2=i;var a=I(ni());He.mat2d=a;var c=I(kt());He.mat3=c;var l=I(oi());He.mat4=l;var d=I(ri());He.quat=d;var y=I(Ze());He.quat2=y;var w=I(Fi());He.vec2=w;var A=I(Vn());He.vec3=A;var _=I(bt());function T(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,z=new WeakMap;return(T=function(B){return B?z:M})(E)}function I(E,M){if(E&&E.__esModule)return E;if(E===null||r(E)!=="object"&&typeof E!="function")return{default:E};var z=T(M);if(z&&z.has(E))return z.get(E);var B={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var H in E)if(H!=="default"&&Object.prototype.hasOwnProperty.call(E,H)){var G=N?Object.getOwnPropertyDescriptor(E,H):null;G&&(G.get||G.set)?Object.defineProperty(B,H,G):B[H]=E[H]}return B.default=E,z&&z.set(E,B),B}return He.vec4=_,He}var Li,lr,qn,Ws,ue=wn(),Ha=function(){if(lr)return Li;function r(e,i,a,c){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=a,this.p2y=c}return lr=1,Li=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,c=0;c<8;c++){var l=this.sampleCurveX(a)-e;if(Math.abs(l)<i)return a;var d=this.sampleCurveDerivativeX(a);if(Math.abs(d)<1e-6)break;a-=l/d}var y=0,w=1;for(a=e,c=0;c<20&&(l=this.sampleCurveX(a),!(Math.abs(l-e)<i));c++)e>l?y=a:w=a,a=.5*(w-y)+y;return a},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Li}(),Za=pe(Ha);function $a(){if(Ws)return qn;function r(e,i){this.x=e,this.y=i}return Ws=1,qn=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,a=e.y-this.y;return i*i+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),a=Math.sin(e),c=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=c,this},_rotateAround:function(e,i){var a=Math.cos(e),c=Math.sin(e),l=i.y+c*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-c*(this.y-i.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(e){return e instanceof r?e:Array.isArray(e)?new r(e[0],e[1]):e},qn}var Mt=pe($a());function Aa(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!Aa(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!Aa(r[i],e[i]))return!1;return!0}return r===e}const Es=Math.PI/180,jr=180/Math.PI;function Gi(r){return r*Es}function Er(r){return r*jr}const Ma=[[0,0],[1,0],[1,1],[0,1]];function Xa(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function _o(r,e,i,a){const c=new Za(r,e,i,a);return function(l){return c.solve(l)}}const kl=_o(.25,.1,.25,1);function Di(r,e,i){return Math.min(i,Math.max(e,r))}function As(r,e,i){return(i=Di((i-r)/(e-r),0,1))*i*(3-2*i)}function aa(r,e,i){const a=i-e,c=((r-e)%a+a)%a+e;return c===e?i:c}function qr(r,e,i){if(!r.length)return i(null,[]);let a=r.length;const c=new Array(r.length);let l=null;r.forEach((d,y)=>{e(d,(w,A)=>{w&&(l=w),c[y]=A,--a==0&&i(l,c)})})}function fr(r,...e){for(const i of e)for(const a in i)r[a]=i[a];return r}let Ar=1;function Wa(){return Ar++}function Ru(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Du(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Ya(r,e,i){const a={};for(const c in r)a[c]=e.call(this,r[c],c,r);return a}function Ka(r,e,i){const a={};for(const c in r)e.call(this,r[c],c,r)&&(a[c]=r[c]);return a}function Gr(r){return Array.isArray(r)?r.map(Gr):typeof r=="object"&&r?Ya(r,Gr):r}const go={};function Pn(r){go[r]||(typeof console<"u"&&console.warn(r),go[r]=!0)}function bn(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function Vc(r){let e=0;for(let i,a,c=0,l=r.length,d=l-1;c<l;d=c++)i=r[c],a=r[d],e+=(a.x-i.x)*(i.y+a.y);return e}function Bl([r,e,i]){const a=Gi(e+90),c=Gi(i);return{x:r*Math.cos(a)*Math.sin(c),y:r*Math.sin(a)*Math.sin(c),z:r*Math.cos(c),azimuthal:e,polar:i}}function rs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ia(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,c,l)=>{const d=c||l;return e[a]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let zu=null;function Nl(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Pu(r,e,i,a){for(;e<i;){const c=e+i>>1;r[c]<a?e=c+1:i=c}return e}function jc(r,e,i,a){for(;e<i;){const c=e+i>>1;r[c]<=a?e=c+1:i=c}return e}function Fl(r){return r>0?1/(1.001-r):1+r}function Ye(r){return r>0?1-1/(1.001-r):-r}const te={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!te.API_URL)return null;try{const r=new URL(te.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ie(r){return te.API_URL_REGEX.test(r)}function me(r){return te.API_SPRITE_REGEX.test(r)}let Se,Ee,Re,qe,Pe,$e;function Je(){return Se==null&&(Se=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Se}const We={now:()=>qe!==void 0?qe:performance.now(),setNow(r){qe=r},restoreNow(){qe=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:a}=r;Pe||(Pe=document.createElement("canvas"));const c=Pe.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Pe.width||a>Pe.height)&&(Pe.width=i,Pe.height=a),c.clearRect(-e,-e,i+2*e,a+2*e),c.drawImage(r,0,0,i,a),c.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:r=>(Ee||(Ee=document.createElement("a")),Ee.href=r,Ee.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Re==null&&(Re=window.matchMedia("(prefers-reduced-motion: reduce)")),Re.matches)},hasCanvasFingerprintNoise(){if($e!==void 0)return $e;if(!Je())return $e=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let c=0;c<r.width;++c)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(c,0,1,1);const a=e.getImageData(0,0,r.width,r.height);i=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&i++!==a.data[c])return $e=!0,!0;return $e=!1,!1}};function pt(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(r.slice(i));for(const c in e)a.set(c,e[c]);return`${r.slice(0,i)}?${a.toString()}`}function Ct(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const a=new URLSearchParams,c=new URLSearchParams(r.slice(i));for(const d of e.persistentParams){const y=c.get(d);y&&a.set(d,y)}const l=a.toString();return`${r.slice(0,i)}${l.length>0?`?${l}`:""}`}const Pt="mapbox-tiles";let fi=500,ai=50;const Ti=["language","worldview","jobid"];let Ai,gn;function Cn(){try{return caches}catch{}}function ki(){const r=Cn();r&&Ai==null&&(Ai=r.open(Pt))}let cn=1/0;const un={supported:!1,testSupport:function(r){!pr&&Gn&&(ir?ss(r):mn=r)}};let mn,Gn,pr=!1,ir=!1;const Us=typeof self<"u"?self:{};function ss(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Gn),r.isContextLost())return;un.supported=!0}catch{}r.deleteTexture(e),pr=!0}Us.document&&(Gn=Us.document.createElement("img"),Gn.onload=function(){mn&&ss(mn),mn=null,ir=!0},Gn.onerror=function(){pr=!0,mn=null},Gn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const nr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(nr);class Mr extends Error{constructor(e,i,a){i===401&&ie(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Go=rs()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,oa=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(Go())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){const l=new AbortController,d=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Go(),referrerPolicy:a.referrerPolicy,signal:l.signal});let y=!1,w=!1;const A=(_=d.url).indexOf("sku=")>0&&ie(_);var _;a.type==="json"&&d.headers.set("Accept","application/json");const T=(E,M,z)=>{if(w)return;if(E&&E.message!=="SecurityError"&&Pn(E.toString()),M&&z)return I(M);const B=Date.now();fetch(d).then(N=>{if(N.ok){const H=A?N.clone():null;return I(N,H,B)}return c(new Mr(N.statusText,N.status,a.url))}).catch(N=>{N.name!=="AbortError"&&c(new Error(`${N.message} ${a.url}`))})},I=(E,M,z)=>{(a.type==="arrayBuffer"?E.arrayBuffer():a.type==="json"?E.json():E.text()).then(B=>{w||(M&&z&&function(N,H,G){if(ki(),Ai==null)return;const j=Ia(H.headers.get("Cache-Control")||"");if(j["no-store"])return;const $={status:H.status,statusText:H.statusText,headers:new Headers};H.headers.forEach((le,se)=>$.headers.set(se,le)),j["max-age"]&&$.headers.set("Expires",new Date(G+1e3*j["max-age"]).toUTCString());const W=$.headers.get("Expires");if(!W||new Date(W).getTime()-G<42e4)return;let Q=Ct(N.url,{persistentParams:Ti});if(H.status===206){const le=N.headers.get("Range");if(!le)return;$.status=200,Q=pt(Q,{range:le})}(function(le,se){if(gn===void 0)try{new Response(new ReadableStream),gn=!0}catch{gn=!1}gn?se(le.body):le.blob().then(se)})(H,le=>{const se=new Response((ae=H.status)!==200&&ae!==404&&[101,103,204,205,304].includes(ae)?null:le,$);var ae;ki(),Ai!=null&&Ai.then(be=>be.put(Q,se)).catch(be=>Pn(be.message))})}(d,M,z),y=!0,c(null,B,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(B=>{w||c(new Error(B.message))})};return A?function(E,M){if(ki(),Ai==null)return M(null);Ai.then(z=>{let B=Ct(E.url,{persistentParams:Ti});const N=E.headers.get("Range");N&&(B=pt(B,{range:N})),z.match(B).then(H=>{const G=function(j){if(!j)return!1;const $=new Date(j.headers.get("Expires")||0),W=Ia(j.headers.get("Cache-Control")||"");return $>Date.now()&&!W["no-cache"]}(H);z.delete(B),G&&z.put(B,H.clone()),M(null,H,G)}).catch(M)}).catch(M)}(d,T):T(null,null),{cancel:()=>{w=!0,y||l.abort()}}}(r,e);if(rs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(a,c){const l=new XMLHttpRequest;l.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const d in a.headers)l.setRequestHeader(d,a.headers[d]);return a.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=a.credentials==="include",l.onerror=()=>{c(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let d=l.response;if(a.type==="json")try{d=JSON.parse(l.response)}catch(y){return c(y)}c(null,d,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else c(new Mr(l.statusText,l.status,a.url))},l.send(a.body),{cancel:()=>l.abort()}}(r,e)},Ca=function(r,e){return oa(fr(r,{type:"arrayBuffer"}),e)};function Vs(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const Ou="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Lu,yo;Lu=[],yo=0;const Nh=function(r,e){if(un.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),yo>=te.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Lu.push(l),l}yo++;let i=!1;const a=()=>{if(!i)for(i=!0,yo--;Lu.length&&yo<te.MAX_PARALLEL_IMAGE_REQUESTS;){const l=Lu.shift(),{requestParameters:d,callback:y,cancelled:w}=l;w||(l.cancel=Nh(d,y).cancel)}},c=Ca(r,(l,d,y,w)=>{a(),l?e(l):d&&(self.createImageBitmap?function(A,_){const T=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(T).then(I=>{_(null,I)}).catch(I=>{_(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(A,_)=>e(A,_,y,w)):function(A,_){const T=new Image;T.onload=()=>{_(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=Ou})},T.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(A)],{type:"image/png"});T.src=A.byteLength?URL.createObjectURL(I):Ou}(d,(A,_)=>e(A,_,y,w)))});return{cancel:()=>{c.cancel(),a()}}};var ku,pp,js,Ho={exports:{}},qs={exports:{}},Ys={exports:{}},Ks=function(){if(js)return Ho.exports;js=1;var r=(ku||(ku=1,qs.exports=function(i,a){var c,l,d,y,w,A,_,T;for(l=i.length-(c=3&i.length),d=a,w=3432918353,A=461845907,T=0;T<l;)_=255&i.charCodeAt(T)|(255&i.charCodeAt(++T))<<8|(255&i.charCodeAt(++T))<<16|(255&i.charCodeAt(++T))<<24,++T,d=27492+(65535&(y=5*(65535&(d=(d^=_=(65535&(_=(_=(65535&_)*w+(((_>>>16)*w&65535)<<16)&4294967295)<<15|_>>>17))*A+(((_>>>16)*A&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(_=0,c){case 3:_^=(255&i.charCodeAt(T+2))<<16;case 2:_^=(255&i.charCodeAt(T+1))<<8;case 1:d^=_=(65535&(_=(_=(65535&(_^=255&i.charCodeAt(T)))*w+(((_>>>16)*w&65535)<<16)&4294967295)<<15|_>>>17))*A+(((_>>>16)*A&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}),qs.exports),e=(pp||(pp=1,Ys.exports=function(i,a){for(var c,l=i.length,d=a^l,y=0;l>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),l-=4,++y;switch(l){case 3:d^=(255&i.charCodeAt(y+2))<<16;case 2:d^=(255&i.charCodeAt(y+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(y)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}),Ys.exports);return Ho.exports=r,Ho.exports.murmur3=r,Ho.exports.murmur2=e,Ho.exports}(),Gs=pe(Ks);class Ms{constructor(e,...i){fr(this,i[0]||{}),this.type=e}}class Ra extends Ms{constructor(e,i={}){super("error",fr({error:e},i))}}function uf(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function Bu(r,e,i){if(i&&i[r]){const a=i[r].indexOf(e);a!==-1&&i[r].splice(a,1)}}class la{on(e,i){return this._listeners=this._listeners||{},uf(e,i,this._listeners),this}off(e,i){return Bu(e,i,this._listeners),Bu(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},uf(e,i,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,i){const a=typeof e=="string"?new Ms(e,i):e,c=a.type;if(this.listens(c)){a.target=this;const l=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of l)w.call(this,a);const d=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of d)Bu(c,w,this._oneTimeListeners),w.call(this,a);const y=this._eventedParent;y&&(fr(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(a))}else a instanceof Ra&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class as{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new as(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,a]=e.split("");return new as({name:i,iconsetId:a})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return as.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var mp,hf={},Is=function(){if(mp)return hf;mp=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(l){return(l=Math.round(l))<0?0:l>255?255:l}function i(l){return e(l[l.length-1]==="%"?parseFloat(l)/100*255:parseInt(l))}function a(l){return(d=l[l.length-1]==="%"?parseFloat(l)/100:parseFloat(l))<0?0:d>1?1:d;var d}function c(l,d,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?l+(d-l)*y*6:2*y<1?d:3*y<2?l+(d-l)*(2/3-y)*6:l}try{hf.parseCSSColor=function(l){var d,y=l.replace(/ /g,"").toLowerCase();if(y in r)return r[y].slice();if(y[0]==="#")return y.length===4?(d=parseInt(y.substr(1),16))>=0&&d<=4095?[(3840&d)>>4|(3840&d)>>8,240&d|(240&d)>>4,15&d|(15&d)<<4,1]:null:y.length===7&&(d=parseInt(y.substr(1),16))>=0&&d<=16777215?[(16711680&d)>>16,(65280&d)>>8,255&d,1]:null;var w=y.indexOf("("),A=y.indexOf(")");if(w!==-1&&A+1===y.length){var _=y.substr(0,w),T=y.substr(w+1,A-(w+1)).split(","),I=1;switch(_){case"rgba":if(T.length!==4)return null;I=a(T.pop());case"rgb":return T.length!==3?null:[i(T[0]),i(T[1]),i(T[2]),I];case"hsla":if(T.length!==4)return null;I=a(T.pop());case"hsl":if(T.length!==3)return null;var E=(parseFloat(T[0])%360+360)%360/360,M=a(T[1]),z=a(T[2]),B=z<=.5?z*(M+1):z+M-z*M,N=2*z-B;return[e(255*c(N,B,E+1/3)),e(255*c(N,B,E)),e(255*c(N,B,E-1/3)),I];default:return null}}return null}}catch{}return hf}();class on{constructor(e,i,a,c=1){this.r=e,this.g=i,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof on)return e;if(typeof e!="string")return;const i=Is.parseCSSColor(e);return i?new on(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,a,c]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(a)},${c})`}toString(){const[e,i,a,c]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*a)},${c})`}toRenderColor(e){const{r:i,g:a,b:c,a:l}=this;return new Nu(e,i,a,c,l)}clone(){return new on(this.r,this.g,this.b,this.a)}}class Nu{constructor(e,i,a,c,l){if(e){const d=e.image.height,y=d*d;i=l===0?0:i/l*(d-1),a=l===0?0:a/l*(d-1),c=l===0?0:c/l*(d-1);const w=Math.floor(i),A=Math.floor(a),_=Math.floor(c),T=Math.ceil(i),I=Math.ceil(a),E=Math.ceil(c),M=i-w,z=a-A,B=c-_,N=e.image.data,H=4*(w+A*y+_*d),G=4*(w+A*y+E*d),j=4*(w+I*y+_*d),$=4*(w+I*y+E*d),W=4*(T+A*y+_*d),Q=4*(T+A*y+E*d),le=4*(T+I*y+_*d),se=4*(T+I*y+E*d);if(H<0||se>=N.length)throw new Error("out of range");this.r=Kt(Kt(Kt(N[H],N[G],B),Kt(N[j],N[$],B),z),Kt(Kt(N[W],N[Q],B),Kt(N[le],N[se],B),z),M)/255*l,this.g=Kt(Kt(Kt(N[H+1],N[G+1],B),Kt(N[j+1],N[$+1],B),z),Kt(Kt(N[W+1],N[Q+1],B),Kt(N[le+1],N[se+1],B),z),M)/255*l,this.b=Kt(Kt(Kt(N[H+2],N[G+2],B),Kt(N[j+2],N[$+2],B),z),Kt(Kt(N[W+2],N[Q+2],B),Kt(N[le+2],N[se+2],B),z),M)/255*l,this.a=l}else this.r=i,this.g=a,this.b=c,this.a=l}toArray(){const{r:e,g:i,b:a,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*a/c,c]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:a,a:c}=this,l=Math.min(Math.max(e/c,0),1),d=Math.min(Math.max(i/c,0),1),y=Math.min(Math.max(a/c,0),1),w=Math.min(l,d,y),A=Math.max(l,d,y),_=(w+A)/2;if(w===A)return[0,0,100*_,c];const T=A-w,I=_>.5?T/(2-A-w):T/(A+w);let E=0;return A===l?E=(d-y)/T+(d<y?6:0):A===d?E=(y-l)/T+2:A===y&&(E=(l-d)/T+4),E*=60,[Math.min(Math.max(E,0),360),Math.min(Math.max(100*I,0),100),Math.min(Math.max(100*_,0),100),c]}toArray01(){const{r:e,g:i,b:a,a:c}=this;return c===0?[0,0,0,0]:[e/c,i/c,a/c,c]}toArray01Scaled(e){const{r:i,g:a,b:c,a:l}=this;return l===0?[0,0,0]:[i/l*e,a/l*e,c/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:a,a:c}=this;return[e,i,a,c]}toArray01Linear(){const{r:e,g:i,b:a,a:c}=this;return c===0?[0,0,0,0]:[Math.pow(e/c,2.2),Math.pow(i/c,2.2),Math.pow(a/c,2.2),c]}}function Kt(r,e,i){return r*(1-i)+e*i}function Ul(r,e,i){return r.map((a,c)=>Kt(a,e[c],i))}function df(r){return r*r*r*r*r}on.black=new on(0,0,0,1),on.white=new on(1,1,1,1),on.transparent=new on(0,0,0,0),on.red=new on(1,0,0,1),on.blue=new on(0,0,1,1);var Vl=Object.freeze({__proto__:null,array:Ul,color:function(r,e,i){return new on(Kt(r.r,e.r,i),Kt(r.g,e.g,i),Kt(r.b,e.b,i),Kt(r.a,e.a,i))},easeIn:df,number:Kt});function Hi(r,...e){for(const i of e)for(const a in i)r[a]=i[a];return r}class ps extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class ca{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,c]of i)this.bindings[a]=c}concat(e){return new ca(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Zo={kind:"null"},Ut={kind:"number"},Zi={kind:"string"},Ki={kind:"boolean"},Lr={kind:"color"},jl={kind:"object"},Ji={kind:"value"},ua={kind:"collator"},qc={kind:"formatted"},xr={kind:"resolvedImage"};function cr(r,e){return{kind:"array",itemType:r,N:e}}function Hn(r){if(r.kind==="array"){const e=Hn(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Cs=[Zo,Ut,Zi,Ki,Lr,qc,jl,cr(Ji),xr];function Gc(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Gc(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of Cs)if(!Gc(i,e))return null}}return`Expected ${Hn(r)} but found ${Hn(e)} instead.`}function Fu(r,e){return e.some(i=>i.kind===r.kind)}function $o(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}class Xo{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wo{constructor(e,i,a,c,l){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=c,this.textColor=l}}class Kr{constructor(e){this.sections=e}static fromString(e){return new Kr([new Wo(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Kr?e:Kr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const c=i.image.getPrimary().id.toString();e.push(["image",c]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class Ja{constructor(e,i={}){if(this.id=as.from(e),this.options=Object.assign({},i),i.transform){const{a,b:c,c:l,d,e:y,f:w}=i.transform;this.options.transform=new DOMMatrix([a,c,l,d,y,w])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:a,d:c,e:l,f:d}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:a,d:c,e:l,f:d}})}static parse(e){let i,a,c,l;try{({name:i,iconsetId:a,params:c,transform:l}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:d,b:y,c:w,d:A,e:_,f:T}=l||{};return new Ja({name:i,iconsetId:a},{params:c,transform:new DOMMatrix([d,y,w,A,_,T])})}scaleSelf(e){return this.options.transform.scaleSelf(e),this}}class os{constructor(e,i,a,c,l=!1){this.primaryId=as.from(e),this.primaryOptions=i,a&&(this.secondaryId=as.from(a)),this.secondaryOptions=c,this.available=l}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ja(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ja(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?os.build({name:e}):e}static build(e,i,a,c){return!e||typeof e=="object"&&!("name"in e)?null:new os(e,a,i,c)}}function Uu(r,e,i,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,i,a]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Js(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof on||r instanceof Xo||r instanceof Kr||r instanceof os)return!0;if(Array.isArray(r)){for(const e of r)if(!Js(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Js(r[e]))return!1;return!0}return!1}function mr(r){if(r===null)return Zo;if(typeof r=="string")return Zi;if(typeof r=="boolean")return Ki;if(typeof r=="number")return Ut;if(r instanceof on)return Lr;if(r instanceof Xo)return ua;if(r instanceof Kr)return qc;if(r instanceof os)return xr;if(Array.isArray(r)){const e=r.length;let i;for(const a of r){const c=mr(a);if(i){if(i===c)continue;i=Ji;break}i=c}return cr(i||Ji,e)}return jl}function kr(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof on?r.toStringPremultipliedAlpha():r instanceof Kr||r instanceof os?r.toString():JSON.stringify(r)}class vo{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Js(e[1]))return i.error("invalid value");const a=e[1];let c=mr(a);const l=i.expectedType;return c.kind!=="array"||c.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(c=l),new vo(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof on?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Kr?this.value.serialize():this.value}}class rr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ff={string:Zi,number:Ut,boolean:Ki,object:jl};class Hs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,c=1;const l=e[0];if(l==="array"){let y,w;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in ff)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=ff[A],c++}else y=Ji;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],c++}a=cr(y,w)}else a=ff[l];const d=[];for(;c<e.length;c++){const y=i.parse(e[c],c,Ji);if(!y)return null;d.push(y)}return new Hs(a,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!Gc(this.type,mr(a)))return a;if(i===this.args.length-1)throw new rr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Hn(mr(a))} but was expected to be of type ${Hn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(a=>a.serialize()))}}class Hc{constructor(e){this.type=qc,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const c=[];let l=!1;for(let d=1;d<=e.length-1;++d){const y=e[d];if(l&&typeof y=="object"&&!Array.isArray(y)){l=!1;let w=null;if(y["font-scale"]&&(w=i.parseObjectValue(y["font-scale"],d,"font-scale",Ut),!w))return null;let A=null;if(y["text-font"]&&(A=i.parseObjectValue(y["text-font"],d,"text-font",cr(Zi)),!A))return null;let _=null;if(y["text-color"]&&(_=i.parseObjectValue(y["text-color"],d,"text-color",Lr),!_))return null;const T=c[c.length-1];T.scale=w,T.font=A,T.textColor=_}else{const w=i.parse(e[d],d,Ji);if(!w)return null;const A=w.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,c.push({content:w,scale:null,font:null,textColor:null})}}return new Hc(c)}evaluate(e){return new Kr(this.sections.map(i=>{const a=i.content.evaluate(e);return mr(a)===xr?new Wo("",a,null,null,null):new Wo(kr(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class Yo{constructor(e,i,a,c){this._imageWarnHistory={},this.type=xr,this.namePrimary=e,this.nameSecondary=i,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),c&&(this.paramsSecondary=c.params,this.iconsetIdSecondary=c.iconset?c.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=1;const c=[];function l(){if(a<e.length){const y=i.parse(e[a],a++,Zi);return y?(c.push({image:y,options:{}}),!0):(i.error(c.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function d(){if(a<e.length){const w=e[a];if((y=w)===null||typeof y!="object"||Array.isArray(y))return!0;const A=w.params,_=w.iconset,T=i.concat(a);if(!A&&!_)return a++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return T.error('Image options "params" should be an object'),!1;const I={},E=T.concat(void 0,"params");for(const M in A){if(!M)return E.error("Image parameter name should be non-empty"),!1;const z=E.concat(void 0,M).parse(A[M],void 0,Lr,void 0,{typeAnnotation:"coerce"});if(!z)return!1;I[M]=z}c[c.length-1].options.params=I}if(_){if(typeof _!="object"||_.constructor!==Object)return T.error('Image options "iconset" should be an object'),!1;if(!_.id)return T.error('Image options "iconset" should have an "id" property'),!1;c[c.length-1].options.iconset=_}return a++,!0}var y;return!0}for(let y=0;y<2;y++)if(!l()||!d())return;return new Yo(c[0].image,c[1]?c[1].image:void 0,c[0].options,c[1]?c[1].options:void 0)}evaluateParams(e,i){const a={};if(i){for(const c in i)if(i[c])try{a[c]=i[c].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,c=os.build(i,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(c&&e.availableImages){const l=c.getPrimary().id;if(c.available=e.availableImages.some(d=>as.isEqual(d,l)),c.available){const d=c.getSecondary()?c.getSecondary().id:null;d&&(c.available=e.availableImages.some(y=>as.isEqual(y,d)))}}return c}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const a={};if(i&&(a.iconset={id:i}),e){a.params={};for(const c in e)e[c]&&(a.params[c]=e[c].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function xo(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}const $m={"to-boolean":Ki,"to-color":Lr,"to-number":Ut,"to-string":Zi};class Da{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],c=[];let l=Zo;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);l=cr(i.expectedType.itemType,d)}else{if(!(d>0&&Js(e[1][0])))return null;l=cr(mr(e[1][0]),d)}for(let y=0;y<d;y++){const w=e[1][y];let A;if(xo(w)==="array")A=i.parse(w,void 0,l.itemType);else{const _=xo(w);if(_!==l.itemType.kind)return i.error(`Expected ${l.itemType.kind} but found ${_}.`);A=i.registry.literal.parse(["literal",w===void 0?null:w],i)}if(!A)return null;c.push(A)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");l=$m[a];for(let d=1;d<e.length;d++){const y=i.parse(e[d],d,Ji);if(!y)return null;c.push(y)}}return new Da(l,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const c of this.args){if(i=c.evaluate(e),a=null,i instanceof on)return i;if(typeof i=="string"){const l=e.parseColor(i);if(l)return l}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Uu(i[0],i[1],i[2],i[3]),!a))return new on(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new rr(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new rr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Kr.fromString(kr(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?os.build(kr(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):kr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Hc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Yo(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Xm=["Unknown","Point","LineString","Polygon"];class Fh{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Xm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(c*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=on.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class ms{constructor(e,i,a,c,l){this.name=e,this.type=i,this._evaluate=a,this.args=c,this._overloadIndex=l}evaluate(e){if(!this._evaluate){const i=ms.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],c=ms.definitions[a];if(!c)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(c)?c[0]:c.type,d=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=[];let w=null,A=-1;for(const[_,T]of d){if(Array.isArray(_)&&_.length!==e.length-1)continue;y.push(_),A++,w=new Yc(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const I=[];let E=!1;for(let M=1;M<e.length;M++){const z=e[M],B=Array.isArray(_)?_[M-1]:_.type,N=w.parse(z,1+I.length,B);if(!N){E=!0;break}I.push(N)}if(!E)if(Array.isArray(_)&&_.length!==I.length)w.error(`Expected ${_.length} arguments, but found ${I.length} instead.`);else{for(let M=0;M<I.length;M++){const z=Array.isArray(_)?_[M]:_.type,B=I[M];w.concat(M+1).checkSubtype(z,B.type)}if(w.errors.length===0)return new ms(a,l,T,I,A)}}if(y.length===1)i.errors.push(...w.errors);else{const _=(y.length?y:d.map(([I])=>I)).map(_p).join(" | "),T=[];for(let I=1;I<e.length;I++){const E=i.parse(e[I],1+T.length);if(!E)return null;T.push(Hn(E.type))}i.error(`Expected arguments of type ${_}, but found (${T.join(", ")}) instead.`)}return null}static register(e,i){ms.definitions=i;for(const a in i)e[a]=ms}}function _p(r){return Array.isArray(r)?`(${r.map(Hn).join(", ")})`:`(${Hn(r.type)}...)`}class ql{constructor(e,i,a){this.type=ua,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const c=a["case-sensitive"]===void 0?i.parse(!1,1,Ki):i.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Ki);if(!c)return null;const l=a["diacritic-sensitive"]===void 0?i.parse(!1,1,Ki):i.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Ki);if(!l)return null;let d=null;return a.locale&&(d=i.parseObjectValue(a.locale,1,"locale",Zi),!d)?null:new ql(c,l,d)}evaluate(e){return new Xo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function gp(r,e,i=0,a=r.length-1,c=Wm){for(;a>i;){if(a-i>600){const w=a-i+1,A=e-i+1,_=Math.log(w),T=.5*Math.exp(2*_/3),I=.5*Math.sqrt(_*T*(w-T)/w)*(A-w/2<0?-1:1);gp(r,e,Math.max(i,Math.floor(e-A*T/w+I)),Math.min(a,Math.floor(e+(w-A)*T/w+I)),c)}const l=r[e];let d=i,y=a;for(Vu(r,i,e),c(r[a],l)>0&&Vu(r,i,a);d<y;){for(Vu(r,d,y),d++,y--;c(r[d],l)<0;)d++;for(;c(r[y],l)>0;)y--}c(r[i],l)===0?Vu(r,i,y):(y++,Vu(r,y,a)),y<=e&&(i=y+1),e<=y&&(a=y-1)}}function Vu(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}function Wm(r,e){return r<e?-1:r>e?1:0}function Ym(r){let e=0;for(let i,a,c=0,l=r.length,d=l-1;c<l;d=c++)i=r[c],a=r[d],e+=(a.x-i.x)*(i.y+a.y);return e}function ju(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function qu(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Km(r,e,i){const a=r[0]-e[0],c=r[1]-e[1],l=r[0]-i[0],d=r[1]-i[1];return a*d-l*c==0&&a*l<=0&&c*d<=0}function Gl(r,e,i=!1){let a=!1;for(let y=0,w=e.length;y<w;y++){const A=e[y];for(let _=0,T=A.length,I=T-1;_<T;I=_++){const E=A[I],M=A[_];if(Km(r,E,M))return i;(l=E)[1]>(c=r)[1]!=(d=M)[1]>c[1]&&c[0]<(d[0]-l[0])*(c[1]-l[1])/(d[1]-l[1])+l[0]&&(a=!a)}}var c,l,d;return a}function bo(r,e,i,a){const c=a[0]-i[0],l=a[1]-i[1],d=(r[0]-i[0])*l-c*(r[1]-i[1]),y=(e[0]-i[0])*l-c*(e[1]-i[1]);return d>0&&y<0||d<0&&y>0}function Ko(r,e,i,a){return(c=[a[0]-i[0],a[1]-i[1]])[0]*(l=[e[0]-r[0],e[1]-r[1]])[1]-c[1]*l[0]!=0&&!(!bo(r,e,i,a)||!bo(i,a,r,e));var c,l}const Jo=8192;function Uh(r,e){const i=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*Jo),Math.round(a*c*Jo)]}function yp(r,e){for(let i=0;i<e.length;i++)if(Gl(r,e[i]))return!0;return!1}function vp(r,e,i){for(const a of i)for(let c=0,l=a.length,d=l-1;c<l;d=c++)if(Ko(r,e,a[d],a[c]))return!0;return!1}function pf(r,e){for(let i=0;i<r.length;++i)if(!Gl(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(vp(r[i],r[i+1],e))return!1;return!0}function xp(r,e){for(let i=0;i<e.length;i++)if(pf(r,e[i]))return!0;return!1}function Qs(r,e,i){const a=[];for(let c=0;c<r.length;c++){const l=[];for(let d=0;d<r[c].length;d++){const y=Uh(r[c][d],i);ju(e,y),l.push(y)}a.push(l)}return a}function zi(r,e,i){const a=[];for(let c=0;c<r.length;c++){const l=Qs(r[c],e,i);a.push(l)}return a}function Wt(r,e,i,a){if(r[0]<i[0]||r[0]>i[2]){const c=.5*a;let l=r[0]-i[0]>c?-a:i[0]-r[0]>c?a:0;l===0&&(l=r[0]-i[2]>c?-a:i[2]-r[0]>c?a:0),r[0]+=l}ju(e,r)}function Vh(r,e,i,a){const c=Math.pow(2,a.z)*Jo,l=[a.x*Jo,a.y*Jo],d=[];if(!r)return d;for(const y of r)for(const w of y){const A=[w.x+l[0],w.y+l[1]];Wt(A,e,i,c),d.push(A)}return d}function xi(r,e,i,a){const c=Math.pow(2,a.z)*Jo,l=[a.x*Jo,a.y*Jo],d=[];if(!r)return d;for(const w of r){const A=[];for(const _ of w){const T=[_.x+l[0],_.y+l[1]];ju(e,T),A.push(T)}d.push(A)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const w of d)for(const A of w)Wt(A,e,i,c)}var y;return d}class Qa{constructor(e,i){this.type=Ki,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Js(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){const l=a.features[c].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Qa(a,a.features[c].geometry)}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Qa(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Qa(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(a.type==="Polygon"){const y=Qs(a.coordinates,l,d),w=Vh(i.geometry(),c,l,d);if(!qu(c,l))return!1;for(const A of w)if(!Gl(A,y))return!1}if(a.type==="MultiPolygon"){const y=zi(a.coordinates,l,d),w=Vh(i.geometry(),c,l,d);if(!qu(c,l))return!1;for(const A of w)if(!yp(A,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(a.type==="Polygon"){const y=Qs(a.coordinates,l,d),w=xi(i.geometry(),c,l,d);if(!qu(c,l))return!1;for(const A of w)if(!pf(A,y))return!1}if(a.type==="MultiPolygon"){const y=zi(a.coordinates,l,d),w=xi(i.geometry(),c,l,d);if(!qu(c,l))return!1;for(const A of w)if(!xp(A,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const eo={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ci=1/298.257223563,mf=ci*(2-ci),to=Math.PI/180;class Hl{static fromTile(e,i,a){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),l=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/to;return new Hl(l,a)}static get units(){return eo}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!eo[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(eo).join(", ")}`);const a=6378.137*to*(i?eo[i]:1),c=Math.cos(e*to),l=1/(1-mf*(1-c*c)),d=Math.sqrt(l);this.kx=a*d*c,this.ky=a*d*l*(1-mf)}distance(e,i){const a=Zn(e[0]-i[0])*this.kx,c=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+c*c)}bearing(e,i){const a=Zn(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/to}destination(e,i,a){const c=a*to;return this.offset(e,Math.sin(c)*i,Math.cos(c)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){const c=e[a];for(let l=0,d=c.length,y=d-1;l<d;y=l++)i+=Zn(c[l][0]-c[y][0])*(c[l][1]+c[y][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let c=0;c<e.length-1;c++){const l=e[c],d=e[c+1],y=this.distance(l,d);if(a+=y,a>i)return Qo(l,d,(i-(a-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[c,l]=i,d=Zn(a[0]-c)*this.kx,y=(a[1]-l)*this.ky;if(d!==0||y!==0){const w=(Zn(e[0]-c)*this.kx*d+(e[1]-l)*this.ky*y)/(d*d+y*y);w>1?(c=a[0],l=a[1]):w>0&&(c+=d/this.kx*w,l+=y/this.ky*w)}return d=Zn(e[0]-c)*this.kx,y=(e[1]-l)*this.ky,Math.sqrt(d*d+y*y)}pointOnLine(e,i){let a=1/0,c=e[0][0],l=e[0][1],d=0,y=0;for(let w=0;w<e.length-1;w++){let A=e[w][0],_=e[w][1],T=Zn(e[w+1][0]-A)*this.kx,I=(e[w+1][1]-_)*this.ky,E=0;T===0&&I===0||(E=(Zn(i[0]-A)*this.kx*T+(i[1]-_)*this.ky*I)/(T*T+I*I),E>1?(A=e[w+1][0],_=e[w+1][1]):E>0&&(A+=T/this.kx*E,_+=I/this.ky*E)),T=Zn(i[0]-A)*this.kx,I=(i[1]-_)*this.ky;const M=T*T+I*I;M<a&&(a=M,c=A,l=_,d=w,y=E)}return{point:[c,l],index:d,t:Math.max(0,Math.min(1,y))}}lineSlice(e,i,a){let c=this.pointOnLine(a,e),l=this.pointOnLine(a,i);if(c.index>l.index||c.index===l.index&&c.t>l.t){const A=c;c=l,l=A}const d=[c.point],y=c.index+1,w=l.index;!jh(a[y],d[0])&&y<=w&&d.push(a[y]);for(let A=y+1;A<=w;A++)d.push(a[A]);return jh(a[w],l.point)||d.push(l.point),d}lineSliceAlong(e,i,a){let c=0;const l=[];for(let d=0;d<a.length-1;d++){const y=a[d],w=a[d+1],A=this.distance(y,w);if(c+=A,c>e&&l.length===0&&l.push(Qo(y,w,(e-(c-A))/A)),c>=i)return l.push(Qo(y,w,(i-(c-A))/A)),l;c>e&&l.push(w)}return l}bufferPoint(e,i){const a=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-a,e[0]+c,e[1]+a]}bufferBBox(e,i){const a=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-a,e[2]+c,e[3]+a]}insideBBox(e,i){return Zn(e[0]-i[0])>=0&&Zn(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function jh(r,e){return r[0]===e[0]&&r[1]===e[1]}function Qo(r,e,i){const a=Zn(e[0]-r[0]);return[r[0]+a*i,r[1]+(e[1]-r[1])*i]}function Zn(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class Zc{constructor(e=[],i=(a,c)=>a<c?-1:a>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,c=i[e];for(;e>0;){const l=e-1>>1,d=i[l];if(a(c,d)>=0)break;i[e]=d,e=l}i[e]=c}_down(e){const{data:i,compare:a}=this,c=this.length>>1,l=i[e];for(;e<c;){let d=1+(e<<1);const y=d+1;if(y<this.length&&a(i[y],i[d])<0&&(d=y),a(i[d],l)>=0)break;i[e]=i[d],e=d}i[e]=l}}var vt=8192;function Gu(r,e){return e.dist-r.dist}const wo=100,Jr=50;function bp(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function qh(r){return r[1]-r[0]+1}function To(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Qr(r,e){if(r[0]>r[1])return[null,null];const i=qh(r);if(e){if(i===2)return[r,null];const a=Math.floor(i/2);return[[r[0],r[0]+a],[r[0]+a,r[1]]]}{if(i===1)return[r,null];const a=Math.floor(i/2)-1;return[[r[0],r[0]+a],[r[0]+a+1,r[1]]]}}function ha(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!To(e,r.length))return i;for(let a=e[0];a<=e[1];++a)ju(i,r[a]);return i}function Zl(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let a=0;a<r[i].length;++a)ju(e,r[i][a]);return e}function $l(r,e,i){if(bp(r)||bp(e))return NaN;let a=0,c=0;return r[2]<e[0]&&(a=e[0]-r[2]),r[0]>e[2]&&(a=r[0]-e[2]),r[1]>e[3]&&(c=r[1]-e[3]),r[3]<e[1]&&(c=e[1]-r[3]),i.distance([0,0],[a,c])}function wp(r){return 360*r-180}function Tp(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Hu(r,e){const i=Math.pow(2,e.z),a=(r.y/vt+e.y)/i;return[wp((r.x/vt+e.x)/i),Tp(a)]}function Sp(r,e){const i=[];for(let a=0;a<r.length;++a)i.push(Hu(r[a],e));return i}function Xl(r,e,i){const a=i.pointOnLine(e,r).point;return i.distance(r,a)}function Gh(r,e,i,a,c){const l=i.slice(a[0],a[1]+1);let d=1/0;for(let y=e[0];y<=e[1];++y)if((d=Math.min(d,Xl(r[y],l,c)))===0)return 0;return d}function el(r,e,i,a,c){const l=Math.min(c.pointToSegmentDistance(r,i,a),c.pointToSegmentDistance(e,i,a)),d=Math.min(c.pointToSegmentDistance(i,r,e),c.pointToSegmentDistance(a,r,e));return Math.min(l,d)}function _f(r,e,i,a,c){if(!To(e,r.length)||!To(a,i.length))return NaN;let l=1/0;for(let d=e[0];d<e[1];++d)for(let y=a[0];y<a[1];++y){if(Ko(r[d],r[d+1],i[y],i[y+1]))return 0;l=Math.min(l,el(r[d],r[d+1],i[y],i[y+1],c))}return l}function tl(r,e,i,a,c){if(!To(e,r.length)||!To(a,i.length))return NaN;let l=1/0;for(let d=e[0];d<=e[1];++d)for(let y=a[0];y<=a[1];++y)if((l=Math.min(l,c.distance(r[d],i[y])))===0)return l;return l}function Wl(r,e,i){if(Gl(r,e,!0))return 0;let a=1/0;for(const c of e){const l=c.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[l-1]&&(a=Math.min(a,i.pointToSegmentDistance(r,c[l-1],c[0])))===0||(a=Math.min(a,Xl(r,c,i)))===0)return a}return a}function $c(r,e,i,a){if(!To(e,r.length))return NaN;for(let l=e[0];l<=e[1];++l)if(Gl(r[l],i,!0))return 0;let c=1/0;for(let l=e[0];l<e[1];++l)for(const d of i)for(let y=0,w=d.length,A=w-1;y<w;A=y++){if(Ko(r[l],r[l+1],d[A],d[y]))return 0;c=Math.min(c,el(r[l],r[l+1],d[A],d[y],a))}return c}function Xc(r,e){for(const i of r)for(let a=0;a<=i.length-1;++a)if(Gl(i[a],e,!0))return!0;return!1}function gf(r,e,i,a=1/0){const c=Zl(r),l=Zl(e);if(a!==1/0&&$l(c,l,i)>=a)return a;if(qu(c,l)){if(Xc(r,e))return 0}else if(Xc(e,r))return 0;let d=a;for(const y of r)for(let w=0,A=y.length,_=A-1;w<A;_=w++)for(const T of e)for(let I=0,E=T.length,M=E-1;I<E;M=I++){if(Ko(y[_],y[w],T[M],T[I]))return 0;d=Math.min(d,el(y[_],y[w],T[M],T[I],i))}return d}function za(r,e,i,a,c,l,d){if(l===null||d===null)return;const y=$l(ha(a,l),ha(c,d),i);y<e&&r.push({dist:y,range1:l,range2:d})}function da(r,e,i,a,c=1/0){let l=Math.min(a.distance(r[0],i[0][0]),c);if(l===0)return l;const d=new Zc([{dist:0,range1:[0,r.length-1],range2:[0,0]}],Gu),y=e?Jr:wo,w=Zl(i);for(;d.length;){const A=d.pop();if(A.dist>=l)continue;const _=A.range1;if(qh(_)<=y){if(!To(_,r.length))return NaN;if(e){const T=$c(r,_,i,a);if((l=Math.min(l,T))===0)return l}else for(let T=_[0];T<=_[1];++T){const I=Wl(r[T],i,a);if((l=Math.min(l,I))===0)return l}}else{const T=Qr(_,e);if(T[0]!==null){const I=$l(ha(r,T[0]),w,a);I<l&&d.push({dist:I,range1:T[0],range2:[0,0]})}if(T[1]!==null){const I=$l(ha(r,T[1]),w,a);I<l&&d.push({dist:I,range1:T[1],range2:[0,0]})}}}return l}function Hh(r,e,i,a,c,l=1/0){let d=Math.min(l,c.distance(r[0],i[0]));if(d===0)return d;const y=new Zc([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],Gu),w=e?Jr:wo,A=a?Jr:wo;for(;y.length;){const _=y.pop();if(_.dist>=d)continue;const T=_.range1,I=_.range2;if(qh(T)<=w&&qh(I)<=A){if(!To(T,r.length)||!To(I,i.length))return NaN;if(e&&a?d=Math.min(d,_f(r,T,i,I,c)):e||a?e&&!a?d=Math.min(d,Gh(i,I,r,T,c)):!e&&a&&(d=Math.min(d,Gh(r,T,i,I,c))):d=Math.min(d,tl(r,T,i,I,c)),d===0)return d}else{const E=Qr(T,e),M=Qr(I,a);za(y,d,c,r,i,E[0],M[0]),za(y,d,c,r,i,E[0],M[1]),za(y,d,c,r,i,E[1],M[0]),za(y,d,c,r,i,E[1],M[1])}}return d}function Zu(r,e,i,a,c=1/0){let l=c;const d=ha(r,[0,r.length-1]);for(const y of i)if(!(l!==1/0&&$l(d,ha(y,[0,y.length-1]),a)>=l)&&(l=Math.min(l,Hh(r,e,y,!0,a,l)),l===0))return l;return l}function $u(r,e,i,a,c=1/0){let l=c;const d=ha(r,[0,r.length-1]);for(const y of i){if(l!==1/0&&$l(d,Zl(y),a)>=l)continue;const w=da(r,e,y,a,l);if(isNaN(w))return w;if((l=Math.min(l,w))===0)return l}return l}function Zh(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class il{constructor(e,i){this.type=Ut,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Js(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let c=0;c<a.features.length;++c)if(Zh(a.features[c].geometry.type))return new il(a,a.features[c].geometry)}else if(a.type==="Feature"){if(Zh(a.geometry.type))return new il(a,a.geometry)}else if(Zh(a.type))return new il(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return function(c,l,d){const y=[];for(const A of c)for(const _ of A)y.push(Hu(_,l));const w=new Hl(y[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?Hh(y,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",w):d.type==="MultiLineString"?Zu(y,!1,d.coordinates,w):d.type==="Polygon"||d.type==="MultiPolygon"?$u(y,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,w):null}(i,a,this.geometries);if(e.geometryType()==="LineString")return function(c,l,d){const y=[];for(const A of c){const _=[];for(const T of A)_.push(Hu(T,l));y.push(_)}const w=new Hl(y[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Zu(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",y,w);if(d.type==="MultiLineString"){let A=1/0;for(let _=0;_<d.coordinates.length;_++){const T=Zu(d.coordinates[_],!0,y,w,A);if(isNaN(T))return T;if((A=Math.min(A,T))===0)return A}return A}if(d.type==="Polygon"||d.type==="MultiPolygon"){let A=1/0;for(let _=0;_<y.length;_++){const T=$u(y[_],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,w,A);if(isNaN(T))return T;if((A=Math.min(A,T))===0)return A}return A}return null}(i,a,this.geometries);if(e.geometryType()==="Polygon")return function(c,l,d){const y=[];for(const A of function(_,T){const I=_.length;if(I<=1)return[_];const E=[];let M,z;for(let B=0;B<I;B++){const N=Ym(_[B]);N!==0&&(_[B].area=Math.abs(N),z===void 0&&(z=N<0),z===N<0?(M&&E.push(M),M=[_[B]]):M.push(_[B]))}return M&&E.push(M),E}(c)){const _=[];for(let T=0;T<A.length;++T)_.push(Sp(A[T],l));y.push(_)}const w=new Hl(y[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return $u(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",y,w);if(d.type==="MultiLineString"){let A=1/0;for(let _=0;_<d.coordinates.length;_++){const T=$u(d.coordinates[_],!0,y,w,A);if(isNaN(T))return T;if((A=Math.min(A,T))===0)return A}return A}return d.type==="Polygon"||d.type==="MultiPolygon"?function(A,_,T){let I=1/0;for(const E of A)for(const M of _){const z=gf(E,M,T,I);if(isNaN(z))return z;if((I=Math.min(I,z))===0)return I}return I}(d.type==="Polygon"?[d.coordinates]:d.coordinates,y,w):null}(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Xu(r,e){switch(r){case"string":return kr(e);case"number":return+e;case"boolean":return!!e;case"color":return on.parse(e);case"formatted":return Kr.fromString(kr(e));case"resolvedImage":return os.build(kr(e))}return e}function $h(r,e,i,a){return a!==void 0&&(r=a*Math.round(r/a)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class So{constructor(e,i,a){this.type=e,this.key=i,this.scope=a}static parse(e,i){let a=i.expectedType;if(a==null&&(a=Ji),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const c=i.parse(e[1],1);if(!(c instanceof vo))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const l=i.parse(e[2],2);return l instanceof vo?new So(a,kr(c.value),kr(l.value)):i.error("Scope of 'config' expression must be a string literal.")}return new So(a,kr(c.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(i);if(!a)return null;const{type:c,value:l,values:d,minValue:y,maxValue:w,stepValue:A}=a,_=a.default.evaluate(e);let T=_;if(l){const I=e.scope;e.scope=(I||"").split("").slice(1).join(""),T=l.evaluate(e),e.scope=I}return c&&(T=Xu(c,T)),T===void 0||y===void 0&&w===void 0&&A===void 0||(typeof T=="number"?T=$h(T,y,w,A):Array.isArray(T)&&(T=T.map(I=>typeof I=="number"?$h(I,y,w,A):I))),l!==void 0&&T!==void 0&&d&&!d.includes(T)&&(T=_,c&&(T=Xu(c,T))),(c&&c!==this.type||T!==void 0&&mr(T)!==this.type)&&(T=Xu(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function _s(r){if(r instanceof ms&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Qa||r instanceof il)return!1;let e=!0;return r.eachChild(i=>{e&&!_s(i)&&(e=!1)}),e}function Wc(r){if(r instanceof ms&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!Wc(i)&&(e=!1)}),e}function gs(r){if(r instanceof So)return new Set([r.key]);let e=new Set;return r.eachChild(i=>{e=new Set([...e,...gs(i)])}),e}function Br(r,e){if(r instanceof ms&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(a=>{i&&!Br(a,e)&&(i=!1)}),i}class fa{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new fa(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class nl{constructor(e,i=[],a,c=new ca,l=[],d,y){this.registry=e,this.path=i,this.key=i.map(w=>typeof w=="string"?`['${w}']`:`[${w}]`).join(""),this.scope=c,this.errors=l,this.expectedType=a,this._scope=d,this.options=y}parse(e,i,a,c,l={}){return i||a?this.concat(i,null,a,c)._parse(e,l):this._parse(e,l)}parseObjectValue(e,i,a,c,l,d={}){return this.concat(i,a,c,l)._parse(e,d)}_parse(e,i){function a(c,l,d){return d==="assert"?new Hs(l,[c]):d==="coerce"?new Da(l,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let l=c.parse(e,this);if(!l)return null;if(this.expectedType){const d=this.expectedType,y=l.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||y.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(d,y))return null}else l=a(l,d,i.typeAnnotation||"coerce");else l=a(l,d,i.typeAnnotation||"assert")}if(!(l instanceof vo)&&l.type.kind!=="resolvedImage"&&Yl(l)){const d=new Fh(this._scope,this.options);try{l=new vo(l.type,l.evaluate(d))}catch(y){return this.error(y.message),null}}return l}return Da.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a,c){let l=typeof e=="number"?this.path.concat(e):this.path;l=typeof i=="string"?l.concat(i):l;const d=c?this.scope.concat(c):this.scope;return new nl(this.registry,l,a||null,d,this.errors,this._scope,this.options)}error(e,...i){const a=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new ps(a,e))}checkSubtype(e,i){const a=Gc(e,i);return a&&this.error(a),a}}var Yc=nl;function Yl(r){if(r instanceof fa)return Yl(r.boundExpression);if(r instanceof ms&&r.name==="error"||r instanceof ql||r instanceof Qa||r instanceof il||r instanceof So)return!1;const e=r instanceof Da||r instanceof Hs;let i=!0;return r.eachChild(a=>{i=e?i&&Yl(a):i&&a instanceof vo}),!!i&&_s(r)&&Br(r,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Kl(r,e){const i=r.length-1;let a,c,l=0,d=i,y=0;for(;l<=d;)if(y=Math.floor((l+d)/2),a=r[y],c=r[y+1],a<=e){if(y===i||e<c)return y;l=y+1}else{if(!(a>e))throw new rr("Input is not a number.");d=y-1}return 0}class Rs{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,l]of a)this.labels.push(c),this.outputs.push(l)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,Ut);if(!a)return null;const c=[];let l=null;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);for(let d=1;d<e.length;d+=2){const y=d===1?-1/0:e[d],w=e[d+1],A=d,_=d+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(c.length&&c[c.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const T=i.parse(w,_,l);if(!T)return null;l=l||T.type,c.push([y,T])}return new Rs(l,a,c)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return a[0].evaluate(e);const l=i.length;return c>=i[l-1]?a[l-1].evaluate(e):a[Kl(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Vi=.95047,Wu=1.08883,Jl=4/29,Kc=6/29,Ds=3*Kc*Kc,yf=Kc*Kc*Kc,xn=Math.PI/180,Ep=180/Math.PI;function Jc(r){return r>yf?Math.pow(r,1/3):r/Ds+Jl}function Eo(r){return r>Kc?r*r*r:Ds*(r-Jl)}function Yu(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Ku(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Ql(r){const e=Ku(r.r),i=Ku(r.g),a=Ku(r.b),c=Jc((.4124564*e+.3575761*i+.1804375*a)/Vi),l=Jc((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*l-16,a:500*(c-l),b:200*(l-Jc((.0193339*e+.119192*i+.9503041*a)/Wu)),alpha:r.a}}function ec(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,a=isNaN(r.b)?e:e-r.b/200;return e=1*Eo(e),i=Vi*Eo(i),a=Wu*Eo(a),new on(Yu(3.2404542*i-1.5371385*e-.4985314*a),Yu(-.969266*i+1.8760108*e+.041556*a),Yu(.0556434*i-.2040259*e+1.0572252*a),r.alpha)}function Xh(r,e,i){const a=e-r;return r+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const rl={forward:Ql,reverse:ec,interpolate:function(r,e,i){return{l:Kt(r.l,e.l,i),a:Kt(r.a,e.a,i),b:Kt(r.b,e.b,i),alpha:Kt(r.alpha,e.alpha,i)}}},ys={forward:function(r){const{l:e,a:i,b:a}=Ql(r),c=Math.atan2(a,i)*Ep;return{h:c<0?c+360:c,c:Math.sqrt(i*i+a*a),l:e,alpha:r.a}},reverse:function(r){const e=r.h*xn,i=r.c;return ec({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:Xh(r.h,e.h,i),c:Kt(r.c,e.c,i),l:Kt(r.l,e.l,i),alpha:Kt(r.alpha,e.alpha,i)}}};var ea=Object.freeze({__proto__:null,hcl:ys,lab:rl});class Hr{constructor(e,i,a,c,l){this.type=e,this.operator=i,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[d,y]of l)this.labels.push(d),this.outputs.push(y)}static interpolationFactor(e,i,a,c){let l=0;if(e.name==="exponential")l=Pa(i,e.base,a,c);else if(e.name==="linear")l=Pa(i,1,a,c);else if(e.name==="cubic-bezier"){const d=e.controlPoints;l=new Za(d[0],d[1],d[2],d[3]).solve(Pa(i,1,a,c))}return l}static parse(e,i){let[a,c,l,...d]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const A=c[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:A}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const A=c.slice(1);if(A.length!==4||A.some(_=>typeof _!="number"||_<0||_>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(l=i.parse(l,2,Ut),!l)return null;const y=[];let w=null;a==="interpolate-hcl"||a==="interpolate-lab"?w=Lr:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let A=0;A<d.length;A+=2){const _=d[A],T=d[A+1],I=A+3,E=A+4;if(typeof _!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(y.length&&y[y.length-1][0]>=_)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const M=i.parse(T,E,w);if(!M)return null;w=w||M.type,y.push([_,M])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Hr(w,a,c,l,y):i.error(`Type ${Hn(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return a[0].evaluate(e);const l=i.length;if(c>=i[l-1])return a[l-1].evaluate(e);const d=Kl(i,c),y=Hr.interpolationFactor(this.interpolation,c,i[d],i[d+1]),w=a[d].evaluate(e),A=a[d+1].evaluate(e);return this.operator==="interpolate"?Vl[this.type.kind.toLowerCase()](w,A,y):this.operator==="interpolate-hcl"?ys.reverse(ys.interpolate(ys.forward(w),ys.forward(A),y)):rl.reverse(rl.interpolate(rl.forward(w),rl.forward(A),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function Pa(r,e,i,a){const c=a-i,l=r-i;return c===0?0:e===1?l/c:(Math.pow(e,l)-1)/(Math.pow(e,c)-1)}class pa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const c=i.expectedType;c&&c.kind!=="value"&&(a=c);const l=[];for(const y of e.slice(1)){const w=i.parse(y,1+l.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,l.push(w)}const d=c&&l.some(y=>Gc(c,y.type));return new pa(d?Ji:a,l)}evaluate(e){let i,a=null,c=0;for(const l of this.args){if(c++,a=l.evaluate(e),a&&a instanceof os&&!a.available&&(i||(i=a),a=null,c===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class io{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let l=1;l<e.length-1;l+=2){const d=e[l];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,l);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",l);const y=i.parse(e[l+1],l+1);if(!y)return null;a.push([d,y])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return c?new io(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class Wh{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ut),c=i.parse(e[2],2,cr(i.expectedType||Ji));return a&&c?new Wh(c.type.itemType,a,c):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new rr(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new rr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new rr(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ju{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ut),c=i.parse(e[2],2,cr(i.expectedType||Ji));return a&&c?new Ju(c.type.itemType,a,c):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new rr(`Array index out of bounds: ${i} < 0.`);if(i>a.length-1)throw new rr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i===Math.floor(i))return a[i];const c=Math.floor(i),l=Math.ceil(i),d=a[c],y=a[l];if(typeof d!="number"||typeof y!="number")throw new rr(`Cannot interpolate between non-number values at index ${i}.`);const w=i-c;return d*(1-w)+y*w}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Qu{constructor(e,i){this.type=Ki,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ji),c=i.parse(e[2],2,Ji);return a&&c?Fu(a.type,[Ki,Zi,Ut,Zo,Ji])?new Qu(a,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!$o(i,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(mr(i))} instead.`);if(!$o(a,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${Hn(mr(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class es{constructor(e,i,a){this.type=Ut,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ji),c=i.parse(e[2],2,Ji);if(!a||!c)return null;if(!Fu(a.type,[Ki,Zi,Ut,Zo,Ji]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(a.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,Ut);return l?new es(a,c,l):null}return new es(a,c)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!$o(i,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${Hn(mr(i))} instead.`);if(!$o(a,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${Hn(mr(a))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return a.indexOf(i,c)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ur{constructor(e,i,a,c,l,d){this.inputType=e,this.type=i,this.input=a,this.cases=c,this.outputs=l,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const l={},d=[];for(let A=2;A<e.length-1;A+=2){let _=e[A];const T=e[A+1];Array.isArray(_)||(_=[_]);const I=i.concat(A);if(_.length===0)return I.error("Expected at least one branch label.");for(const M of _){if(typeof M!="number"&&typeof M!="string")return I.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return I.error("Numeric branch labels must be integer values.");if(a){if(I.checkSubtype(a,mr(M)))return null}else a=mr(M);if(l[String(M)]!==void 0)return I.error("Branch labels must be unique.");l[String(M)]=d.length}const E=i.parse(T,A,c);if(!E)return null;c=c||E.type,d.push(E)}const y=i.parse(e[1],1,Ji);if(!y)return null;const w=i.parse(e[e.length-1],e.length-1,c);return w?y.type.kind!=="value"&&i.concat(1).checkSubtype(a,y.type)?null:new ur(a,c,y,l,d,w):null}evaluate(e){const i=this.input.evaluate(e);return(mr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],c={};for(const d of i){const y=c[this.cases[d]];y===void 0?(c[this.cases[d]]=a.length,a.push([this.cases[d],[d]])):a[y][1].push(d)}const l=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,y]of a)e.push(y.length===1?l(y[0]):y.map(l)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class On{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c=[];for(let d=1;d<e.length-1;d+=2){const y=i.parse(e[d],d,Ki);if(!y)return null;const w=i.parse(e[d+1],d+1,a);if(!w)return null;c.push([y,w]),a=a||w.type}const l=i.parse(e[e.length-1],e.length-1,a);return l?new On(a,c,l):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class no{constructor(e,i,a,c){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ji),c=i.parse(e[2],2,Ut);if(!a||!c)return null;if(!Fu(a.type,[cr(Ji),Zi,Ji]))return i.error(`Expected first argument to be of type array or string, but found ${Hn(a.type)} instead`);if(e.length===4){const l=i.parse(e[3],3,Ut);return l?new no(a.type,a,c,l):null}return new no(a.type,a,c)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!$o(i,["string","array"]))throw new rr(`Expected first argument to be of type array or string, but found ${Hn(mr(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(a,c)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Oa(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Yh(r,e,i,a){return a.compare(e,i)===0}function ma(r,e,i){const a=r!=="=="&&r!=="!=";return class fS{constructor(l,d,y){this.type=Ki,this.lhs=l,this.rhs=d,this.collator=y,this.hasUntypedArgument=l.type.kind==="value"||d.type.kind==="value"}static parse(l,d){if(l.length!==3&&l.length!==4)return d.error("Expected two or three arguments.");const y=l[0];let w=d.parse(l[1],1,Ji);if(!w)return null;if(!Oa(y,w.type))return d.concat(1).error(`"${y}" comparisons are not supported for type '${Hn(w.type)}'.`);let A=d.parse(l[2],2,Ji);if(!A)return null;if(!Oa(y,A.type))return d.concat(2).error(`"${y}" comparisons are not supported for type '${Hn(A.type)}'.`);if(w.type.kind!==A.type.kind&&w.type.kind!=="value"&&A.type.kind!=="value")return d.error(`Cannot compare types '${Hn(w.type)}' and '${Hn(A.type)}'.`);a&&(w.type.kind==="value"&&A.type.kind!=="value"?w=new Hs(A.type,[w]):w.type.kind!=="value"&&A.type.kind==="value"&&(A=new Hs(w.type,[A])));let _=null;if(l.length===4){if(w.type.kind!=="string"&&A.type.kind!=="string"&&w.type.kind!=="value"&&A.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(_=d.parse(l[3],3,ua),!_)return null}return new fS(w,A,_)}evaluate(l){const d=this.lhs.evaluate(l),y=this.rhs.evaluate(l);if(a&&this.hasUntypedArgument){const w=mr(d),A=mr(y);if(w.kind!==A.kind||w.kind!=="string"&&w.kind!=="number")throw new rr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${w.kind}, ${A.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const w=mr(d),A=mr(y);if(w.kind!=="string"||A.kind!=="string")return e(l,d,y)}return this.collator?i(l,d,y,this.collator.evaluate(l)):e(l,d,y)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[r];return this.eachChild(d=>{l.push(d.serialize())}),l}}}const Ap=ma("==",function(r,e,i){return e===i},Yh),Mp=ma("!=",function(r,e,i){return e!==i},function(r,e,i,a){return!Yh(0,e,i,a)}),eh=ma("<",function(r,e,i){return e<i},function(r,e,i,a){return a.compare(e,i)<0}),th=ma(">",function(r,e,i){return e>i},function(r,e,i,a){return a.compare(e,i)>0}),Ip=ma("<=",function(r,e,i){return e<=i},function(r,e,i,a){return a.compare(e,i)<=0}),ih=ma(">=",function(r,e,i){return e>=i},function(r,e,i,a){return a.compare(e,i)>=0});class tc{constructor(e,i,a,c,l,d){this.type=Zi,this.number=e,this.locale=i,this.currency=a,this.unit=c,this.minFractionDigits=l,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Ut);if(!a)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let l=null;if(c.locale&&(l=i.parseObjectValue(c.locale,2,"locale",Zi),!l))return null;let d=null;if(c.currency&&(d=i.parseObjectValue(c.currency,2,"currency",Zi),!d))return null;let y=null;if(c.unit&&(y=i.parseObjectValue(c.unit,2,"unit",Zi),!y))return null;let w=null;if(c["min-fraction-digits"]&&(w=i.parseObjectValue(c["min-fraction-digits"],2,"min-fraction-digits",Ut),!w))return null;let A=null;return c["max-fraction-digits"]&&(A=i.parseObjectValue(c["max-fraction-digits"],2,"max-fraction-digits",Ut),!A)?null:new tc(a,l,d,y,w,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ao{constructor(e){this.type=Ut,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Hn(a.type)} instead.`):new Ao(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new rr(`Expected value to be of type string or array, but found ${Hn(mr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function La(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ta={"==":Ap,"!=":Mp,">":th,"<":eh,">=":ih,"<=":Ip,array:Hs,at:Wh,"at-interpolated":Ju,boolean:Hs,case:On,coalesce:pa,collator:ql,format:Hc,image:Yo,in:Qu,"index-of":es,interpolate:Hr,"interpolate-hcl":Hr,"interpolate-lab":Hr,length:Ao,let:io,literal:vo,match:ur,number:Hs,"number-format":tc,object:Hs,slice:no,step:Rs,string:Hs,"to-boolean":Da,"to-color":Da,"to-number":Da,"to-string":Da,var:fa,within:Qa,distance:il,config:So};function ro(r,[e,i,a,c]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const l=c?c.evaluate(r):1,d=Uu(e,i,a,l);if(d)throw new rr(d);return new on(e/255*l,i/255*l,a/255*l,l)}function Kh(r,[e,i,a,c]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const l=c?c.evaluate(r):1,d=function(A,_,T,I){return typeof A=="number"&&A>=0&&A<=360?typeof _=="number"&&_>=0&&_<=100&&typeof T=="number"&&T>=0&&T<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[A,_,T,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[A,_,T,I]:[A,_,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[A,_,T,I]:[A,_,T]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,a,l);if(d)throw new rr(d);const y=`hsla(${e}, ${i}%, ${a}%, ${l})`,w=on.parse(y);if(!w)throw new rr(`Failed to parse HSLA color: ${y}`);return w}function nh(r,e){return r in e}function sl(r,e){const i=e[r];return i===void 0?null:i}function zs(r){return{type:r}}function Mo(r){return{result:"success",value:r}}function hr(r){return{result:"error",value:r}}function Qc(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function ic(r){return r["property-type"]==="data-driven"}function Jh(r){return Qc(r.expression,"measure-light")}function Cp(r){return Qc(r.expression,"zoom")}function vf(r){return!!r.expression&&r.expression.interpolated}function br(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Qh(r){return r}function eu(r,e){const i=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",c=a||!(a||r.property!==void 0),l=r.type||(vf(e)?"exponential":"interval");if(i&&((r=Hi({},r)).stops&&(r.stops=r.stops.map(A=>[A[0],on.parse(A[1])])),r.default=on.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!ea[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let d,y,w;if(l==="exponential")d=al;else if(l==="interval")d=nc;else if(l==="categorical"){d=xf,y=Object.create(null);for(const A of r.stops)y[A[0]]=A[1];w=typeof r.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);d=ed}if(a){const A={},_=[];for(let E=0;E<r.stops.length;E++){const M=r.stops[E],z=M[0].zoom;A[z]===void 0&&(A[z]={zoom:z,type:r.type,property:r.property,default:r.default,stops:[]},_.push(z)),A[z].stops.push([M[0].value,M[1]])}const T=[];for(const E of _)T.push([A[E].zoom,eu(A[E],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Hr.interpolationFactor.bind(void 0,I),zoomStops:T.map(E=>E[0]),evaluate:({zoom:E},M)=>al({stops:T,base:r.base},e,E).evaluate(E,M)}}if(c){const A=l==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Hr.interpolationFactor.bind(void 0,A),zoomStops:r.stops.map(_=>_[0]),evaluate:({zoom:_})=>d(r,e,_,y,w)}}return{kind:"source",evaluate(A,_){const T=_&&_.properties?_.properties[r.property]:void 0;return T===void 0?Io(r.default,e.default):d(r,e,T,y,w)}}}function Io(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function xf(r,e,i,a,c){return Io(typeof i===c?a[i]:void 0,r.default,e.default)}function nc(r,e,i){if(xo(i)!=="number")return Io(r.default,e.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const c=Kl(r.stops.map(l=>l[0]),i);return r.stops[c][1]}function al(r,e,i){const a=r.base!==void 0?r.base:1;if(xo(i)!=="number")return Io(r.default,e.default);const c=r.stops.length;if(c===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[c-1][0])return r.stops[c-1][1];const l=Kl(r.stops.map(_=>_[0]),i),d=function(_,T,I,E){const M=E-I,z=_-I;return M===0?0:T===1?z/M:(Math.pow(T,z)-1)/(Math.pow(T,M)-1)}(i,a,r.stops[l][0],r.stops[l+1][0]),y=r.stops[l][1],w=r.stops[l+1][1];let A=Vl[e.type]||Qh;if(r.colorSpace&&r.colorSpace!=="rgb"){const _=ea[r.colorSpace];A=(T,I)=>_.reverse(_.interpolate(_.forward(T),_.forward(I),d))}return typeof y.evaluate=="function"?{evaluate(..._){const T=y.evaluate.apply(void 0,_),I=w.evaluate.apply(void 0,_);if(T!==void 0&&I!==void 0)return A(T,I,d)}}:A(y,w,d)}function ed(r,e,i){return e.type==="color"?i=on.parse(i):e.type==="formatted"?i=Kr.fromString(i.toString()):e.type==="resolvedImage"?i=os.build(i.toString()):xo(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Io(i,r.default,e.default)}ms.register(ta,{error:[{kind:"error"},[Zi],(r,[e])=>{throw new rr(e.evaluate(r))}],typeof:[Zi,[Ji],(r,[e])=>Hn(mr(e.evaluate(r)))],"to-rgba":[cr(Ut,4),[Lr],(r,[e])=>e.evaluate(r).toRenderColor(null).toArray()],"to-hsla":[cr(Ut,4),[Lr],(r,[e])=>e.evaluate(r).toRenderColor(null).toHslaArray()],rgb:[Lr,[Ut,Ut,Ut],ro],rgba:[Lr,[Ut,Ut,Ut,Ut],ro],hsl:[Lr,[Ut,Ut,Ut],Kh],hsla:[Lr,[Ut,Ut,Ut,Ut],Kh],has:{type:Ki,overloads:[[[Zi],(r,[e])=>nh(e.evaluate(r),r.properties())],[[Zi,jl],(r,[e,i])=>nh(e.evaluate(r),i.evaluate(r))]]},get:{type:Ji,overloads:[[[Zi],(r,[e])=>sl(e.evaluate(r),r.properties())],[[Zi,jl],(r,[e,i])=>sl(e.evaluate(r),i.evaluate(r))]]},"feature-state":[Ji,[Zi],(r,[e])=>sl(e.evaluate(r),r.featureState||{})],properties:[jl,[],r=>r.properties()],"geometry-type":[Zi,[],r=>r.geometryType()],id:[Ji,[],r=>r.id()],zoom:[Ut,[],r=>r.globals.zoom],pitch:[Ut,[],r=>r.globals.pitch||0],"distance-from-center":[Ut,[],r=>r.distanceFromCenter()],"measure-light":[Ut,[Zi],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[Ut,[],r=>r.globals.heatmapDensity||0],"line-progress":[Ut,[],r=>r.globals.lineProgress||0],"raster-value":[Ut,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[Ut,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ut,[],r=>r.globals.skyRadialProgress||0],accumulated:[Ji,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ut,zs(Ut),(r,e)=>{let i=0;for(const a of e)i+=a.evaluate(r);return i}],"*":[Ut,zs(Ut),(r,e)=>{let i=1;for(const a of e)i*=a.evaluate(r);return i}],"-":{type:Ut,overloads:[[[Ut,Ut],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Ut],(r,[e])=>-e.evaluate(r)]]},"/":[Ut,[Ut,Ut],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Ut,[Ut,Ut],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Ut,[],()=>Math.LN2],pi:[Ut,[],()=>Math.PI],e:[Ut,[],()=>Math.E],"^":[Ut,[Ut,Ut],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Ut,[Ut],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Ut,[Ut],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Ut,[Ut],(r,[e])=>Math.log(e.evaluate(r))],log2:[Ut,[Ut],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Ut,[Ut],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Ut,[Ut],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Ut,[Ut],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Ut,[Ut],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Ut,[Ut],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Ut,[Ut],(r,[e])=>Math.atan(e.evaluate(r))],min:[Ut,zs(Ut),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[Ut,zs(Ut),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[Ut,[Ut],(r,[e])=>Math.abs(e.evaluate(r))],round:[Ut,[Ut],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ut,[Ut],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Ut,[Ut],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Ki,[Zi,Ji],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[Ki,[Ji],(r,[e])=>r.id()===e.value],"filter-type-==":[Ki,[Zi],(r,[e])=>r.geometryType()===e.value],"filter-<":[Ki,[Zi,Ji],(r,[e,i])=>{const a=r.properties()[e.value],c=i.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Ki,[Ji],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[Ki,[Zi,Ji],(r,[e,i])=>{const a=r.properties()[e.value],c=i.value;return typeof a==typeof c&&a>c}],"filter-id->":[Ki,[Ji],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[Ki,[Zi,Ji],(r,[e,i])=>{const a=r.properties()[e.value],c=i.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Ki,[Ji],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[Ki,[Zi,Ji],(r,[e,i])=>{const a=r.properties()[e.value],c=i.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Ki,[Ji],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[Ki,[Ji],(r,[e])=>e.value in r.properties()],"filter-has-id":[Ki,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Ki,[cr(Zi)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Ki,[cr(Ji)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Ki,[Zi,cr(Ji)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Ki,[Zi,cr(Ji)],(r,[e,i])=>function(a,c,l,d){for(;l<=d;){const y=l+d>>1;if(c[y]===a)return!0;c[y]>a?d=y-1:l=y+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ki,overloads:[[[Ki,Ki],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[zs(Ki),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:Ki,overloads:[[[Ki,Ki],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[zs(Ki),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[Ki,[Ki],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Ki,[Zi],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[Zi,[Zi],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Zi,[Zi],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Zi,zs(Ji),(r,e)=>e.map(i=>kr(i.evaluate(r))).join("")],"resolved-locale":[Zi,[ua],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[Ut,[Ut,Ut,Ji],(r,e)=>{const[i,a,c]=e.map(d=>d.evaluate(r));if(i>a||i===a)return i;let l;if(typeof c=="string")l=function(d){let y=0;if(d.length===0)return y;for(let w=0;w<d.length;w++)y=(y<<5)-y+d.charCodeAt(w),y|=0;return y}(c);else{if(typeof c!="number")throw new rr(`Invalid seed input: ${c}`);l=c}return i+La(l)()*(a-i)}]});class td{constructor(e,i,a,c){this.expression=e,this._warningHistory={},this._evaluator=new Fh(a,c),this._defaultValue=i?function(l){return l.type==="color"&&(br(l.default)||Array.isArray(l.default))?new on(0,0,0,0):l.type==="color"?on.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=gs(e)}evaluateWithoutErrorHandling(e,i,a,c,l,d,y,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,c,l,d,y,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=w||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new rr(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function id(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in ta}function rc(r,e,i,a){const c=new Yc(ta,[],e?function(d){const y={color:Lr,string:Zi,number:Ut,enum:Zi,boolean:Ki,formatted:qc,resolvedImage:xr};return d.type==="array"?cr(y[d.value]||Ji,d.length):y[d.type]}(e):void 0,void 0,void 0,i,a),l=c.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Mo(new td(l,e,i,a)):hr(c.errors)}class Co{constructor(e,i,a,c){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isLineProgressConstant=c,this.isStateDependent=e!=="constant"&&!Wc(i.expression),this.configDependencies=gs(i.expression)}evaluateWithoutErrorHandling(e,i,a,c,l,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,c,l,d)}evaluate(e,i,a,c,l,d){return this._styleExpression.evaluate(e,i,a,c,l,d)}}class ol{constructor(e,i,a,c,l,d){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Wc(i.expression),this.isLightConstant=l,this.isLineProgressConstant=d,this.configDependencies=gs(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,a,c,l,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,c,l,d)}evaluate(e,i,a,c,l,d){return this._styleExpression.evaluate(e,i,a,c,l,d)}interpolationFactor(e,i,a){return this.interpolationType?Hr.interpolationFactor(this.interpolationType,e,i,a):0}}function tu(r,e,i,a){if((r=rc(r,e,i,a)).result==="error")return r;const c=r.value.expression,l=_s(c);if(!l&&!ic(e))return hr([new ps("","data expressions not supported")]);const d=Br(c,["zoom","pitch","distance-from-center"]);if(!d&&!Cp(e))return hr([new ps("","zoom expressions not supported")]);const y=Br(c,["measure-light"]);if(!y&&!Jh(e))return hr([new ps("","measure-light expression not supported")]);const w=Br(c,["line-progress"]);if(!w&&!function(T){return Qc(T.expression,"line-progress")}(e))return hr([new ps("","line-progress expression not supported")]);const A=e.expression&&e.expression.relaxZoomRestriction,_=ll(c);return _||d||A?_ instanceof ps?hr([_]):_ instanceof Hr&&!vf(e)?hr([new ps("",'"interpolate" expressions cannot be used with this property')]):Mo(_?new ol(l&&w?"camera":"composite",r.value,_.labels,_ instanceof Hr?_.interpolation:void 0,y,w):new Co(l&&w?"constant":"source",r.value,y,w)):hr([new ps("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class rh{constructor(e,i){this._parameters=e,this._specification=i,Hi(this,eu(this._parameters,this._specification))}static deserialize(e){return new rh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ll(r){let e=null;if(r instanceof io)e=ll(r.result);else if(r instanceof pa){for(const i of r.args)if(e=ll(i),e)break}else(r instanceof Rs||r instanceof Hr)&&r.input instanceof ms&&r.input.name==="zoom"&&(e=r);return e instanceof ps||r.eachChild(i=>{const a=ll(i);a instanceof ps?e=a:e&&a&&e!==a&&(e=new ps("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var iu,sh,nd=function(){if(sh)return iu;sh=1,iu=e;var r=3;function e(i,a,c){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var d=new Int32Array(this.arrayBuffer);i=d[0],this.d=(a=d[1])+2*(c=d[2]);for(var y=0;y<this.d*this.d;y++){var w=d[r+y],A=d[r+y+1];l.push(w===A?null:d.subarray(w,A))}var _=d[r+l.length+1];this.keys=d.subarray(d[r+l.length],_),this.bboxes=d.subarray(_),this.insert=this._insertReadonly}else{this.d=a+2*c;for(var T=0;T<this.d*this.d;T++)l.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=c,this.scale=a/i,this.uid=0;var I=c/a*i;this.min=-I,this.max=i+I}return e.prototype.insert=function(i,a,c,l,d){this._forEachCell(a,c,l,d,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(l),this.bboxes.push(d)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,a,c,l,d,y){this.cells[d].push(y)},e.prototype.query=function(i,a,c,l,d){var y=this.min,w=this.max;if(i<=y&&a<=y&&w<=c&&w<=l&&!d)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,a,c,l,this._queryCell,A,{},d),A},e.prototype._queryCell=function(i,a,c,l,d,y,w,A){var _=this.cells[d];if(_!==null)for(var T=this.keys,I=this.bboxes,E=0;E<_.length;E++){var M=_[E];if(w[M]===void 0){var z=4*M;(A?A(I[z+0],I[z+1],I[z+2],I[z+3]):i<=I[z+2]&&a<=I[z+3]&&c>=I[z+0]&&l>=I[z+1])?(w[M]=!0,y.push(T[M])):w[M]=!1}}},e.prototype._forEachCell=function(i,a,c,l,d,y,w,A){for(var _=this._convertToCellCoord(i),T=this._convertToCellCoord(a),I=this._convertToCellCoord(c),E=this._convertToCellCoord(l),M=_;M<=I;M++)for(var z=T;z<=E;z++){var B=this.d*z+M;if((!A||A(this._convertFromCellCoord(M),this._convertFromCellCoord(z),this._convertFromCellCoord(M+1),this._convertFromCellCoord(z+1)))&&d.call(this,i,a,c,l,B,y,w,A))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=r+this.cells.length+1+1,c=0,l=0;l<this.cells.length;l++)c+=this.cells[l].length;var d=new Int32Array(a+c+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var y=a,w=0;w<i.length;w++){var A=i[w];d[r+w]=y,d.set(A,y),y+=A.length}return d[r+i.length]=y,d.set(this.keys,y),d[r+i.length+1]=y+=this.keys.length,d.set(this.bboxes,y),y+=this.bboxes.length,d.buffer},iu}(),sc=pe(nd);const ac={};function Ot(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),ac[e]={klass:r,omit:i.omit||[]}}Ot(Object,"Object"),sc.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},sc.deserialize=function(r){return new sc(r.buffer)},Object.defineProperty(sc,"name",{value:"Grid"}),Ot(sc,"Grid"),typeof DOMMatrix<"u"&&Ot(DOMMatrix,"DOMMatrix"),Ot(on,"Color"),Ot(Error,"Error"),Ot(Kr,"Formatted"),Ot(Wo,"FormattedSection"),Ot(Mr,"AJAXError"),Ot(os,"ResolvedImage"),Ot(rh,"StylePropertyFunction"),Ot(td,"StyleExpression",{omit:["_evaluator"]}),Ot(as,"ImageId"),Ot(Ja,"ImageVariant"),Ot(ol,"ZoomDependentExpression"),Ot(Co,"ZoomConstantExpression"),Ot(ms,"CompoundExpression",{omit:["_evaluate"]});for(const r in ta)ac[ta[r]._classRegistryKey]||Ot(ta[r],`Expression${r}`);function oc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function rd(r){return self.ImageBitmap&&r instanceof ImageBitmap}function Ro(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(oc(r)||rd(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const a of r)i.push(Ro(a,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[a,c]of r.entries())i.entries.push(Ro(a),Ro(c));return i}if(r instanceof Set){const i={$name:"Set"};let a=0;for(const c of r.values())i[++a]=Ro(c);return i}if(r instanceof DOMMatrix){const i={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const c of a)i[c]=r[c];return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,a=i._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const c=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const l in r)r.hasOwnProperty(l)&&(ac[a].omit.indexOf(l)>=0||(c[l]=Ro(r[l],e)));r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof r)}function Nr(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||oc(r)||rd(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Nr);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const c=r.entries||[],l=new Map;for(let d=0;d<c.length;d+=2)l.set(Nr(c[d]),Nr(c[d+1]));return l}if(e==="Set"){const c=new Set;for(const l of Object.keys(r))l!=="$name"&&c.add(Nr(r[l]));return c}if(e==="DOMMatrix"){let c;return c=r.is2D?[r.a,r.b,r.c,r.d,r.e,r.f]:[r.m11,r.m12,r.m13,r.m14,r.m21,r.m22,r.m23,r.m24,r.m31,r.m32,r.m33,r.m34,r.m41,r.m42,r.m43,r.m44],new DOMMatrix(c)}if(e==="BigInt")return BigInt(r.value);const{klass:i}=ac[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const a=Object.create(i.prototype);for(const c of Object.keys(r))c!=="$name"&&(a[c]=Nr(r[c]));return a}throw new Error("can't deserialize object of type "+typeof r)}const Yt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function ah(r){for(const e of r)if(ul(e.charCodeAt(0)))return!0;return!1}function cl(r){for(const e of r)if(!Do(e.charCodeAt(0)))return!1;return!0}function Do(r){return!(Yt.Arabic(r)||Yt["Arabic Supplement"](r)||Yt["Arabic Extended-A"](r)||Yt["Arabic Presentation Forms-A"](r)||Yt["Arabic Presentation Forms-B"](r))}function ul(r){return!(r!==746&&r!==747&&(r<4352||!(Yt["Bopomofo Extended"](r)||Yt.Bopomofo(r)||Yt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Yt["CJK Compatibility Ideographs"](r)||Yt["CJK Compatibility"](r)||Yt["CJK Radicals Supplement"](r)||Yt["CJK Strokes"](r)||!(!Yt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Yt["CJK Unified Ideographs Extension A"](r)||Yt["CJK Unified Ideographs"](r)||Yt["Enclosed CJK Letters and Months"](r)||Yt["Hangul Compatibility Jamo"](r)||Yt["Hangul Jamo Extended-A"](r)||Yt["Hangul Jamo Extended-B"](r)||Yt["Hangul Jamo"](r)||Yt["Hangul Syllables"](r)||Yt.Hiragana(r)||Yt["Ideographic Description Characters"](r)||Yt.Kanbun(r)||Yt["Kangxi Radicals"](r)||Yt["Katakana Phonetic Extensions"](r)||Yt.Katakana(r)&&r!==12540||!(!Yt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Yt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Yt["Unified Canadian Aboriginal Syllabics"](r)||Yt["Unified Canadian Aboriginal Syllabics Extended"](r)||Yt["Vertical Forms"](r)||Yt["Yijing Hexagram Symbols"](r)||Yt["Yi Syllables"](r)||Yt["Yi Radicals"](r))))}function oh(r){return!(ul(r)||function(e){return!!(Yt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Yt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Yt["Letterlike Symbols"](e)||Yt["Number Forms"](e)||Yt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Yt["Control Pictures"](e)&&e!==9251||Yt["Optical Character Recognition"](e)||Yt["Enclosed Alphanumerics"](e)||Yt["Geometric Shapes"](e)||Yt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Yt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Yt["CJK Symbols and Punctuation"](e)||Yt.Katakana(e)||Yt["Private Use Area"](e)||Yt["CJK Compatibility Forms"](e)||Yt["Small Form Variants"](e)||Yt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function sd(r){return Yt.Arabic(r)||Yt["Arabic Supplement"](r)||Yt["Arabic Extended-A"](r)||Yt["Arabic Presentation Forms-A"](r)||Yt["Arabic Presentation Forms-B"](r)}function hl(r){return r>=1424&&r<=2303||Yt["Arabic Presentation Forms-A"](r)||Yt["Arabic Presentation Forms-B"](r)}function lc(r,e){return!(!e&&hl(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Yt.Khmer(r))}function bf(r){for(const e of r)if(hl(e.charCodeAt(0)))return!0;return!1}const ad="deferred",Ps="loading",nu="loaded";let od=null,ls="unavailable",so=null;const _a=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(ls="error"),od&&od(r)};function _n(){Ln.fire(new Ms("pluginStateChange",{pluginStatus:ls,pluginURL:so}))}const Ln=new la,_r=function(){return ls},lh=function(){if(ls!==ad||!so)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ls=Ps,_n(),so&&Ca({url:so},r=>{r?_a(r):(ls=nu,_n())})},cs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ls===nu||cs.applyArabicShaping!=null,isLoading:()=>ls===Ps,setState(r){ls=r.pluginStatus,so=r.pluginURL},isParsed:()=>cs.applyArabicShaping!=null&&cs.processBidirectionalText!=null&&cs.processStyledBidirectionalText!=null,getPluginURL:()=>so};class hn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,a){for(const c of i)if(!lc(c.charCodeAt(0),a))return!1;return!0}(e,cs.isLoaded())}}class zo{constructor(e,i,a,c){this.property=e,this.value=i,this.expression=function(l,d,y,w){if(br(l))return new rh(l,d);if(id(l)||Array.isArray(l)&&l.length>0){const A=tu(l,d,y,w);if(A.result==="error")throw new Error(A.value.map(_=>`${_.key}: ${_.message}`).join(", "));return A.value}{let A=l;return typeof l=="string"&&d.type==="color"&&(A=on.parse(l)),{kind:"constant",configDependencies:new Set,evaluate:()=>A}}}(i===void 0?e.specification.default:i,e.specification,a,c)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class cc{constructor(e,i,a){this.property=e,this.value=new zo(e,void 0,i,a)}transitioned(e,i){return new ld(this.property,this.value,i,fr({},e.transition,this.transition),e.now)}untransitioned(){return new ld(this.property,this.value,null,{},0)}}class dl{constructor(e,i,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this.configDependencies=new Set}getValue(e){return Gr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new cc(this._values[e].property,this._scope,this._options)),this._values[e].value=new zo(this._values[e].property,i===null?void 0:Gr(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const c in e){const l=e[c];if(c.endsWith("-transition")){const d=c.slice(0,-11);a[d]&&this.setTransition(d,l)}else a.hasOwnProperty(c)&&this.setValue(c,l)}}getTransition(e){return Gr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new cc(this._values[e].property)),this._values[e].transition=Gr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const a=new sr(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,i._values[c]);return a}untransitioned(){const e=new sr(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ld{constructor(e,i,a,c,l){const d=c.delay||0,y=c.duration||0;l=l||0,this.property=e,this.value=i,this.begin=l+d,this.end=this.begin+y,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const c=e.now||0,l=this.value.possiblyEvaluate(e,i,a),d=this.prior;if(d){if(c>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(c<this.begin)return d.possiblyEvaluate(e,i,a);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,a),l,Xa(y))}}return l}}class sr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const c=new uc(this._properties);for(const l of Object.keys(this._values))c._values[l]=this._values[l].possiblyEvaluate(e,i,a);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fl{constructor(e,i,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this.configDependencies=new Set}getValue(e){return Gr(this._values[e].value)}setValue(e,i){this._values[e]=new zo(this._values[e].property,i===null?void 0:Gr(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){const c=new uc(this._properties);for(const l of Object.keys(this._values))c._values[l]=this._values[l].possiblyEvaluate(e,i,a);return c}}class pl{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,c){return this.property.evaluate(this.value,this.parameters,e,i,a,c)}}class uc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class yt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const c=Vl[this.specification.type];return c?c(e,i,a):e}}class Lt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,c){return new pl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},a,c)}:e.expression,i)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new pl(this,{kind:"constant",value:void 0},e.parameters);const c=Vl[this.specification.type];return c?new pl(this,{kind:"constant",value:c(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,c,l,d){return e.kind==="constant"?e.value:e.evaluate(i,a,c,l,d)}}class ml{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,c){return!!e.expression.evaluate(i,null,{},a,c)}interpolate(){return!1}}class Bn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new hn(0,{});for(const a in e){const c=e[a];c.specification.overridable&&this.overridableProperties.push(a);const l=this.defaultPropertyValues[a]=new zo(c,void 0),d=this.defaultTransitionablePropertyValues[a]=new cc(c);this.defaultTransitioningPropertyValues[a]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=l.possiblyEvaluate(i)}}}Ot(Lt,"DataDrivenProperty"),Ot(yt,"DataConstantProperty"),Ot(ml,"ColorRampProperty");var Fe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function Os(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function gr(r){if(Array.isArray(r))return r.map(gr);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=gr(r[i]);return e}return Os(r)}function ch(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!ch(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function hc(r,e="",i=null,a="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ch(r)||(r=hh(r));const c=r;let l=!0;try{l=function(_){if(!Zs(_))return _;let T=gr(_);return cd(T),T=uh(T),T}(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}let d=null,y=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){y=Fe[`filter_${a}`];const _=rc(l,y,e,i);if(_.result==="error")throw new Error(_.value.map(T=>`${T.key}: ${T.message}`).join(", "));d=(T,I,E)=>_.value.evaluate(T,I,{},E)}let w=null,A=null;if(l!==c){const _=rc(c,y,e,i);if(_.result==="error")throw new Error(_.value.map(T=>`${T.key}: ${T.message}`).join(", "));w=(T,I,E,M,z)=>_.value.evaluate(T,I,{},E,void 0,void 0,M,z),A=!_s(_.value.expression)}return{filter:d,dynamicFilter:w||void 0,needGeometry:hd(l),needFeature:!!A}}function uh(r){if(!Array.isArray(r))return r;const e=function(i){if(ud.has(i[0])){for(let a=1;a<i.length;a++)if(Zs(i[a]))return!0}return i}(r);return e===!0?e:e.map(i=>uh(i))}function cd(r){let e=!1;const i=[];if(r[0]==="case"){for(let a=1;a<r.length-1;a+=2)e=e||Zs(r[a]),i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Zs(r[1]);for(let a=2;a<r.length-1;a+=2)i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Zs(r[1]);for(let a=1;a<r.length-1;a+=2)i.push(r[a+1])}e&&(r.length=0,r.push("any",...i));for(let a=1;a<r.length;a++)cd(r[a])}function Zs(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Zs(r[i]))return!0;return!1}const ud=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wf(r,e){return r<e?-1:r>e?1:0}function hd(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(hd(r[e]))return!0;return!1}function hh(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Po(r[1],r[2],"=="):e==="!="?_l(Po(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Po(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(hh))):e==="all"?["all"].concat(r.slice(1).map(hh)):e==="none"?["all"].concat(r.slice(1).map(hh).map(_l)):e==="in"?dd(r[1],r.slice(2)):e==="!in"?_l(dd(r[1],r.slice(2))):e==="has"?fd(r[1]):e!=="!has"||_l(fd(r[1]));var i}function Po(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function dd(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(wf)]]:["filter-in-small",r,["literal",e]]}}function fd(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function _l(r){return["!",r]}const dh="";function gl(r,e){return e?`${r}${dh}${e}`:r}const ao="-transition",Rp=new Set(["fill","line","background","hillshade","raster"]);class Ir extends la{constructor(e,i,a,c,l){if(super(),this.id=e.id,this.fqid=gl(this.id,a),this.type=e.type,this.scope=a,this.lut=c,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const d=rc(this.filter,Fe[`filter_${e.type}`]);d.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...d.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new fl(i.layout,this.scope,l),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new dl(i.paint,this.scope,l);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new uc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Rp.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(ao)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const a=this._transitionablePaint,c=a._properties.properties;if(e.endsWith(ao)){const T=e.slice(0,-11);return c[T]&&a.setTransition(T,i||void 0),!1}if(!c[e])return!1;const l=a._values[e],d=l.value.isDataDriven(),y=l.value;a.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const w=a._values[e].value,A=w.isDataDriven(),_=e.endsWith("pattern")||e==="line-dasharray";return A||d||_||this._handleOverridablePaintPropertyUpdate(e,y,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Ka({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof pl&&ic(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=hc(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,a,c,l,d,y,w,A){}}const Dp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ru{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Tn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function nn(r,e=1){let i=0,a=0;return{members:r.map(c=>{const l=Dp[c.type].BYTES_PER_ELEMENT,d=i=Tf(i,Math.max(e,l)),y=c.components||1;return a=Math.max(a,l),i+=l*y,{name:c.name,type:c.type,components:y,offset:d}}),size:Tf(i,Math.max(a,e)),alignment:e}}function Tf(r,e){return Math.ceil(r/e)*e}class oo extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=a,e}}oo.prototype.bytesPerElement=4,Ot(oo,"StructArrayLayout2i4");class dc extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const l=3*e;return this.int16[l+0]=i,this.int16[l+1]=a,this.int16[l+2]=c,e}}dc.prototype.bytesPerElement=6,Ot(dc,"StructArrayLayout3i6");class lo extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,a,c)}emplace(e,i,a,c,l){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=a,this.int16[d+2]=c,this.int16[d+3]=l,e}}lo.prototype.bytesPerElement=8,Ot(lo,"StructArrayLayout4i8");class fc extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}fc.prototype.bytesPerElement=4,Ot(fc,"StructArrayLayout1f4");class su extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const l=4*e,d=2*e;return this.int16[l+0]=i,this.int16[l+1]=a,this.float32[d+1]=c,e}}su.prototype.bytesPerElement=8,Ot(su,"StructArrayLayout2i1f8");class yl extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const l=4*e;return this.int16[l+0]=i,this.int16[l+1]=a,this.int16[l+2]=c,e}}yl.prototype.bytesPerElement=8,Ot(yl,"StructArrayLayout3i8");class Ls extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c,l)}emplace(e,i,a,c,l,d){const y=5*e;return this.int16[y+0]=i,this.int16[y+1]=a,this.int16[y+2]=c,this.int16[y+3]=l,this.int16[y+4]=d,e}}Ls.prototype.bytesPerElement=10,Ot(Ls,"StructArrayLayout5i10");class pd extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,a,c,l,d,y)}emplace(e,i,a,c,l,d,y,w){const A=6*e,_=12*e,T=3*e;return this.int16[A+0]=i,this.int16[A+1]=a,this.uint8[_+4]=c,this.uint8[_+5]=l,this.uint8[_+6]=d,this.uint8[_+7]=y,this.float32[T+2]=w,e}}pd.prototype.bytesPerElement=12,Ot(pd,"StructArrayLayout2i4ub1f12");class $s extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const l=3*e;return this.float32[l+0]=i,this.float32[l+1]=a,this.float32[l+2]=c,e}}$s.prototype.bytesPerElement=12,Ot($s,"StructArrayLayout3f12");class ga extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c,l)}emplace(e,i,a,c,l,d){const y=6*e,w=3*e;return this.uint16[y+0]=i,this.uint16[y+1]=a,this.uint16[y+2]=c,this.uint16[y+3]=l,this.float32[w+2]=d,e}}ga.prototype.bytesPerElement=12,Ot(ga,"StructArrayLayout4ui1f12");class fh extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,a,c)}emplace(e,i,a,c,l){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=a,this.uint16[d+2]=c,this.uint16[d+3]=l,e}}fh.prototype.bytesPerElement=8,Ot(fh,"StructArrayLayout4ui8");class ph extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,c,l,d)}emplace(e,i,a,c,l,d,y){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=a,this.int16[w+2]=c,this.int16[w+3]=l,this.int16[w+4]=d,this.int16[w+5]=y,e}}ph.prototype.bytesPerElement=12,Ot(ph,"StructArrayLayout6i12");class md extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y,w,A,_,T,I){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,a,c,l,d,y,w,A,_,T,I)}emplace(e,i,a,c,l,d,y,w,A,_,T,I,E){const M=12*e;return this.int16[M+0]=i,this.int16[M+1]=a,this.int16[M+2]=c,this.int16[M+3]=l,this.uint16[M+4]=d,this.uint16[M+5]=y,this.uint16[M+6]=w,this.uint16[M+7]=A,this.int16[M+8]=_,this.int16[M+9]=T,this.int16[M+10]=I,this.int16[M+11]=E,e}}md.prototype.bytesPerElement=24,Ot(md,"StructArrayLayout4i4ui4i24");class _d extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,c,l,d)}emplace(e,i,a,c,l,d,y){const w=10*e,A=5*e;return this.int16[w+0]=i,this.int16[w+1]=a,this.int16[w+2]=c,this.float32[A+2]=l,this.float32[A+3]=d,this.float32[A+4]=y,e}}_d.prototype.bytesPerElement=20,Ot(_d,"StructArrayLayout3i3f20");class vl extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,a,c)}emplace(e,i,a,c,l){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=a,this.float32[d+2]=c,this.float32[d+3]=l,e}}vl.prototype.bytesPerElement=16,Ot(vl,"StructArrayLayout4f16");class gd extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}gd.prototype.bytesPerElement=4,Ot(gd,"StructArrayLayout1ul4");class co extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=a,e}}co.prototype.bytesPerElement=4,Ot(co,"StructArrayLayout2ui4");class yd extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y,w,A,_,T,I,E){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,a,c,l,d,y,w,A,_,T,I,E)}emplace(e,i,a,c,l,d,y,w,A,_,T,I,E,M){const z=20*e,B=10*e;return this.int16[z+0]=i,this.int16[z+1]=a,this.int16[z+2]=c,this.int16[z+3]=l,this.int16[z+4]=d,this.float32[B+3]=y,this.float32[B+4]=w,this.float32[B+5]=A,this.float32[B+6]=_,this.int16[z+14]=T,this.uint32[B+8]=I,this.uint16[z+18]=E,this.uint16[z+19]=M,e}}yd.prototype.bytesPerElement=40,Ot(yd,"StructArrayLayout5i4f1i1ul2ui40");class au extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,a,c,l,d,y)}emplace(e,i,a,c,l,d,y,w){const A=8*e;return this.int16[A+0]=i,this.int16[A+1]=a,this.int16[A+2]=c,this.int16[A+4]=l,this.int16[A+5]=d,this.int16[A+6]=y,this.int16[A+7]=w,e}}au.prototype.bytesPerElement=16,Ot(au,"StructArrayLayout3i2i2i16");class mh extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c,l)}emplace(e,i,a,c,l,d){const y=4*e,w=8*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=c,this.int16[w+6]=l,this.int16[w+7]=d,e}}mh.prototype.bytesPerElement=16,Ot(mh,"StructArrayLayout2f1f2i16");class vd extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,c,l,d)}emplace(e,i,a,c,l,d,y){const w=20*e,A=5*e;return this.uint8[w+0]=i,this.uint8[w+1]=a,this.float32[A+1]=c,this.float32[A+2]=l,this.float32[A+3]=d,this.float32[A+4]=y,e}}vd.prototype.bytesPerElement=20,Ot(vd,"StructArrayLayout2ub4f20");class Fr extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const l=3*e;return this.uint16[l+0]=i,this.uint16[l+1]=a,this.uint16[l+2]=c,e}}Fr.prototype.bytesPerElement=6,Ot(Fr,"StructArrayLayout3ui6");class xd extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B,N,H,G,j,$){const W=this.length;return this.resize(W+1),this.emplace(W,e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B,N,H,G,j,$)}emplace(e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B,N,H,G,j,$,W){const Q=30*e,le=15*e,se=60*e;return this.int16[Q+0]=i,this.int16[Q+1]=a,this.int16[Q+2]=c,this.float32[le+2]=l,this.float32[le+3]=d,this.uint16[Q+8]=y,this.uint16[Q+9]=w,this.uint32[le+5]=A,this.uint32[le+6]=_,this.uint32[le+7]=T,this.uint16[Q+16]=I,this.uint16[Q+17]=E,this.uint16[Q+18]=M,this.float32[le+10]=z,this.float32[le+11]=B,this.uint8[se+48]=N,this.uint8[se+49]=H,this.uint8[se+50]=G,this.uint32[le+13]=j,this.int16[Q+28]=$,this.uint8[se+58]=W,e}}xd.prototype.bytesPerElement=60,Ot(xd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ou extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B,N,H,G,j,$,W,Q,le,se,ae,be,he,Te,Ie,Me,ze,De){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B,N,H,G,j,$,W,Q,le,se,ae,be,he,Te,Ie,Me,ze,De)}emplace(e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B,N,H,G,j,$,W,Q,le,se,ae,be,he,Te,Ie,Me,ze,De,Ne){const ke=20*e,Ue=40*e,lt=80*e;return this.float32[ke+0]=i,this.float32[ke+1]=a,this.int16[Ue+4]=c,this.int16[Ue+5]=l,this.int16[Ue+6]=d,this.int16[Ue+7]=y,this.int16[Ue+8]=w,this.int16[Ue+9]=A,this.int16[Ue+10]=_,this.int16[Ue+11]=T,this.int16[Ue+12]=I,this.uint16[Ue+13]=E,this.uint16[Ue+14]=M,this.uint16[Ue+15]=z,this.uint16[Ue+16]=B,this.uint16[Ue+17]=N,this.uint16[Ue+18]=H,this.uint16[Ue+19]=G,this.uint16[Ue+20]=j,this.uint16[Ue+21]=$,this.uint16[Ue+22]=W,this.uint16[Ue+23]=Q,this.uint16[Ue+24]=le,this.uint16[Ue+25]=se,this.uint16[Ue+26]=ae,this.uint16[Ue+27]=be,this.uint32[ke+14]=he,this.float32[ke+15]=Te,this.float32[ke+16]=Ie,this.float32[ke+17]=Me,this.float32[ke+18]=ze,this.uint8[lt+76]=De,this.uint16[Ue+39]=Ne,e}}ou.prototype.bytesPerElement=80,Ot(ou,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class ks extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a,c,l)}emplace(e,i,a,c,l,d){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=c,this.float32[y+3]=l,this.float32[y+4]=d,e}}ks.prototype.bytesPerElement=20,Ot(ks,"StructArrayLayout5f20");class _h extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,a,c,l,d,y)}emplace(e,i,a,c,l,d,y,w){const A=7*e;return this.float32[A+0]=i,this.float32[A+1]=a,this.float32[A+2]=c,this.float32[A+3]=l,this.float32[A+4]=d,this.float32[A+5]=y,this.float32[A+6]=w,e}}_h.prototype.bytesPerElement=28,Ot(_h,"StructArrayLayout7f28");class gh extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y,w,A,_,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,a,c,l,d,y,w,A,_,T)}emplace(e,i,a,c,l,d,y,w,A,_,T,I){const E=11*e;return this.float32[E+0]=i,this.float32[E+1]=a,this.float32[E+2]=c,this.float32[E+3]=l,this.float32[E+4]=d,this.float32[E+5]=y,this.float32[E+6]=w,this.float32[E+7]=A,this.float32[E+8]=_,this.float32[E+9]=T,this.float32[E+10]=I,e}}gh.prototype.bytesPerElement=44,Ot(gh,"StructArrayLayout11f44");class bd extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y,w,A){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,c,l,d,y,w,A)}emplace(e,i,a,c,l,d,y,w,A,_){const T=9*e;return this.float32[T+0]=i,this.float32[T+1]=a,this.float32[T+2]=c,this.float32[T+3]=l,this.float32[T+4]=d,this.float32[T+5]=y,this.float32[T+6]=w,this.float32[T+7]=A,this.float32[T+8]=_,e}}bd.prototype.bytesPerElement=36,Ot(bd,"StructArrayLayout9f36");class pc extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=a,e}}pc.prototype.bytesPerElement=8,Ot(pc,"StructArrayLayout2f8");class yh extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,a,c)}emplace(e,i,a,c,l){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=a,this.uint16[d+3]=c,this.uint16[d+4]=l,e}}yh.prototype.bytesPerElement=12,Ot(yh,"StructArrayLayout1ul3ui12");class wd extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}wd.prototype.bytesPerElement=2,Ot(wd,"StructArrayLayout1ui2");class vh extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B)}emplace(e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B,N){const H=16*e;return this.float32[H+0]=i,this.float32[H+1]=a,this.float32[H+2]=c,this.float32[H+3]=l,this.float32[H+4]=d,this.float32[H+5]=y,this.float32[H+6]=w,this.float32[H+7]=A,this.float32[H+8]=_,this.float32[H+9]=T,this.float32[H+10]=I,this.float32[H+11]=E,this.float32[H+12]=M,this.float32[H+13]=z,this.float32[H+14]=B,this.float32[H+15]=N,e}}vh.prototype.bytesPerElement=64,Ot(vh,"StructArrayLayout16f64");class xl extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,l,d,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,a,c,l,d,y)}emplace(e,i,a,c,l,d,y,w){const A=10*e,_=5*e;return this.uint16[A+0]=i,this.uint16[A+1]=a,this.uint16[A+2]=c,this.uint16[A+3]=l,this.float32[_+2]=d,this.float32[_+3]=y,this.float32[_+4]=w,e}}xl.prototype.bytesPerElement=20,Ot(xl,"StructArrayLayout4ui3f20");class lu extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}lu.prototype.bytesPerElement=2,Ot(lu,"StructArrayLayout1i2");class cu extends Tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}cu.prototype.bytesPerElement=1,Ot(cu,"StructArrayLayout1ub1");class Td extends ru{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Td.prototype.size=40;class uu extends yd{get(e){return new Td(this,e)}}Ot(uu,"CollisionBoxArray");class xh extends ru{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}xh.prototype.size=60;class Sf extends xd{get(e){return new xh(this,e)}}Ot(Sf,"PlacedSymbolArray");class Ef extends ru{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Ef.prototype.size=80;class zp extends ou{get(e){return new Ef(this,e)}}Ot(zp,"SymbolInstanceArray");class mc extends fc{getoffsetX(e){return this.float32[1*e+0]}}Ot(mc,"GlyphOffsetArray");class Oo extends oo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ot(Oo,"SymbolLineVertexArray");class bl extends ru{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bl.prototype.size=12;class ts extends yh{get(e){return new bl(this,e)}}Ot(ts,"FeatureIndexArray");class wl extends co{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ot(wl,"FillExtrusionCentroidArray");class Af extends ru{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Af.prototype.size=6;class Mf extends dc{get(e){return new Af(this,e)}}Ot(Mf,"FillExtrusionWallArray");const hu=nn([{name:"a_pos",components:2,type:"Int16"}],4),Pp=nn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class dn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,c){let l=this.segments[this.segments.length-1];return e>dn.MAX_VERTEX_ARRAY_LENGTH&&Pn(`Max vertices per segment is ${dn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>dn.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==c)&&(l={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},c!==void 0&&(l.sortKey=c),this.segments.push(l)),l}prepareSegment(e,i,a,c){return this._prepareSegment(e,i.length,a.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,c){return new dn([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function ka(r,e){return 256*(r=Di(Math.floor(r),0,255))+Di(Math.floor(e),0,255)}dn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ot(dn,"SegmentVector");const uo=nn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Op=nn([{name:"a_dash",components:4,type:"Uint16"}]);class ya{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,c){this.ids.push(Ba(e)),this.positions.push(i,a,c)}eachPosition(e,i){const a=Ba(e);let c=0,l=this.ids.length-1;for(;c<l;){const d=c+l>>1;this.ids[d]>=a?l=d:c=d+1}for(;this.ids[c]===a;)i(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,i){const a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return yr(a,c,0,a.length-1),i&&(i.add(a.buffer),i.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){const i=new ya;let a;i.ids=e.ids,i.positions=e.positions;for(const c of i.ids)c!==a&&i.uniqueIds.push(c),a=c;return i.indexed=!0,i}}function Ba(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Gs(String(r))}function yr(r,e,i,a){for(;i<a;){const c=r[i+a>>1];let l=i-1,d=a+1;for(;;){do l++;while(r[l]<c);do d--;while(r[d]>c);if(l>=d)break;_c(r,l,d),_c(e,3*l,3*d),_c(e,3*l+1,3*d+1),_c(e,3*l+2,3*d+2)}d-i<a-d?(yr(r,e,i,d),i=d+1):(yr(r,e,d+1,a),a=d)}}function _c(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}Ot(ya,"FeaturePositionMap");class va{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class gc extends va{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Qn extends va{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class ia extends va{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class xa extends va{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Tl extends va{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class If extends va{constructor(e){super(e),this.current=on.transparent.toRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Cf=new Float32Array(16);class du extends va{constructor(e){super(e),this.current=Cf}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const fu=new Float32Array(9),Lp=new Float32Array(4);class bh extends va{constructor(e){super(e),this.current=Lp}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Sd(r){return[ka(255*r.r,255*r.g),ka(255*r.b,255*r.a)]}class pu{constructor(e,i,a,c){this.value=e,this.uniformNames=i.map(l=>`u_${l}`),this.type=a,this.context=c}setUniform(e,i,a,c,l){const d=c.constantOr(this.value);i.set(e,l,d instanceof on?d.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):d)}getBinding(e,i){return this.type==="color"?new If(e):new Qn(e)}}class yc{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,a,c,l){const d=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;d&&i.set(e,l,d)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Tl(e):new Qn(e)}}class ho{constructor(e,i,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(l=>({name:`a_${l}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,a,c,l,d,y){const w=this.paintVertexArray.length,A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new hn(0,{brightness:d}),i,{},l,c,y):this.expression.kind==="constant"&&this.expression.value,_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new hn(0,{brightness:d}),i,{},l,c,y):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(w,e,A,_?null:this.context.lut)}updatePaintArray(e,i,a,c,l,d,y){const w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:y},a,c,void 0,l):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new hn(0,{brightness:y}),a,c,void 0,l):this.lutExpression.value)==="none";this._setPaintValue(e,i,w,A?null:this.context.lut)}_setPaintValue(e,i,a,c){if(this.type==="color"){const l=Sd(a.toRenderColor(c));for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,l[0],l[1])}else{for(let l=e;l<i;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xn{constructor(e,i,a,c,l,d){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=c,this.context=l,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,a,c,l,d,y){const w=this.expression.evaluate(new hn(this.context.zoom,{brightness:d}),i,{},l,c,y),A=this.expression.evaluate(new hn(this.context.zoom+1,{brightness:d}),i,{},l,c,y),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new hn(0,{brightness:d}),i,{},l,c,y):this.lutExpression.value)==="none",T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,w,A,_?null:this.context.lut)}updatePaintArray(e,i,a,c,l,d,y){const w=this.expression.evaluate({zoom:this.context.zoom,brightness:y},a,c,void 0,l),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y},a,c,void 0,l),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new hn(0,{brightness:y}),a,c,void 0,l):this.lutExpression.value)==="none";this._setPaintValue(e,i,w,A,_?null:this.context.lut)}_setPaintValue(e,i,a,c,l){if(this.type==="color"){const d=Sd(a.toRenderColor(l)),y=Sd(a.toRenderColor(l));for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,d[0],d[1],y[0],y[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,c,l){const d=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=Di(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);i.set(e,l,y)}getBinding(e,i){return new Qn(e)}}class dr{constructor(e,i,a,c,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(a==="array"?Op:uo).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new c}populatePaintArray(e,i,a,c){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,c,l,d,y){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],d)}_setPaintValues(e,i,a,c){if(!c||!a)return;const l=c[a];if(!l)return;const{tl:d,br:y,pixelRatio:w}=l;for(let A=e;A<i;A++)this.paintVertexArray.emplace(A,d[0],d[1],y[0],y[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sl{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[],this.context=i;const c=[];for(const l in e.paint._values){const d=e.paint.get(l);if(l.endsWith("-use-theme")||!a(l)||!(d instanceof pl&&ic(d.property.specification)))continue;const y=Bp(l,e.type),w=d.value,A=d.property.specification.type,_=!!d.property.useIntegerZoom,T=l==="line-dasharray"||l.endsWith("pattern"),I=e.paint.get(`${l}-use-theme`),E=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||I&&I.value.kind!=="constant";if(w.kind!=="constant"||E)if(w.kind==="source"||E||T){const M=Ed(l,A,"source");this.binders[l]=T?new dr(w,y,A,M,e.id):new ho(w,y,A,M),c.push(`/a_${l}`)}else{const M=Ed(l,A,"composite");this.binders[l]=new Xn(w,y,A,_,i,M),c.push(`/z_${l}`)}else this.binders[l]=T?new yc(w.value,y):new pu(w.value,y,A,i),c.push(`/u_${l}`);I&&(this.binders[l].lutExpression=I.value)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof ho||i instanceof Xn?i.maxValue:0}populatePaintArrays(e,i,a,c,l,d,y){for(const w in this.binders){const A=this.binders[w];A.context=this.context,(A instanceof ho||A instanceof Xn||A instanceof dr)&&A.populatePaintArray(e,i,a,c,l,d,y)}}setConstantPatternPositions(e){for(const i in this.binders){const a=this.binders[i];a instanceof yc&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,i,a,c,l,d,y,w,A){let _=!1;const T=Object.keys(e),I=T.length!==0&&!w,E=I?T:i.uniqueIds;this.context.lut=l.lut;for(const M in this.binders){const z=this.binders[M];if(z.context=this.context,(z instanceof ho||z instanceof Xn||z instanceof dr)&&z.expression&&z.expression.kind&&z.expression.kind!=="constant"&&(z.expression.isStateDependent===!0||z.expression.isLightConstant===!1)){const B=l.paint.get(M);z.expression=B.value;for(const N of E){const H=e[N.toString()];i.eachPosition(N,(G,j,$)=>{const W=c.feature(G);z.updatePaintArray(j,$,W,H,d,y,A)})}if(!I)for(const N of a.uniqueIds){const H=e[N.toString()];a.eachPosition(N,(G,j,$)=>{const W=c.feature(G);z.updatePaintArray(j,$,W,H,d,y,A)})}_=!0}}return _}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof pu||a instanceof yc)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof ho||a instanceof Xn||a instanceof dr)for(let c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof pu||a instanceof yc||a instanceof Xn)for(const c of a.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof pu||c instanceof yc||c instanceof Xn)for(const l of c.uniformNames)i.push({name:l,property:a,binding:c.getBinding(e,l)})}return i}setUniforms(e,i,a,c,l){for(const{name:d,property:y,binding:w}of a)this.binders[y].setUniform(e,w,l,c.get(y),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof ho||i instanceof Xn||i instanceof dr)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof ho||a instanceof Xn||a instanceof dr)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof ho||i instanceof Xn||i instanceof dr)&&i.destroy()}}}class Lo{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Sl(c,i,a);this.needsUpload=!1,this._featureMap=new ya,this._featureMapWithoutIds=new ya,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,c,l,d,y,w){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(e,i,c,l,d,y,w);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,c,l,d,y){for(const w of a)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,w,c,l,d,y||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const kp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Bp(r,e){return kp[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const Np={"line-pattern":{source:ga,composite:ga},"fill-pattern":{source:ga,composite:ga},"fill-extrusion-pattern":{source:ga,composite:ga},"line-dasharray":{source:fh,composite:fh}},vc={color:{source:pc,composite:vl},number:{source:fc,composite:pc}};function Ed(r,e,i){const a=Np[r];return a&&a[i]||vc[e][i]}Ot(pu,"ConstantBinder"),Ot(yc,"PatternConstantBinder"),Ot(ho,"SourceExpressionBinder"),Ot(dr,"PatternCompositeBinder"),Ot(Xn,"CompositeExpressionBinder"),Ot(Sl,"ProgramConfiguration",{omit:["_buffers"]}),Ot(Lo,"ProgramConfigurationSet");const us=vt/Math.PI/2,xc=5,Rf=6,Ad=16383,El=64,mu=[El,32,16],Xs=-us,Bs=us;function ko(r,e,i,a=us){return i=Gi(i),[r*Math.sin(i)*a,-e*a,r*Math.cos(i)*a]}function Bo(r,e,i){return ko(Math.cos(Gi(r)),Math.sin(Gi(r)),e,i)}const Al=63710088e-1,wh=2*Math.PI*Al;class rn{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new rn(aa(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,c=e.lat*i,l=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return Al*Math.acos(Math.min(l,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new vs({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return Bo(this.lat,this.lng,us+e*us/Al)}static convert(e){if(e instanceof rn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new rn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new rn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class vs{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{const a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof rn?new rn(e.lng,e.lat):rn.convert(e),this}setSouthWest(e){return this._sw=e instanceof rn?new rn(e.lng,e.lat):rn.convert(e),this}extend(e){const i=this._sw,a=this._ne;let c,l;if(e instanceof rn)c=e,l=e;else{if(!(e instanceof vs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(vs.convert(e)):this.extend(rn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(rn.convert(e)):this;if(c=e._sw,l=e._ne,!c||!l)return this}return i||a?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),a.lng=Math.max(l.lng,a.lng),a.lat=Math.max(l.lat,a.lat)):(this._sw=new rn(c.lng,c.lat),this._ne=new rn(l.lng,l.lat)),this}getCenter(){return new rn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new rn(this.getWest(),this.getNorth())}getSouthEast(){return new rn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=rn.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){if(e)return e instanceof vs?e:new vs(e)}}const Df=0,Jm=25.5;function Th(r){return wh*Math.cos(r*Math.PI/180)}function is(r){return(180+r)/360}function Zr(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Cr(r,e){return r/Th(e)}function ns(r){return 360*r-180}function yn(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function zf(r,e){return r*Th(yn(e))}const Ns=85.051129;function Pf(r){return Math.cos(Gi(Di(r,-85.051129,Ns)))}function ba(r,e){const i=Di(e,Df,Jm),a=Math.pow(2,i);return Pf(r)*wh/(512*a)}function Ml(r){return 1/Math.cos(r*Math.PI/180)}function h(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/vt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/vt/(1<<r.z)}class t{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=rn.convert(e);return new t(is(a.lng),Zr(a.lat),Cr(i,a.lat))}toLngLat(){return new rn(ns(this.x),yn(this.y))}toAltitude(){return zf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/wh*Ml(yn(this.y))}}function n(r,e,i,a,c,l,d,y,w){const A=(e+a)/2,_=(i+c)/2,T=new Mt(A,_);y(T),function(I,E,M,z,B,N){const H=M-B,G=z-N;return Math.abs((z-E)*H-(M-I)*G)/Math.hypot(H,G)}(T.x,T.y,l.x,l.y,d.x,d.y)>=w?(n(r,e,i,A,_,l,T,y,w),n(r,A,_,a,c,T,d,y,w)):r.push(d)}function u(r,e,i){let a=r[0],c=a.x,l=a.y;e(a);const d=[a];for(let y=1;y<r.length;y++){const w=r[y],{x:A,y:_}=w;e(w),n(d,c,l,A,_,a,w,e,i),c=A,l=_,a=w}return d}function p(r,e,i,a){if(a(e,i)){const c=e.add(i)._mult(.5);p(r,e,c,a),p(r,c,i,a)}else r.push(i)}function g(r,e){let i=r[0];const a=[i];for(let c=1;c<r.length;c++){const l=r[c];p(a,i,l,e),i=l}return a}const x=Math.pow(2,14)-1,C=-x-1;function P(r,e){const i=Math.round(r.x*e),a=Math.round(r.y*e);return r.x=Di(i,C,x),r.y=Di(a,C,x),(i<r.x||i>r.x+1||a<r.y||a>r.y+1)&&Pn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function O(r,e,i){const a=r.loadGeometry(),c=r.extent,l=vt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:y,x:w,y:A,projection:_}=i,T=I=>{const E=ns((e.x+I.x/c)/d),M=yn((e.y+I.y/c)/d),z=_.project(E,M);I.x=(z.x*y-w)*c,I.y=(z.y*y-A)*c};for(let I=0;I<a.length;I++)if(r.type!==1)a[I]=u(a[I],T,1);else{const E=[];for(const M of a[I])M.x<0||M.x>=c||M.y<0||M.y>=c||(T(M),E.push(M));a[I]=E}}for(const d of a)for(const y of d)P(y,l);return a}function k(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?O(r):[]}}function U(r,e,i,a,c){r.emplaceBack(2*e+(a+1)/2,2*i+(c+1)/2)}function F(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Z{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new oo,this.indexArray=new Fr,this.segments=new dn,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,a,c){const l=this.layers[0],d=[];let y=null;l.type==="circle"&&(y=l.layout.get("circle-sort-key"));for(const{feature:A,id:_,index:T,sourceLayerIndex:I}of e){const E=this.layers[0]._featureFilter.needGeometry,M=k(A,E);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),M,a))continue;const z=y?y.evaluate(M,{},a):void 0,B={id:_,properties:A.properties,type:A.type,sourceLayerIndex:I,index:T,geometry:E?M.geometry:O(A,a,c),patterns:{},sortKey:z};d.push(B)}y&&d.sort((A,_)=>A.sortKey-_.sortKey);let w=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new ph,w=c.projection);for(const A of d){const{geometry:_,index:T,sourceLayerIndex:I}=A,E=e[T].feature;this.addFeature(A,_,T,i.availableImages,a,w,i.brightness),i.featureIndex.insert(E,_,T,I,this.index)}}update(e,i,a,c,l,d,y){this.programConfigurations.updatePaintArrays(e,i,l,a,c,d,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Pp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,a,c,l,d,y){for(const w of i)for(const A of w){const _=A.x,T=A.y;if(_<0||_>=vt||T<0||T>=vt)continue;if(d){const M=d.projectTilePoint(_,T,l),z=d.upVector(l,_,T),B=this.globeExtVertexArray;F(B,M,z),F(B,M,z),F(B,M,z),F(B,M,z)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=I.vertexLength;U(this.layoutVertexArray,_,T,-1,-1),U(this.layoutVertexArray,_,T,1,-1),U(this.layoutVertexArray,_,T,1,1),U(this.layoutVertexArray,_,T,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+2,E+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,l,y)}}function Y(r,e){for(let i=0;i<r.length;i++)if(ge(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(ge(r,e[i]))return!0;return!!oe(r,e)}function X(r,e,i){return!!ge(r,e)||!!ce(e,r,i)}function J(r,e){if(r.length===1)return _e(e,r[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let c=0;c<a.length;c++)if(ge(r,a[c]))return!0}for(let i=0;i<r.length;i++)if(_e(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(oe(r,e[i]))return!0;return!1}function ee(r,e,i){if(r.length>1){if(oe(r,e))return!0;for(let a=0;a<e.length;a++)if(ce(e[a],r,i))return!0}for(let a=0;a<r.length;a++)if(ce(r[a],e,i))return!0;return!1}function oe(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const a=r[i],c=r[i+1];for(let l=0;l<e.length-1;l++)if(fe(a,c,e[l],e[l+1]))return!0}return!1}function fe(r,e,i,a){return bn(r,i,a)!==bn(e,i,a)&&bn(r,e,i)!==bn(r,e,a)}function ce(r,e,i){const a=i*i;if(e.length===1)return r.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(xe(r,e[c-1],e[c])<a)return!0;return!1}function xe(r,e,i){const a=e.distSqr(i);if(a===0)return r.distSqr(e);const c=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/a;return r.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function _e(r,e){let i,a,c,l=!1;for(let d=0;d<r.length;d++){i=r[d];for(let y=0,w=i.length-1;y<i.length;w=y++)a=i[y],c=i[w],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(l=!l)}return l}function ge(r,e){let i=!1;for(let a=0,c=r.length-1;a<r.length;c=a++){const l=r[a],d=r[c];l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(i=!i)}return i}function ye(r,e,i,a,c){for(const d of r)if(e<=d.x&&i<=d.y&&a>=d.x&&c>=d.y)return!0;const l=[new Mt(e,i),new Mt(e,c),new Mt(a,c),new Mt(a,i)];if(r.length>2){for(const d of l)if(ge(r,d))return!0}for(let d=0;d<r.length-1;d++)if(we(r[d],r[d+1],l))return!0;return!1}function we(r,e,i){const a=i[0],c=i[2];if(r.x<a.x&&e.x<a.x||r.x>c.x&&e.x>c.x||r.y<a.y&&e.y<a.y||r.y>c.y&&e.y>c.y)return!1;const l=bn(r,e,i[0]);return l!==bn(r,e,i[1])||l!==bn(r,e,i[2])||l!==bn(r,e,i[3])}function Ae(r,e,i,a,c,l){let d=e.y-r.y,y=r.x-e.x;if(l=l||0){const w=d*d+y*y;if(w===0)return!0;const A=Math.sqrt(w);d/=A,y/=A}return!((i.x-r.x)*d+(i.y-r.y)*y-l<0||(a.x-r.x)*d+(a.y-r.y)*y-l<0||(c.x-r.x)*d+(c.y-r.y)*y-l<0)}function je(r,e,i,a,c,l,d){return!(Ae(r,e,a,c,l,d)||Ae(e,i,a,c,l,d)||Ae(i,r,a,c,l,d)||Ae(a,c,r,e,i,d)||Ae(c,l,r,e,i,d)||Ae(l,a,r,e,i,d))}function Be(r,e,i){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(r)}function Qe(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function nt(r,e,i,a,c){if(!e[0]&&!e[1])return r;const l=Mt.convert(e)._mult(c);i==="viewport"&&l._rotate(-a);const d=[];for(let y=0;y<r.length;y++)d.push(r[y].sub(l));return d}function dt(r,e,i,a){const c=Mt.convert(r)._mult(a);return e==="viewport"&&c._rotate(-i),c}let Le,et;Ot(Z,"CircleBucket",{omit:["layers"]});var Oe,tt={exports:{}},Xe=(Oe||(Oe=1,function(r,e){(function(i){function a(l,d,y){var w=c(256*l,256*(d=Math.pow(2,y)-d-1),y),A=c(256*(l+1),256*(d+1),y);return w[0]+","+w[1]+","+A[0]+","+A[1]}function c(l,d,y){var w=2*Math.PI*6378137/256/Math.pow(2,y);return[l*w-2*Math.PI*6378137/2,d*w-2*Math.PI*6378137/2]}i.getURL=function(l,d,y,w,A,_){return _=_||{},l+"?"+["bbox="+a(y,w,A),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+d].join("&")},i.getTileBBox=a,i.getMercCoords=c,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,tt.exports)),tt.exports);class st{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=St(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const a=Xe.getTileBBox(this.x,this.y,this.z),c=function(l,d,y){let w,A="";for(let _=l;_>0;_--)w=1<<_-1,A+=(d&w?1:0)+(y&w?2:0);return A}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ge{constructor(e,i){this.wrap=e,this.canonical=i,this.key=St(e,i.z,i.z,i.x,i.y)}}class rt{constructor(e,i,a,c,l){this.overscaledZ=e,this.wrap=i,this.canonical=new st(a,+c,+l),this.key=i===0&&e===a?this.canonical.key:St(i,e,a,c,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new rt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rt(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return St(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return St(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new rt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new rt(i,this.wrap,i,a,c),new rt(i,this.wrap,i,a+1,c),new rt(i,this.wrap,i,a,c+1),new rt(i,this.wrap,i,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new rt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new rt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ge(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function St(r,e,i,a,c){const l=1<<Math.min(i,22);let d=l*(c%l)+a%l;return r&&i<22&&(d+=l*l*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}const Et=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new rt(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new rt(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new rt(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new rt(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Ot(st,"CanonicalTileID"),Ot(rt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const It=nn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Vt}=It,di=nn([{name:"a_pos_3",components:3,type:"Int16"}]);var Qt=nn([{name:"a_pos",type:"Int16",components:2}]);class ui{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const c=ue.vec2.dot(i,this.dir);if(Math.abs(c)<1e-6)return!1;const l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/c;return a[0]=this.pos[0]+this.dir[0]*l,a[1]=this.pos[1]+this.dir[1]*l,!0}}class li{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const c=ue.vec3.dot(i,this.dir);if(Math.abs(c)<1e-6)return!1;const l=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return a[0]=this.pos[0]+this.dir[0]*l,a[1]=this.pos[1]+this.dir[1]*l,a[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,i,a){if(ue.vec3.equals(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[c,l,d]=this.dir,y=this.pos[0]-e[0],w=this.pos[1]-e[1],A=this.pos[2]-e[2],_=c*c+l*l+d*d,T=2*(y*c+w*l+A*d),I=T*T-4*_*(y*y+w*w+A*A-i*i);if(I<0){const E=Math.max(-T/2,0),M=y+c*E,z=w+l*E,B=A+d*E,N=Math.hypot(M,z,B);return a[0]=M*i/N,a[1]=z*i/N,a[2]=B*i/N,!1}{const E=(-T-Math.sqrt(I))/(2*_);if(E<0){const M=Math.hypot(y,w,A);return a[0]=y*i/M,a[1]=w*i/M,a[2]=A*i/M,!1}return a[0]=y+c*E,a[1]=w+l*E,a[2]=A+d*E,!0}}}class Ui{constructor(e,i,a,c,l){this.TL=e,this.TR=i,this.BR=a,this.BL=c,this.horizon=l}static fromInvProjectionMatrix(e,i,a){const c=[-1,1,1],l=[1,1,1],d=[1,-1,1],y=[-1,-1,1],w=ue.vec3.transformMat4(c,c,e),A=ue.vec3.transformMat4(l,l,e),_=ue.vec3.transformMat4(d,d,e),T=ue.vec3.transformMat4(y,y,e);return new Ui(w,A,_,T,i/a)}}function sn(r,e,i){let a=1/0,c=-1/0;const l=[];for(const d of r){ue.vec3.sub(l,d,e);const y=ue.vec3.dot(l,i);a=Math.min(a,y),c=Math.max(c,y)}return[a,c]}function Si(r,e){let i=!0;for(let a=0;a<r.planes.length;a++){const c=r.planes[a];let l=0;for(let d=0;d<e.length;d++)l+=ue.vec3.dot(c,e[d])+c[3]>=0;if(l===0)return 0;l!==e.length&&(i=!1)}return i?2:1}function ii(r,e){for(const i of r.projections){const a=sn(e,r.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function bi(r,e){let i=0;const a=[0,0,0,0];for(let c=0;c<r.length;c++)a[0]=r[c][0],a[1]=r[c][1],a[2]=r[c][2],a[3]=1,ue.vec4.dot(a,e)>=0&&i++;return i}class Ht{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=At.fromPoints(this.points),this.projections=[],this.frustumEdges=[ue.vec3.sub([],this.points[2],this.points[3]),ue.vec3.sub([],this.points[0],this.points[3]),ue.vec3.sub([],this.points[4],this.points[0]),ue.vec3.sub([],this.points[5],this.points[1]),ue.vec3.sub([],this.points[6],this.points[2]),ue.vec3.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const c=[0,-a[2],a[1]],l=[a[2],0,-a[0]];this.projections.push({axis:c,projection:sn(this.points,this.points[0],c)}),this.projections.push({axis:l,projection:sn(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,i,a,c){const l=Math.pow(2,a),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const _=ue.vec4.transformMat4([],A,e),T=1/_[3]/i*l;return ue.vec4.mul(_,_,[T,T,c?1/_[3]:T,T])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const _=ue.vec3.sub([],d[A[0]],d[A[1]]),T=ue.vec3.sub([],d[A[2]],d[A[1]]),I=ue.vec3.normalize([],ue.vec3.cross([],_,T)),E=-ue.vec3.dot(I,d[A[1]]);return I.concat(E)}),w=[];for(let A=0;A<d.length;A++)w.push([d[A][0],d[A][1],d[A][2]]);return new Ht(w,y)}intersectsPrecise(e,i,a){for(let c=0;c<i.length;c++)if(!bi(e,i[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!bi(e,this.planes[c]))return 0;for(const c of a)for(const l of this.frustumEdges){const d=ue.vec3.cross([],c,l),y=ue.vec3.length(d);if(y===0)continue;ue.vec3.scale(d,d,1/y);const w=sn(this.points,this.points[0],d),A=sn(e,this.points[0],d);if(w[0]>A[1]||A[0]>w[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const a=i[3];if(ue.vec3.dot([i[0],i[1],i[2]],e)+a<0)return!1}return!0}}class At{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const c of e)ue.vec3.min(i,i,c),ue.vec3.max(a,a,c);return new At(i,a)}static fromTileIdAndHeight(e,i,a){const c=1<<e.canonical.z,l=e.canonical.x,d=e.canonical.y;return new At([l/c,d/c,i],[(l+1)/c,(d+1)/c,a])}static applyTransform(e,i){const a=e.getCorners();for(let c=0;c<a.length;++c)ue.vec3.transformMat4(a[c],a[c],i);return At.fromPoints(a)}static applyTransformFast(e,i){const a=[i[12],i[13],i[14]],c=[...a];for(let l=0;l<3;l++)for(let d=0;d<3;d++){const y=i[4*d+l],w=y*e.min[d],A=y*e.max[d];a[l]+=Math.min(w,A),c[l]+=Math.max(w,A)}return new At(a,c)}static projectAabbCorners(e,i){const a=e.getCorners();for(let c=0;c<a.length;++c)ue.vec3.transformMat4(a[c],a[c],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=ue.vec3.scale([],ue.vec3.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=ue.vec3.clone(this.min),c=ue.vec3.clone(this.max);for(let l=0;l<i.length;l++)a[l]=i[l]?this.min[l]:this.center[l],c[l]=i[l]?this.center[l]:this.max[l];return c[2]=this.max[2],new At(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Si(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Si(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?ii(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?ii(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Ei(r){return r*us/Al}Ot(At,"Aabb");const Xi=[new At([Xs,Xs,Xs],[Bs,Bs,Bs]),new At([Xs,Xs,Xs],[0,0,Bs]),new At([0,Xs,Xs],[Bs,0,Bs]),new At([Xs,0,Xs],[0,Bs,Bs]),new At([0,0,Xs],[Bs,Bs,Bs])];function qi(r,e,i,a=!0){const c=ue.vec3.scale([],r._camera.position,r.worldSize),l=[e,i,1,1];ue.vec4.transformMat4(l,l,r.pixelMatrixInverse),ue.vec4.scale(l,l,1/l[3]);const d=ue.vec3.sub([],l,c),y=ue.vec3.normalize([],d),w=r.globeMatrix,A=[w[12],w[13],w[14]],_=ue.vec3.sub([],A,c),T=ue.vec3.length(_),I=ue.vec3.normalize([],_),E=r.worldSize/(2*Math.PI),M=ue.vec3.dot(I,y),z=Math.asin(E/T);if(z<Math.acos(M)){if(!a)return null;const be=[],he=[];ue.vec3.scale(be,y,T/M),ue.vec3.normalize(he,ue.vec3.sub(he,be,_)),ue.vec3.normalize(y,ue.vec3.add(y,_,ue.vec3.scale(y,he,Math.tan(z)*T)))}const B=[];new li(c,y).closestPointOnSphere(A,E,B);const N=ue.vec3.normalize([],Nl(w,0)),H=ue.vec3.normalize([],Nl(w,1)),G=ue.vec3.normalize([],Nl(w,2)),j=ue.vec3.dot(N,B),$=ue.vec3.dot(H,B),W=ue.vec3.dot(G,B),Q=Er(Math.asin(-$/E));let le=Er(Math.atan2(j,W));le=r.center.lng+function(be,he){const Te=(he-be+180)%360-180;return Te<-180?Te+360:Te}(r.center.lng,le);const se=is(le),ae=Di(Zr(Q),0,1);return new t(se,ae)}class jn{constructor(e,i,a){this.a=ue.vec3.sub([],e,a),this.b=ue.vec3.sub([],i,a),this.center=a;const c=ue.vec3.normalize([],this.a),l=ue.vec3.normalize([],this.b);this.angle=Math.acos(ue.vec3.dot(c,l))}}function kn(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(a,c,l,d){const y=Math.sin(l);return a*(Math.sin((1-d)*l)/y)+c*(Math.sin(d*l)/y)}(r.a[e],r.b[e],r.angle,Di(i,0,1))+r.center[e]}function fn(r){if(r.z<=1)return Xi[r.z+2*r.y+r.x];const e=Sn(Ri(r));return At.fromPoints(e)}function Wn(r,e,i){return ue.vec3.scale(r,r,1-i),ue.vec3.scaleAndAdd(r,r,e,i)}function $r(r,e,i){for(const a of r)ue.vec3.transformMat4(a,a,e),ue.vec3.scale(a,a,i)}function Xr(r,e,i,a){const c=e/r.worldSize,l=r.globeMatrix;if(i.z<=1){const se=fn(i).getCorners();return $r(se,l,c),At.fromPoints(se)}const d=Ri(i,a),y=Sn(d,us+Ei(r._tileCoverLift));$r(y,l,c);const w=Number.MAX_VALUE,A=[-w,-w,-w],_=[w,w,w];if(d.contains(r.center)){for(const be of y)ue.vec3.min(_,_,be),ue.vec3.max(A,A,be);A[2]=0;const se=r.point,ae=[se.x*c,se.y*c,0];return ue.vec3.min(_,_,ae),ue.vec3.max(A,A,ae),new At(_,A)}if(r._tileCoverLift>0){for(const se of y)ue.vec3.min(_,_,se),ue.vec3.max(A,A,se);return new At(_,A)}const T=[l[12]*c,l[13]*c,l[14]*c],I=d.getCenter(),E=Di(r.center.lat,-85.051129,Ns),M=Di(I.lat,-85.051129,Ns),z=is(r.center.lng),B=Zr(E);let N=z-is(I.lng);const H=B-Zr(M);N>.5?N-=1:N<-.5&&(N+=1);let G=0;if(Math.abs(N)>Math.abs(H))G=N>=0?1:3;else{G=H>=0?0:2;const se=[l[4]*c,l[5]*c,l[6]*c],ae=-Math.sin(Gi(H>=0?d.getSouth():d.getNorth()))*us;ue.vec3.scaleAndAdd(T,T,se,ae)}const j=y[G],$=y[(G+1)%4],W=new jn(j,$,T),Q=[kn(W,0)||j[0],kn(W,1)||j[1],kn(W,2)||j[2]],le=wr(r.zoom);if(le>0){const se=function({x:be,y:he,z:Te},Ie,Me,ze,De){const Ne=1/(1<<Te);let ke=be*Ne,Ue=ke+Ne,lt=he*Ne,ot=lt+Ne,Nt=0;const mt=(ke+Ue)/2-ze;return mt>.5?Nt=-1:mt<-.5&&(Nt=1),ke=((ke+Nt)*Ie-(ze*=Ie))*Me+ze,Ue=((Ue+Nt)*Ie-ze)*Me+ze,lt=(lt*Ie-(De*=Ie))*Me+De,ot=(ot*Ie-De)*Me+De,[[ke,ot,0],[Ue,ot,0],[Ue,lt,0],[ke,lt,0]]}(i,e,r._pixelsPerMercatorPixel,z,B);for(let be=0;be<y.length;be++)Wn(y[be],se[be],le);const ae=ue.vec3.add([],se[G],se[(G+1)%4]);ue.vec3.scale(ae,ae,.5),Wn(Q,ae,le)}for(const se of y)ue.vec3.min(_,_,se),ue.vec3.max(A,A,se);return _[2]=Math.min(j[2],$[2]),ue.vec3.min(_,_,Q),ue.vec3.max(A,A,Q),new At(_,A)}function Ri({x:r,y:e,z:i},a=!1){const c=1/(1<<i),l=new rn(ns(r*c),e===(1<<i)-1&&a?-90:yn((e+1)*c)),d=new rn(ns((r+1)*c),e===0&&a?90:yn(e*c));return new vs(l,d)}function Sn(r,e=us){const i=Gi(r.getNorth()),a=Gi(r.getSouth()),c=Math.cos(i),l=Math.cos(a),d=Math.sin(i),y=Math.sin(a),w=r.getWest(),A=r.getEast();return[ko(l,y,w,e),ko(l,y,A,e),ko(c,d,A,e),ko(c,d,w,e)]}function Wi(r,e,i,a){const c=1<<i.z,l=(r/vt+i.x)/c;return Bo(yn((e/vt+i.y)/c),ns(l),a)}function $i({min:r,max:e}){return Ad/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const Rr=new Float64Array(16);function Rn(r){const e=$i(r),i=ue.mat4.fromScaling(Rr,[e,e,e]);return ue.mat4.translate(i,i,ue.vec3.negate([],r.min))}function ar(r){const e=ue.mat4.fromTranslation(Rr,r.min),i=1/$i(r);return ue.mat4.scale(e,e,[i,i,i])}function na(r){const e=vt/(2*Math.PI);return r/(2*Math.PI)/e}function Dr(r,e){return vt/(512*Math.pow(2,r))*$i(fn(e))}function Yn(r,e,i,a,c){const l=na(i),d=[r,e,-i/(2*Math.PI)],y=ue.mat4.identity(new Float64Array(16));return ue.mat4.translate(y,y,d),ue.mat4.scale(y,y,[l,l,l]),ue.mat4.rotateX(y,y,Gi(-c)),ue.mat4.rotateY(y,y,Gi(-a)),y}function wr(r){return As(xc,Rf,r)}function hs(r,e){const i=Bo(e.lat,e.lng),a=function(l){const d=Bo(l._center.lat,l._center.lng),y=ue.vec3.fromValues(0,1,0);let w=ue.vec3.cross([],y,d);const A=ue.mat4.fromRotation([],-l.angle,d);w=ue.vec3.transformMat4(w,w,A),ue.mat4.fromRotation(A,-l._pitch,w);const _=ue.vec3.normalize([],d);return ue.vec3.scale(_,_,Ei(l.cameraToCenterDistance/l.pixelsPerMeter)),ue.vec3.transformMat4(_,_,A),ue.vec3.add([],d,_)}(r),c=ue.vec3.subtract([],a,i);return ue.vec3.angle(c,i)}function Wr(r,e){return hs(r,e)>Math.PI/2*1.01}const Na=Gi(85),wa=Math.cos(Na),fo=Math.sin(Na),bc=ue.mat4.create(),Il=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function xs(r,e,i,a,c,l,d,y,w){if(l&&r.queryGeometry.isAboveHorizon)return!1;l&&(w*=r.pixelToTileUnitsFactor);const A=r.tileID.canonical,_=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const T of e)for(const I of T){const E=I.add(y),M=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(E.x,E.y,!0):0,z=i.projection.projectTilePoint(E.x,E.y,A);if(M>0){const G=i.projection.upVector(A,E.x,E.y);z.x+=G[0]*_*M,z.y+=G[1]*_*M,z.z+=G[2]*_*M}const B=l?E:Md(z.x,z.y,z.z,a),N=l?r.tilespaceRays.map(G=>ug(G,M)):r.queryGeometry.screenGeometry,H=ue.vec4.transformMat4([],[z.x,z.y,z.z,1],a);if(!d&&l?w*=H[3]/i.cameraToCenterDistance:d&&!l&&(w*=i.cameraToCenterDistance/H[3]),l){const G=yn((I.y/vt+A.y)/(1<<A.z));w/=i.projection.pixelsPerMeter(G,1)/Cr(1,G)}if(X(N,B,w))return!0}return!1}function Md(r,e,i,a){const c=ue.vec4.transformMat4([],[r,e,i,1],a);return new Mt(c[0]/c[3],c[1]/c[3])}const Ta=ue.vec3.fromValues(0,0,0),cg=ue.vec3.fromValues(0,0,1);function ug(r,e){const i=ue.vec3.create();return Ta[2]=e,r.intersectsPlane(Ta,cg,i),new Mt(i[0],i[1])}class hg extends Z{}let wc,Of,Fp,Sh;function Qm(r,{width:e,height:i},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*a);return r.width=e,r.height=i,r.data=c,r}function e_(r,e,i){const{width:a,height:c}=e;a===r.width&&c===r.height||(Up(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,a),height:Math.min(r.height,c)},i,null),r.width=a,r.height=c,r.data=e.data)}function Up(r,e,i,a,c,l,d,y){if(c.width===0||c.height===0)return e;if(c.width>r.width||c.height>r.height||i.x>r.width-c.width||i.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const w=r.data,A=e.data,_=l===4&&y;for(let T=0;T<c.height;T++){const I=((i.y+T)*r.width+i.x)*l,E=((a.y+T)*e.width+a.x)*l;if(_)for(let M=0;M<c.width;M++){const z=I+M*l+3,B=E+M*l;A[B+0]=255,A[B+1]=255,A[B+2]=255,A[B+3]=w[z]}else if(d)for(let M=0;M<c.width;M++){const z=I+M*l,B=E+M*l,N=w[z+3],H=new on(w[z+0]/255*N,w[z+1]/255*N,w[z+2]/255*N,N).toRenderColor(d).toArray();A[B+0]=H[0],A[B+1]=H[1],A[B+2]=H[2],A[B+3]=H[3]}else for(let M=0;M<c.width*l;M++)A[E+M]=w[I+M]}return e}Ot(hg,"HeatmapBucket",{omit:["layers"]});class Cl{constructor(e,i){Qm(this,e,1,i)}resize(e){e_(this,new Cl(e),1)}clone(){return new Cl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,c,l){Up(e,i,a,c,l,1,null)}}class Ur{constructor(e,i){Qm(this,e,4,i)}resize(e){e_(this,new Ur(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ur({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,c,l,d,y){Up(e,i,a,c,l,4,d,y)}}class dg{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Lf(r){const e={},i=r.resolution||256,a=r.clips?r.clips.length:1,c=r.image||new Ur({width:i,height:a}),l=(d,y,w)=>{e[r.evaluationKey]=w;const A=r.expression.evaluate(e);A&&(c.data[d+y+0]=Math.floor(255*A.r/A.a),c.data[d+y+1]=Math.floor(255*A.g/A.a),c.data[d+y+2]=Math.floor(255*A.b/A.a),c.data[d+y+3]=Math.floor(255*A.a))};if(r.clips)for(let d=0,y=0;d<a;++d,y+=4*i)for(let w=0,A=0;w<i;w++,A+=4){const _=w/(i-1),{start:T,end:I}=r.clips[d];l(y,A,T*(1-_)+I*_)}else for(let d=0,y=0;d<i;d++,y+=4)l(0,y,d/(i-1));return c}Ot(Cl,"AlphaImage"),Ot(Ur,"RGBAImage");const sv=nn([{name:"a_pos",components:2,type:"Int16"}],4),fg=nn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),pg=nn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Id=nn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function _u(r,e,i=2){const a=e&&e.length,c=a?e[0]*i:r.length;let l=t_(r,0,c,i,!0);const d=[];if(!l||l.next===l.prev)return d;let y,w,A;if(a&&(l=function(_,T,I,E){const M=[];for(let z=0,B=T.length;z<B;z++){const N=t_(_,T[z]*E,z<B-1?T[z+1]*E:_.length,E,!1);N===N.next&&(N.steiner=!0),M.push(av(N))}M.sort(yg);for(let z=0;z<M.length;z++)I=vg(M[z],I);return I}(r,e,l,i)),r.length>80*i){y=1/0,w=1/0;let _=-1/0,T=-1/0;for(let I=i;I<c;I+=i){const E=r[I],M=r[I+1];E<y&&(y=E),M<w&&(w=M),E>_&&(_=E),M>T&&(T=M)}A=Math.max(_-y,T-w),A=A!==0?32767/A:0}return Cd(l,d,i,y,w,A,0),d}function t_(r,e,i,a,c){let l;if(c===function(d,y,w,A){let _=0;for(let T=y,I=w-A;T<w;T+=A)_+=(d[I]-d[T])*(d[T+1]+d[I+1]),I=T;return _}(r,e,i,a)>0)for(let d=e;d<i;d+=a)l=vu(d/a|0,r[d],r[d+1],l);else for(let d=i-a;d>=e;d-=a)l=vu(d/a|0,r[d],r[d+1],l);return l&&jp(l,l.next)&&(Sa(l),l=l.next),l}function gu(r,e){if(!r)return r;e||(e=r);let i,a=r;do if(i=!1,a.steiner||!jp(a,a.next)&&zr(a.prev,a,a.next)!==0)a=a.next;else{if(Sa(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function Cd(r,e,i,a,c,l,d){if(!r)return;!d&&l&&function(w,A,_,T){let I=w;do I.z===0&&(I.z=kf(I.x,I.y,A,_,T)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==w);I.prevZ.nextZ=null,I.prevZ=null,function(E){let M,z=1;do{let B,N=E;E=null;let H=null;for(M=0;N;){M++;let G=N,j=0;for(let W=0;W<z&&(j++,G=G.nextZ,G);W++);let $=z;for(;j>0||$>0&&G;)j!==0&&($===0||!G||N.z<=G.z)?(B=N,N=N.nextZ,j--):(B=G,G=G.nextZ,$--),H?H.nextZ=B:E=B,B.prevZ=H,H=B;N=G}H.nextZ=null,z*=2}while(M>1)}(I)}(r,a,c,l);let y=r;for(;r.prev!==r.next;){const w=r.prev,A=r.next;if(l?_g(r,a,c,l):mg(r))e.push(w.i,r.i,A.i),Sa(r),r=A.next,y=A.next;else if((r=A)===y){d?d===1?Cd(r=gg(gu(r),e),e,i,a,c,l,2):d===2&&Vp(r,e,i,a,c,l):Cd(gu(r),e,i,a,c,l,1);break}}}function mg(r){const e=r.prev,i=r,a=r.next;if(zr(e,i,a)>=0)return!1;const c=e.x,l=i.x,d=a.x,y=e.y,w=i.y,A=a.y,_=c<l?c<d?c:d:l<d?l:d,T=y<w?y<A?y:A:w<A?w:A,I=c>l?c>d?c:d:l>d?l:d,E=y>w?y>A?y:A:w>A?w:A;let M=a.next;for(;M!==e;){if(M.x>=_&&M.x<=I&&M.y>=T&&M.y<=E&&Eh(c,y,l,w,d,A,M.x,M.y)&&zr(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function _g(r,e,i,a){const c=r.prev,l=r,d=r.next;if(zr(c,l,d)>=0)return!1;const y=c.x,w=l.x,A=d.x,_=c.y,T=l.y,I=d.y,E=y<w?y<A?y:A:w<A?w:A,M=_<T?_<I?_:I:T<I?T:I,z=y>w?y>A?y:A:w>A?w:A,B=_>T?_>I?_:I:T>I?T:I,N=kf(E,M,e,i,a),H=kf(z,B,e,i,a);let G=r.prevZ,j=r.nextZ;for(;G&&G.z>=N&&j&&j.z<=H;){if(G.x>=E&&G.x<=z&&G.y>=M&&G.y<=B&&G!==c&&G!==d&&Eh(y,_,w,T,A,I,G.x,G.y)&&zr(G.prev,G,G.next)>=0||(G=G.prevZ,j.x>=E&&j.x<=z&&j.y>=M&&j.y<=B&&j!==c&&j!==d&&Eh(y,_,w,T,A,I,j.x,j.y)&&zr(j.prev,j,j.next)>=0))return!1;j=j.nextZ}for(;G&&G.z>=N;){if(G.x>=E&&G.x<=z&&G.y>=M&&G.y<=B&&G!==c&&G!==d&&Eh(y,_,w,T,A,I,G.x,G.y)&&zr(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;j&&j.z<=H;){if(j.x>=E&&j.x<=z&&j.y>=M&&j.y<=B&&j!==c&&j!==d&&Eh(y,_,w,T,A,I,j.x,j.y)&&zr(j.prev,j,j.next)>=0)return!1;j=j.nextZ}return!0}function gg(r,e){let i=r;do{const a=i.prev,c=i.next.next;!jp(a,c)&&Bf(a,i,i.next,c)&&yu(a,c)&&yu(c,a)&&(e.push(a.i,i.i,c.i),Sa(i),Sa(i.next),i=r=c),i=i.next}while(i!==r);return gu(i)}function Vp(r,e,i,a,c,l){let d=r;do{let y=d.next.next;for(;y!==d.prev;){if(d.i!==y.i&&ov(d,y)){let w=qp(d,y);return d=gu(d,d.next),w=gu(w,w.next),Cd(d,e,i,a,c,l,0),void Cd(w,e,i,a,c,l,0)}y=y.next}d=d.next}while(d!==r)}function yg(r,e){return r.x-e.x}function vg(r,e){const i=function(c,l){let d=l;const y=c.x,w=c.y;let A,_=-1/0;do{if(w<=d.y&&w>=d.next.y&&d.next.y!==d.y){const z=d.x+(w-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(z<=y&&z>_&&(_=z,A=d.x<d.next.x?d:d.next,z===y))return A}d=d.next}while(d!==l);if(!A)return null;const T=A,I=A.x,E=A.y;let M=1/0;d=A;do{if(y>=d.x&&d.x>=I&&y!==d.x&&Eh(w<E?y:_,w,I,E,w<E?_:y,w,d.x,d.y)){const z=Math.abs(w-d.y)/(y-d.x);yu(d,c)&&(z<M||z===M&&(d.x>A.x||d.x===A.x&&or(A,d)))&&(A=d,M=z)}d=d.next}while(d!==T);return A}(r,e);if(!i)return e;const a=qp(i,r);return gu(a,a.next),gu(i,i.next)}function or(r,e){return zr(r.prev,r,e.prev)<0&&zr(e.next,r,r.next)<0}function kf(r,e,i,a,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function av(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Eh(r,e,i,a,c,l,d,y){return(c-d)*(e-y)>=(r-d)*(l-y)&&(r-d)*(a-y)>=(i-d)*(e-y)&&(i-d)*(l-y)>=(c-d)*(a-y)}function ov(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,a){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==a.i&&c.next.i!==a.i&&Bf(c,c.next,i,a))return!0;c=c.next}while(c!==i);return!1}(r,e)&&(yu(r,e)&&yu(e,r)&&function(i,a){let c=i,l=!1;const d=(i.x+a.x)/2,y=(i.y+a.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&d<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(l=!l),c=c.next;while(c!==i);return l}(r,e)&&(zr(r.prev,r,e.prev)||zr(r,e.prev,e))||jp(r,e)&&zr(r.prev,r,r.next)>0&&zr(e.prev,e,e.next)>0)}function zr(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function jp(r,e){return r.x===e.x&&r.y===e.y}function Bf(r,e,i,a){const c=Rd(zr(r,e,i)),l=Rd(zr(r,e,a)),d=Rd(zr(i,a,r)),y=Rd(zr(i,a,e));return c!==l&&d!==y||!(c!==0||!Tc(r,i,e))||!(l!==0||!Tc(r,a,e))||!(d!==0||!Tc(i,r,a))||!(y!==0||!Tc(i,e,a))}function Tc(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function Rd(r){return r>0?1:r<0?-1:0}function yu(r,e){return zr(r.prev,r,r.next)<0?zr(r,e,r.next)>=0&&zr(r,r.prev,e)>=0:zr(r,e,r.prev)<0||zr(r,r.next,e)<0}function qp(r,e){const i=Ah(r.i,r.x,r.y),a=Ah(e.i,e.x,e.y),c=r.next,l=e.prev;return r.next=e,e.prev=r,i.next=c,c.prev=i,a.next=i,i.prev=a,l.next=a,a.prev=l,a}function vu(r,e,i,a){const c=Ah(r,e,i);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Sa(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Ah(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Gp(r,e){const i=r.length;if(i<=1)return[r];const a=[];let c,l;for(let d=0;d<i;d++){const y=Vc(r[d]);y!==0&&(r[d].area=Math.abs(y),l===void 0&&(l=y<0),l===y<0?(c&&a.push(c),c=[r[d]]):c.push(r[d]))}if(c&&a.push(c),e>1)for(let d=0;d<a.length;d++)a[d].length<=e||(gp(a[d],e,1,a[d].length-1,xg),a[d]=a[d].slice(0,e));return a}function xg(r,e){return e.area-r.area}function i_(r,e,i=1){if(!r)return null;const a=typeof r=="string"?os.from(r).getPrimary():r.getPrimary(),c=a.id.toString();return e.has(c)||e.set(c,[]),a.scaleSelf(i),e.get(c).push(a),a.toString()}function Hp(r,e,i,a){const c=a.patternDependencies;let l=!1;for(const d of e){const y=d.paint.get(`${r}-pattern`);y.isConstant()||(l=!0),i_(y.constantOr(null),c,i)&&(l=!0)}return l}function Zp(r,e,i,a,c,l){const d=l.patternDependencies;for(const y of e){const w=y.paint.get(`${r}-pattern`).value;if(w.kind!=="constant"){let A=w.evaluate({zoom:a},i,{},l.availableImages);A=A&&A.name?A.name:A;const _=i_(A,d,c);_&&(i.patterns[y.id]=_)}}return i}var n_,$p,Xp,r_,s_,Wp,Yp,Kp={};function bg(){if($p)return n_;$p=1;var r=$a();function e(c,l,d,y,w){this.properties={},this.extent=d,this.type=0,this._pbf=c,this._geometry=-1,this._keys=y,this._values=w,c.readFields(i,this,l)}function i(c,l,d){c==1?l.id=d.readVarint():c==2?function(y,w){for(var A=y.readVarint()+y.pos;y.pos<A;){var _=w._keys[y.readVarint()],T=w._values[y.readVarint()];w.properties[_]=T}}(d,l):c==3?l.type=d.readVarint():c==4&&(l._geometry=d.pos)}function a(c){for(var l,d,y=0,w=0,A=c.length,_=A-1;w<A;_=w++)y+=((d=c[_]).x-(l=c[w]).x)*(l.y+d.y);return y}return n_=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var l,d=c.readVarint()+c.pos,y=1,w=0,A=0,_=0,T=[];c.pos<d;){if(w<=0){var I=c.readVarint();y=7&I,w=I>>3}if(w--,y===1||y===2)A+=c.readSVarint(),_+=c.readSVarint(),y===1&&(l&&T.push(l),l=[]),l.push(new r(A,_));else{if(y!==7)throw new Error("unknown command "+y);l&&l.push(l[0].clone())}}return l&&T.push(l),T},e.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var l=c.readVarint()+c.pos,d=1,y=0,w=0,A=0,_=1/0,T=-1/0,I=1/0,E=-1/0;c.pos<l;){if(y<=0){var M=c.readVarint();d=7&M,y=M>>3}if(y--,d===1||d===2)(w+=c.readSVarint())<_&&(_=w),w>T&&(T=w),(A+=c.readSVarint())<I&&(I=A),A>E&&(E=A);else if(d!==7)throw new Error("unknown command "+d)}return[_,I,T,E]},e.prototype.toGeoJSON=function(c,l,d){var y,w,A=this.extent*Math.pow(2,d),_=this.extent*c,T=this.extent*l,I=this.loadGeometry(),E=e.types[this.type];function M(N){for(var H=0;H<N.length;H++){var G=N[H];N[H]=[360*(G.x+_)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+T)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(y=0;y<I.length;y++)z[y]=I[y][0];M(I=z);break;case 2:for(y=0;y<I.length;y++)M(I[y]);break;case 3:for(I=function(N){var H=N.length;if(H<=1)return[N];for(var G,j,$=[],W=0;W<H;W++){var Q=a(N[W]);Q!==0&&(j===void 0&&(j=Q<0),j===Q<0?(G&&$.push(G),G=[N[W]]):G.push(N[W]))}return G&&$.push(G),$}(I),y=0;y<I.length;y++)for(w=0;w<I[y].length;w++)M(I[y][w])}I.length===1?I=I[0]:E="Multi"+E;var B={type:"Feature",geometry:{type:E,coordinates:I},properties:this.properties};return"id"in this&&(B.id=this.id),B},n_}function Dd(){if(r_)return Xp;r_=1;var r=bg();function e(a,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(i,this,c),this.length=this._features.length}function i(a,c,l){a===15?c.version=l.readVarint():a===1?c.name=l.readString():a===5?c.extent=l.readVarint():a===2?c._features.push(l.pos):a===3?c._keys.push(l.readString()):a===4&&c._values.push(function(d){for(var y=null,w=d.readVarint()+d.pos;d.pos<w;){var A=d.readVarint()>>3;y=A===1?d.readString():A===2?d.readFloat():A===3?d.readDouble():A===4?d.readVarint64():A===5?d.readVarint():A===6?d.readSVarint():A===7?d.readBoolean():null}return y}(l))}return Xp=e,e.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var c=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,c,this.extent,this._keys,this._values)},Xp}function wg(){return Yp||(Yp=1,Kp.VectorTile=function(){if(Wp)return s_;Wp=1;var r=Dd();function e(i,a,c){if(i===3){var l=new r(c,c.readVarint()+c.pos);l.length&&(a[l.name]=l)}}return s_=function(i,a){this.layers=i.readFields(e,{},a)},s_}(),Kp.VectorTileFeature=bg(),Kp.VectorTileLayer=Dd()),Kp}var Sc=wg();const vn="3d_elevation_id",Jp="level";class Qp{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,a){return this.get(e,!0,i,a)}optional(e,i,a){return this.get(e,!1,i,a)}success(){return this._valid}get(e,i,a,c){const l=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&l!==void 0?a(c?c(l):l):i&&(this._valid=!1),this}}class em{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,a){return this.featureFunc(e,i,a)}parseVertex(e,i,a){return this.vertexFunc(e,i,a)}}const Tg=new em((r,e,i)=>r.reset(e).require(vn,a=>{i.id=a}).optional("fixed_height_relative",a=>{i.constantHeight=a},Fa.decodeRelativeHeight).geometry(a=>{i.bounds=a},Fa.computeBounds).success(),(r,e,i)=>r.reset(e).require(vn,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height_relative",a=>{i.height=a},Fa.decodeRelativeHeight).geometry(a=>{i.position=a},Fa.getPoint).success()),a_=new em((r,e,i)=>r.reset(e).require(vn,a=>{i.id=a}).optional("fixed_height",a=>{i.constantHeight=a},Fa.decodeMetricHeight).geometry(a=>{i.bounds=a},Fa.computeBounds).success(),(r,e,i)=>r.reset(e).require(vn,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height",a=>{i.height=a},Fa.decodeMetricHeight).geometry(a=>{i.position=a},Fa.getPoint).success());class Fa{static computeBounds(e){const i=new Mt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new Mt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const c of e[0])i.x>c.x&&(i.x=c.x),i.y>c.y&&(i.y=c.y),a.x<c.x&&(a.x=c.x),a.y<c.y&&(a.y=c.y);return{min:i,max:a}}static getPoint(e){return ue.vec2.fromValues(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],a=[],c=e.length,l=new Qp;for(let y=0;y<c;y++){const w=e.feature(y),A=w.properties.hasOwnProperty("version")?String(w.properties.version):void 0,_=(d=A)?d==="1.0.1"?a_:void 0:Tg;if(_===void 0){Pn(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const T=w.properties.hasOwnProperty("type")?w.properties.type:void 0;if(T){if(Sc.VectorTileFeature.types[w.type]==="Point"&&T==="curve_point"){const I={};_.parseVertex(l,w,I)&&i.push(I)}else if(Sc.VectorTileFeature.types[w.type]==="Polygon"&&T==="curve_meta"){const I={};_.parseFeature(l,w,I)&&a.push(I)}}}var d;return{vertices:i,features:a}}}class zd{constructor(e,i,a,c,l,d){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:a,max:a},this.safeArea=i,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||c.length!==0)){this.vertices=c,this.edges=l,this.edges=this.edges.filter(y=>y.a<this.vertices.length&&y.b<this.vertices.length&&!ue.vec2.exactEquals(this.vertices[y.a].position,this.vertices[y.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const y of this.vertices)this.vertexProps.push({dir:ue.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,y.height),this.heightRange.max=Math.max(this.heightRange.max,y.height);for(const y of this.edges){const w=this.vertices[y.a].position,A=this.vertices[y.b].position,_=ue.vec2.subtract(ue.vec2.create(),A,w),T=ue.vec2.length(_),I=ue.vec2.scale(ue.vec2.create(),_,1/T);this.edgeProps.push({vec:_,dir:I,len:T});const E=this.vertexProps[y.a].dir,M=this.vertexProps[y.b].dir;ue.vec2.add(E,E,I),ue.vec2.add(M,M,I)}for(const y of this.vertexProps)y.dir[0]===0&&y.dir[1]===0||ue.vec2.normalize(y.dir,y.dir);this.tessellate(d)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[a,c]=i;return((l,d,y)=>(1-y)*l+y*d)(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,c)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,a=Number.POSITIVE_INFINITY,c=0;const l=ue.vec2.fromValues(e.x,e.y);for(let d=0;d<this.edges.length;d++){const y=this.edges[d],w=this.edgeProps[d].dir,A=new ui(l,this.edgeProps[d].dir),_=this.vertices[y.a].position,T=this.vertices[y.b].position,I=ue.vec2.create(),E=ue.vec2.create(),M=A.intersectsPlane(_,this.vertexProps[y.a].dir,I),z=A.intersectsPlane(T,this.vertexProps[y.b].dir,E);if(!M||!z)continue;const B=ue.vec2.subtract(ue.vec2.create(),E,I),N=ue.vec2.subtract(ue.vec2.create(),l,I),H=ue.vec2.dot(B,B),G=H>0?ue.vec2.dot(N,B)/H:0,j=Di(G,0,1),$=Math.abs((G-j)*this.edgeProps[d].len),W=ue.vec2.subtract(ue.vec2.create(),l,_),Q=$+Math.abs(ue.vec2.dot(W,ue.vec2.fromValues(w[1],-w[0])));Q<a&&(i=d,a=Q,c=j)}return[i,c]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const a=this.edges[i].a,c=this.edges[i].b,{position:l,height:d,extent:y}=this.vertices[a],{position:w,height:A,extent:_}=this.vertices[c],T=this.vertexProps[a].dir,I=this.vertexProps[c].dir,E=ue.vec3.fromValues(l[0]/e,l[1]/e,d),M=ue.vec3.fromValues(w[0]/e,w[1]/e,A),z=ue.vec3.fromValues(T[1],-T[0],0);ue.vec3.scale(z,z,y);const B=ue.vec3.fromValues(I[1],-I[0],0);if(ue.vec3.scale(B,B,_),this.distSqLines(ue.vec3.fromValues(E[0]+.5*z[0],E[1]+.5*z[1],E[2]+.5*z[2]),ue.vec3.fromValues(M[0]-.5*B[0],M[1]-.5*B[1],M[2]-.5*B[2]),ue.vec3.fromValues(E[0]-.5*z[0],E[1]-.5*z[1],E[2]-.5*z[2]),ue.vec3.fromValues(M[0]+.5*B[0],M[1]+.5*B[1],M[2]+.5*B[2]))<=.05*.05)continue;const N=this.vertices.length,H=ue.vec2.add(ue.vec2.create(),l,w);this.vertices.push({position:ue.vec2.scale(H,H,.5),height:.5*(d+A),extent:.5*(y+_)});const G=ue.vec2.add(ue.vec2.create(),T,I);this.vertexProps.push({dir:ue.vec2.normalize(G,G)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a,b:N}),this.edges.push({a:N,b:c});const j=ue.vec2.subtract(ue.vec2.create(),this.vertices[N].position,l),$=ue.vec2.length(j),W={vec:j,dir:ue.vec2.scale(ue.vec2.create(),j,1/$),len:$};this.edgeProps.push(W),this.edgeProps.push(W)}}distSqLines(e,i,a,c){const l=ue.vec3.subtract(ue.vec3.create(),i,e),d=ue.vec3.subtract(ue.vec3.create(),c,a),y=ue.vec3.subtract(ue.vec3.create(),e,a),w=ue.vec3.dot(l,l),A=ue.vec3.dot(l,d),_=ue.vec3.dot(l,y),T=ue.vec3.dot(d,d),I=ue.vec3.dot(d,y),E=w*T-A*A;if(E===0){const H=ue.vec3.dot(y,d)/ue.vec3.dot(d,d),G=ue.vec3.lerp(ue.vec3.create(),a,c,H);return ue.vec3.squaredDistance(G,e)}const M=(A*I-_*T)/E,z=(w*I-A*_)/E,B=ue.vec3.lerp(ue.vec3.create(),e,i,M),N=ue.vec3.lerp(ue.vec3.create(),a,c,z);return ue.vec3.squaredDistance(B,N)}}class Pd{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*vt,this.yOffset=(e.y*this.zScale-i.y)*vt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,a){const c=this.constantElevation(i,a);return c??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),a))}computeBiasedHeight(e,i){return i<=0?e:e+i*As(0,i,e>=0?e:Math.abs(.5*e))}}Ot(zd,"ElevationFeature");class o_{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,a]of e.polygons)this.add(i,...a)}}class Mh{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Mh;let i=[];for(const A of e)i.push(...A.portals);if(i.length===0)return new Mh;const a=(A,_)=>A<=0&&_<=0||A>=vt&&_>=vt;for(const A of i){const _=A.va,T=A.vb;(a(_.x,T.x)||a(_.y,T.y))&&(A.type="border")}const c=i.filter(A=>A.type!=="unevaluated"),l=i.filter(A=>A.type==="unevaluated");if(l.length===0)return new Mh;l.sort((A,_)=>A.hash===_.hash?A.isTunnel===_.isTunnel?0:A.isTunnel?-1:1:A.hash<_.hash?1:-1),i=c.concat(l);let d=c.length,y=d,w=d;do if(y++,y===i.length||i[d].hash!==i[y].hash){if(y-d==2){w<d&&(i[w]=i[d],i[d]=null);const A=i[w],_=i[y-1];A.type=A.isTunnel!==_.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:_.connection.a},w++}d=y}while(d!==i.length);return i.splice(w),i.sort((A,_)=>A.hash<_.hash?1:-1),{portals:i}}}Ot(Mh,"ElevationPortalGraph"),Ot(o_,"ElevationPolygons");class lv{constructor(e,i,a){this.outPositions=e,this.outNormals=i,this.outIndices=a,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,a){let c=e[2];a!=null&&(c*=a);const l=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),d=this.vertexLookup.get(l);if(d!=null)return d;const y=this.outPositions.length;this.vertexLookup.set(l,y);const w=Math.trunc(16384*i[0]),A=Math.trunc(16384*i[1]),_=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],c),this.outNormals.emplaceBack(w,A,_),y}addVertices(e,i,...a){const c=[];for(const l of a){const d=this.addVertex(l,e,i);c.push(d)}return c}addTriangles(e,i,a){if(i&&a){const c=a.length===1,l=ue.vec3.fromValues(0,0,0);for(let d=0;d<e.length;d+=3){const y=i[e[d+0]],w=i[e[d+1]],A=i[e[d+2]],_=c?a[0]:a[e[d+1]],T=c?a[0]:a[e[d+2]],I=this.addVertex(ue.vec3.fromValues(y.x,y.y,c?a[0]:a[e[d+0]]),l),E=this.addVertex(ue.vec3.fromValues(w.x,w.y,_),l),M=this.addVertex(ue.vec3.fromValues(A.x,A.y,T),l);this.outIndices.emplaceBack(I,E,M)}}else for(let c=0;c<e.length;c+=3)this.outIndices.emplaceBack(e[c+0],e[c+1],e[c+2])}addQuad(e,i){const a=this.addVertices(i,void 0,...e.map(w=>ue.vec3.fromValues(w.coord.x,w.coord.y,w.height))),[c,l,d,y]=a;this.addTriangles([c,l,d,d,y,c])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class po{constructor(e){this.unevaluatedPortals=new Mh,this.portalPolygons=new o_,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new su,this.vertexNormals=new yl,this.indexArray=new Fr,this.tileToMeters=h(e)}addVertices(e,i){const a=this.unevalVertices.length;for(let c=0;c<e.length;c++)this.unevalVertices.push(e[c]),this.unevalHeights.push(i[c]);return a}addTriangles(e,i,a){const c=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const l of e)c.push(l+i)}addRenderableRing(e,i,a,c,l){const d=[new Mt(l.min.x,l.min.y),new Mt(l.max.x,l.min.y),new Mt(l.max.x,l.max.y),new Mt(l.min.x,l.max.y)];for(let y=0;y<a-1;y++){const w=i+y,A=w+1,_=this.unevalVertices[w],T=this.unevalVertices[A];if(!(_.x>=l.min.x&&_.x<=l.max.x&&_.y>=l.min.y&&_.y<=l.max.y||T.x>=l.min.x&&T.x<=l.max.x&&T.y>=l.min.y&&T.y<=l.max.y||we(_,T,d))||this.isOnBorder(_.x,T.x)||this.isOnBorder(_.y,T.y))continue;const I=po.computeEdgeHash(this.unevalVertices[w],this.unevalVertices[A]);let E,M=this.vertexHashLookup.get(po.computePosHash(_));M!=null?E=M.next:(M=this.vertexHashLookup.get(po.computePosHash(T)),E=M!=null?M.prev:I),this.unevalEdges.push({polygonIdx:e,a:w,b:A,hash:I,portalHash:E,isTunnel:c,type:"unevaluated"})}}addPortalCandidates(e,i,a,c,l){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:l});const d=i[0];this.vertexHashLookup.clear();let y=po.computeEdgeHash(d[d.length-2],d[d.length-1]);for(let w=0;w<d.length-1;w++){const A=d[w+0],_=d[w+1],T=ue.vec2.fromValues(_.x-A.x,_.y-A.y),I=ue.vec2.length(T);if(I===0)continue;let E="unevaluated";const M=c.pointElevation(A),z=c.pointElevation(_);Math.abs(M)<.01&&Math.abs(z)<.01?E="entrance":(this.isOnBorder(A.x,_.x)||this.isOnBorder(A.y,_.y))&&(E="border");const B=po.computeEdgeHash(A,_);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:A,vb:_,vab:T,length:I,hash:B,isTunnel:a,type:E});const N=po.computePosHash(A);this.vertexHashLookup.set(N,{prev:y,next:B}),y=B}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=T=>{T.primitiveLength=this.indexArray.length-T.primitiveOffset},c=new lv(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const l=i(),d=i(),y=i(),w=(T,I)=>{T.sort((M,z)=>M.type===I&&z.type!==I?-1:M.type!==I&&z.type===I?1:0);const E=T.findIndex(M=>M.type!==I);return E>=0?E:T.length};let A=0;this.unevalEdges.length>0&&(A=w(this.unevalEdges,"none"),this.constructBridgeStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters));const _=i();if(this.unevalEdges.length>0){const T=this.unevalEdges.splice(A),I=w(T,"tunnel")+A;this.unevalEdges.push(...T),this.constructTunnelStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:I})}a(y),c.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(_),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(d),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(l),this.maskSegments=dn.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.depthSegments=dn.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength),this.renderableSegments=dn.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.shadowCasterSegments=dn.simpleSegment(0,l.primitiveOffset,0,l.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,pg.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Id.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,i,a,c){const l=new Map;for(let d=a;d<c;d++){const y=i[d],w=y.a,A=y.b;l.has(w)||l.set(w,{}),l.has(A)||l.set(A,{});const _=l.get(w),T=l.get(A);e[A]>0&&(_.to=A),e[w]>0&&(T.from=w)}return l}constructBridgeStructures(e,i,a,c,l,d){const y=this.computeVertexConnections(a,c,l.min,l.max),w=1/d,A=.5*w,_=I=>ue.vec3.fromValues(i[I].x,i[I].y,a[I]*w),T=I=>{const E=y.get(I),M=E.from,z=E.to;if(!M||!z)return;const B=_(M),N=_(I),H=_(z),G=ue.vec3.fromValues(0,0,0);if(!ue.vec3.exactEquals(B,N)){const $=ue.vec3.sub(ue.vec3.create(),N,B);ue.vec3.add(G,G,ue.vec3.normalize($,$))}if(!ue.vec3.exactEquals(H,N)){const $=ue.vec3.sub(ue.vec3.create(),H,N);ue.vec3.add(G,G,ue.vec3.normalize($,$))}const j=ue.vec3.len(G);return j>0?ue.vec3.scale(G,G,1/j):void 0};for(let I=l.min;I<l.max;I++){const E=c[I],M=this.prepareEdgePoints(i,a,E,(ut,ti)=>ut>=ti);if(M==null)continue;const z=M[0],B=M[1],N=ue.vec3.fromValues(z.coord.x,z.coord.y,w*z.height),H=ue.vec3.fromValues(B.coord.x,B.coord.y,w*B.height);if(ue.vec3.exactEquals(N,H))continue;const G=ue.vec3.sub(ue.vec3.create(),H,N);ue.vec3.normalize(G,G);const j=ut=>ue.vec3.normalize(ut,ut),$=T(E.a)||G,W=T(E.b)||G,Q=j(ue.vec3.fromValues($[1],-$[0],0)),le=j(ue.vec3.fromValues(W[1],-W[0],0)),se=j(ue.vec3.cross(ue.vec3.create(),Q,$)),ae=j(ue.vec3.cross(ue.vec3.create(),le,W)),be=ue.vec3.create(),he=[ue.vec3.add(ue.vec3.create(),N,ue.vec3.scale(be,ue.vec3.sub(be,Q,se),A)),ue.vec3.add(ue.vec3.create(),N,ue.vec3.scale(be,ue.vec3.add(be,Q,se),A)),ue.vec3.add(ue.vec3.create(),N,ue.vec3.scale(be,se,A)),N],Te=[ue.vec3.add(ue.vec3.create(),H,ue.vec3.scale(be,ue.vec3.sub(be,le,ae),A)),ue.vec3.add(ue.vec3.create(),H,ue.vec3.scale(be,ue.vec3.add(be,le,ae),A)),ue.vec3.add(ue.vec3.create(),H,ue.vec3.scale(be,ae,A)),H],[Ie,Me]=e.addVertices(Q,d,he[0],he[1]),[ze,De]=e.addVertices(le,d,Te[0],Te[1]);e.addTriangles([Ie,Me,ze,Me,De,ze]);const[Ne,ke]=e.addVertices(se,d,he[1],he[2]),[Ue,lt]=e.addVertices(ae,d,Te[1],Te[2]);e.addTriangles([Ne,ke,Ue,ke,lt,Ue]);const[ot,Nt]=e.addVertices(ue.vec3.negate(Q,Q),d,he[2],he[3]),[mt,xt]=e.addVertices(ue.vec3.negate(le,le),d,Te[2],Te[3]);e.addTriangles([ot,Nt,mt,Nt,xt,mt])}}constructTunnelStructures(e,i,a,c,l,d){const y=w=>ue.vec3.normalize(w,w);for(let w=l.min;w<l.max;w++){const A=this.prepareEdgePoints(i,a,c[w],(E,M)=>E<=M);if(A==null)continue;const[_,T]=A,I=y(ue.vec3.fromValues(T.coord.y-_.coord.y,-(T.coord.x-_.coord.x),0));e.addQuad([_,T,{coord:T.coord,height:c[w].isTunnel?-.1:0},{coord:_.coord,height:c[w].isTunnel?-.1:0}],I)}for(let w=d.min;w<d.max;w++){const A=c[w],_=i[A.a],T=i[A.b],I=y(ue.vec3.fromValues(T.y-_.y,-(T.x-_.x),0));e.addQuad([{coord:T,height:0},{coord:_,height:0},{coord:_,height:a[A.a]+4},{coord:T,height:a[A.b]+4}],I),e.addQuad([{coord:_,height:0},{coord:T,height:0},{coord:T,height:a[A.b]+4},{coord:_,height:a[A.a]+4}],I)}}prepareEdgePoints(e,i,a,c){const l=e[a.a],d=e[a.b];let y=i[a.a],w=i[a.b];if(!(y!==0&&c(y,0)||w!==0&&c(w,0)))return;const A=l.clone(),_=d.clone();if(c(y,0)){if(!c(w,0)){const T=w/(w-y);_.x=Kt(_.x,A.x,T),_.y=Kt(_.y,A.y,T),w=Kt(w,y,T)}}else{const T=y/(y-w);A.x=Kt(A.x,_.x,T),A.y=Kt(A.y,_.y,T),y=Kt(y,w,T)}return[{coord:A,height:y},{coord:_,height:w}]}prepareEdges(e,i){if(i.length===0)return;i.sort((y,w)=>y.hash===w.hash?w.polygonIdx-y.polygonIdx:w.hash>y.hash?1:-1);let a=0,c=0,l=0,d=i[a].polygonIdx;do c++,(c===i.length||i[a].hash!==i[c].hash)&&((c-a==1||i[c-1].polygonIdx!==d)&&(l<a&&(i[l]=i[a],i[a]=null),i[l].type="none",l++),a=c,a!==i.length&&(d=i[a].polygonIdx));while(a!==i.length);if(i.splice(l),i.length!==0&&e.length!==0){i.sort((A,_)=>A.hash<_.hash?1:-1);let y=0,w=0;for(;y!==i.length&&w!==e.length;){const A=i[y],_=e[w];A.portalHash>_.hash?y++:_.hash>A.portalHash?w++:(A.type=_.type,y++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=vt&&i>=vt}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(po.computePosHash(e))<<32n|BigInt(po.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}class tm{constructor(e,i){this.layoutVertexArray=new oo,this.indexArray=new Fr,this.lineIndexArray=new co,this.triangleSegments=new dn,this.lineSegments=new dn,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new fc)}update(e,i,a,c,l,d,y){this.programConfigurations.updatePaintArrays(e,i,l,a,c,d,y)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,fg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,a,c,l,d){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,a,c,l,d)}}class Od{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new tm(e,!1),this.elevationBufferData=new tm(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,i){}populate(e,i,a,c){this.hasPattern=Hp("fill",this.layers,this.pixelRatio,i);const l=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:y,id:w,index:A,sourceLayerIndex:_}of e){const T=this.layers[0]._featureFilter.needGeometry,I=k(y,T);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),I,a))continue;const E=l?l.evaluate(I,{},a,i.availableImages):void 0,M={id:w,properties:y.properties,type:y.type,sourceLayerIndex:_,index:A,geometry:T?I.geometry:O(y,a,c),patterns:{},sortKey:E};d.push(M)}l&&d.sort((y,w)=>y.sortKey-w.sortKey);for(const y of d){const{geometry:w,index:A,sourceLayerIndex:_}=y;if(this.hasPattern){const T=Zp("fill",this.layers,y,this.zoom,this.pixelRatio,i);this.patternFeatures.push(T)}else this.addFeature(y,w,A,a,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[A].feature,w,A,_,this.index)}}update(e,i,a,c,l,d,y){this.bufferData.update(e,i,a,c,l,d,y),this.elevationBufferData.update(e,i,a,c,l,d,y)}addFeatures(e,i,a,c,l,d){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,a,c,d,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,a,c,l,d=[],y,w){const A=Gp(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,A,c,a,w):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(e,a,l,d,c,y),this.elevationBufferData.populatePaintArrays(e,a,l,d,c,y)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,i,a,c,l){const d=new Array,y=this.getElevationFeature(e,l);if(y){d.push({polygons:i,elevationFeature:y,elevationTileID:a});for(const w of d)if(w.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new po(w.elevationTileID));const _=w.elevationFeature.isTunnel();let T=0;e.properties.hasOwnProperty(Jp)&&(T=+e.properties[Jp]);for(const I of w.polygons)this.elevatedStructures.addPortalCandidates(w.elevationFeature.id,I,_,w.elevationFeature,T)}const A=new Pd(a,w.elevationTileID);this.addElevatedGeometry(w.polygons,A,w.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,c)}}else this.addGeometry(i,this.bufferData)}addElevatedGeometry(e,i,a,c,l){const d={elevation:a,elevationSampler:i,bias:c,index:l},[y,w]=this.addGeometry(e,this.elevationBufferData,d);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:y,max:w}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,y),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,w))}addGeometry(e,i,a){let c=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,d=null;a&&(d=a.elevationSampler.constantElevation(a.elevation,a.bias),d!=null&&(c=d,l=d));const y=(w,A,_)=>{if(a!=null)if(A.push(w),d!=null)i.elevatedLayoutVertexArray.emplaceBack(d),_.push(d);else{const T=a.elevationSampler.pointElevation(w,a.elevation,a.bias);i.elevatedLayoutVertexArray.emplaceBack(T),_.push(T),c=Math.min(c,T),l=Math.max(l,T)}};for(const w of e){let A=0;for(const G of w)A+=G.length;const _=i.triangleSegments.prepareSegment(A,i.layoutVertexArray,i.indexArray),T=_.vertexLength,I=[],E=[],M=[],z=[],B=[],N=i.layoutVertexArray.length;for(const G of w){if(G.length===0)continue;G!==w[0]&&E.push(I.length/2);const j=i.lineSegments.prepareSegment(G.length,i.layoutVertexArray,i.lineIndexArray),$=j.vertexLength;a&&B.push(i.layoutVertexArray.length-N),y(G[0],M,z),i.layoutVertexArray.emplaceBack(G[0].x,G[0].y),i.lineIndexArray.emplaceBack($+G.length-1,$),I.push(G[0].x),I.push(G[0].y);for(let W=1;W<G.length;W++)y(G[W],M,z),i.layoutVertexArray.emplaceBack(G[W].x,G[W].y),i.lineIndexArray.emplaceBack($+W-1,$+W),I.push(G[W].x),I.push(G[W].y);j.vertexLength+=G.length,j.primitiveLength+=G.length}const H=_u(I,E);for(let G=0;G<H.length;G+=3)i.indexArray.emplaceBack(T+H[G],T+H[G+1],T+H[G+2]);if(a&&this.elevationMode==="hd-road-base"){const G=a.elevation.isTunnel(),j=a.elevation.safeArea,$=this.elevatedStructures.addVertices(M,z);this.elevatedStructures.addTriangles(H,$,G);const W=B.length;if(W>0){for(let Q=0;Q<W-1;Q++)this.elevatedStructures.addRenderableRing(a.index,B[Q]+$,B[Q+1]-B[Q],G,j);this.elevatedStructures.addRenderableRing(a.index,B[W-1]+$,M.length-B[W-1],G,j)}}_.vertexLength+=A,_.primitiveLength+=H.length/3}return[c,l]}getElevationFeature(e,i){if(!i)return;const a=+e.properties[vn];return a!=null?i.find(c=>c.id===a):void 0}}let Kn,im,bs,Sg;Ot(Od,"FillBucket",{omit:["layers","patternFeatures"]}),Ot(tm,"FillBufferData"),Ot(po,"ElevatedStructures");class Nf{constructor(e,i,a,c){if(this.triangleCount=i.length/3,this.min=new Mt(0,0),this.max=new Mt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[l,d]=[e[0].clone(),e[0].clone()];for(let T=1;T<e.length;++T){const I=e[T];l.x=Math.min(l.x,I.x),l.y=Math.min(l.y,I.y),d.x=Math.max(d.x,I.x),d.y=Math.max(d.y,I.y)}if(c){const T=Math.ceil(Math.max(d.x-l.x,d.y-l.y)/c);a=Math.max(a,T)}if(a===0)return;this.min=l,this.max=d;const y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);const w=Math.max(y.x,y.y)/a;this.cellsX=Math.max(1,Math.ceil(y.x/w)),this.cellsY=Math.max(1,Math.ceil(y.y/w)),this.xScale=1/w,this.yScale=1/w;const A=[];for(let T=0;T<this.triangleCount;T++){const I=e[i[3*T+0]].sub(this.min),E=e[i[3*T+1]].sub(this.min),M=e[i[3*T+2]].sub(this.min),z=mo(Math.floor(Math.min(I.x,E.x,M.x)),this.xScale,this.cellsX),B=mo(Math.floor(Math.max(I.x,E.x,M.x)),this.xScale,this.cellsX),N=mo(Math.floor(Math.min(I.y,E.y,M.y)),this.yScale,this.cellsY),H=mo(Math.floor(Math.max(I.y,E.y,M.y)),this.yScale,this.cellsY),G=new Mt(0,0),j=new Mt(0,0),$=new Mt(0,0),W=new Mt(0,0);for(let Q=N;Q<=H;++Q){G.y=j.y=Q*w,$.y=W.y=(Q+1)*w;for(let le=z;le<=B;++le)G.x=$.x=le*w,j.x=W.x=(le+1)*w,(je(I,E,M,G,j,W)||je(I,E,M,G,W,$))&&A.push({cellIdx:Q*this.cellsX+le,triIdx:T})}}if(A.length===0)return;A.sort((T,I)=>T.cellIdx-I.cellIdx||T.triIdx-I.triIdx);let _=0;for(;_<A.length;){const T=A[_].cellIdx,I={start:this.payload.length,len:0};for(;_<A.length&&A[_].cellIdx===T;)++I.len,this.payload.push(A[_++].triIdx);this.cells[T]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=mo(e.x-this.min.x,this.xScale,this.cellsX),c=mo(e.y-this.min.y,this.yScale,this.cellsY),l=this.cells[c*this.cellsX+a];if(l){this._lazyInitLookup();for(let d=0;d<l.len;d++){const y=this.payload[l.start+d],w=Math.floor(y/8),A=1<<y%8;if(!(this.lookup[w]&A)&&(this.lookup[w]|=A,i.push(y),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const c=mo(e.x-this.min.x,this.xScale,this.cellsX),l=mo(i.x-this.min.x,this.xScale,this.cellsX),d=mo(e.y-this.min.y,this.yScale,this.cellsY),y=mo(i.y-this.min.y,this.yScale,this.cellsY);for(let w=d;w<=y;w++)for(let A=c;A<=l;A++){const _=this.cells[w*this.cellsX+A];if(_)for(let T=0;T<_.len;T++){const I=this.payload[_.start+T],E=Math.floor(I/8),M=1<<I%8;if(!(this.lookup[E]&M)&&(this.lookup[E]|=M,a.push(I),a.length===this.triangleCount))return}}}}function mo(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}Ot(Nf,"TriangleGridIndex");class Ff{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}populate(e,i,a,c){const l=[];for(const{feature:d,id:y,index:w,sourceLayerIndex:A}of e){const _=this.layers[0]._featureFilter.needGeometry,T=k(d,_);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),T,a))continue;const I={id:y,properties:d.properties,type:d.type,sourceLayerIndex:A,index:w,geometry:_?T.geometry:O(d,a,c),patterns:{}};l.push(I)}for(const d of l){const{geometry:y,index:w,sourceLayerIndex:A}=d;this.addFeature(d,y,w,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[w].feature,y,w,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,c,l,d,y){}destroy(){}addFeature(e,i,a,c,l,d=[],y){for(const w of Gp(i,2)){const A=[],_=[],T=[],I=new Mt(1/0,1/0),E=new Mt(-1/0,-1/0);for(const B of w)if(B.length!==0){B!==w[0]&&T.push(_.length/2);for(let N=0;N<B.length;N++)_.push(B[N].x),_.push(B[N].y),A.push(B[N]),I.x=Math.min(I.x,B[N].x),I.y=Math.min(I.y,B[N].y),E.x=Math.max(E.x,B[N].x),E.y=Math.max(E.y,B[N].y)}const M=_u(_,T),z=new Nf(A,M,8,256);this.footprints.push({vertices:A,indices:M,grid:z,min:I,max:E})}}}Ot(Ff,"ClipBucket",{omit:["layers"]});const Eg=nn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ag=nn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),l_=nn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),c_=nn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),cv=nn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Mg=nn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:uv}=Eg;class xu extends Mt{constructor(e,i,a){super(e,i),this.z=a}}class Ig extends xu{constructor(e,i,a,c){super(e,i,a),this.w=c}}function nm(r,e,i,a){const c=[],l=a===0?(d,y,w,A,_,T)=>{d.push(new Mt(T,w+(T-y)/(A-y)*(_-w)))}:(d,y,w,A,_,T)=>{d.push(new Mt(y+(T-w)/(_-w)*(A-y),T))};for(const d of r){const y=[];for(const w of d){if(w.length<=2)continue;const A=[];for(let I=0;I<w.length-1;I++){const E=w[I].x,M=w[I].y,z=w[I+1].x,B=w[I+1].y,N=a===0?E:M,H=a===0?z:B;N<e?H>e&&l(A,E,M,z,B,e):N>i?H<i&&l(A,E,M,z,B,i):A.push(w[I]),H<e&&N>=e&&l(A,E,M,z,B,e),H>i&&N<=i&&l(A,E,M,z,B,i)}let _=w[w.length-1];const T=a===0?_.x:_.y;T>=e&&T<=i&&A.push(_),A.length&&(_=A[A.length-1],A[0].x===_.x&&A[0].y===_.y||A.push(A[0]),y.push(A))}y.length&&c.push(y)}return c}function Ec(r,e,i,a){const c=i==="x"?"y":"x",l=(a-r[i])/(e[i]-r[i]);r[c]=r[c]+(e[c]-r[c])*l,r[i]=a,r.hasOwnProperty("z")&&(r.z=Kt(r.z,e.z,l)),r.hasOwnProperty("w")&&(r.w=Kt(r.w,e.w,l))}function u_(r,e,i,a){const c=i,l=a;for(const d of["x","y"]){let y=r,w=e;y[d]>=w[d]&&(y=e,w=r),y[d]<c&&w[d]>c&&Ec(y,w,d,c),y[d]<l&&w[d]>l&&Ec(w,y,d,l)}}const Ld=Number.MAX_SAFE_INTEGER;function Cg(r,e,i,a){return r.order<e||r.order===Ld||!(r.clipMask&i)||function(c,l){return l.length!==0&&l.find(d=>d===c)===void 0}(a,r.clipScope)}function rm(r,e){return r.x-e.x||r.y-e.y}function sm(r,e){return rm(r.min,e.min)===0&&rm(r.max,e.max)===0}function h_(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function Ua(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!sm(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!Aa(r[i].clipScope,e[i].clipScope))return!1;return!0}function am(r,e,i){const a=1/vt,c=1/(1<<i.canonical.z),l=(e.x*a+i.canonical.x)*c+i.wrap,d=(e.y*a+i.canonical.y)*c;return{min:new Mt((r.x*a+i.canonical.x)*c+i.wrap,(r.y*a+i.canonical.y)*c),max:new Mt(l,d)}}function Rg(r,e,i){const a=1<<i.canonical.z,c=((e.x-i.wrap)*a-i.canonical.x)*vt,l=(e.y*a-i.canonical.y)*vt;return{min:new Mt(((r.x-i.wrap)*a-i.canonical.x)*vt,(r.y*a-i.canonical.y)*vt),max:new Mt(c,l)}}function d_(r,e,i,a,c,l,d){const y=r.indices,w=r.vertices,A=[];for(let _=a;_<a+c;_+=3){const T=e[i[_+0]+l],I=e[i[_+1]+l],E=e[i[_+2]+l],M=Math.min(T.x,I.x,E.x),z=Math.max(T.x,I.x,E.x),B=Math.min(T.y,I.y,E.y),N=Math.max(T.y,I.y,E.y);A.length=0,r.grid.query(new Mt(M,B),new Mt(z,N),A);for(let H=0;H<A.length;H++){const G=A[H];if(je(w[y[3*G+0]],w[y[3*G+1]],w[y[3*G+2]],T,I,E,d))return!0}}return!1}function kd(r,e,i,a){if(!r||!i)return!1;let c=r.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<r.vertices.length)return kd(i,a,r,e);const l=e.canonical,d=a.canonical,y=Math.pow(2,d.z-l.z);c=r.vertices.map(w=>new Mt((w.x+l.x*vt)*y-d.x*vt,(w.y+l.y*vt)*y-d.y*vt))}return d_(i,c,r.indices,0,r.indices.length,0,0)}function Va(r,e,i,a){const c=Math.pow(2,a.z-i.z);return new Mt((r+i.x*vt)*c-a.x*vt,(e+i.y*vt)*c-a.y*vt)}function f_(r,e){const i=[];e.grid.queryPoint(r,i);const a=e.indices,c=e.vertices;for(let l=0;l<i.length;l++){const d=i[l];if(ge([c[a[3*d+0]],c[a[3*d+1]],c[a[3*d+2]]],r))return!0}return!1}const Bd=[new Mt(0,0),new Mt(vt,0),new Mt(vt,vt),new Mt(0,vt)];function Rl(r,e){const i=[];let a=[];if(!e||r.length<2)return[r];if(r.length===2)return we(r[0],r[1],Bd)?[r]:[];for(let c=0;c<r.length+2;c++){const l=r[c%r.length],d=r[(c+1)%r.length],y=we(c===0?r[r.length-1]:r[(c-1)%r.length],l,Bd),w=we(l,d,Bd),A=y||w;A&&a.push(l),A&&w||a.length>0&&(a.length>1&&i.push(a),a=[])}return a.length>1&&i.push(a),i}const p_=Sc.VectorTileFeature.types,hv=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Nd=["fill-extrusion-flood-light-ground-radius"],Dg=Math.pow(2,13),dv=Math.pow(2,15)-1,zg=new Mt(0,1),bu=2147483648;function Uf(r,e,i,a,c,l,d,y){r.emplaceBack((e<<1)+d,(i<<1)+l,(Math.floor(a*Dg)<<1)+c,Math.round(y))}function Vf(r,e,i){r.emplaceBack(e.x*vt,e.y*vt,i?1:0)}function om(r,e,i,a,c,l){r.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+c,l)}function jf(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class m_{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Ih{constructor(){this.centroidXY=new Mt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Mt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Mt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Mt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Fd{constructor(){this.acc=new Mt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let c=!!this.borders;i.x<e.min.x?(e.min.x=i.x,c=!0):i.x>e.max.x&&(e.max.x=i.x,c=!0),i.y<e.min.y?(e.min.y=i.y,c=!0):i.y>e.max.y&&(e.max.y=i.y,c=!0),((i.x===0||i.x===vt)&&i.x===a.x)!=((i.y===0||i.y===vt)&&i.y===a.y)&&this.processBorderOverlap(i,a),c&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Kt(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>vt!=e.x>vt&&this.addBorderIntersection(1,Kt(i.y,e.y,(vt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Kt(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>vt!=e.y>vt&&this.addBorderIntersection(3,Kt(i.x,e.x,(vt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Mt(0,0):new Mt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function __(r,e){const i=r.add(e)._unit(),a=Di(r.x*i.x+r.y*i.y,-1,1);var c,l,d;return d=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(d)))/4*dv*((c=r).x*(l=e).y-c.y*l.x<0?-1:1)}const fv=[r=>r.x<0,r=>r.x>vt,r=>r.y<0,r=>r.y>vt];function Ud(r,e,i,a){const c=[4];if(a===0)return c;i._mult(a);const l=r.sub(i),d=e.sub(i),y=[r,e,l,d];for(let w=0;w<4;w++)for(const A of y)if(fv[w](A)){c.push(w);break}return c}class Vd{constructor(e){this.vertexArray=new Ls,this.indexArray=new Fr,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut},i=>Nd.includes(i)),this._segments=new dn,this.hiddenByLandmarkVertexArray=new cu,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new dn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,c=!1){const l=e.length;if(l>2){let d=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let w;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const A=e[0],_=e[1];w=__(A.sub(e[l-1])._perp()._unit(),_.sub(A)._perp()._unit())}for(let A=0;A<l;A++){const _=A===l-1?0:A+1,T=e[A],I=e[_],E=e[_===l-1?0:_+1],M=I.sub(T)._perp()._unit(),z=__(M,E.sub(I)._perp()._unit()),B=w,N=z;if(jd(T,I,i)||c&&y_(T,i)&&y_(I,i)){w=z;continue}const H=y.vertexLength;om(this.vertexArray,T,I,1,1,B),om(this.vertexArray,T,I,1,0,B),om(this.vertexArray,T,I,0,1,N),om(this.vertexArray,T,I,0,0,N),y.vertexLength+=4;const G=Ud(T,I,M,a);for(const j of G)this._segmentToGroundQuads[d].push({id:H,region:j}),this._segmentToRegionTriCounts[d][j]+=2,y.primitiveLength+=2;w=z}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort((c,l)=>c.region-l.region);for(let a=0;a<i;a++){const c=this._segmentToGroundQuads[a],l=e[a],d=this._segmentToRegionTriCounts[a];d.reduce((w,A)=>w+A,0);let y=0;for(let w=0;w<=4;w++){const A=d[w];if(A!==0){let _=this.regionSegments[w];_||(_=this.regionSegments[w]=new dn);const T={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+y,vertexLength:l.vertexLength,primitiveLength:A};_.get().push(T)}y+=A}for(let w=0;w<c.length;w++){const A=c[w].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,c,l,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,c,l,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Ag.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,c,l,d,y){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,c,l,d,y)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&bu?1:0;for(let c=e.groundVertexArrayOffset;c<i;++c)this.hiddenByLandmarkVertexArray.emplace(c,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,cv.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class qf{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Fr,this.footprintVertices=new oo,this.footprintSegments=[],this.layoutVertexArray=new lo,this.centroidVertexArray=new wl,this.wallVertexArray=new Mf,this.indexArray=new Fr,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut},i=>hv.includes(i)),this.segments=new dn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Vd(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,a,c){this.features=[],this.hasPattern=Hp("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=h(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:l,id:d,index:y,sourceLayerIndex:w}of e){const A=this.layers[0]._featureFilter.needGeometry,_=k(l,A);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),_,a))continue;const T={id:d,sourceLayerIndex:w,index:y,geometry:A?_.geometry:O(l,a,c),properties:l.properties,type:l.type,patterns:{}},I=this.layoutVertexArray.length,E=p_[T.type]==="Polygon";if(this.hasPattern)this.features.push(Zp("fill-extrusion",this.layers,T,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const M of T.geometry)for(const z of Rl(M,E))this.addFeature(T,[z],y,a,{},i.availableImages,c,i.brightness);else this.addFeature(T,T.geometry,y,a,{},i.availableImages,c,i.brightness);i.featureIndex.insert(l,T.geometry,y,w,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,c,l,d){for(const y of this.features){const w=p_[y.type]==="Polygon",{geometry:A}=y;if(this.wallMode)for(const _ of A)for(const T of Rl(_,w))this.addFeature(y,[T],y.index,i,a,c,l,d);else this.addFeature(y,A,y.index,i,a,c,l,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,c,l,d,y){this.programConfigurations.updatePaintArrays(e,i,l,a,c,d,y),this.groundEffect.update(e,i,l,a,c,d,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uv),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,c_.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Mg.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,l_.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,c,l,d,y,w){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,_=[new Mt(0,0),new Mt(vt,vt)],T=y.projection,I=T.name==="globe",E=this.wallMode||p_[e.type]==="Polygon",M=new Fd;M.centroidDataIndex=this.centroidData.length;const z=new Ih,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},c)<=0,N=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},c);let H;if(z.height=N,z.vertexArrayOffset=this.layoutVertexArray.length,z.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ph),this.wallMode){if(I)return void Pn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;H=function(ae){const be=ae[0].x===ae[ae.length-1].x&&ae[0].y===ae[ae.length-1].y;(function(xt){let ut=0;const ti=xt.length;for(let zt=0;zt<ti;zt++)ut+=(xt[(zt+1)%ti].x-xt[zt].x)*(xt[(zt+1)%ti].y+xt[zt].y);return ut>=0})(ae)||(ae=ae.reverse());const Te={geometry:[],joinNormals:[],indices:[]},Ie=[],Me=[],ze=[];let De=ae.length;for(;De>=2&&ae[De-1].equals(ae[De-2]);)De--;if(De<(be?3:2))return Te;let Ne,ke,Ue,lt,ot,Nt=0;for(;Nt<De-1&&ae[Nt].equals(ae[Nt+1]);)Nt++;be&&(Ne=ae[De-2],ot=ae[Nt].sub(Ne)._unit()._perp());for(let xt=Nt;xt<De;xt++){if(Ue=xt===De-1?be?ae[Nt+1]:void 0:ae[xt+1],Ue&&ae[xt].equals(Ue))continue;ot&&(lt=ot),Ne&&(ke=Ne),Ne=ae[xt],ot=Ue?Ue.sub(Ne)._unit()._perp():lt,lt=lt||ot;let ut=lt.add(ot);ut.x===0&&ut.y===0||ut._unit();const ti=ut.x*ot.x+ut.y*ot.y,zt=ti!==0?1/ti:1/0,Zt=lt.x*ot.y-lt.y*ot.x>0;let pi="miter";const Ci=2;pi==="miter"&&zt>Ci&&(pi="bevel"),pi==="bevel"&&(zt>100&&(pi="flipbevel"),zt<Ci&&(pi="miter"));const yi=(Bi,Mi,ji,ln)=>{const Dn=new Mt(Bi.x,Bi.y),gi=new Mt(Bi.x,Bi.y);Dn.x+=Mi.x*ln,Dn.y+=Mi.y*ln,gi.x-=Mi.x*Math.max(ji,1),gi.y-=Mi.y*Math.max(ji,1),ze.push(Mi),Ie.push(Dn),Me.push(gi)};if(pi==="miter")ut._mult(zt),yi(Ne,ut,0,0);else if(pi==="flipbevel")ut=ot.mult(-1),yi(Ne,ut,0,0),yi(Ne,ut.mult(-1),0,0);else{const Bi=-Math.sqrt(zt*zt-1),Mi=Zt?Bi:0,ji=Zt?0:Bi;ke&&yi(Ne,lt,Mi,ji),Ue&&yi(Ne,ot,Mi,ji)}}Te.geometry=[...Ie,...Me.reverse(),Ie[0]],Te.joinNormals=[...ze,...ze.reverse(),ze[ze.length-1]];const mt=Te.geometry.length-1;for(let xt=0;xt<mt/2;xt++)if(xt+1<mt/2){let ut=xt,ti=xt+1,zt=mt-1-xt,Zt=mt-2-xt;ut=ut===0?mt-1:ut-1,ti=ti===0?mt-1:ti-1,zt=zt===0?mt-1:zt-1,Zt=Zt===0?mt-1:Zt-1,Te.indices.push(zt),Te.indices.push(ti),Te.indices.push(ut),Te.indices.push(zt),Te.indices.push(Zt),Te.indices.push(ti)}return Te}(i[0]),i=[H.geometry]}const G=(ae,be)=>ae<(be.length-1)/2||ae===be.length-1,j=this.wallMode?[i]:Gp(i,500);for(let ae=j.length-1;ae>=0;ae--){const be=j[ae];(be.length===0||($=be[0]).every(he=>he.x<=0)||$.every(he=>he.x>=vt)||$.every(he=>he.y<=0)||$.every(he=>he.y>=vt))&&j.splice(ae,1)}var $;let W;if(I)W=qd(j,_,c);else{W=[];for(const ae of j)W.push({polygon:ae,bounds:_})}const Q=E?this.edgeRadius:0,le=Q>0&&this.zoom<17,se=(ae,be)=>{if(ae.length===0)return!1;const he=ae[ae.length-1];return be.x===he.x&&be.y===he.y};for(const{polygon:ae,bounds:be}of W){let he=0,Te=0;for(const De of ae)E&&!De[0].equals(De[De.length-1])&&De.push(De[0]),Te+=E?De.length-1:De.length;const Ie=this.segments.prepareSegment((E?5:4)*Te,this.layoutVertexArray,this.indexArray);z.footprintSegIdx<0&&(z.footprintSegIdx=this.footprintSegments.length),z.polygonSegIdx<0&&(z.polygonSegIdx=this.polygonSegments.length);const Me={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ze=new m_;if(ze.vertexOffset=this.footprintVertices.length,ze.indexOffset=3*this.footprintIndices.length,ze.ringIndices=[],E){const De=[],Ne=[];he=Ie.vertexLength;for(let Ue=0;Ue<ae.length;Ue++){const lt=ae[Ue];lt.length&&Ue!==0&&Ne.push(De.length/2);const ot=[];let Nt,mt;Nt=lt[1].sub(lt[0])._perp()._unit(),ze.ringIndices.push(lt.length-1);for(let xt=1;xt<lt.length;xt++){const ut=lt[xt],ti=lt[xt===lt.length-1?1:xt+1],zt=ut.clone();if(Q){mt=ti.sub(ut)._perp()._unit();const Zt=Nt.add(mt)._unit(),pi=Q*Math.min(4,1/(Nt.x*Zt.x+Nt.y*Zt.y));zt.x+=pi*Zt.x,zt.y+=pi*Zt.y,zt.x=Math.round(zt.x),zt.y=Math.round(zt.y),Nt=mt}if(!B||Q!==0&&!le||se(ot,zt)||ot.push(zt),Uf(this.layoutVertexArray,zt.x,zt.y,0,0,1,1,0),this.wallMode){const Zt=G(xt,lt);Vf(this.wallVertexArray,H.joinNormals[xt],!Zt)}Ie.vertexLength++,this.footprintVertices.emplaceBack(ut.x,ut.y),De.push(ut.x,ut.y),I&&jf(this.layoutVertexExtArray,T.projectTilePoint(zt.x,zt.y,c),T.upVector(c,zt.x,zt.y))}B&&(Q===0||le)&&(ot.length!==0&&se(ot,ot[0])&&ot.pop(),this.groundEffect.addData(ot,be,A))}const ke=this.wallMode?H.indices:_u(De,Ne);for(let Ue=0;Ue<ke.length;Ue+=3)this.footprintIndices.emplaceBack(ze.vertexOffset+ke[Ue+0],ze.vertexOffset+ke[Ue+1],ze.vertexOffset+ke[Ue+2]),this.indexArray.emplaceBack(he+ke[Ue],he+ke[Ue+2],he+ke[Ue+1]),Ie.primitiveLength++;ze.indexCount+=ke.length,ze.vertexCount+=this.footprintVertices.length-ze.vertexOffset}for(let De=0;De<ae.length;De++){const Ne=ae[De];M.startRing(z,Ne[0]);let ke=Ne.length>4&&v_(Ne[Ne.length-2],Ne[0],Ne[1]),Ue=Q?g_(Ne[Ne.length-2],Ne[0],Ne[1],Q):0;const lt=[];let ot,Nt,mt;Nt=Ne[1].sub(Ne[0])._perp()._unit();let xt=!0;for(let ut=1,ti=0;ut<Ne.length;ut++){let zt=Ne[ut-1],Zt=Ne[ut];const pi=Ne[ut===Ne.length-1?1:ut+1];if(M.appendEdge(z,Zt,zt),jd(Zt,zt,be)){Q&&(Nt=pi.sub(Zt)._perp()._unit(),xt=!xt);continue}const Ci=Zt.sub(zt)._perp(),yi=Ci.x/(Math.abs(Ci.x)+Math.abs(Ci.y)),Bi=Ci.y>0?1:0,Mi=zt.dist(Zt);if(ti+Mi>32768&&(ti=0),Q){mt=pi.sub(Zt)._perp()._unit();let gi=lm(zt,Zt,pi,Gf(Nt,mt),Q);isNaN(gi)&&(gi=0);const Yi=Zt.sub(zt)._unit();zt=zt.add(Yi.mult(Ue))._round(),Zt=Zt.add(Yi.mult(-gi))._round(),Ue=gi,Nt=mt,B&&this.zoom>=17&&(se(lt,zt)||lt.push(zt),se(lt,Zt)||lt.push(Zt))}const ji=Ie.vertexLength,ln=Ne.length>4&&v_(zt,Zt,pi);let Dn=Pg(ti,ke,xt);if(Uf(this.layoutVertexArray,zt.x,zt.y,yi,Bi,0,0,Dn),Uf(this.layoutVertexArray,zt.x,zt.y,yi,Bi,0,1,Dn),this.wallMode){const gi=G(ut-1,Ne),Yi=H.joinNormals[ut-1];Vf(this.wallVertexArray,Yi,gi),Vf(this.wallVertexArray,Yi,gi)}if(ti+=Mi,Dn=Pg(ti,ln,!xt),ke=ln,Uf(this.layoutVertexArray,Zt.x,Zt.y,yi,Bi,0,0,Dn),Uf(this.layoutVertexArray,Zt.x,Zt.y,yi,Bi,0,1,Dn),this.wallMode){const gi=G(ut,Ne),Yi=H.joinNormals[ut];Vf(this.wallVertexArray,Yi,gi),Vf(this.wallVertexArray,Yi,gi)}if(Ie.vertexLength+=4,this.indexArray.emplaceBack(ji+0,ji+1,ji+2),this.indexArray.emplaceBack(ji+1,ji+3,ji+2),Ie.primitiveLength+=2,Q){const gi=he+(ut===1?Ne.length-2:ut-2),Yi=ut===1?he:gi+1;if(this.indexArray.emplaceBack(ji+1,gi,ji+3),this.indexArray.emplaceBack(gi,Yi,ji+3),Ie.primitiveLength+=2,ot===void 0&&(ot=ji),!jd(pi,Ne[ut],be)){const Fn=ut===Ne.length-1?ot:Ie.vertexLength;this.indexArray.emplaceBack(ji+2,ji+3,Fn),this.indexArray.emplaceBack(ji+3,Fn+1,Fn),this.indexArray.emplaceBack(ji+3,Yi,Fn+1),Ie.primitiveLength+=3}xt=!xt}if(I){const gi=this.layoutVertexExtArray,Yi=T.projectTilePoint(zt.x,zt.y,c),Fn=T.projectTilePoint(Zt.x,Zt.y,c),$n=T.upVector(c,zt.x,zt.y),Jn=T.upVector(c,Zt.x,Zt.y);jf(gi,Yi,$n),jf(gi,Yi,$n),jf(gi,Fn,Jn),jf(gi,Fn,Jn)}}E&&(he+=Ne.length-1),B&&Q&&this.zoom>=17&&(lt.length!==0&&se(lt,lt[0])&&lt.pop(),this.groundEffect.addData(lt,be,A,Q>0))}this.footprintSegments.push(ze),Me.triangleCount=this.indexArray.length-Me.triangleArrayOffset,this.polygonSegments.push(Me),++z.footprintSegLen,++z.polygonSegLen}if(z.vertexCount=this.layoutVertexArray.length-z.vertexArrayOffset,z.groundVertexCount=this.groundEffect.vertexArray.length-z.groundVertexArrayOffset,z.vertexCount!==0){if(z.centroidXY=M.borders?zg:this.encodeCentroid(M,z),this.centroidData.push(z),M.borders){this.featuresOnBorder.push(M);const ae=this.featuresOnBorder.length-1;for(let be=0;be<M.borders.length;be++)M.borders[be][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[be].push(ae)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,l,d,c,w),this.groundEffect.addPaintPropertiesData(e,a,l,d,c,w),this.maxHeight=Math.max(this.maxHeight,N)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const w=this.centroidData[y],A=+(w.min.y+w.max.y>vt),_=2*A+(+(w.min.x+w.max.x>vt)^A);for(let T=0;T<w.polygonSegLen;T++){const I=w.polygonSegIdx+T;e.push({centroidIdx:y,subtile:_,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const i=new Fr;e.sort((y,w)=>y.triangleSegmentIdx===w.triangleSegmentIdx?y.subtile-w.subtile:y.triangleSegmentIdx-w.triangleSegmentIdx);let a=0,c=0,l=0;for(const y of e){if(y.triangleSegmentIdx!==a)break;l++}const d=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let y=0,w=c,A=c;for(let _=w;_<l&&e[_].subtile===y;_++)A++;for(;w!==l;){const _=e[w];y=_.subtile;const T=this.centroidData[_.centroidIdx].min.clone(),I=this.centroidData[_.centroidIdx].max.clone(),E={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let M=w;M<A;M++){const z=e[M],B=this.polygonSegments[z.polygonSegmentIdx],N=this.centroidData[z.centroidIdx].min,H=this.centroidData[z.centroidIdx].max,G=this.indexArray.uint16;for(let j=B.triangleArrayOffset;j<B.triangleArrayOffset+B.triangleCount;j++)i.emplaceBack(G[3*j],G[3*j+1],G[3*j+2]);E.primitiveLength+=B.triangleCount,T.x=Math.min(T.x,N.x),T.y=Math.min(T.y,N.y),I.x=Math.max(I.x,H.x),I.y=Math.max(I.y,H.y)}E.primitiveLength>0&&this.triangleSubSegments.push({segment:E,min:T,max:I}),w=A;for(let M=w;M<l&&e[M].subtile===e[w].subtile;M++)A++}c=l;for(let _=c;_<d&&e[_].triangleSegmentIdx===e[c].triangleSegmentIdx;_++)l++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){const c=new dn;if(this.wallMode){for(const z of this.triangleSubSegments)c.segments.push(z.segment);return c}let l=0,d=0;const y=1<<e.canonical.z;if(i){const z=i.getMinMaxForTile(e);z&&(l=z.min,d=z.max)}d+=this.maxHeight;const w=e.toUnwrapped();let A;const _=[w.canonical.x/y+w.wrap,w.canonical.y/y],T=[(w.canonical.x+1)/y+w.wrap,(w.canonical.y+1)/y],I=(z,B,N)=>[z[0]*(1-N[0])+B[0]*N[0],z[1]*(1-N[1])+B[1]*N[1]],E=[],M=[];for(const z of this.triangleSubSegments){E[0]=z.min.x/vt,E[1]=z.min.y/vt,M[0]=z.max.x/vt,M[1]=z.max.y/vt;const B=I(_,T,E),N=I(_,T,M);if(new At([B[0],B[1],l],[N[0],N[1],d]).intersectsPrecise(a)===0){A&&(c.segments.push(A),A=void 0);continue}const H=z.segment;A&&A.vertexOffset!==H.vertexOffset&&(c.segments.push(A),A=void 0),A?(A.vertexLength+=H.vertexLength,A.primitiveLength+=H.primitiveLength):A={vertexOffset:H.vertexOffset,primitiveLength:H.primitiveLength,vertexLength:H.vertexLength,primitiveOffset:H.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&c.segments.push(A),c}encodeCentroid(e,i){const a=e.centroid(),c=i.span(),l=Math.min(7,Math.round(c.x*this.tileToMeter/10)),d=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new Mt(Di(a.x,1,vt-1)<<3|l,Di(a.y,1,vt-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new Mt(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const c=i[0][0]!==a?0:1;return new Mt(6|(i[0][0]!==a?0:65528),(i[c][0]+i[c][1])/2<<3|6)}{const c=i[2][0]!==a?2:3;return new Mt((i[c][0]+i[c][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=bu,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&bu?zg:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==c.y||l!==c.x){for(let d=i;d<a;++d)this.centroidVertexArray.emplace(d,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());if(Ua(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const l=[];for(const d of this.activeReplacements){if(d.order<a)continue;const y=Math.max(1,Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z));for(const w of this.centroidData)if(!(w.flags&bu||d.min.x>w.max.x||w.min.x>d.max.x||d.min.y>w.max.y||w.min.y>d.max.y))for(let A=0;A<w.footprintSegLen;A++){const _=this.footprintSegments[w.footprintSegIdx+A];if(l.length=0,pv(this.footprintVertices,_.vertexOffset,_.vertexCount,d.footprintTileId.canonical,e.canonical,l),d_(d.footprint,l,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-y)){w.flags|=bu;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let c=!1;for(let l=0;l<a.footprintSegLen;l++){const d=this.footprintSegments[a.footprintSegIdx+l];let y=0;for(const w of d.ringIndices){for(let A=y,_=w+y-1;A<w+y;_=A++){const T=this.footprintVertices.int16[2*(A+d.vertexOffset)+0],I=this.footprintVertices.int16[2*(A+d.vertexOffset)+1],E=this.footprintVertices.int16[2*(_+d.vertexOffset)+1];I>i!=E>i&&e<(this.footprintVertices.int16[2*(_+d.vertexOffset)+0]-T)*(i-I)/(E-I)+T&&(c=!c)}y=w}}return c}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,c=!0;const l=4*(e+vt)*vt+(i+vt);if(this.partLookup.hasOwnProperty(l)){const d=this.partLookup[l];return d?{height:d.height,hidden:!!(d.flags&bu)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||i>d.max.y||d.min.y>i||this.footprintContainsPoint(e,i,d)&&d&&d.height>a&&(a=d.height,this.partLookup[l]=d,c=!!(d.flags&bu));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[l]=void 0}}function Gf(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function g_(r,e,i,a){const c=e.sub(r)._perp()._unit(),l=i.sub(e)._perp()._unit();return lm(r,e,i,Gf(c,l),a)}function lm(r,e,i,a,c){const l=Math.sqrt(1-a*a);return Math.min(r.dist(e)/3,e.dist(i)/3,c*l/a)}function jd(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function y_(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function v_(r,e,i){if(r.x<0||r.x>=vt||e.x<0||e.x>=vt||i.x<0||i.x>=vt)return!1;const a=i.sub(e),c=a.perp(),l=r.sub(e);return(a.x*l.x+a.y*l.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(l.x*l.x+l.y*l.y))>-.866&&c.x*l.x+c.y*l.y<0}function Pg(r,e,i){const a=e?2|r:-3&r;return i?1|a:-2&a}function x_(){const r=Math.PI/32,e=Math.tan(r),i=Al;return i*Math.sqrt(1+2*e*e)-i}function qd(r,e,i){const a=1<<i.z,c=ns(i.x/a),l=ns((i.x+1)/a),d=yn(i.y/a),y=yn((i.y+1)/a);return function(w,A,_,T,I=0,E){const M=[];if(!w.length||!_||!T)return M;const z=(W,Q)=>{for(const le of W)M.push({polygon:le,bounds:Q})},B=Math.ceil(Math.log2(_)),N=Math.ceil(Math.log2(T)),H=B-N,G=[];for(let W=0;W<Math.abs(H);W++)G.push(H>0?0:1);for(let W=0;W<Math.min(B,N);W++)G.push(0),G.push(1);let j=w;if(j=nm(j,A[0].y-I,A[1].y+I,1),j=nm(j,A[0].x-I,A[1].x+I,0),!j.length)return M;const $=[];for(G.length?$.push({polygons:j,bounds:A,depth:0}):z(j,A);$.length;){const W=$.pop(),Q=W.depth,le=G[Q],se=W.bounds[0],ae=W.bounds[1],be=le===0?se.x:se.y,he=le===0?ae.x:ae.y,Te=E?E(le,be,he):.5*(be+he),Ie=nm(W.polygons,be-I,Te+I,le),Me=nm(W.polygons,Te-I,he+I,le);if(Ie.length){const ze=[se,new Mt(le===0?Te:ae.x,le===1?Te:ae.y)];G.length>Q+1?$.push({polygons:Ie,bounds:ze,depth:Q+1}):z(Ie,ze)}if(Me.length){const ze=[new Mt(le===0?Te:se.x,le===1?Te:se.y),ae];G.length>Q+1?$.push({polygons:Me,bounds:ze,depth:Q+1}):z(Me,ze)}}return M}(r,e,Math.ceil((l-c)/11.25),Math.ceil((d-y)/11.25),1,(w,A,_)=>{if(w===0)return .5*(A+_);{const T=yn((i.y+A/vt)/a);return(Zr(.5*(yn((i.y+_/vt)/a)+T))*a-i.y)*vt}})}function pv(r,e,i,a,c,l){const d=Math.pow(2,a.z-c.z);for(let y=0;y<i;y++){let w=r.int16[2*(y+e)+0],A=r.int16[2*(y+e)+1];w=(w+c.x*vt)*d-a.x*vt,A=(A+c.y*vt)*d-a.y*vt,l.push(new Mt(w,A))}}let Og,Lg;function wu(r,e){return r.x*e.x+r.y*e.y}function Hf(r,e){if(r.length===1){let i=0;const a=e[i++];let c;for(;!c||a.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const l=e[i],d=r[0],y=c.sub(a),w=l.sub(a),A=d.sub(a),_=wu(y,y),T=wu(y,w),I=wu(w,w),E=wu(A,y),M=wu(A,w),z=_*I-T*T,B=(I*E-T*M)/z,N=(_*M-T*E)/z,H=a.z*(1-B-N)+c.z*B+l.z*N;if(isFinite(H))return H}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function cm(r,e,i,a,c,l,d,y){const w=d*c.getElevationAt(r,e,!0,!0),A=l[0]!==0,_=A?l[1]===0?d*(l[0]/7-450):d*function(T,I,E){const M=Math.floor(I[0]/8),z=Math.floor(I[1]/8),B=10*(I[0]-8*M),N=10*(I[1]-8*z),H=T.getElevationAt(M,z,!0,!0),G=T.getMeterToDEM(E),j=Math.floor(.5*(B*G-1)),$=Math.floor(.5*(N*G-1)),W=T.tileCoordToPixel(M,z),Q=2*j+1,le=2*$+1,se=function(Me,ze,De,Ne,ke){return[Me.getElevationAtPixel(ze,De,!0),Me.getElevationAtPixel(ze+ke,De,!0),Me.getElevationAtPixel(ze,De+ke,!0),Me.getElevationAtPixel(ze+Ne,De+ke,!0)]}(T,W.x-j,W.y-$,Q,le),ae=Math.abs(se[0]-se[1]),be=Math.abs(se[2]-se[3]),he=Math.abs(se[0]-se[2])+Math.abs(se[1]-se[3]),Te=Math.min(.25,.5*G*(ae+be)/Q),Ie=Math.min(.25,.5*G*he/le);return H+Math.max(Te*B,Ie*N)}(c,l,y):w;return{base:w+(i===0?-1:i),top:A?Math.max(_+a,w+i+2):w+a}}Ot(qf,"FillExtrusionBucket",{omit:["layers","features"]}),Ot(Ih,"PartData"),Ot(m_,"FootprintSegment"),Ot(Fd,"BorderCentroidData"),Ot(Vd,"GroundEffect");const mv=nn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Zf=nn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:_v}=mv,kg=nn([{name:"a_packed",components:3,type:"Float32"}]),{members:Bg}=kg,Ng=nn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Fg}=Ng;class um{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Cl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=Ru(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const c=[];let l=e.length%2==1?-e[e.length-1]*a:0,d=e[0]*a,y=!0;c.push({left:l,right:d,isDash:y,zeroLength:e[0]===0});let w=e[0];for(let A=1;A<e.length;A++){y=!y;const _=e[A];l=w*a,w+=_,d=w*a,c.push({left:l,right:d,isDash:y,zeroLength:_===0})}return c}addRoundDash(e,i,a){const c=i/2;for(let l=-a;l<=a;l++){const d=this.width*(this.nextRow+a+l);let y=0,w=e[y];for(let A=0;A<this.width;A++){A/w.right>1&&(w=e[++y]);const _=Math.abs(A-w.left),T=Math.abs(A-w.right),I=Math.min(_,T);let E;const M=l/a*(c+1);if(w.isDash){const z=c-Math.abs(M);E=Math.sqrt(I*I+z*z)}else E=c-Math.sqrt(I*I+M*M);this.image.data[d+A]=Math.max(0,Math.min(255,E+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const A=e[w],_=e[w+1];A.zeroLength?e.splice(w,1):_&&_.isDash===A.isDash&&(_.left=A.left,e.splice(w,1))}const a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const l=this.width*this.nextRow;let d=0,y=e[d];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++d]);const A=Math.abs(w-y.left),_=Math.abs(w-y.right),T=Math.min(A,_);this.image.data[l+w]=Math.max(0,Math.min(255,(y.isDash?T:-T)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const c=i==="round",l=c?7:0,d=2*l+1;if(this.nextRow+d>this.height)return Pn("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let _=0;_<e.length;_++)e[_]<0&&(Pn("Negative value is found in line dasharray, replacing values with 0"),e[_]=0),y+=e[_];if(y!==0){const _=this.width/y,T=this.getDashRanges(e,this.width,_);c?this.addRoundDash(T,_,l):this.addRegularDash(T,i==="square"?.5*_:0)}const w=this.nextRow+l;this.nextRow+=d;const A={tl:[w,l],br:[y,0]};return this.positions[a]=A,A}}Ot(um,"LineAtlas");const Ug=Sc.VectorTileFeature.types,hm=Math.cos(Math.PI/180*37.5),gv=Math.cos(Math.PI/180*5);class b_{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new pd,this.layoutVertexArray2=new $s,this.patternVertexArray=new $s,this.indexArray=new Fr,this.programConfigurations=new Lo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new dn,this.maxLineLength=0,this.zOffsetVertexArray=new $s,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:vt/64}updateFootprints(e,i){}populate(e,i,a,c){this.hasPattern=Hp("line",this.layers,this.pixelRatio,i);const l=this.layers[0].layout.get("line-sort-key");this.tileToMeter=h(a);const d=this.layers[0].layout.get("line-z-offset"),y=d.isConstant()&&!d.constantOr(0),w=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=w==="sea"||w==="ground"||!y&&w==="none",this.hasZOffset&&w==="none"&&Pn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const A=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&A!==void 0;const _=[];for(const{feature:M,id:z,index:B,sourceLayerIndex:N}of e){const H=this.layers[0]._featureFilter.needGeometry,G=k(M,H);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),G,a))continue;const j=l?l.evaluate(G,{},a):void 0,$={id:z,properties:M.properties,type:M.type,sourceLayerIndex:N,index:B,geometry:H?G.geometry:O(M,a,c),patterns:{},sortKey:j};_.push($)}l&&_.sort((M,z)=>M.sortKey-z.sortKey);const{lineAtlas:T,featureIndex:I}=i,E=this.addConstantDashes(T);for(const M of _){const{geometry:z,index:B,sourceLayerIndex:N}=M;if(E&&this.addFeatureDashes(M,T),this.hasPattern){const H=Zp("line",this.layers,M,this.zoom,this.pixelRatio,i);this.patternFeatures.push(H)}else this.addFeature(M,z,B,a,T.positions,i.availableImages,i.brightness);I.insert(e[B].feature,z,B,N,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,l=a.layout.get("line-cap").value;if(c.kind!=="constant"||l.kind!=="constant")i=!0;else{const d=l.value,y=c.value;if(!y)continue;e.addDash(y,d)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const c of this.layers){const l=c.paint.get("line-dasharray").value,d=c.layout.get("line-cap").value;if(l.kind==="constant"&&d.kind==="constant")continue;let y,w;if(l.kind==="constant"){if(y=l.value,!y)continue}else y=l.evaluate({zoom:a},e);w=d.kind==="constant"?d.value:d.evaluate({zoom:a},e),i.addDash(y,w),e.patterns[c.id]=i.getKey(y,w)}}update(e,i,a,c,l,d,y){this.programConfigurations.updatePaintArrays(e,i,l,a,c,d,y)}addFeatures(e,i,a,c,l,d){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,a,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Bg)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Fg)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Zf.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_v),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,c,l,d,y){const w=this.layers[0].layout,A=w.get("line-join").evaluate(e,{}),_=w.get("line-cap").evaluate(e,{}),T=w.get("line-miter-limit"),I=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=w.get("line-z-offset").value;const E=this.layers[0].paint.get("line-width").value;E.kind!=="constant"&&E.isLineProgressConstant===!1&&(this.variableWidthValue=E);for(const M of i)this.addLine(M,e,c,A,_,T,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,l,d,c,y)}addLine(e,i,a,c,l,d,y){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const w=c==="none";if(this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<e.length-1;G++)this.totalDistance+=e[G].dist(e[G+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=Ug[i.type]==="Polygon";let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let T=0;for(;T<_-1&&e[T].equals(e[T+1]);)T++;if(_<(A?3:2))return;c==="bevel"&&(d=1.05);const I=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let E,M,z,B,N,H;this.e1=this.e2=-1,A&&(E=e[_-2],N=e[T].sub(E)._unit()._perp());for(let G=T;G<_;G++){if(z=G===_-1?A?e[T+1]:void 0:e[G+1],z&&e[G].equals(z))continue;N&&(B=N),E&&(M=E),E=e[G],H=this.evaluateLineProgressFeatures(M?M.dist(E):0),N=z?z.sub(E)._unit()._perp():B,B=B||N;const j=M&&z;let $=j?c:A||w?"butt":l;const W=B.x*N.x+B.y*N.y;if(w){const Ie=function(Me){if(Me.patternJoinNone){const ze=Me.segmentPoints.length/2,De=Me.lineSoFar-Me.segmentStart;for(let Ne=0;Ne<ze;++Ne){const ke=Me.segmentPoints[2*Ne+1],Ue=Math.round(Me.segmentPoints[2*Ne])+.5+.25*ke;Me.patternVertexArray.emplaceBack(Ue,De,Me.segmentStart),Me.patternVertexArray.emplaceBack(Ue,De,Me.segmentStart)}Me.segmentPoints.length=0}Me.e1=Me.e2=-1};if(j&&W<gv){this.updateDistance(M,E),this.addCurrentVertex(E,B,1,1,I,H),Ie(this),this.addCurrentVertex(E,N,-1,-1,I,H);continue}if(M){if(!z){this.updateDistance(M,E),this.addCurrentVertex(E,B,1,1,I,H),Ie(this);continue}$="miter"}}let Q=B.add(N);Q.x===0&&Q.y===0||Q._unit();const le=Q.x*N.x+Q.y*N.y,se=le!==0?1/le:1/0,ae=2*Math.sqrt(2-2*le),be=le<hm&&M&&z,he=B.x*N.y-B.y*N.x>0,Te=this.overscaling<=16?15*vt/(512*this.overscaling):0;if(j&&$==="round"){if(se<y)$="miter";else if(se<=2){const Ie=$f(E,-10,vt+10);$=this.hasZOffset&&(Ie||this.hasCrossSlope)?"miter":"fakeround"}}if($==="miter"&&se>d&&($="bevel"),$==="bevel"&&(se>2&&($="flipbevel"),se<d&&($="miter")),M&&!($==="miter"&&be)&&this.updateDistance(M,E),$==="miter")if(be){const Ie=E.dist(M);if(Ie>2*Te){const ze=E.sub(E.sub(M)._mult(Te/Ie)._round());this.updateDistance(M,ze),this.addCurrentVertex(ze,B,0,0,I,H),M=ze}this.updateDistance(M,E),Q._mult(se),this.addCurrentVertex(E,Q,0,0,I,H);const Me=E.dist(z);if(Me>2*Te){const ze=E.add(z.sub(E)._mult(Te/Me)._round());this.updateDistance(E,ze),this.addCurrentVertex(ze,N,0,0,I,H),E=ze}}else Q._mult(se),this.addCurrentVertex(E,Q,0,0,I,H);else if($==="flipbevel"){if(se>100)Q=N.mult(-1);else{const Ie=se*B.add(N).mag()/B.sub(N).mag();Q._perp()._mult(Ie*(he?-1:1))}this.addCurrentVertex(E,Q,0,0,I,H),this.addCurrentVertex(E,Q.mult(-1),0,0,I,H)}else if($==="bevel"||$==="fakeround"){H!=null&&M&&this.addCurrentVertex(E,B,-1,-1,I,H);const Ie=E.dist(M)<=2*Te&&$!=="bevel",Me=Q.mult(he?1:-1);Me._mult(se);const ze=N.mult(he?-1:1),De=B.mult(he?-1:1),Ne=this.evaluateLineProgressFeatures(this.distance);if(H==null&&(this.addHalfVertex(E,Me.x,Me.y,!1,!he,0,I,Ne),Ie||this.addHalfVertex(E,Me.x+2*De.x,Me.y+2*De.y,!1,he,0,I,Ne)),$==="fakeround"){const ke=Math.round(180*ae/Math.PI/20);this.addHalfVertex(E,De.x,De.y,!1,he,0,I,Ne);for(let Ue=0;Ue<ke;Ue++){let lt=Ue/ke;if(lt!==.5){const Nt=lt-.5;lt+=lt*Nt*(lt-1)*((1.0904+W*(W*(3.55645-1.43519*W)-3.2452))*Nt*Nt+(.848013+W*(.215638*W-1.06021)))}const ot=ze.sub(De)._mult(lt)._add(De)._unit();this.addHalfVertex(E,ot.x,ot.y,!1,he,0,I,Ne)}this.addHalfVertex(E,ze.x,ze.y,!1,he,0,I,Ne)}Ie||H!=null||this.addHalfVertex(E,Me.x+2*ze.x,Me.y+2*ze.y,!1,he,0,I,Ne),H!=null&&z&&this.addCurrentVertex(E,N,1,1,I,H)}else $==="butt"?this.addCurrentVertex(E,Q,0,0,I,H):$==="square"?(M||this.addCurrentVertex(E,Q,-1,-1,I,H),this.addCurrentVertex(E,Q,0,0,I,H),M&&this.addCurrentVertex(E,Q,1,1,I,H)):$==="round"&&(M&&(this.addCurrentVertex(E,B,0,0,I,H),this.addCurrentVertex(E,B,1,1,I,H,!0)),z&&(this.addCurrentVertex(E,N,-1,-1,I,H,!0),this.addCurrentVertex(E,N,0,0,I,H)))}}addVerticesTo(e,i,a,c,l,d,y,w,A,_){const T=(i.w-e.w)/this.tessellationStep|0;let I=0;const E=this.scaledDistance;if(T>1){this.lineSoFar=e.w;const z=(i.x-e.x)/T,B=(i.y-e.y)/T,N=(i.z-e.z)/T,H=(i.w-e.w)/T;for(let G=1;G<T;++G){e.x+=z,e.y+=B,e.z+=N,this.lineSoFar+=H,I+=H;const j=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(e,a,c,_,!1,y,A,j),this.addHalfVertex(e,l,d,_,!0,-w,A,j)}}this.lineSoFar=i.w,this.scaledDistance=E;const M=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,a,c,_,!1,y,A,M),this.addHalfVertex(i,l,d,_,!0,-w,A,M)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Pn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}:{zOffset:0,variableWidth:i}}addCurrentVertex(e,i,a,c,l,d,y=!1){const w=i.x+i.y*a,A=i.y-i.x*a,_=i.y*c-i.x,T=-i.y-i.x*c;if(d!=null){const I=this.hasZOffset,E=-10,M=vt+10,z=d.zOffset,B=new Ig(e.x,e.y,z,this.lineSoFar),N=!!I&&$f(e,E,M),H=this.lineSoFar,G=this.distance;if(this.currentVertex)if(N){const j=this.currentVertexIsOutside,$=this.currentVertex,W=new Ig(e.x,e.y,z,this.lineSoFar);if(u_($,W,E,M),!$f(W,E,M)){if(j){this.e1=this.e2=-1,this.distance-=$.dist(B),this.lineSoFar=$.w;const Q=this.evaluateLineProgressFeatures($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,w,A,y,!1,a,l,Q),this.addHalfVertex($,_,T,y,!0,-c,l,Q),this.prevDistance=this.distance}this.distance=this.prevDistance+$.dist(W),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo($,W,w,A,_,T,a,c,l,y),this.distance=G,this.scaledDistance=this.distance/this.totalDistance}}else{const j=this.currentVertex;if(this.currentVertexIsOutside){u_(j,B,E,M),this.e1=this.e2=-1,this.distance-=j.dist(B),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=j.w;const $=this.evaluateLineProgressFeatures(j.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(j,w,A,y,!1,a,l,$),this.addHalfVertex(j,_,T,y,!0,-c,l,$),this.prevDistance=this.distance,this.distance=G,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(j,B,w,A,_,T,a,c,l,y)}else N||(this.addHalfVertex(e,w,A,y,!1,a,l,d),this.addHalfVertex(e,_,T,y,!0,-c,l,d));this.currentVertex=B,this.currentVertexIsOutside=N,this.lineSoFar=H}else this.addHalfVertex(e,w,A,y,!1,a,l,d),this.addHalfVertex(e,_,T,y,!0,-c,l,d)}addHalfVertex({x:e,y:i},a,c,l,d,y,w,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(i<<1)+(d?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const T=Kt(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,T)}const _=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),w.primitiveLength++),d?this.e2=_:this.e1=_,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function $f(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let dm,Xf;function fm(r,e,i){return e*(vt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}Ot(b_,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const w_=(r,e,i)=>(1-i)*r+i*e;function pm(r,e){return 1/fm(r,1,e.tileZoom)}function Ac(r,e,i,a){return r.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Mc=r=>{const e=[];Ic(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=r.layout.get("line-join").constantOr("miter")==="none",c=!!r.paint.get("line-pattern").constantOr(1);return a&&c&&e.push("LINE_JOIN_NONE"),e};function Ic(r){const e=r.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Ch;const Gd=()=>Ch||(Ch={layout:dm||(dm=new Bn({"line-cap":new Lt(Fe.layout_line["line-cap"]),"line-join":new Lt(Fe.layout_line["line-join"]),"line-miter-limit":new yt(Fe.layout_line["line-miter-limit"]),"line-round-limit":new yt(Fe.layout_line["line-round-limit"]),"line-sort-key":new Lt(Fe.layout_line["line-sort-key"]),"line-z-offset":new Lt(Fe.layout_line["line-z-offset"]),"line-elevation-reference":new yt(Fe.layout_line["line-elevation-reference"]),"line-cross-slope":new yt(Fe.layout_line["line-cross-slope"]),visibility:new yt(Fe.layout_line.visibility),"line-width-unit":new yt(Fe.layout_line["line-width-unit"])})),paint:Xf||(Xf=new Bn({"line-opacity":new Lt(Fe.paint_line["line-opacity"]),"line-color":new Lt(Fe.paint_line["line-color"]),"line-translate":new yt(Fe.paint_line["line-translate"]),"line-translate-anchor":new yt(Fe.paint_line["line-translate-anchor"]),"line-width":new Lt(Fe.paint_line["line-width"]),"line-gap-width":new Lt(Fe.paint_line["line-gap-width"]),"line-offset":new Lt(Fe.paint_line["line-offset"]),"line-blur":new Lt(Fe.paint_line["line-blur"]),"line-dasharray":new Lt(Fe.paint_line["line-dasharray"]),"line-pattern":new Lt(Fe.paint_line["line-pattern"]),"line-gradient":new ml(Fe.paint_line["line-gradient"]),"line-trim-offset":new yt(Fe.paint_line["line-trim-offset"]),"line-trim-fade-range":new yt(Fe.paint_line["line-trim-fade-range"]),"line-trim-color":new yt(Fe.paint_line["line-trim-color"]),"line-emissive-strength":new yt(Fe.paint_line["line-emissive-strength"]),"line-border-width":new Lt(Fe.paint_line["line-border-width"]),"line-border-color":new Lt(Fe.paint_line["line-border-color"]),"line-occlusion-opacity":new yt(Fe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},Ch);class Tu extends Lt{possiblyEvaluate(e,i){return i=new hn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,a,c){return i=fr({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,a,c)}}let Wf;function T_(r,e){return e>0?e+2*r:r}const Yf=nn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yv=nn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Vg=nn([{name:"a_projected_pos",components:4,type:"Float32"}],4);nn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const mm=nn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),jg=nn([{name:"a_texb",components:2,type:"Uint16"}]),vv=nn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),_m=nn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);nn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Kf=nn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),qg=nn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);nn([{name:"triangle",components:3,type:"Uint16"}]),nn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),nn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),nn([{type:"Float32",name:"offsetX"}]),nn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Tr=24;const ja=128;function Jf(r,e,i,a,c){if(r.kind==="camera")return r.maxSize;if(r.kind==="composite"){const l=e.possiblyEvaluate(new hn(r.maxZoom),i).evaluate(c,{},i),d=e.possiblyEvaluate(new hn(r.minZoom),i).evaluate(c,{},i);return Math.max(l,d)}return e.possiblyEvaluate(new hn(a)).evaluate(c,{},i)}function gm(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new hn(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=i;let l=0;for(;l<a.length&&a[l]<=r;)l++;l=Math.max(0,l-1);let d=l;for(;d<a.length&&a[d]<r+1;)d++;d=Math.min(a.length-1,d);const y=a[l],w=a[d];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:w,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:w,minSize:i.evaluate(new hn(y)),maxSize:i.evaluate(new hn(w)),interpolationType:c}}}function ym(r,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:c}){return r.kind==="source"?a/ja:r.kind==="composite"?Kt(a/ja,c/ja,i):e}function Cc(r,e,i=1){let a=0,c=0;if(r.kind==="constant")c=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:l,minZoom:d,maxZoom:y}=r,w=l?Di(Hr.interpolationFactor(l,e,d,y),0,1):0;r.kind==="camera"?c=Kt(r.minSize,r.maxSize,w)*i:a=w*i}return{uSizeT:a,uSize:c}}var o=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ja,evaluateSizeForFeature:ym,evaluateSizeForZoom:Cc,getRasterizedIconSize:Jf,getSizeData:gm});function f(r,e,i){return r.sections.forEach(a=>{a.text=function(c,l,d){const y=l.layout.get("text-transform").evaluate(d,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),cs.applyArabicShaping&&(c=cs.applyArabicShaping(c)),c}(a.text,e,i)}),r}const v={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function R(r){return r==="︶"||r==="﹈"||r==="︸"||r==="﹄"||r==="﹂"||r==="︾"||r==="︼"||r==="︺"||r==="︘"||r==="﹀"||r==="︐"||r==="︓"||r==="︔"||r==="｀"||r==="￣"||r==="︑"||r==="︒"}function L(r){return r==="︵"||r==="﹇"||r==="︷"||r==="﹃"||r==="﹁"||r==="︽"||r==="︻"||r==="︹"||r==="︗"||r==="︿"}var q,ne,ve,Ve={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function ht(){return q||(q=1,Ve.read=function(r,e,i,a,c){var l,d,y=8*c-a-1,w=(1<<y)-1,A=w>>1,_=-7,T=i?c-1:0,I=i?-1:1,E=r[e+T];for(T+=I,l=E&(1<<-_)-1,E>>=-_,_+=y;_>0;l=256*l+r[e+T],T+=I,_-=8);for(d=l&(1<<-_)-1,l>>=-_,_+=a;_>0;d=256*d+r[e+T],T+=I,_-=8);if(l===0)l=1-A;else{if(l===w)return d?NaN:1/0*(E?-1:1);d+=Math.pow(2,a),l-=A}return(E?-1:1)*d*Math.pow(2,l-a)},Ve.write=function(r,e,i,a,c,l){var d,y,w,A=8*l-c-1,_=(1<<A)-1,T=_>>1,I=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=a?0:l-1,M=a?1:-1,z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,d=_):(d=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-d))<1&&(d--,w*=2),(e+=d+T>=1?I/w:I*Math.pow(2,1-T))*w>=2&&(d++,w/=2),d+T>=_?(y=0,d=_):d+T>=1?(y=(e*w-1)*Math.pow(2,c),d+=T):(y=e*Math.pow(2,T-1)*Math.pow(2,c),d=0));c>=8;r[i+E]=255&y,E+=M,y/=256,c-=8);for(d=d<<c|y,A+=c;A>0;r[i+E]=255&d,E+=M,d/=256,A-=8);r[i+E-M]|=128*z}),Ve}function Rt(){if(ve)return ne;ve=1,ne=e;var r=ht();function e(j){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(j)?j:new Uint8Array(j||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,a=1/i,c=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function l(j){return j.type===e.Bytes?j.readVarint()+j.pos:j.pos+1}function d(j,$,W){return W?4294967296*$+(j>>>0):4294967296*($>>>0)+(j>>>0)}function y(j,$,W){var Q=$<=16383?1:$<=2097151?2:$<=268435455?3:Math.floor(Math.log($)/(7*Math.LN2));W.realloc(Q);for(var le=W.pos-1;le>=j;le--)W.buf[le+Q]=W.buf[le]}function w(j,$){for(var W=0;W<j.length;W++)$.writeVarint(j[W])}function A(j,$){for(var W=0;W<j.length;W++)$.writeSVarint(j[W])}function _(j,$){for(var W=0;W<j.length;W++)$.writeFloat(j[W])}function T(j,$){for(var W=0;W<j.length;W++)$.writeDouble(j[W])}function I(j,$){for(var W=0;W<j.length;W++)$.writeBoolean(j[W])}function E(j,$){for(var W=0;W<j.length;W++)$.writeFixed32(j[W])}function M(j,$){for(var W=0;W<j.length;W++)$.writeSFixed32(j[W])}function z(j,$){for(var W=0;W<j.length;W++)$.writeFixed64(j[W])}function B(j,$){for(var W=0;W<j.length;W++)$.writeSFixed64(j[W])}function N(j,$){return(j[$]|j[$+1]<<8|j[$+2]<<16)+16777216*j[$+3]}function H(j,$,W){j[W]=$,j[W+1]=$>>>8,j[W+2]=$>>>16,j[W+3]=$>>>24}function G(j,$){return(j[$]|j[$+1]<<8|j[$+2]<<16)+(j[$+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(j,$,W){for(W=W||this.length;this.pos<W;){var Q=this.readVarint(),le=Q>>3,se=this.pos;this.type=7&Q,j(le,$,this),this.pos===se&&this.skip(Q)}return $},readMessage:function(j,$){return this.readFields(j,$,this.readVarint()+this.pos)},readFixed32:function(){var j=N(this.buf,this.pos);return this.pos+=4,j},readSFixed32:function(){var j=G(this.buf,this.pos);return this.pos+=4,j},readFixed64:function(){var j=N(this.buf,this.pos)+N(this.buf,this.pos+4)*i;return this.pos+=8,j},readSFixed64:function(){var j=N(this.buf,this.pos)+G(this.buf,this.pos+4)*i;return this.pos+=8,j},readFloat:function(){var j=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,j},readDouble:function(){var j=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,j},readVarint:function(j){var $,W,Q=this.buf;return $=127&(W=Q[this.pos++]),W<128?$:($|=(127&(W=Q[this.pos++]))<<7,W<128?$:($|=(127&(W=Q[this.pos++]))<<14,W<128?$:($|=(127&(W=Q[this.pos++]))<<21,W<128?$:function(le,se,ae){var be,he,Te=ae.buf;if(be=(112&(he=Te[ae.pos++]))>>4,he<128||(be|=(127&(he=Te[ae.pos++]))<<3,he<128)||(be|=(127&(he=Te[ae.pos++]))<<10,he<128)||(be|=(127&(he=Te[ae.pos++]))<<17,he<128)||(be|=(127&(he=Te[ae.pos++]))<<24,he<128)||(be|=(1&(he=Te[ae.pos++]))<<31,he<128))return d(le,be,se);throw new Error("Expected varint not more than 10 bytes")}($|=(15&(W=Q[this.pos]))<<28,j,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var j=this.readVarint();return j%2==1?(j+1)/-2:j/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var j=this.readVarint()+this.pos,$=this.pos;return this.pos=j,j-$>=12&&c?function(W,Q,le){return c.decode(W.subarray(Q,le))}(this.buf,$,j):function(W,Q,le){for(var se="",ae=Q;ae<le;){var be,he,Te,Ie=W[ae],Me=null,ze=Ie>239?4:Ie>223?3:Ie>191?2:1;if(ae+ze>le)break;ze===1?Ie<128&&(Me=Ie):ze===2?(192&(be=W[ae+1]))==128&&(Me=(31&Ie)<<6|63&be)<=127&&(Me=null):ze===3?(he=W[ae+2],(192&(be=W[ae+1]))==128&&(192&he)==128&&((Me=(15&Ie)<<12|(63&be)<<6|63&he)<=2047||Me>=55296&&Me<=57343)&&(Me=null)):ze===4&&(he=W[ae+2],Te=W[ae+3],(192&(be=W[ae+1]))==128&&(192&he)==128&&(192&Te)==128&&((Me=(15&Ie)<<18|(63&be)<<12|(63&he)<<6|63&Te)<=65535||Me>=1114112)&&(Me=null)),Me===null?(Me=65533,ze=1):Me>65535&&(Me-=65536,se+=String.fromCharCode(Me>>>10&1023|55296),Me=56320|1023&Me),se+=String.fromCharCode(Me),ae+=ze}return se}(this.buf,$,j)},readBytes:function(){var j=this.readVarint()+this.pos,$=this.buf.subarray(this.pos,j);return this.pos=j,$},readPackedVarint:function(j,$){if(this.type!==e.Bytes)return j.push(this.readVarint($));var W=l(this);for(j=j||[];this.pos<W;)j.push(this.readVarint($));return j},readPackedSVarint:function(j){if(this.type!==e.Bytes)return j.push(this.readSVarint());var $=l(this);for(j=j||[];this.pos<$;)j.push(this.readSVarint());return j},readPackedBoolean:function(j){if(this.type!==e.Bytes)return j.push(this.readBoolean());var $=l(this);for(j=j||[];this.pos<$;)j.push(this.readBoolean());return j},readPackedFloat:function(j){if(this.type!==e.Bytes)return j.push(this.readFloat());var $=l(this);for(j=j||[];this.pos<$;)j.push(this.readFloat());return j},readPackedDouble:function(j){if(this.type!==e.Bytes)return j.push(this.readDouble());var $=l(this);for(j=j||[];this.pos<$;)j.push(this.readDouble());return j},readPackedFixed32:function(j){if(this.type!==e.Bytes)return j.push(this.readFixed32());var $=l(this);for(j=j||[];this.pos<$;)j.push(this.readFixed32());return j},readPackedSFixed32:function(j){if(this.type!==e.Bytes)return j.push(this.readSFixed32());var $=l(this);for(j=j||[];this.pos<$;)j.push(this.readSFixed32());return j},readPackedFixed64:function(j){if(this.type!==e.Bytes)return j.push(this.readFixed64());var $=l(this);for(j=j||[];this.pos<$;)j.push(this.readFixed64());return j},readPackedSFixed64:function(j){if(this.type!==e.Bytes)return j.push(this.readSFixed64());var $=l(this);for(j=j||[];this.pos<$;)j.push(this.readSFixed64());return j},skip:function(j){var $=7&j;if($===e.Varint)for(;this.buf[this.pos++]>127;);else if($===e.Bytes)this.pos=this.readVarint()+this.pos;else if($===e.Fixed32)this.pos+=4;else{if($!==e.Fixed64)throw new Error("Unimplemented type: "+$);this.pos+=8}},writeTag:function(j,$){this.writeVarint(j<<3|$)},realloc:function(j){for(var $=this.length||16;$<this.pos+j;)$*=2;if($!==this.length){var W=new Uint8Array($);W.set(this.buf),this.buf=W,this.length=$}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(j){this.realloc(4),H(this.buf,j,this.pos),this.pos+=4},writeSFixed32:function(j){this.realloc(4),H(this.buf,j,this.pos),this.pos+=4},writeFixed64:function(j){this.realloc(8),H(this.buf,-1&j,this.pos),H(this.buf,Math.floor(j*a),this.pos+4),this.pos+=8},writeSFixed64:function(j){this.realloc(8),H(this.buf,-1&j,this.pos),H(this.buf,Math.floor(j*a),this.pos+4),this.pos+=8},writeVarint:function(j){(j=+j||0)>268435455||j<0?function($,W){var Q,le;if($>=0?(Q=$%4294967296|0,le=$/4294967296|0):(le=~(-$/4294967296),4294967295^(Q=~(-$%4294967296))?Q=Q+1|0:(Q=0,le=le+1|0)),$>=18446744073709552e3||$<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");W.realloc(10),function(se,ae,be){be.buf[be.pos++]=127&se|128,se>>>=7,be.buf[be.pos++]=127&se|128,se>>>=7,be.buf[be.pos++]=127&se|128,se>>>=7,be.buf[be.pos++]=127&se|128,be.buf[be.pos]=127&(se>>>=7)}(Q,0,W),function(se,ae){var be=(7&se)<<4;ae.buf[ae.pos++]|=be|((se>>>=3)?128:0),se&&(ae.buf[ae.pos++]=127&se|((se>>>=7)?128:0),se&&(ae.buf[ae.pos++]=127&se|((se>>>=7)?128:0),se&&(ae.buf[ae.pos++]=127&se|((se>>>=7)?128:0),se&&(ae.buf[ae.pos++]=127&se|((se>>>=7)?128:0),se&&(ae.buf[ae.pos++]=127&se)))))}(le,W)}(j,this):(this.realloc(4),this.buf[this.pos++]=127&j|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=127&(j>>>=7)|(j>127?128:0),j<=127||(this.buf[this.pos++]=j>>>7&127))))},writeSVarint:function(j){this.writeVarint(j<0?2*-j-1:2*j)},writeBoolean:function(j){this.writeVarint(!!j)},writeString:function(j){j=String(j),this.realloc(4*j.length),this.pos++;var $=this.pos;this.pos=function(Q,le,se){for(var ae,be,he=0;he<le.length;he++){if((ae=le.charCodeAt(he))>55295&&ae<57344){if(!be){ae>56319||he+1===le.length?(Q[se++]=239,Q[se++]=191,Q[se++]=189):be=ae;continue}if(ae<56320){Q[se++]=239,Q[se++]=191,Q[se++]=189,be=ae;continue}ae=be-55296<<10|ae-56320|65536,be=null}else be&&(Q[se++]=239,Q[se++]=191,Q[se++]=189,be=null);ae<128?Q[se++]=ae:(ae<2048?Q[se++]=ae>>6|192:(ae<65536?Q[se++]=ae>>12|224:(Q[se++]=ae>>18|240,Q[se++]=ae>>12&63|128),Q[se++]=ae>>6&63|128),Q[se++]=63&ae|128)}return se}(this.buf,j,this.pos);var W=this.pos-$;W>=128&&y($,W,this),this.pos=$-1,this.writeVarint(W),this.pos+=W},writeFloat:function(j){this.realloc(4),r.write(this.buf,j,this.pos,!0,23,4),this.pos+=4},writeDouble:function(j){this.realloc(8),r.write(this.buf,j,this.pos,!0,52,8),this.pos+=8},writeBytes:function(j){var $=j.length;this.writeVarint($),this.realloc($);for(var W=0;W<$;W++)this.buf[this.pos++]=j[W]},writeRawMessage:function(j,$){this.pos++;var W=this.pos;j($,this);var Q=this.pos-W;Q>=128&&y(W,Q,this),this.pos=W-1,this.writeVarint(Q),this.pos+=Q},writeMessage:function(j,$,W){this.writeTag(j,e.Bytes),this.writeRawMessage($,W)},writePackedVarint:function(j,$){$.length&&this.writeMessage(j,w,$)},writePackedSVarint:function(j,$){$.length&&this.writeMessage(j,A,$)},writePackedBoolean:function(j,$){$.length&&this.writeMessage(j,I,$)},writePackedFloat:function(j,$){$.length&&this.writeMessage(j,_,$)},writePackedDouble:function(j,$){$.length&&this.writeMessage(j,T,$)},writePackedFixed32:function(j,$){$.length&&this.writeMessage(j,E,$)},writePackedSFixed32:function(j,$){$.length&&this.writeMessage(j,M,$)},writePackedFixed64:function(j,$){$.length&&this.writeMessage(j,z,$)},writePackedSFixed64:function(j,$){$.length&&this.writeMessage(j,B,$)},writeBytesField:function(j,$){this.writeTag(j,e.Bytes),this.writeBytes($)},writeFixed32Field:function(j,$){this.writeTag(j,e.Fixed32),this.writeFixed32($)},writeSFixed32Field:function(j,$){this.writeTag(j,e.Fixed32),this.writeSFixed32($)},writeFixed64Field:function(j,$){this.writeTag(j,e.Fixed64),this.writeFixed64($)},writeSFixed64Field:function(j,$){this.writeTag(j,e.Fixed64),this.writeSFixed64($)},writeVarintField:function(j,$){this.writeTag(j,e.Varint),this.writeVarint($)},writeSVarintField:function(j,$){this.writeTag(j,e.Varint),this.writeSVarint($)},writeStringField:function(j,$){this.writeTag(j,e.Bytes),this.writeString($)},writeFloatField:function(j,$){this.writeTag(j,e.Fixed32),this.writeFloat($)},writeDoubleField:function(j,$){this.writeTag(j,e.Fixed64),this.writeDouble($)},writeBooleanField:function(j,$){this.writeVarintField(j,!!$)}},ne}var Bt=pe(Rt());const ft=3;function _t(r,e,i){e.glyphs=[],r===1&&i.readMessage(an,e)}function an(r,e,i){if(r===3){const{id:a,bitmap:c,width:l,height:d,left:y,top:w,advance:A}=i.readMessage(Qi,{});e.glyphs.push({id:a,bitmap:new Cl({width:l+2*ft,height:d+2*ft},c),metrics:{width:l,height:d,left:y,top:w,advance:A}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function Qi(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const er=ft,it={horizontal:1,vertical:2,horizontalOnly:3};class Ke{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const a=new Ke;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new Ke;return i.image=e,i}}class ct{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,a){const c=new ct;for(let l=0;l<e.sections.length;l++){const d=e.sections[l];d.image?c.addImageSection(d,a):c.addTextSection(d,i)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,a){let c="";for(let l=0;l<i.length;l++){const d=i.charCodeAt(l+1)||null,y=i.charCodeAt(l-1)||null;c+=!a&&(d&&oh(d)&&!v[i[l+1]]||y&&oh(y)&&!v[i[l-1]])||!v[i[l]]?i[l]:v[i[l]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&wi[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&wi[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new ct;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Ke.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e,i){const a=e.image?e.image.getPrimary():null;if(!a)return void Pn("Can't add FormattedSection with an empty image.");a.scaleSelf(i);const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(Ke.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Pn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Dt(r,e,i,a,c,l,d,y,w,A,_,T,I,E,M,z=1){const B=ct.fromFeature(r,c,z);T===it.vertical&&B.verticalizePunctuation(I);let N=[];const H=function(Q,le,se,ae,be,he){if(!Q)return[];const Te=[],Ie=function(Ne,ke,Ue,lt,ot,Nt){let mt=0;for(let xt=0;xt<Ne.length();xt++){const ut=Ne.getSection(xt);mt+=Pi(Ne.getCodePoint(xt),ut,lt,ot,ke,Nt)}return mt/Math.max(1,Math.ceil(mt/Ue))}(Q,le,se,ae,be,he),Me=Q.text.indexOf("​")>=0;let ze=0;for(let Ne=0;Ne<Q.length();Ne++){const ke=Q.getSection(Ne),Ue=Q.getCodePoint(Ne);if(wi[Ue]||(ze+=Pi(Ue,ke,ae,be,le,he)),Ne<Q.length()-1){const lt=!((De=Ue)<11904||!(Yt["Bopomofo Extended"](De)||Yt.Bopomofo(De)||Yt["CJK Compatibility Forms"](De)||Yt["CJK Compatibility Ideographs"](De)||Yt["CJK Compatibility"](De)||Yt["CJK Radicals Supplement"](De)||Yt["CJK Strokes"](De)||Yt["CJK Symbols and Punctuation"](De)||Yt["CJK Unified Ideographs Extension A"](De)||Yt["CJK Unified Ideographs"](De)||Yt["Enclosed CJK Letters and Months"](De)||Yt["Halfwidth and Fullwidth Forms"](De)||Yt.Hiragana(De)||Yt["Ideographic Description Characters"](De)||Yt["Kangxi Radicals"](De)||Yt["Katakana Phonetic Extensions"](De)||Yt.Katakana(De)||Yt["Vertical Forms"](De)||Yt["Yi Radicals"](De)||Yt["Yi Syllables"](De)));(Mn[Ue]||lt||ke.image)&&Te.push(Nn(Ne+1,ze,Ie,Te,ws(Ue,Q.getCodePoint(Ne+1),lt&&Me),!1))}}var De;return Rc(Nn(Q.length(),ze,Ie,Te,0,!0))}(B,A,l,e,a,E),{processBidirectionalText:G,processStyledBidirectionalText:j}=cs;if(G&&B.sections.length===1){const Q=G(B.toString(),H);for(const le of Q){const se=new ct;se.text=le,se.sections=B.sections;for(let ae=0;ae<le.length;ae++)se.sectionIndex.push(0);N.push(se)}}else if(j){const Q=j(B.text,B.sectionIndex,H);for(const le of Q){const se=new ct;se.text=le[0],se.sectionIndex=le[1],se.sections=B.sections,N.push(se)}}else N=function(Q,le){const se=[],ae=Q.text;let be=0;for(const he of le)se.push(Q.substring(be,he)),be=he;return be<ae.length&&se.push(Q.substring(be,ae.length)),se}(B,H);const $=[],W={positionedLines:$,text:B.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Q,le,se,ae,be,he,Te,Ie,Me,ze,De,Ne){let ke=0,Ue=0,lt=0;const ot=Ie==="right"?1:Ie==="left"?0:.5;let Nt=!1;for(const Zt of be){const pi=Zt.getSections();for(const Ci of pi){if(Ci.image)continue;const yi=le[Ci.fontStack];if(yi&&(Nt=yi.ascender!==void 0&&yi.descender!==void 0,!Nt))break}if(!Nt)break}let mt=0;for(const Zt of be){Zt.trim();const pi=Zt.getMaxScale(),Ci=(pi-1)*Tr,yi={positionedGlyphs:[],lineOffset:0};Q.positionedLines[mt]=yi;const Bi=yi.positionedGlyphs;let Mi=0;if(!Zt.length()){Ue+=he,++mt;continue}let ji=0,ln=0;for(let gi=0;gi<Zt.length();gi++){const Yi=Zt.getSection(gi),Fn=Zt.getSectionIndex(gi),$n=Zt.getCodePoint(gi);let Jn=Yi.scale,tr=null,In=null,Yr=null,ra=Tr,Sr=0;Me===it.vertical&&((xt=$n)===12312||xt===12313||xt===12316||xt===12540||xt===12448)&&(Me=it.horizontal);const Or=!(Me===it.horizontal||!De&&!ul($n)||De&&(wi[$n]||sd($n)));if(Yi.image){const Fs=ae.get(Yi.image.toString());if(!Fs)continue;Yr=Yi.image,Q.iconsInText=Q.iconsInText||!0,In=Fs.paddedRect;const ds=Fs.displaySize;Jn=Jn*Tr/Ne,tr={width:ds[0],height:ds[1],left:0,top:-3,advance:Or?ds[1]:ds[0],localGlyph:!1},Sr=Nt?-tr.height*Jn:pi*Tr-17-ds[1]*Jn,ra=tr.advance;const Fo=(Or?ds[0]:ds[1])*Jn-Tr*pi;Fo>0&&Fo>Mi&&(Mi=Fo)}else{const Fs=se[Yi.fontStack];if(!Fs)continue;Fs[$n]&&(In=Fs[$n]);const ds=le[Yi.fontStack];if(!ds)continue;const Fo=ds.glyphs[$n];if(!Fo)continue;if(tr=Fo.metrics,ra=$n!==8203?Tr:0,Nt){const Wd=ds.ascender!==void 0?Math.abs(ds.ascender):0,zl=ds.descender!==void 0?Math.abs(ds.descender):0,Lc=(Wd+zl)*Jn;ji<Lc&&(ji=Lc,ln=(Wd-zl)/2*Jn),Sr=-Wd*Jn}else Sr=(pi-Jn)*Tr-17}Or?(Q.verticalizable=!0,Bi.push({glyph:$n,image:Yr,x:ke,y:Ue+Sr,vertical:Or,scale:Jn,localGlyph:tr.localGlyph,fontStack:Yi.fontStack,sectionIndex:Fn,metrics:tr,rect:In}),ke+=ra*Jn+ze):(Bi.push({glyph:$n,image:Yr,x:ke,y:Ue+Sr,vertical:Or,scale:Jn,localGlyph:tr.localGlyph,fontStack:Yi.fontStack,sectionIndex:Fn,metrics:tr,rect:In}),ke+=tr.advance*Jn+ze)}Bi.length!==0&&(lt=Math.max(ke-ze,lt),Nt?Mx(Bi,ot,Mi,ln,he*pi/2):Mx(Bi,ot,Mi,0,he/2)),ke=0;const Dn=he*pi+Mi;yi.lineOffset=Math.max(Mi,Ci),Ue+=Dn,++mt}var xt;const ut=Ue,{horizontalAlign:ti,verticalAlign:zt}=S_(Te);(function(Zt,pi,Ci,yi,Bi,Mi){const ji=(pi-Ci)*Bi,ln=-Mi*yi;for(const Dn of Zt)for(const gi of Dn.positionedGlyphs)gi.x+=ji,gi.y+=ln})(Q.positionedLines,ot,ti,zt,lt,ut),Q.top+=-zt*ut,Q.bottom=Q.top+ut,Q.left+=-ti*lt,Q.right=Q.left+lt,Q.hasBaseline=Nt}(W,e,i,a,N,d,y,w,T,A,I,M),!function(Q){for(const le of Q)if(le.positionedGlyphs.length!==0)return!1;return!0}($))return W}const wi={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Mn={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Pi(r,e,i,a,c,l){if(e.image){const d=a.get(e.image.toString());return d?d.displaySize[0]*e.scale*Tr/l+c:0}{const d=i[e.fontStack],y=d&&d.glyphs[r];return y?y.metrics.advance*e.scale+c:0}}function en(r,e,i,a){const c=Math.pow(r-e,2);return a?r<e?c/2:2*c:c+Math.abs(i)*i}function ws(r,e,i){let a=0;return r===10&&(a-=1e4),i&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Nn(r,e,i,a,c,l){let d=null,y=en(e,i,c,l);for(const w of a){const A=en(e-w.x,i,c,l)+w.badness;A<=y&&(d=w,y=A)}return{index:r,x:e,priorBreak:d,badness:y}}function Rc(r){return r?Rc(r.priorBreak).concat(r.index):[]}function S_(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Mx(r,e,i,a,c){if(!(e||i||a||c))return;const l=r.length-1,d=r[l],y=(d.x+d.metrics.advance*d.scale)*e;for(let w=0;w<=l;w++)r[w].x-=y,r[w].y+=i+a+c}function vS(r,e,i,a){const{horizontalAlign:c,verticalAlign:l}=S_(a),d=i[0]-r.displaySize[0]*c,y=i[1]-r.displaySize[1]*l;return{imagePrimary:r,imageSecondary:e,top:y,bottom:y+r.displaySize[1],left:d,right:d+r.displaySize[0]}}function Ix(r,e,i,a,c,l){const d=r.imagePrimary;let y;if(d.content){const B=d.content,N=d.pixelRatio||1;y=[B[0]/N,B[1]/N,d.displaySize[0]-B[2]/N,d.displaySize[1]-B[3]/N]}const w=e.left*l,A=e.right*l;let _,T,I,E;i==="width"||i==="both"?(E=c[0]+w-a[3],T=c[0]+A+a[1]):(E=c[0]+(w+A-d.displaySize[0])/2,T=E+d.displaySize[0]);const M=e.top*l,z=e.bottom*l;return i==="height"||i==="both"?(_=c[1]+M-a[0],I=c[1]+z+a[2]):(_=c[1]+(M+z-d.displaySize[1])/2,I=_+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:_,right:T,bottom:I,left:E,collisionPadding:y}}class Rh extends Mt{constructor(e,i,a,c,l){super(e,i),this.angle=c,this.z=a,l!==void 0&&(this.segment=l)}clone(){return new Rh(this.x,this.y,this.z,this.angle,this.segment)}}function Cx(r,e,i,a,c){if(e.segment===void 0)return!0;let l=e,d=e.segment+1,y=0;for(;y>-i/2;){if(d--,d<0)return!1;y-=r[d].dist(l),l=r[d]}y+=r[d].dist(r[d+1]),d++;const w=[];let A=0;for(;y<i/2;){const _=r[d],T=r[d+1];if(!T)return!1;let I=r[d-1].angleTo(_)-_.angleTo(T);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:y,angleDelta:I}),A+=I;y-w[0].distance>a;)A-=w.shift().angleDelta;if(A>c)return!1;d++,y+=_.dist(T)}return!0}function Rx(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function Dx(r,e,i){return r?.6*e*i:0}function zx(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function xS(r,e,i,a,c,l){const d=Dx(i,c,l),y=zx(i,a)*l;let w=0;const A=Rx(r)/2;for(let _=0;_<r.length-1;_++){const T=r[_],I=r[_+1],E=T.dist(I);if(w+E>A){const M=(A-w)/E,z=Kt(T.x,I.x,M),B=Kt(T.y,I.y,M),N=new Rh(z,B,0,I.angleTo(T),_);return!d||Cx(r,N,y,d,e)?N:void 0}w+=E}}function bS(r,e,i,a,c,l,d,y,w){const A=Dx(a,l,d),_=zx(a,c),T=_*d,I=r[0].x===0||r[0].x===w||r[0].y===0||r[0].y===w;return e-T<e/4&&(e=T+e/4),Px(r,I?e/2*y%e:(_/2+2*l)*d*y%e,e,A,i,T,I,!1,w)}function Px(r,e,i,a,c,l,d,y,w){const A=l/2,_=Rx(r);let T=0,I=e-i,E=[];for(let M=0;M<r.length-1;M++){const z=r[M],B=r[M+1],N=z.dist(B),H=B.angleTo(z);for(;I+i<T+N;){I+=i;const G=(I-T)/N,j=Kt(z.x,B.x,G),$=Kt(z.y,B.y,G);if(j>=0&&j<w&&$>=0&&$<w&&I-A>=0&&I+A<=_){const W=new Rh(j,$,0,H,M);a&&!Cx(r,W,l,a,c)||E.push(W)}}T+=N}return y||E.length||d||(E=Px(r,T/2,i,a,c,l,d,!0,w)),E}function Ox(r,e,i,a,c){const l=[];for(let d=0;d<r.length;d++){const y=r[d];let w;for(let A=0;A<y.length-1;A++){let _=y[A],T=y[A+1];_.x<e&&T.x<e||(_.x<e?_=new Mt(e,_.y+(e-_.x)/(T.x-_.x)*(T.y-_.y))._round():T.x<e&&(T=new Mt(e,_.y+(e-_.x)/(T.x-_.x)*(T.y-_.y))._round()),_.y<i&&T.y<i||(_.y<i?_=new Mt(_.x+(i-_.y)/(T.y-_.y)*(T.x-_.x),i)._round():T.y<i&&(T=new Mt(_.x+(i-_.y)/(T.y-_.y)*(T.x-_.x),i)._round()),_.x>=a&&T.x>=a||(_.x>=a?_=new Mt(a,_.y+(a-_.x)/(T.x-_.x)*(T.y-_.y))._round():T.x>=a&&(T=new Mt(a,_.y+(a-_.x)/(T.x-_.x)*(T.y-_.y))._round()),_.y>=c&&T.y>=c||(_.y>=c?_=new Mt(_.x+(c-_.y)/(T.y-_.y)*(T.x-_.x),c)._round():T.y>=c&&(T=new Mt(_.x+(c-_.y)/(T.y-_.y)*(T.x-_.x),c)._round()),w&&_.equals(w[w.length-1])||(w=[_],l.push(w)),w.push(T)))))}}return l}function Lx(r){let e=0,i=0;for(const d of r)e+=d.w*d.h,i=Math.max(i,d.w);r.sort((d,y)=>y.h-d.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,l=0;for(const d of r)for(let y=a.length-1;y>=0;y--){const w=a[y];if(!(d.w>w.w||d.h>w.h)){if(d.x=w.x,d.y=w.y,l=Math.max(l,d.y+d.h),c=Math.max(c,d.x+d.w),d.w===w.w&&d.h===w.h){const A=a.pop();y<a.length&&(a[y]=A)}else d.h===w.h?(w.x+=d.w,w.w-=d.w):d.w===w.w?(w.y+=d.h,w.h-=d.h):(a.push({x:w.x+d.w,y:w.y,w:w.w-d.w,h:d.h}),w.y+=d.h,w.h-=d.h);break}}return{w:c,h:l,fill:e/(c*l)||0}}Ot(Rh,"Anchor");const vm=1;class E_{static getImagePositionScale(e,i,a){if(i&&e&&e.options&&e.options.transform){const c=e.options.transform;return{x:c.a,y:c.d}}return{x:a,y:a}}constructor(e,i,a,c){this.paddedRect=e;const{pixelRatio:l,version:d,stretchX:y,stretchY:w,content:A,sdf:_,usvg:T}=i;this.pixelRatio=l,this.stretchX=y,this.stretchY=w,this.content=A,this.version=d,this.padding=a,this.sdf=_,this.scale=E_.getImagePositionScale(c,T,l)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function kx(r,e,i){const a=Ja.parse(r),c=function(l,d,y=[1,1]){return{x:0,y:0,w:(l.data?l.data.width:l.width*y[0])+2*d,h:(l.data?l.data.height:l.height*y[1])+2*d}}(e,i,[a.options.transform.a,a.options.transform.d]);return{bin:c,imagePosition:new E_(c,e,i,a),imageVariant:a}}class Bx{constructor(e,i,a){const c=new Map,l=new Map;this.haveRenderCallbacks=[];const d=[];this.addImages(e,c,vm,d),this.addImages(i,l,2,d);const{w:y,h:w}=Lx(d),A=new Ur({width:y||1,height:w||1});for(const[_,T]of e.entries()){const I=c.get(_).paddedRect;Ur.copy(T.data,A,{x:0,y:0},{x:I.x+vm,y:I.y+vm},T.data,a,T.sdf)}for(const[_,T]of i.entries()){const I=l.get(_),E=I.paddedRect;let M=I.padding;const z=E.x+M,B=E.y+M,N=T.data.width,H=T.data.height;M=M>1?M-1:M,Ur.copy(T.data,A,{x:0,y:0},{x:z,y:B},T.data,a),Ur.copy(T.data,A,{x:0,y:H-M},{x:z,y:B-M},{width:N,height:M},a),Ur.copy(T.data,A,{x:0,y:0},{x:z,y:B+H},{width:N,height:M},a),Ur.copy(T.data,A,{x:N-M,y:0},{x:z-M,y:B},{width:M,height:H},a),Ur.copy(T.data,A,{x:0,y:0},{x:z+N,y:B},{width:M,height:H},a),Ur.copy(T.data,A,{x:N-M,y:H-M},{x:z-M,y:B-M},{width:M,height:M},a),Ur.copy(T.data,A,{x:0,y:H-M},{x:z+N,y:B-M},{width:M,height:M},a),Ur.copy(T.data,A,{x:0,y:0},{x:z+N,y:B+H},{width:M,height:M},a),Ur.copy(T.data,A,{x:N-M,y:0},{x:z-M,y:B+H},{width:M,height:M},a)}this.lut=a,this.image=A,this.iconPositions=c,this.patternPositions=l}addImages(e,i,a,c){for(const[l,d]of e.entries()){const{bin:y,imagePosition:w,imageVariant:A}=kx(l,d,a);i.set(l,w),c.push(y),d.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const c of e.getUpdatedImages(a)){for(const l of this.iconPositions.keys()){const d=Ja.parse(l);if(as.isEqual(d.id,c)){const y=e.getImage(c,a);this.patchUpdatedImage(this.iconPositions.get(l),y,i)}}for(const l of this.patternPositions.keys()){const d=Ja.parse(l);if(as.isEqual(d.id,c)){const y=e.getImage(c,a);this.patchUpdatedImage(this.patternPositions.get(l),y,i)}}}}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,l]=e.tl,d=e.sdf;if(this.lut||d){const y={width:i.data.width,height:i.data.height},w=new Ur(y);Ur.copy(i.data,w,{x:0,y:0},{x:0,y:0},y,this.lut,d),a.update(w,{position:{x:c,y:l}})}else a.update(i.data,{position:{x:c,y:l}})}}Ot(E_,"ImagePosition"),Ot(Bx,"ImageAtlas");const Gg=1e20;function Nx(r,e,i,a,c,l,d,y,w){for(let A=e;A<e+a;A++)Fx(r,i*l+A,l,c,d,y,w);for(let A=i;A<i+c;A++)Fx(r,A*l+e,1,a,d,y,w)}function Fx(r,e,i,a,c,l,d){l[0]=0,d[0]=-1e20,d[1]=Gg,c[0]=r[e];for(let y=1,w=0,A=0;y<a;y++){c[y]=r[e+y*i];const _=y*y;do{const T=l[w];A=(c[y]-c[T]+_-T*T)/(y-T)/2}while(A<=d[w]&&--w>-1);w++,l[w]=y,d[w]=A,d[w+1]=Gg}for(let y=0,w=0;y<a;y++){for(;d[w+1]<y;)w++;const A=l[w],_=y-A;r[e+y*i]=c[A]+_*_}}const Dc=2,xv={none:0,ideographs:1,all:2};class xm{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,a){const c=[],l=this.urls[i]||te.GLYPHS_URL;for(const d in e)for(const y of e[d])c.push({stack:d,id:y});qr(c,({stack:d,id:y},w)=>{let A=this.entries[d];A||(A=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=A.glyphs[y];if(_!==void 0)return void w(null,{stack:d,id:y,glyph:_});if(_=this._tinySDF(A,d,y),_)return A.glyphs[y]=_,void w(null,{stack:d,id:y,glyph:_});const T=Math.floor(y/256);if(256*T>65535)return Pn("glyphs > 65535 not supported"),void w(null,{stack:d,id:y,glyph:_});if(A.ranges[T])return void w(null,{stack:d,id:y,glyph:_});let I=A.requests[T];I||(I=A.requests[T]=[],xm.loadGlyphRange(d,T,l,this.requestManager,(E,M)=>{if(M){A.ascender=M.ascender,A.descender=M.descender;for(const z in M.glyphs)this._doesCharSupportLocalGlyph(+z)||(A.glyphs[+z]=M.glyphs[+z]);A.ranges[T]=!0}for(const z of I)z(E,M);delete A.requests[T]})),I.push((E,M)=>{E?w(E):M&&w(null,{stack:d,id:y,glyph:M.glyphs[y]||null})})},(d,y)=>{if(d)a(d);else if(y){const w={};for(const{stack:A,id:_,glyph:T}of y)w[A]===void 0&&(w[A]={}),w[A].glyphs===void 0&&(w[A].glyphs={}),w[A].glyphs[_]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},w[A].ascender=this.entries[A].ascender,w[A].descender=this.entries[A].descender;a(null,w)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==xv.none&&(this.localGlyphMode===xv.all?!!this.localFontFamily:!!this.localFontFamily&&(Yt["CJK Unified Ideographs"](e)||Yt["Hangul Syllables"](e)||Yt.Hiragana(e)||Yt.Katakana(e)||Yt["CJK Symbols and Punctuation"](e)||Yt["CJK Unified Ideographs Extension A"](e)||Yt["CJK Unified Ideographs Extension B"](e)||Yt.Osage(e)))}_tinySDF(e,i,a){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let l=e.tinySDF;if(!l){let z="400";/bold/i.test(i)?z="900":/medium/i.test(i)?z="500":/light/i.test(i)&&(z="200"),l=e.tinySDF=new xm.TinySDF({fontFamily:c,fontWeight:z,fontSize:24*Dc,buffer:3*Dc,radius:8*Dc}),l.fontWeight=z}if(this.localGlyphs[l.fontWeight][a])return this.localGlyphs[l.fontWeight][a];const d=String.fromCodePoint(a),{data:y,width:w,height:A,glyphWidth:_,glyphHeight:T,glyphLeft:I,glyphTop:E,glyphAdvance:M}=l.draw(d);return this.localGlyphs[l.fontWeight][a]={id:a,bitmap:new Cl({width:w,height:A},y),metrics:{width:_/Dc,height:T/Dc,left:I/Dc,top:E/Dc-27,advance:M/Dc,localGlyph:!0}}}}xm.loadGlyphRange=function(r,e,i,a,c){const l=256*e,d=l+255,y=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${l}-${d}`),nr.Glyphs);Ca(y,(w,A)=>{if(w)c(w);else if(A){const _={},T=function(I){return new Bt(I).readFields(_t,{})}(A);for(const I of T.glyphs)_[I.id]=I;c(null,{glyphs:_,ascender:T.ascender,descender:T.descender})}})},xm.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:l="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;const y=this.size=r+4*e,w=this._createCanvas(y),A=this.ctx=w.getContext("2d",{willReadFrequently:!0});A.font=`${d} ${l} ${r}px ${c}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:l}=this.ctx.measureText(r),d=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-c))),w=Math.min(this.size-this.buffer,d+Math.ceil(a)),A=y+2*this.buffer,_=w+2*this.buffer,T=Math.max(A*_,0),I=new Uint8ClampedArray(T),E={data:I,width:A,height:_,glyphWidth:y,glyphHeight:w,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(y===0||w===0)return E;const{ctx:M,buffer:z,gridInner:B,gridOuter:N}=this;M.clearRect(z,z,y,w),M.fillText(r,z,z+d);const H=M.getImageData(z,z,y,w);N.fill(Gg,0,T),B.fill(0,0,T);for(let G=0;G<w;G++)for(let j=0;j<y;j++){const $=H.data[4*(G*y+j)+3]/255;if($===0)continue;const W=(G+z)*A+j+z;if($===1)N[W]=0,B[W]=Gg;else{const Q=.5-$;N[W]=Q>0?Q*Q:0,B[W]=Q<0?Q*Q:0}}Nx(N,0,0,A,_,A,this.f,this.v,this.z),Nx(B,z,z,y,w,A,this.f,this.v,this.z);for(let G=0;G<T;G++){const j=Math.sqrt(N[G])-Math.sqrt(B[G]);I[G]=Math.round(255-255*(j/this.radius+this.cutoff))}return E}};const Qf=vm;function Ux(r,e){return r+e[1]-e[0]}function Vx(r,e,i,a,c=1){const l=[],d=r.imagePrimary,y=d.pixelRatio,w=d.paddedRect.w-2*Qf,A=d.paddedRect.h-2*Qf,_=(r.right-r.left)*c,T=(r.bottom-r.top)*c,I=d.stretchX||[[0,w]],E=d.stretchY||[[0,A]],M=I.reduce(Ux,0),z=E.reduce(Ux,0),B=w-M,N=A-z;let H=0,G=M,j=0,$=z,W=0,Q=B,le=0,se=N;if(d.content&&a){const be=d.content;H=Hg(I,0,be[0]),j=Hg(E,0,be[1]),G=Hg(I,be[0],be[2]),$=Hg(E,be[1],be[3]),W=be[0]-H,le=be[1]-j,Q=be[2]-be[0]-G,se=be[3]-be[1]-$}const ae=(be,he,Te,Ie)=>{const Me=Zg(be.stretch-H,G,_,r.left*c),ze=$g(be.fixed-W,Q,be.stretch,M),De=Zg(he.stretch-j,$,T,r.top*c),Ne=$g(he.fixed-le,se,he.stretch,z),ke=Zg(Te.stretch-H,G,_,r.left*c),Ue=$g(Te.fixed-W,Q,Te.stretch,M),lt=Zg(Ie.stretch-j,$,T,r.top*c),ot=$g(Ie.fixed-le,se,Ie.stretch,z),Nt=new Mt(Me,De),mt=new Mt(ke,De),xt=new Mt(ke,lt),ut=new Mt(Me,lt),ti=new Mt(ze/y,Ne/y),zt=new Mt(Ue/y,ot/y),Zt=e*Math.PI/180;if(Zt){const ji=Math.sin(Zt),ln=Math.cos(Zt),Dn=[ln,-ji,ji,ln];Nt._matMult(Dn),mt._matMult(Dn),ut._matMult(Dn),xt._matMult(Dn)}const pi=be.stretch+be.fixed,Ci=Te.stretch+Te.fixed,yi=he.stretch+he.fixed,Bi=Ie.stretch+Ie.fixed,Mi=r.imageSecondary;return{tl:Nt,tr:mt,bl:ut,br:xt,texPrimary:{x:d.paddedRect.x+Qf+pi,y:d.paddedRect.y+Qf+yi,w:Ci-pi,h:Bi-yi},texSecondary:Mi?{x:Mi.paddedRect.x+Qf+pi,y:Mi.paddedRect.y+Qf+yi,w:Ci-pi,h:Bi-yi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ti,pixelOffsetBR:zt,minFontScaleX:Q/y/_,minFontScaleY:se/y/T,isSDF:i}};if(a&&(d.stretchX||d.stretchY)){const be=jx(I,B,M),he=jx(E,N,z);for(let Te=0;Te<be.length-1;Te++){const Ie=be[Te],Me=be[Te+1];for(let ze=0;ze<he.length-1;ze++)l.push(ae(Ie,he[ze],Me,he[ze+1]))}}else l.push(ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:A+1}));return l}function Hg(r,e,i){let a=0;for(const c of r)a+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return a}function jx(r,e,i){const a=[{fixed:-1,stretch:0}];for(const[c,l]of r){const d=a[a.length-1];a.push({fixed:c-d.stretch,stretch:d.stretch}),a.push({fixed:c-d.stretch,stretch:d.stretch+(l-c)})}return a.push({fixed:e+Qf,stretch:i}),a}function Zg(r,e,i,a){return r/e*i+a}function $g(r,e,i,a){return r-e*i/a}function wS(r,e,i,a){const c=e+r.positionedLines[a].lineOffset;return a===0?i+c/2:i+(c+(e+r.positionedLines[a-1].lineOffset))/2}function TS(r,e=1,i=!1){let a=1/0,c=1/0,l=-1/0,d=-1/0;const y=r[0];for(let E=0;E<y.length;E++){const M=y[E];(!E||M.x<a)&&(a=M.x),(!E||M.y<c)&&(c=M.y),(!E||M.x>l)&&(l=M.x),(!E||M.y>d)&&(d=M.y)}const w=Math.min(l-a,d-c);let A=w/2;const _=new Zc([],SS);if(w===0)return new Mt(a,c);for(let E=a;E<l;E+=w)for(let M=c;M<d;M+=w)_.push(new bm(E+A,M+A,A,r));let T=function(E){let M=0,z=0,B=0;const N=E[0];for(let H=0,G=N.length,j=G-1;H<G;j=H++){const $=N[H],W=N[j],Q=$.x*W.y-W.x*$.y;z+=($.x+W.x)*Q,B+=($.y+W.y)*Q,M+=3*Q}return new bm(z/M,B/M,0,E)}(r),I=_.length;for(;_.length;){const E=_.pop();(E.d>T.d||!T.d)&&(T=E,i&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,I)),E.max-T.d<=e||(A=E.h/2,_.push(new bm(E.p.x-A,E.p.y-A,A,r)),_.push(new bm(E.p.x+A,E.p.y-A,A,r)),_.push(new bm(E.p.x-A,E.p.y+A,A,r)),_.push(new bm(E.p.x+A,E.p.y+A,A,r)),I+=4)}return i&&(console.log(`num probes: ${I}`),console.log(`best distance: ${T.d}`)),T.p}function SS(r,e){return e.max-r.max}class bm{constructor(e,i,a,c){this.p=new Mt(e,i),this.h=a,this.d=function(l,d){let y=!1,w=1/0;for(let A=0;A<d.length;A++){const _=d[A];for(let T=0,I=_.length,E=I-1;T<I;E=T++){const M=_[T],z=_[E];M.y>l.y!=z.y>l.y&&l.x<(z.x-M.x)*(l.y-M.y)/(z.y-M.y)+M.x&&(y=!y),w=Math.min(w,xe(l,M,z))}}return(y?1:-1)*Math.sqrt(w)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const bv=Number.POSITIVE_INFINITY,ES=Math.sqrt(2);function qx(r,[e,i]){let a=0,c=0;if(i===bv){e<0&&(e=0);const l=e/ES;switch(r){case"top-right":case"top-left":c=l-7;break;case"bottom-right":case"bottom-left":c=7-l;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(r){case"top-right":case"bottom-right":a=-l;break;case"top-left":case"bottom-left":a=l;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(r){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function Gx(r,e,i,a,c,l,d,y){if(!r)return;const w=Jf(e,i,a,c,l);return r.scaleSelf(w*y*d)}function Hx(r,e,i,a,c,l,d,y){return{iconPrimary:Gx(r.getPrimary(),e,i,a,c,l,d,y),iconSecondary:Gx(r.getSecondary(),e,i,a,c,l,d,y)}}function Zx(r,e,i,a){if(!r)return;const c=e.get(i.toString());if(r.imagePrimary=c,a){const l=e.get(a.toString());r.imageSecondary=l}}function AS(r,e){for(const i in r.horizontal)$x(r.horizontal[i],e);$x(r.vertical,e)}function $x(r,e){if(r){for(const i of r.positionedLines)for(const a of i.positionedGlyphs)if(a.image!==null){const c=a.image.toString();a.rect=e.get(c).paddedRect}}}function wv(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function MS(r,e,i,a,c,l,d,y,w){const A=Tv(l.horizontal)||l.vertical,_=i.get("icon-text-fit-padding").evaluate(a,{},c);let T,I=e;return e&&w!=="none"&&(r.allowVerticalPlacement&&l.vertical&&(T=Ix(e,l.vertical,w,_,y,d)),A&&(I=Ix(e,A,w,_,y,d))),{defaultShapedIcon:I,verticallyShapedIcon:T}}function IS(r,e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B,N,H,G){let j=d.textMaxSize.evaluate(e,{},I);j===void 0?j=y*d.textScaleFactor:j*=d.textScaleFactor;const $=r.layers[0].layout,W=Tv(i.horizontal)||i.vertical,Q=E.name==="globe",le=Tr,se=r.tilePixelRatio*j/le,ae=(ze=r.overscaling,r.zoom>18&&ze>2&&(ze>>=1),Math.max(vt/(512*ze),1)*$.get("symbol-spacing")),be=$.get("text-padding")*r.tilePixelRatio,he=$.get("icon-padding")*r.tilePixelRatio,Te=Gi($.get("text-max-angle")),Ie=$.get("icon-rotation-alignment")==="map"&&G!=="point",Me=ae/2;var ze;r.hasAnyIconTextFit===!1&&B!=="none"&&(r.hasAnyIconTextFit=!0);const De=e.properties?+e.properties[vn]:null,Ne=De&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(De):65535,ke=(Ue,lt,ot)=>{if(lt.x<0||lt.x>=vt||lt.y<0||lt.y>=vt)return;let Nt=null;if(Q){const{x:mt,y:xt,z:ut}=E.projectTilePoint(lt.x,lt.y,ot);Nt={anchor:new Rh(mt,xt,ut,0,void 0),up:E.upVector(ot,lt.x,lt.y)}}(function(mt,xt,ut,ti,zt,Zt,pi,Ci,yi,Bi,Mi,ji,ln,Dn,gi,Yi,Fn,$n,Jn,tr,In,Yr,ra,Sr,Or,Fs,ds,Fo,Wd){const zl=mt.addToLineVertexArray(xt,ti);let Lc,Yd,Kd,rp,Cb,Rb,Db,zb=0,Pb=0,Ob=0,Lb=0,i0=-1,n0=-1;const Su={};let kb=Gs("");const sp=ut?ut.anchor:xt,r0=Fo!=="none";let s0=0,a0=0;if(yi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[s0,a0]=yi.layout.get("text-offset").evaluate(In,{},Or).map(Uo=>Uo*Tr):(s0=yi.layout.get("text-radial-offset").evaluate(In,{},Or)*Tr,a0=bv),mt.allowVerticalPlacement&&zt.vertical){const Uo=zt.vertical;if(gi)Rb=Sv(Uo),Ci&&(Db=Sv(Ci));else{const qa=yi.layout.get("text-rotate").evaluate(In,{},Or)+90;Kd=Xg(Bi,sp,xt,Mi,ji,ln,Uo,Dn,qa,Yi),Ci&&(rp=Xg(Bi,sp,xt,Mi,ji,ln,Ci,$n,qa))}}if(Zt){const Uo=mt.iconSizeData,qa=yi.layout.get("icon-rotate").evaluate(In,{},Or),G_=Vx(Zt,qa,ra,r0,Yr.iconScaleFactor),l0=Ci?Vx(Ci,qa,ra,r0,Yr.iconScaleFactor):void 0;Yd=Xg(Bi,sp,xt,Mi,ji,ln,Zt,$n,qa,null),zb=4*G_.length;let ap=null;Uo.kind==="source"?(ap=[ja*yi.layout.get("icon-size").evaluate(In,{},Or)*Yr.iconScaleFactor],ap[0]>Hd&&Pn(`${mt.layerIds[0]}: Value for "icon-size" is >= ${A_}. Reduce your "icon-size".`)):Uo.kind==="composite"&&(ap=[ja*Yr.compositeIconSizes[0].evaluate(In,{},Or)*Yr.iconScaleFactor,ja*Yr.compositeIconSizes[1].evaluate(In,{},Or)*Yr.iconScaleFactor],(ap[0]>Hd||ap[1]>Hd)&&Pn(`${mt.layerIds[0]}: Value for "icon-size" is >= ${A_}. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,G_,ap,tr,Jn,In,!1,ut,xt,zl.lineStartIndex,zl.lineLength,-1,Sr,Or,Fs,ds),i0=mt.icon.placedSymbolArray.length-1,l0&&(Pb=4*l0.length,mt.addSymbols(mt.icon,l0,ap,tr,Jn,In,it.vertical,ut,xt,zl.lineStartIndex,zl.lineLength,-1,Sr,Or,Fs,ds),n0=mt.icon.placedSymbolArray.length-1)}for(const Uo in zt.horizontal){const qa=zt.horizontal[Uo];Lc||(kb=Gs(qa.text),gi?Cb=Sv(qa):Lc=Xg(Bi,sp,xt,Mi,ji,ln,qa,Dn,yi.layout.get("text-rotate").evaluate(In,{},Or),Yi));const G_=qa.positionedLines.length===1;if(Ob+=Xx(mt,ut,xt,qa,pi,yi,gi,In,Yi,zl,zt.vertical?it.horizontal:it.horizontalOnly,G_?Object.keys(zt.horizontal):[Uo],Su,i0,Yr,Sr,Or,Fs),G_)break}zt.vertical&&(Lb+=Xx(mt,ut,xt,zt.vertical,pi,yi,gi,In,Yi,zl,it.vertical,["vertical"],Su,n0,Yr,Sr,Or,Fs));let Jd=-1;const o0=(Uo,qa)=>Uo?Math.max(Uo,qa):qa;Jd=o0(Cb,Jd),Jd=o0(Rb,Jd),Jd=o0(Db,Jd);const aE=Jd>-1?1:0;mt.glyphOffsetArray.length>=65535&&Pn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),In.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,In.sortKey),mt.symbolInstances.emplaceBack(xt.x,xt.y,sp.x,sp.y,sp.z,Su.right>=0?Su.right:-1,Su.center>=0?Su.center:-1,Su.left>=0?Su.left:-1,Su.vertical>=0?Su.vertical:-1,i0,n0,kb,Lc!==void 0?Lc:mt.collisionBoxArray.length,Lc!==void 0?Lc+1:mt.collisionBoxArray.length,Kd!==void 0?Kd:mt.collisionBoxArray.length,Kd!==void 0?Kd+1:mt.collisionBoxArray.length,Yd!==void 0?Yd:mt.collisionBoxArray.length,Yd!==void 0?Yd+1:mt.collisionBoxArray.length,rp||mt.collisionBoxArray.length,rp?rp+1:mt.collisionBoxArray.length,Mi,Ob,Lb,zb,Pb,aE,0,s0,a0,Jd,0,r0?1:0,Wd)})(r,lt,Nt,Ue,i,a,l,c,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,be,H,A,0,he,Ie,N,e,d,_,T,I,M,z,B,Ne)};if(G==="line")for(const Ue of Ox(e.geometry,0,0,vt,vt)){const lt=bS(Ue,ae,Te,i.vertical||W,a,le,se,r.overscaling,vt);for(const ot of lt)W&&CS(r,W.text,Me,ot)||ke(Ue,ot,I)}else if(G==="line-center"){for(const Ue of e.geometry)if(Ue.length>1){const lt=xS(Ue,Te,i.vertical||W,a,le,se);lt&&ke(Ue,lt,I)}}else if(e.type==="Polygon")for(const Ue of Gp(e.geometry,0)){const lt=TS(Ue,16);ke(Ue[0],new Rh(lt.x,lt.y,0,0,void 0),I)}else if(e.type==="LineString")for(const Ue of e.geometry)ke(Ue,new Rh(Ue[0].x,Ue[0].y,0,0,void 0),I);else if(e.type==="Point")for(const Ue of e.geometry)for(const lt of Ue)ke([lt],new Rh(lt.x,lt.y,0,0,void 0),I)}const A_=255,Hd=A_*ja;function Xx(r,e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B,N){const H=function($,W,Q,le,se,ae,be,he){const Te=[];if(W.positionedLines.length===0)return Te;const Ie=le.layout.get("text-rotate").evaluate(ae,{})*Math.PI/180,Me=function(Ue){const lt=Ue[0],ot=Ue[1],Nt=lt*ot;return Nt>0?[lt,-ot]:Nt<0?[-lt,ot]:lt===0?[ot,lt]:[ot,-lt]}(Q);let ze=Math.abs(W.top-W.bottom);for(const Ue of W.positionedLines)ze-=Ue.lineOffset;const De=W.positionedLines.length,Ne=ze/De;let ke=W.top-Q[1];for(let Ue=0;Ue<De;++Ue){const lt=W.positionedLines[Ue];ke=wS(W,Ne,ke,Ue);for(const ot of lt.positionedGlyphs){if(!ot.rect)continue;const Nt=ot.rect||{};let mt=er+1,xt=!0,ut=1,ti=0;if(ot.image){const In=be.get(ot.image.toString());if(!In)continue;if(In.sdf){Pn("SDF images are not supported in formatted text and will be ignored.");continue}xt=!1,ut=In.pixelRatio,mt=vm/ut}const zt=(se||he)&&ot.vertical,Zt=ot.metrics.advance*ot.scale/2,pi=ot.metrics,Ci=ot.rect;if(Ci===null)continue;he&&W.verticalizable&&(ti=ot.image?Zt-ot.metrics.width*ot.scale/2:0);const yi=se?[ot.x+Zt,ot.y]:[0,0];let Bi=[0,0],Mi=[0,0],ji=!1;se||(zt?(Mi=[ot.x+Zt+Me[0],ot.y+Me[1]-ti],ji=!0):Bi=[ot.x+Zt+Q[0],ot.y+Q[1]-ti]);const ln=Ci.w*ot.scale/(ut*(ot.localGlyph?Dc:1)),Dn=Ci.h*ot.scale/(ut*(ot.localGlyph?Dc:1));let gi,Yi,Fn,$n;if(zt){const In=ot.y-ke,Yr=new Mt(-Zt,Zt-In),ra=-Math.PI/2,Sr=new Mt(...Mi);gi=new Mt(-Zt+Bi[0],Bi[1]),gi._rotateAround(ra,Yr)._add(Sr),gi.x+=-In+Zt,gi.y-=(pi.left-mt)*ot.scale;const Or=ot.image?pi.advance*ot.scale:Tr*ot.scale,Fs=String.fromCodePoint(ot.glyph);R(Fs)?gi.x+=(1-mt)*ot.scale:L(Fs)?gi.x+=Or-pi.height*ot.scale+(-mt-1)*ot.scale:gi.x+=ot.image||pi.width+2*mt===Ci.w&&pi.height+2*mt===Ci.h?(Or-Dn)/2:(Or-(pi.height+2*mt)*ot.scale)/2,Yi=new Mt(gi.x,gi.y-ln),Fn=new Mt(gi.x+Dn,gi.y),$n=new Mt(gi.x+Dn,gi.y-ln)}else{const In=(pi.left-mt)*ot.scale-Zt+Bi[0],Yr=(-pi.top-mt)*ot.scale+Bi[1],ra=In+ln,Sr=Yr+Dn;gi=new Mt(In,Yr),Yi=new Mt(ra,Yr),Fn=new Mt(In,Sr),$n=new Mt(ra,Sr)}if(Ie){let In;In=se?new Mt(0,0):ji?new Mt(Me[0],Me[1]):new Mt(Q[0],Q[1]),gi._rotateAround(Ie,In),Yi._rotateAround(Ie,In),Fn._rotateAround(Ie,In),$n._rotateAround(Ie,In)}const Jn=new Mt(0,0),tr=new Mt(0,0);Te.push({tl:gi,tr:Yi,bl:Fn,br:$n,texPrimary:Nt,texSecondary:void 0,writingMode:W.writingMode,glyphOffset:yi,sectionIndex:ot.sectionIndex,isSDF:xt,pixelOffsetTL:Jn,pixelOffsetBR:tr,minFontScaleX:0,minFontScaleY:0})}}return Te}(0,a,w,l,d,y,c,r.allowVerticalPlacement),G=r.textSizeData;let j=null;G.kind==="source"?(j=[ja*l.layout.get("text-size").evaluate(y,{},B)*M.textScaleFactor],j[0]>Hd&&Pn(`${r.layerIds[0]}: Value for "text-size" is >= ${A_}. Reduce your "text-size".`)):G.kind==="composite"&&(j=[ja*M.compositeTextSizes[0].evaluate(y,{},B)*M.textScaleFactor,ja*M.compositeTextSizes[1].evaluate(y,{},B)*M.textScaleFactor],(j[0]>Hd||j[1]>Hd)&&Pn(`${r.layerIds[0]}: Value for "text-size" is >= ${A_}. Reduce your "text-size".`)),r.addSymbols(r.text,H,j,w,d,y,_,e,i,A.lineStartIndex,A.lineLength,E,z,B,N,!1);for(const $ of T)I[$]=r.text.placedSymbolArray.length-1;return 4*H.length}function Tv(r){for(const e in r)return r[e];return null}function Xg(r,e,i,a,c,l,d,y,w,A){let _=d.top,T=d.bottom,I=d.left,E=d.right;const M=d.collisionPadding;if(M&&(I-=M[0],_-=M[1],E+=M[2],T+=M[3]),w){const z=new Mt(I,_),B=new Mt(E,_),N=new Mt(I,T),H=new Mt(E,T),G=Gi(w);let j=new Mt(0,0);A&&(j=new Mt(A[0],A[1])),z._rotateAround(G,j),B._rotateAround(G,j),N._rotateAround(G,j),H._rotateAround(G,j),I=Math.min(z.x,B.x,N.x,H.x),E=Math.max(z.x,B.x,N.x,H.x),_=Math.min(z.y,B.y,N.y,H.y),T=Math.max(z.y,B.y,N.y,H.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,I,_,E,T,y,a,c,l),r.length-1}function Sv(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function CS(r,e,i,a){const c=r.compareText;if(e in c){const l=c[e];for(let d=l.length-1;d>=0;d--)if(a.dist(l[d])<i)return!0}else c[e]=[];return c[e].push(a),!1}function Wx(r,e){const i=r.fovAboveCenter,a=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,c=(r._camera.position[2]*r.worldSize-a)/Math.cos(r._pitch),l=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let d=Math.sin(r._pitch)*l+c;const y=c*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let w=Math.max(r.zoom-17,0);r.isOrthographic&&(w/=10),d*=1+w}return Math.min(1.01*d,y)}function M_(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),a=r.x*i,c=(r.x+1)*i,l=r.y*i,d=(r.y+1)*i,y=ns(a),w=ns(c),A=yn(l),_=yn(d),T=e.project(y,A),I=e.project(w,A),E=e.project(w,_),M=e.project(y,_);let z=Math.min(T.x,I.x,E.x,M.x),B=Math.min(T.y,I.y,E.y,M.y),N=Math.max(T.x,I.x,E.x,M.x),H=Math.max(T.y,I.y,E.y,M.y);const G=i/16;function j(W,Q,le,se,ae,be){const he=(le+ae)/2,Te=(se+be)/2,Ie=e.project(ns(he),yn(Te)),Me=Math.max(0,z-Ie.x,B-Ie.y,Ie.x-N,Ie.y-H);z=Math.min(z,Ie.x),N=Math.max(N,Ie.x),B=Math.min(B,Ie.y),H=Math.max(H,Ie.y),Me>G&&(j(W,Ie,le,se,he,Te),j(Ie,Q,he,Te,ae,be))}j(T,I,a,l,c,l),j(I,E,c,l,c,d),j(E,M,c,d,a,d),j(M,T,a,d,a,l),z-=G,B-=G,N+=G,H+=G;const $=1/Math.max(N-z,H-B);return{scale:$,x:z*$,y:B*$,x2:N*$,y2:H*$,projection:e}}function Yx(r,{x:e,y:i},a=0){return new Mt(((e-a)*r.scale-r.x)*vt,(i*r.scale-r.y)*vt)}const RS=ue.mat4.identity(new Float32Array(16));class Zd{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new rn(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a,c=!0){return e._coordinatePoint(e.locationCoordinate(i,a),c)}pixelsPerMeter(e,i){return Cr(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return Wx(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,c){const l=e.horizonLineFromTop(!1),d=new Mt(i,Math.max(l,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,c))}pointCoordinate3D(e,i,a){const c=new Mt(i,a);if(e.elevation)return e.elevation.pointCoordinate(c);{const l=this.pointCoordinate(e,c.x,c.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return RS}createTileMatrix(e,i,a){let c,l,d;const y=a.canonical,w=ue.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=M_(y,this);c=1,l=A.x+a.wrap*A.scale,d=A.y,ue.mat4.scale(w,w,[c/A.scale,c/A.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(y.z),l=(y.x+Math.pow(2,y.z)*a.wrap)*c,d=y.y*c;return ue.mat4.translate(w,w,[l,d,0]),ue.mat4.scale(w,w,[c/vt,c/vt,1]),w}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class DS extends Zd{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Gi(i));this.n=(c+Math.sin(Gi(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c,r0:l}=this,d=Gi(e-this.center[0]),y=Gi(i),w=Math.sqrt(c-2*a*Math.sin(y))/a;return{x:w*Math.sin(d*a),y:w*Math.cos(d*a)-l,z:0}}unproject(e,i){const{n:a,c,r0:l}=this,d=l+i;let y=Math.atan2(e,Math.abs(d))*Math.sign(d);d*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(d));const w=Gi(this.center[0])*a;y=aa(y,-Math.PI-w,Math.PI-w);const A=Di(Er(y/a)+this.center[0],-180,180),_=Math.asin(Di((c-(e*e+d*d)*a*a)/(2*a),-1,1)),T=Di(Er(_),-85.051129,Ns);return new rn(A,T)}}const I_=1.340264,C_=-.081106,R_=893e-6,D_=.003796,Wg=Math.sqrt(3)/2;class zS extends Zd{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Wg*Math.sin(i)),c=a*a,l=c*c*c;return{x:.5*(e*Math.cos(a)/(Wg*(I_+3*C_*c+l*(7*R_+9*D_*c)))/Math.PI+.5),y:1-.5*(a*(I_+C_*c+l*(R_+D_*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=a*a,l=c*c*c;for(let _,T,I,E=0;E<12&&(T=a*(I_+C_*c+l*(R_+D_*c))-i,I=I_+3*C_*c+l*(7*R_+9*D_*c),_=T/I,a=Di(a-_,-Math.PI/3,Math.PI/3),c=a*a,l=c*c*c,!(Math.abs(_)<1e-12));++E);const d=Wg*e*(I_+3*C_*c+l*(7*R_+9*D_*c))/Math.cos(a),y=Math.asin(Math.sin(a)/Wg),w=Di(180*d/Math.PI,-180,180),A=Di(180*y/Math.PI,-85.051129,Ns);return new rn(w,A)}}class PS extends Zd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),c=Di(360*(.5-i),-85.051129,Ns);return new rn(a,c)}}const wm=Math.PI/2;function Yg(r){return Math.tan((wm+r)/2)}class OS extends Zd{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let c=Gi(i),l=Gi(a);this.southernCenter=c+l<0,this.southernCenter&&(c=-c,l=-l);const d=Math.cos(c),y=Yg(c);this.n=c===l?Math.sin(c):Math.log(d/Math.cos(l))/Math.log(Yg(l)/y),this.f=d*Math.pow(Yg(c),this.n)/this.n}project(e,i){i=Gi(i),this.southernCenter&&(i=-i),e=Gi(e-this.center[0]);const a=1e-6,{n:c,f:l}=this;l>0?i<-wm+a&&(i=-wm+a):i>wm-a&&(i=wm-a);const d=l/Math.pow(Yg(i),c);let y=d*Math.sin(c*e),w=l-d*Math.cos(c*e);return y=.5*(y/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:y,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:c}=this,l=c-i,d=Math.sign(l),y=Math.sign(a)*Math.sqrt(e*e+l*l);let w=Math.atan2(e,Math.abs(l))*d;l*a<0&&(w-=Math.PI*Math.sign(e)*d);const A=Di(Er(w/a)+this.center[0],-180,180),_=Di(Er(2*Math.atan(Math.pow(c/y,1/a))-wm),-85.051129,Ns);return new rn(A,this.southernCenter?-_:_)}}class Kx extends Zd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:is(e),y:Zr(i),z:0}}unproject(e,i){const a=ns(e),c=yn(i);return new rn(a,c)}}const Jx=Gi(Ns);class LS extends Zd{project(e,i){const a=(i=Gi(i))*i,c=a*a;return{x:.5*((e=Gi(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=25,l=0,d=a*a;do{d=a*a;const A=d*d;l=(a*(1.007226+d*(.015085+A*(.028874*d-.044475-.005916*A)))-i)/(1.007226+d*(.045255+A*(.259866*d-.311325-.005916*11*A))),a=Di(a-l,-Jx,Jx)}while(Math.abs(l)>1e-6&&--c>0);d=a*a;const y=Di(Er(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),w=Er(a);return new rn(y,w)}}const Qx=Gi(Ns);class kS extends Zd{project(e,i){i=Gi(i),e=Gi(e);const a=Math.cos(i),c=2/Math.PI,l=Math.acos(a*Math.cos(e/2)),d=Math.sin(l)/l,y=.5*(e*c+2*a*Math.sin(e/2)/d)||0,w=.5*(i+Math.sin(i)/d)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,l=25;const d=1e-6;let y=0,w=0;do{const A=Math.cos(c),_=Math.sin(c),T=2*_*A,I=_*_,E=A*A,M=Math.cos(a/2),z=Math.sin(a/2),B=2*M*z,N=z*z,H=1-E*M*M,G=H?1/H:0,j=H?Math.acos(A*M)*Math.sqrt(1/H):0,$=.5*(2*j*A*z+2*a/Math.PI)-e,W=.5*(j*_+c)-i,Q=.5*G*(E*N+j*A*M*I)+1/Math.PI,le=G*(B*T/4-j*_*z),se=.125*G*(T*z-j*_*E*B),ae=.5*G*(I*M+j*N*A)+.5,be=le*se-ae*Q;y=(W*le-$*ae)/be,w=($*se-W*Q)/be,a=Di(a-y,-Math.PI,Math.PI),c=Di(c-w,-Qx,Qx)}while((Math.abs(y)>d||Math.abs(w)>d)&&--l>0);return new rn(Er(a),Er(c))}}class e1 extends Zd{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Gi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:c}=this;return{x:Gi(e)*c*a+.5,y:-Math.sin(Gi(i))/c*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:c}=this,l=-(i-.5)/a,d=Di(Er((e-.5)/a)/c,-180,180),y=Math.asin(Di(l*c,-1,1)),w=Di(Er(y),-85.051129,Ns);return new rn(d,w)}}class BS extends Kx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const c=Wi(e,i,a),l=Rn(fn(a));return ue.vec3.transformMat4(c,c,l),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i,a){const c=Bo(i.lat,i.lng),l=ue.vec3.normalize([],c),d=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,y=Cr(1,0)*vt*d;ue.vec3.scaleAndAdd(c,c,l,y);const w=ue.mat4.identity(new Float64Array(16));return ue.mat4.multiply(w,e.pixelMatrix,e.globeMatrix),ue.vec3.transformMat4(c,c,w),new Mt(c[0],c[1])}pixelsPerMeter(e,i){return Cr(1,0)*i}pixelSpaceConversion(e,i,a){const c=Cr(1,e)*i,l=Kt(Cr(1,45)*i,c,a);return this.pixelsPerMeter(e,i)/l}createTileMatrix(e,i,a){const c=ar(fn(a.canonical));return ue.mat4.multiply(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:a}=e,c=Rn(fn(i));return ue.mat4.rotateY(c,c,Gi(a.lng)),ue.mat4.rotateX(c,c,Gi(a.lat)),ue.mat4.scale(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,a,c){return qi(e,i,a,!0)||new t(0,0)}pointCoordinate3D(e,i,a){const c=this.pointCoordinate(e,i,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!qi(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,l){const d=c.cameraToCenterDistance,y=c._centerAltitude*l,w=c._camera,A=c._camera.forward(),_=ue.vec3.add([],ue.vec3.scale([],A,-d),[0,0,y]),T=c.worldSize/(2*Math.PI),I=[0,0,-T],E=c.width/c.height,M=Math.tan(c.fovAboveCenter),z=ue.vec3.scale([],w.up(),M),B=ue.vec3.scale([],w.right(),M*E),N=ue.vec3.normalize([],ue.vec3.add([],ue.vec3.add([],A,z),B)),H=[];let G;if(new li(_,N).closestPointOnSphere(I,T,H)){const j=ue.vec3.add([],H,I),$=ue.vec3.sub([],j,_);G=Math.cos(c.fovAboveCenter)*ue.vec3.length($)}else{const j=ue.vec3.sub([],_,I),$=ue.vec3.sub([],I,_);ue.vec3.normalize($,$);const W=ue.vec3.length(j)-T;G=Math.sqrt(W*(W+2*T));const Q=Math.acos(G/(T+W))-Math.acos(ue.vec3.dot(A,$));G*=Math.cos(Q)}return 1.01*G}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=wr(e.zoom);if(a>0){const c=Wx(e,Cr(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Kt(i,c+l*(1-Math.cos(d)),Math.pow(a,10))}return i}upVector(e,i,a){return Wi(i,a,e,1)}upVectorScale(e){return{metersToTile:Ei($i(fn(e)))}}}function t1(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new Kx(r);case"equirectangular":return new PS(r);case"naturalEarth":return new LS(r);case"equalEarth":return new zS(r);case"winkelTripel":return new kS(r);case"albers":return i?new e1(r):new DS(r);case"lambertConformalConic":return i?new e1(r):new OS(r);case"globe":return new BS(r)}throw new Error(`Invalid projection name: ${r.name}`)}const NS=Sc.VectorTileFeature.types,FS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kg(r,e,i,a,c,l,d,y,w,A,_,T,I){const E=y?Math.min(Hd,Math.round(y[0])):0,M=y?Math.min(Hd,Math.round(y[1])):0;r.emplaceBack(e,i,Math.round(32*a),Math.round(32*c),l,d,(E<<1)+(w?1:0),M,16*A,16*_,256*T,256*I)}function Jg(r,e,i){r.emplaceBack(e,i)}function Qg(r,e,i,a,c,l,d){r.emplaceBack(e,i,a,c,l,d)}function ey(r,e,i,a,c){r.emplaceBack(e,i,a,c),r.emplaceBack(e,i,a,c),r.emplaceBack(e,i,a,c),r.emplaceBack(e,i,a,c)}function US(r){for(const e of r.sections)if(bf(e.text))return!0;return!1}class Ev{constructor(e){this.layoutVertexArray=new md,this.indexArray=new Fr,this.programConfigurations=e,this.segments=new dn,this.dynamicLayoutVertexArray=new vl,this.opacityVertexArray=new gd,this.placedSymbolArray=new Sf,this.iconTransitioningVertexArray=new co,this.globeExtVertexArray=new _d,this.zOffsetVertexArray=new fc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,a,c,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Vg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,FS,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,jg.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,yv.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,mm.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ot(Ev,"SymbolBuffers");class Av{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new dn,this.collisionVertexArray=new vd,this.collisionVertexArrayExt=new vl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,vv.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,_m.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ot(Av,"CollisionBuffers");class ty{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ue.mat4.identity([]),this.placementViewportMatrix=ue.mat4.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gm(this.zoom,i["text-size"]),this.iconSizeData=gm(this.zoom,i["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),l=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(d=>it[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Ev(new Lo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Ev(new Lo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new mc,this.lineVertexArray=new Oo,this.symbolInstances=new zp}calculateGlyphDependencies(e,i,a,c,l){for(const d of e){const y=d.codePointAt(0);if(y===void 0)break;if(i[y]=!0,c&&l&&y<=65535){const w=v[d];w&&(i[w.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Ua(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,i,a,c){const l=this.layers[0],d=l.layout,y=this.projection.name==="globe",w=d.get("text-font"),A=d.get("text-field"),_=d.get("icon-image"),[T,I]=d.get("icon-size-scale-range"),E=Di(i.scaleFactor||1,T,I),M=(A.value.kind!=="constant"||A.value.value instanceof Kr&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),z=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,B=d.get("symbol-sort-key");if(this.features=[],!M&&!z)return;const N=i.iconDependencies,H=i.glyphDependencies,G=i.availableImages,j=new hn(this.zoom);for(const{feature:$,id:W,index:Q,sourceLayerIndex:le}of e){const se=l._featureFilter.needGeometry,ae=k($,se);if(!l._featureFilter.filter(j,ae,a))continue;if(se||(ae.geometry=O($,a,c)),y&&$.type!==1&&a.z<=5){const Me=ae.geometry,ze=.98078528056,De=(Ne,ke)=>{const Ue=Wi(Ne.x,Ne.y,a,1),lt=Wi(ke.x,ke.y,a,1);return ue.vec3.dot(Ue,lt)<ze};for(let Ne=0;Ne<Me.length;Ne++)Me[Ne]=g(Me[Ne],De)}let be,he;if(M){const Me=l.getValueAndResolveTokens("text-field",ae,a,G),ze=Kr.factory(Me);US(ze)&&(this.hasRTLText=!0),(!this.hasRTLText||_r()==="unavailable"||this.hasRTLText&&cs.isParsed())&&(be=f(ze,l,ae))}if(z){const Me=l.getValueAndResolveTokens("icon-image",ae,a,G);he=Me instanceof os?Me:os.build(Me)}if(!be&&!he)continue;const Te=this.sortFeaturesByKey?B.evaluate(ae,{},a):void 0,Ie={id:W,text:be,icon:he,index:Q,sourceLayerIndex:le,geometry:ae.geometry,properties:$.properties,type:NS[$.type],sortKey:Te};if(this.features.push(Ie),he){const Me=this.layers[0]._unevaluatedLayout._values,{iconPrimary:ze,iconSecondary:De}=Hx(he,this.iconSizeData,Me["icon-size"],a,this.zoom,Ie,this.pixelRatio,E),Ne=ze.id.toString();if(N.has(Ne)?N.get(Ne).push(ze):N.set(Ne,[ze]),De){const ke=De.id.toString();N.has(ke)?N.get(ke).push(De):N.set(ke,[De])}}if(be){const Me=w.evaluate(ae,{},a).join(","),ze=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(it.vertical)>=0;for(const De of be.sections)if(De.image){const Ne=De.image.getPrimary().scaleSelf(this.pixelRatio),ke=Ne.id.toString(),Ue=N.get(ke)||[];Ue.push(Ne),N.set(ke,Ue)}else{const Ne=ah(be.toString()),ke=De.fontStack||Me,Ue=H[ke]=H[ke]||{};this.calculateGlyphDependencies(De.text,Ue,ze,this.allowVerticalPlacement,Ne)}}}if(d.get("symbol-placement")==="line"&&(this.features=function($){const W={},Q={},le=[];let se=0;function ae(Ie){le.push($[Ie]),se++}function be(Ie,Me,ze){const De=Q[Ie];return delete Q[Ie],Q[Me]=De,le[De].geometry[0].pop(),le[De].geometry[0]=le[De].geometry[0].concat(ze[0]),De}function he(Ie,Me,ze){const De=W[Me];return delete W[Me],W[Ie]=De,le[De].geometry[0].shift(),le[De].geometry[0]=ze[0].concat(le[De].geometry[0]),De}function Te(Ie,Me,ze){const De=ze?Me[0][Me[0].length-1]:Me[0][0];return`${Ie}:${De.x}:${De.y}`}for(let Ie=0;Ie<$.length;Ie++){const Me=$[Ie],ze=Me.geometry,De=Me.text?Me.text.toString():null;if(!De){ae(Ie);continue}const Ne=Te(De,ze),ke=Te(De,ze,!0);if(Ne in Q&&ke in W&&Q[Ne]!==W[ke]){const Ue=he(Ne,ke,ze),lt=be(Ne,ke,le[Ue].geometry);delete W[Ne],delete Q[ke],Q[Te(De,le[lt].geometry,!0)]=lt,le[Ue].geometry=null}else Ne in Q?be(Ne,ke,ze):ke in W?he(Ne,ke,ze):(ae(Ie),W[Ne]=se-1,Q[ke]=se-1)}return le.filter(Ie=>Ie.geometry)}(this.features)),d.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const $ of i.elevationFeatures)this.elevationFeatureIdToIndex.set($.id,this.elevationFeatures.length),this.elevationFeatures.push($)}}else d.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(($,W)=>$.sortKey-W.sortKey)}update(e,i,a,c,l,d,y){this.text.programConfigurations.updatePaintArrays(e,i,l,a,c,d,y),this.icon.programConfigurations.updatePaintArrays(e,i,l,a,c,d,y)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);if(a.elevationFeatureIndex===65535)continue;const c=this.elevationFeatures[a.elevationFeatureIndex];if(c){const l=.05+c.pointElevation(new Mt(a.tileAnchorX,a.tileAnchorY));a.zOffset!==l&&(e=!0,a.zOffset=l)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(l,d,y)=>{a+=d,a>l.length&&l.resize(a);for(let w=-d;w<0;w++)l.emplace(w+a,y)},i=(l,d,y)=>{c+=d,c>l.length&&l.resize(c);for(let w=-d;w<0;w++)l.emplace(w+c,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:w,numIconVertices:A}=d,_=d.zOffset,T=A>0;if((y>0||w>0)&&(e(this.text.zOffsetVertexArray,y,_),e(this.text.zOffsetVertexArray,w,_)),T){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:E}=d;I>=0&&i(this.icon.zOffsetVertexArray,A,_),E>=0&&i(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=t1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:l}of i)this.lineVertexArray.emplaceBack(c,l);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,c,l,d,y,w,A,_,T,I,E,M,z,B){const N=e.indexArray,H=e.layoutVertexArray,G=e.globeExtVertexArray,j=e.segments.prepareSegment(4*i.length,H,N,this.canOverlap?d.sortKey:void 0),$=this.glyphOffsetArray.length,W=j.vertexLength,Q=this.allowVerticalPlacement&&y===it.vertical?Math.PI/2:0,le=d.text&&d.text.sections;for(let ae=0;ae<i.length;ae++){const{tl:be,tr:he,bl:Te,br:Ie,texPrimary:Me,texSecondary:ze,pixelOffsetTL:De,pixelOffsetBR:Ne,minFontScaleX:ke,minFontScaleY:Ue,glyphOffset:lt,isSDF:ot,sectionIndex:Nt}=i[ae],mt=j.vertexLength,xt=lt[1];if(Kg(H,A.x,A.y,be.x,xt+be.y,Me.x,Me.y,a,ot,De.x,De.y,ke,Ue),Kg(H,A.x,A.y,he.x,xt+he.y,Me.x+Me.w,Me.y,a,ot,Ne.x,De.y,ke,Ue),Kg(H,A.x,A.y,Te.x,xt+Te.y,Me.x,Me.y+Me.h,a,ot,De.x,Ne.y,ke,Ue),Kg(H,A.x,A.y,Ie.x,xt+Ie.y,Me.x+Me.w,Me.y+Me.h,a,ot,Ne.x,Ne.y,ke,Ue),w){const{x:ut,y:ti,z:zt}=w.anchor,[Zt,pi,Ci]=w.up;Qg(G,ut,ti,zt,Zt,pi,Ci),Qg(G,ut,ti,zt,Zt,pi,Ci),Qg(G,ut,ti,zt,Zt,pi,Ci),Qg(G,ut,ti,zt,Zt,pi,Ci),ey(e.dynamicLayoutVertexArray,ut,ti,zt,Q)}else ey(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Q);if(B){const ut=ze||Me;Jg(e.iconTransitioningVertexArray,ut.x,ut.y),Jg(e.iconTransitioningVertexArray,ut.x+ut.w,ut.y),Jg(e.iconTransitioningVertexArray,ut.x,ut.y+ut.h),Jg(e.iconTransitioningVertexArray,ut.x+ut.w,ut.y+ut.h)}N.emplaceBack(mt,mt+1,mt+2),N.emplaceBack(mt+1,mt+2,mt+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(lt[0]),ae!==i.length-1&&Nt===i[ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(H.length,d,d.index,{},E,M,z,le&&le[Nt])}const se=w?w.anchor:A;e.placedSymbolArray.emplaceBack(se.x,se.y,se.z,A.x,A.y,$,this.glyphOffsetArray.length-$,W,_,T,A.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],y,0,!1,0,I,0)}_commitLayoutVertex(e,i,a,c,l,d,y){e.emplaceBack(i,a,c,l,d,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,a,c,l,d,y){const w=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),A=w.vertexLength,_=y.tileAnchorX,T=y.tileAnchorY;for(let E=0;E<4;E++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,y.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,l,d,_,T,new Mt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,l,d,_,T,new Mt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,l,d,_,T,new Mt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,l,d,_,T,new Mt(e.x1,e.y2)),w.vertexLength+=4;const I=a.indexArray;I.emplaceBack(A,A+1),I.emplaceBack(A+1,A+2),I.emplaceBack(A+2,A+3),I.emplaceBack(A+3,A),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,c,l,d){for(let y=c;y<l;y++){const w=a.get(y),A=this.getSymbolInstanceTextSize(e,d,i,y);this._addCollisionDebugVertices(w,A,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,a,c,l,d){for(let y=c;y<l;y++){const w=a.get(y),A=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(w,A,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Av(au,Kf.members,co),this.iconCollisionBox=new Av(au,Kf.members,co);const c=Cc(this.iconSizeData,e),l=Cc(this.textSizeData,e,a);for(let d=0;d<this.symbolInstances.length;d++){const y=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(l,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(l,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,i,a,c){const l=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),d=ym(this.textSizeData,e,l)/Tr;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,a){const c=this.icon.placedSymbolArray.get(a),l=ym(this.iconSizeData,e,c);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,i,a,c){e.emplaceBack(i,-a,-a,c),e.emplaceBack(i,a,-a,c),e.emplaceBack(i,a,a,c),e.emplaceBack(i,-a,a,c)}_updateTextDebugCollisionBoxes(e,i,a,c,l,d,y){for(let w=c;w<l;w++){const A=a.get(w),_=this.getSymbolInstanceTextSize(e,d,i,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,A.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,c,l,d,y){for(let w=c;w<l;w++){const A=a.get(w),_=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,A.padding,d.zOffset)}}updateCollisionDebugBuffers(e,i,a,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Cc(this.iconSizeData,e,c),d=Cc(this.textSizeData,e,a);for(let y=0;y<this.symbolInstances.length;y++){const w=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(d,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w,a),this._updateTextDebugCollisionBoxes(d,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,a),this._updateIconDebugCollisionBoxes(l,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w,c),this._updateIconDebugCollisionBoxes(l,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,c,l,d,y,w,A){const _={};if(i<a){const{x1:T,y1:I,x2:E,y2:M,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:G,tileAnchorY:j,featureIndex:$}=e.get(i);_.textBox={x1:T,y1:I,x2:E,y2:M,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:G,tileAnchorY:j},_.textFeatureIndex=$}if(c<l){const{x1:T,y1:I,x2:E,y2:M,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:G,tileAnchorY:j,featureIndex:$}=e.get(c);_.verticalTextBox={x1:T,y1:I,x2:E,y2:M,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:G,tileAnchorY:j},_.verticalTextFeatureIndex=$}if(d<y){const{x1:T,y1:I,x2:E,y2:M,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:G,tileAnchorY:j,featureIndex:$}=e.get(d);_.iconBox={x1:T,y1:I,x2:E,y2:M,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:G,tileAnchorY:j},_.iconFeatureIndex=$}if(w<A){const{x1:T,y1:I,x2:E,y2:M,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:G,tileAnchorY:j,featureIndex:$}=e.get(w);_.verticalIconBox={x1:T,y1:I,x2:E,y2:M,padding:z,projectedAnchorX:B,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:G,tileAnchorY:j},_.verticalIconFeatureIndex=$}return _}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),c=a.vertexStartIndex+4*a.numGlyphs;for(let l=a.vertexStartIndex;l<c;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),c=[],l=[],d=[];for(let y=0;y<this.symbolInstances.length;++y){d.push(y);const w=this.symbolInstances.get(y);c.push(0|Math.round(i*w.tileAnchorX+a*w.tileAnchorY)),l.push(w.featureIndex)}return d.sort((y,w)=>c[y]-c[w]||l[w]-l[y]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:A}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),l>=0&&l!==c&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&d!==c&&this.addIndicesForPlacedSymbol(this.text,d),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let i1,n1,Mv;Ot(ty,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ty.addDynamicAttributes=ey;class r1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Zo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ot(r1,"FormatSectionOverride",{omit:["defaultValue"]});const Iv=()=>Mv||(Mv={layout:i1||(i1=new Bn({"symbol-placement":new yt(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new yt(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yt(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Lt(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yt(Fe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new yt(Fe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new yt(Fe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new yt(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new yt(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new yt(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yt(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Lt(Fe.layout_symbol["icon-size"]),"icon-size-scale-range":new yt(Fe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Lt(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Lt(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Lt(Fe.layout_symbol["icon-image"]),"icon-rotate":new Lt(Fe.layout_symbol["icon-rotate"]),"icon-padding":new yt(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new yt(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new Lt(Fe.layout_symbol["icon-offset"]),"icon-anchor":new Lt(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yt(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yt(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yt(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new Lt(Fe.layout_symbol["text-field"]),"text-font":new Lt(Fe.layout_symbol["text-font"]),"text-size":new Lt(Fe.layout_symbol["text-size"]),"text-size-scale-range":new yt(Fe.layout_symbol["text-size-scale-range"]),"text-max-width":new Lt(Fe.layout_symbol["text-max-width"]),"text-line-height":new Lt(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new Lt(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new Lt(Fe.layout_symbol["text-justify"]),"text-radial-offset":new Lt(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yt(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new Lt(Fe.layout_symbol["text-anchor"]),"text-max-angle":new yt(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new yt(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new Lt(Fe.layout_symbol["text-rotate"]),"text-padding":new yt(Fe.layout_symbol["text-padding"]),"text-keep-upright":new yt(Fe.layout_symbol["text-keep-upright"]),"text-transform":new Lt(Fe.layout_symbol["text-transform"]),"text-offset":new Lt(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new yt(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new yt(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new yt(Fe.layout_symbol["text-optional"]),visibility:new yt(Fe.layout_symbol.visibility)})),paint:n1||(n1=new Bn({"icon-opacity":new Lt(Fe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Lt(Fe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Lt(Fe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Lt(Fe.paint_symbol["text-emissive-strength"]),"icon-color":new Lt(Fe.paint_symbol["icon-color"]),"icon-halo-color":new Lt(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Lt(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Lt(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new yt(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new yt(Fe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Lt(Fe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Lt(Fe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Lt(Fe.paint_symbol["text-occlusion-opacity"]),"text-color":new Lt(Fe.paint_symbol["text-color"],{runtimeType:Lr,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Lt(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new Lt(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new Lt(Fe.paint_symbol["text-halo-blur"]),"text-translate":new yt(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new yt(Fe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new yt(Fe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new yt(Fe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new yt(Fe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new yt(Fe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Lt(Fe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},Mv);class iy extends Ir{constructor(e,i,a,c){super(e,Iv(),i,a,c),this._colorAdjustmentMatrix=ue.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const l of a)c.indexOf(l)<0&&c.push(l);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,c){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(l,d,y,w){l=Ye(l),d=Fl(d);const A=ue.mat4.create(),_=l/3,T=1-2*_,I=[T,_,_,0,_,T,_,0,_,_,T,0,0,0,0,1],E=.5-.5*d,M=w-y;return ue.mat4.multiply(A,[M,0,0,0,0,M,0,0,0,0,M,0,y,y,y,1],[d,0,0,0,0,d,0,0,0,0,d,0,E,E,E,1]),ue.mat4.multiply(A,A,I),A}(e,i,a,c),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,c){const l=this.layout.get(e).evaluate(i,{},a,c),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||id(d.value)||!l?l:function(y,w){return w.replace(/{([^{}]+)}/g,(A,_)=>_ in y?String(y[_]):"")}(i.properties,l)}createBucket(e){return new ty(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Iv().paint.overridableProperties){if(!iy.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new r1(i),c=new td(a,i.property.specification,this.scope,this.options);let l=null;l=i.value.kind==="constant"||i.value.kind==="source"?new Co("source",c):new ol("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new pl(i.property,l,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&iy.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),c=Iv().paint.properties[i];let l=!1;const d=y=>{for(const w of y)if(c.overrides&&c.overrides.hasOverride(w))return void(l=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Kr)d(a.value.value.sections);else if(a.value.kind==="source"){const y=A=>{l||(A instanceof vo&&mr(A.value)===qc?d(A.value.sections):A instanceof Hc?d(A.sections):A.eachChild(y))},w=a.value;w._styleExpression&&y(w._styleExpression.expression)}return l}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,a){return{config:new Sl(this,{zoom:i,lut:a}),overrideFog:!1}}}let s1,a1,o1,l1;var Cv=nn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Rv(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Dv(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class zv{constructor(e,i,a,c){this.context=e,this.format=a,this.useMipmap=c&&c.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:c&&c.premultiply})}update(e,i){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,c=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:l}=this,{gl:d}=l,{x:y,y:w}=i&&i.position?i.position:{x:0,y:0},A=y+a,_=w+c;!this.size||this.size[0]===A&&this.size[1]===_||(d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(this.texture),this.texture=d.createTexture(),this.size=null),d.bindTexture(d.TEXTURE_2D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA8&&(!i||i.premultiply!==!1));const T=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&_>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(A,_)))+1:1;d.texStorage2D(d.TEXTURE_2D,I,this.format,A,_),this.size=[A,_]}if(this.size)if(T)d.texSubImage2D(d.TEXTURE_2D,0,y,w,Rv(this.format),Dv(this.format),e);else{const I=e.data;I&&d.texSubImage2D(d.TEXTURE_2D,0,y,w,a,c,Rv(this.format),Dv(this.format),I)}this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,i,a=!1){const{context:c}=this,{gl:l}=c;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,c){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,c),this.wrapT=c)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ny{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}}function ry(r,e,i,a,c,l,d,y){const w=[r,e,1,i,a,1,c,l,1],A=[d,y,1],_=ue.mat3.adjoint([],w),[T,I,E]=ue.vec3.transformMat3(A,A,_);return ue.mat3.multiply(w,w,[T,0,0,0,I,0,0,0,E])}function c1(r,e,i,a,c,l,d,y){const w=function(A,_,T,I,E,M,z,B){const N=ry(0,0,1,0,1,1,0,1),H=ry(A,_,T,I,E,M,z,B),G=ue.mat3.adjoint([],N);return ue.mat3.multiply(H,H,G)}(r,e,i,a,c,l,d,y);return[w[2]/w[8]/vt,w[5]/w[8]/vt]}function sy(r){return[r[0],Math.min(Math.max(r[1],-85.051129),Ns)]}class u1 extends la{constructor(e,i,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Ms("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Nh(this.map._requestManager.transformRequest(this.url,nr.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Ra(a)):c&&(this.image=c instanceof HTMLImageElement?We.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ny(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ms("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ny||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const l of e)l[1]>a&&(a=l[1]),l[1]<i&&(i=l[1]);const c=(a+i)/2;if(c>Ns?this.onNorthPole=!0:c<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(t.fromLngLat);this.tileID=function(d){let y=1/0,w=1/0,A=-1/0,_=-1/0;for(const z of d)y=Math.min(y,z.x),w=Math.min(w,z.y),A=Math.max(A,z.x),_=Math.max(_,z.y);const T=Math.max(A-y,_-w),I=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),E=Math.pow(2,I);let M=Math.floor((y+A)/2*E);return M>1&&(M-=1),new st(I,M,Math.floor((w+_)/2*E))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ms("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const N in this.tiles){const H=this.tiles[N];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=M_(new st(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){const H=N[1].x-N[0].x,G=N[1].y-N[0].y,j=N[2].x-N[1].x,$=N[2].y-N[1].y,W=N[3].x-N[2].x,Q=N[3].y-N[2].y,le=N[0].x-N[3].x,se=N[0].y-N[3].y,ae=H*$-j*G,be=j*Q-W*$,he=W*se-le*Q,Te=le*G-H*se;return ae>0&&be>0&&he>0&&Te>0||ae<0&&be<0&&he<0&&Te<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=M_(this.tileID,this.map.transform.projection),[l,d,y,w]=this.coordinates.map(N=>{const H=c.projection.project(N[0],N[1]);return Yx(c,H)._round()});this.perspectiveTransform=c1(l.x,l.y,d.x,d.y,y.x,y.y,w.x,w.y);const A=this._boundsArray=new lo;A.emplaceBack(l.x,l.y,0,0),A.emplaceBack(d.x,d.y,vt,0),A.emplaceBack(w.x,w.y,0,vt),A.emplaceBack(y.x,y.y,vt,vt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,Cv.members),this.boundsSegments=dn.simpleSegment(0,0,4,2);const _=[],T=[sy((I=this.coordinates)[0]),sy(I[1]),sy(I[2]),sy(I[3])];var I;const[E,M,z,B]=function(N){let H=N[0][0],G=H,j=N[0][1],$=j;for(let W=1;W<N.length;W++)N[W][0]<H?H=N[W][0]:N[W][0]>G&&(G=N[W][0]),N[W][1]<j?j=N[W][1]:N[W][1]>$&&($=N[W][1]);return[H,j,G-H,$-j]}(T);{const N=new lo,[H,G,j,$]=function(De){let Ne=De[0].x,ke=Ne,Ue=De[0].y,lt=Ue;for(let ot=1;ot<De.length;ot++)De[ot].x<Ne?Ne=De[ot].x:De[ot].x>ke&&(ke=De[ot].x),De[ot].y<Ue?Ue=De[ot].y:De[ot].y>lt&&(lt=De[ot].y);return[Ne,Ue,ke-Ne,lt-Ue]}(a),W=De=>[(De.x-H)/j,(De.y-G)/$],[Q,le,se,ae]=a.map(W),be=function(De,Ne,ke,Ue,lt,ot,Nt,mt){const xt=ry(0,0,1,0,1,1,0,1),ut=ry(De,Ne,ke,Ue,lt,ot,Nt,mt),ti=ue.mat3.adjoint([],ut);return ue.mat3.multiply(xt,xt,ti)}(Q[0],Q[1],le[0],le[1],se[0],se[1],ae[0],ae[1]);this.elevatedGlobePerspectiveTransform=c1(Q[0],Q[1],le[0],le[1],se[0],se[1],ae[0],ae[1]);const he=(De,Ne)=>{_.push(De.lng);const ke=Math.round((De.lng-E)/z*vt),Ue=Math.round((De.lat-M)/B*vt),lt=W(Ne),ot=ue.vec3.transformMat3([],[lt[0],lt[1],1],be),Nt=Math.round(ot[0]/ot[2]*vt),mt=Math.round(ot[1]/ot[2]*vt);N.emplaceBack(ke,Ue,Nt,mt)},Te=a[3].x-a[0].x,Ie=a[3].y-a[0].y,Me=a[2].x-a[1].x,ze=a[2].y-a[1].y;for(let De=0;De<65;De++){const Ne=De/64,ke=[a[0].x+Ne*Te,a[0].y+Ne*Ie],Ue=[a[1].x+Ne*Me,a[1].y+Ne*ze],lt=Ue[0]-ke[0],ot=Ue[1]-ke[1];for(let Nt=0;Nt<65;Nt++){const mt=Nt/64,xt={x:ke[0]+lt*mt,y:ke[1]+ot*mt};he(i.projection.unproject(xt.x,xt.y),xt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(N,Cv.members)}{this.maxLongitudeTriangleSize=0;let N=[],H=new Fr;const G=(j,$,W)=>{H.emplaceBack(j,$,W);const Q=_[j],le=_[$],se=_[W],ae=Math.min(Math.min(Q,le),se),be=Math.max(Math.max(Q,le),se)-ae;be>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=be),N.push(ae+be/2)};for(let j=0;j<64;j++)for(let $=0;$<64;$++){const W=65*j+$,Q=W+1,le=W+65,se=le+1;G(W,le,Q),G(Q,le,se)}[N,H]=function(j,$){const W=Array.from({length:j.length},(se,ae)=>ae);W.sort((se,ae)=>j[se]-j[ae]);const Q=[],le=new Fr;for(let se=0;se<W.length;se++){const ae=W[se];Q.push(j[ae]);const be=3*ae,he=be+1;le.emplaceBack($.uint16[be],$.uint16[he],$.uint16[he+1])}return[Q,le]}(N,H),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(H)}this.elevatedGlobeSegments=dn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,z/vt,0,B/vt,0,0,M,E,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof ny||(this.texture?this.texture.update(this.image):(this.texture=new zv(i,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let c=(l=e+180)+360*Math.round((a[0]-l)/360);var l;const d=new dn,y=(T,I)=>{d.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:i.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=w){const T=jc(a,0,a.length,c+w);return T===a.length||y(T,Pu(a,T+1,a.length,c+360-w)-T),d}c<a[0]&&(c+=360);const A=Pu(a,0,a.length,c-w);if(A===a.length)return y(0,a.length),d;y(0,A-0);const _=jc(a,A+1,a.length,c+w);return _!==a.length&&y(_,a.length-_),d}}const VS=(Math.pow(256,2)-1)/16907520;class h1 extends Ir{constructor(e,i,a,c){super(e,{layout:o1||(o1=new Bn({visibility:new yt(Fe.layout_raster.visibility)})),paint:l1||(l1=new Bn({"raster-opacity":new yt(Fe.paint_raster["raster-opacity"]),"raster-color":new ml(Fe.paint_raster["raster-color"]),"raster-color-mix":new yt(Fe.paint_raster["raster-color-mix"]),"raster-color-range":new yt(Fe.paint_raster["raster-color-range"]),"raster-hue-rotate":new yt(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yt(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yt(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new yt(Fe.paint_raster["raster-saturation"]),"raster-contrast":new yt(Fe.paint_raster["raster-contrast"]),"raster-resampling":new yt(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new yt(Fe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new yt(Fe.paint_raster["raster-emissive-strength"]),"raster-array-band":new yt(Fe.paint_raster["raster-array-band"]),"raster-elevation":new yt(Fe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof u1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[a,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(c)||a===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=Lf({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,c])}}let d1,f1,p1,m1,_1;class g1 extends Ir{constructor(e,i,a,c){super(e,{layout:d1||(d1=new Bn({visibility:new yt(Fe["layout_raster-particle"].visibility)})),paint:f1||(f1=new Bn({"raster-particle-array-band":new yt(Fe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new yt(Fe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ml(Fe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new yt(Fe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new yt(Fe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new yt(Fe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new yt(Fe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new yt(Fe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,c),this._updateColorRamp(),this.lastInvalidatedAt=We.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Lf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=We.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class jS extends Ir{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Pv(r,e,i){const a=[0,0,1],c=ue.quat.identity([]);return ue.quat.rotateY(c,c,i?-Gi(r)+Math.PI:Gi(r)),ue.quat.rotateX(c,c,-Gi(e)),ue.vec3.transformQuat(a,a,c),ue.vec3.normalize(a,a)}function y1(r,e){const i=ay(r.projection,r.zoom,r.width,r.height),a=function(l,d,y,w,A){const _=new rn(y.lng-180*$d,y.lat),T=new rn(y.lng+180*$d,y.lat),I=l.project(_.lng,_.lat),E=l.project(T.lng,T.lat),M=-Math.atan2(E.y-I.y,E.x-I.x),z=t.fromLngLat(y);z.y=Di(z.y,-1+$d,1-$d);const B=z.toLngLat(),N=l.project(B.lng,B.lat),H=t.fromLngLat(B);H.x+=$d;const G=H.toLngLat(),j=l.project(G.lng,G.lat),$=x1(j.x-N.x,j.y-N.y,M),W=t.fromLngLat(B);W.y+=$d;const Q=W.toLngLat(),le=l.project(Q.lng,Q.lat),se=x1(le.x-N.x,le.y-N.y,M),ae=Math.abs($.x)/Math.abs(se.y),be=ue.mat4.identity([]);ue.mat4.rotateZ(be,be,-M*(1-(A?0:w)));const he=ue.mat4.identity([]);return ue.mat4.scale(he,he,[1,1-(1-ae)*w,1]),he[4]=-se.x/se.y*w,ue.mat4.rotateZ(he,he,M),ue.mat4.multiply(he,be,he),he}(r.projection,0,r.center,i,e),c=v1(r);return ue.mat4.scale(a,a,[c,c,1]),a}function v1(r){const e=r.projection,i=ay(r.projection,r.zoom,r.width,r.height),a=Ov(e,r.center),c=Ov(e,rn.convert(e.center));return Math.pow(2,a*i+(1-i)*c)}function ay(r,e,i,a,c=1/0){const l=r.range;if(!l)return 0;const d=Math.min(c,Math.max(i,a)),y=Math.log(d/1024)/Math.LN2;return As(l[0]+y,l[1]+y,e)}const $d=1/4e4;function Ov(r,e){const i=Di(e.lat,-85.051129,Ns),a=new rn(e.lng-180*$d,i),c=new rn(e.lng+180*$d,i),l=r.project(a.lng,i),d=r.project(c.lng,i),y=t.fromLngLat(a),w=t.fromLngLat(c),A=d.x-l.x,_=d.y-l.y,T=w.x-y.x,I=w.y-y.y,E=Math.sqrt((T*T+I*I)/(A*A+_*_));return Math.log(E)/Math.LN2}function x1(r,e,i){const a=Math.cos(i),c=Math.sin(i);return{x:r*a-e*c,y:r*c+e*a}}function b1(r,e,i){ue.mat4.identity(r),ue.mat4.rotateZ(r,r,Gi(e[2])),ue.mat4.rotateX(r,r,Gi(e[0])),ue.mat4.rotateY(r,r,Gi(e[1])),ue.mat4.scale(r,r,i),ue.mat4.multiply(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function oy(r,e,i,a,c,l,d,y){const w=[i[0]-e[0],i[1]-e[1],0],A=[a[0]-e[0],a[1]-e[1],0];if(ue.vec3.length(w)<1e-12||ue.vec3.length(A)<1e-12)return ue.quat.identity(r);const _=ue.vec3.cross([],w,A);ue.vec3.normalize(_,_),ue.vec3.subtract(A,a,e),w[2]=(l-c)*y,A[2]=(d-c)*y;const T=w;return ue.vec3.cross(T,w,A),ue.vec3.normalize(T,T),ue.quat.rotationTo(r,_,T)}function Lv(r,e,i=!1){const a=wr(e.zoom),c=function(l,d,y){const w=d.worldSize,A=[l[12],l[13],l[14]],_=yn(A[1]/w),T=ns(A[0]/w),I=ue.mat4.identity([]),E=Cr(1,_)*w,M=Cr(1,0)*w*ba(_,d.zoom),z=1/na(w);let B=M*z;if(y){const j=ay(d.projection,d.zoom,d.width,d.height,1024);B=z*d.projection.pixelSpaceConversion(d.center.lat,w,j)}const N=Bo(_,T);ue.vec3.add(N,N,ue.vec3.scale([],ue.vec3.normalize([],N),E*B*A[2]));const H=function(j){const $=[j[0],j[1],j[2]];let W=[0,1,0];const Q=ue.vec3.cross([],W,$);return ue.vec3.cross(W,$,Q),ue.vec3.squaredLength(W)===0&&(W=[0,1,0],ue.vec3.cross(Q,$,W)),ue.vec3.normalize(Q,Q),ue.vec3.normalize(W,W),ue.vec3.normalize($,$),[Q[0],Q[1],Q[2],0,W[0],W[1],W[2],0,$[0],$[1],$[2],0,j[0],j[1],j[2],1]}(N);ue.mat4.scale(I,I,[B,B,B*E]),ue.mat4.translate(I,I,[-A[0],-A[1],-A[2]]);const G=ue.mat4.multiply([],d.globeMatrix,H);return ue.mat4.multiply(G,G,I),ue.mat4.multiply(G,G,l),G}(r,e,i);if(a>0){const l=function(d,y){const w=y.worldSize,A=Cr(1,0)*w*ba(y.center.lat,y.zoom)/na(w),_=Cr(1,y.center.lat)*w,T=ue.mat4.identity([]);return ue.mat4.rotateY(T,T,Gi(y.center.lng)),ue.mat4.rotateX(T,T,Gi(y.center.lat)),ue.mat4.translate(T,T,[0,0,us]),ue.mat4.scale(T,T,[A,A,A*_]),ue.mat4.translate(T,T,[y.point.x-.5*w,y.point.y-.5*w,0]),ue.mat4.multiply(T,T,d),ue.mat4.multiply(T,y.globeMatrix,T)}(r,e);return function(d,y,w){const A=(M,z,B)=>{const N=ue.vec3.length(M),H=ue.vec3.length(z),G=Wn(M,z,B);return ue.vec3.scale(G,G,1/ue.vec3.length(G)*Kt(N,H,B))},_=A([d[0],d[1],d[2]],[y[0],y[1],y[2]],w),T=A([d[4],d[5],d[6]],[y[4],y[5],y[6]],w),I=A([d[8],d[9],d[10]],[y[8],y[9],y[10]],w),E=Wn([d[12],d[13],d[14]],[y[12],y[13],y[14]],w);return[_[0],_[1],_[2],0,T[0],T[1],T[2],0,I[0],I[1],I[2],0,E[0],E[1],E[2],1]}(c,l,a)}return c}function w1(r,e,i,a){const c=At.projectAabbCorners(a,i);let l=Number.MAX_VALUE,d=-1;for(let A=0;A<c.length;++A){const _=c[A];_[0]=(.5*_[0]+.5)*e.width,_[1]=(.5-.5*_[1])*e.height,_[2]<l&&(d=A,l=_[2])}const y=A=>new Mt(c[A][0],c[A][1]);let w;switch(d){case 0:case 6:w=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:w=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:w=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:w=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(Y(r,w))return l}const qS=nn([{name:"a_pos_3f",components:3,type:"Float32"}]),GS=nn([{name:"a_color_3f",components:3,type:"Float32"}]),HS=nn([{name:"a_color_4f",components:4,type:"Float32"}]),ZS=nn([{name:"a_uv_2f",components:2,type:"Float32"}]),$S=nn([{name:"a_normal_3f",components:3,type:"Float32"}]),XS=nn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),WS=nn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),T1={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class ly{constructor(e,i,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function S1(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class E1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class A1{constructor(){this.instancedDataArray=new vh,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class kv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,a,c){this.tileToMeter=h(a);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:y,index:w,sourceLayerIndex:A}of e){const _=y??(d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0),T=k(d,l);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),T,a))continue;const I={id:_,sourceLayerIndex:A,index:w,geometry:l?T.geometry:O(d,a,c),properties:d.properties,type:d.type,patterns:{}},E=this.addFeature(I,I.geometry,T);E&&i.featureIndex.insert(d,I.geometry,w,A,this.index,this.instancesPerModel[E].instancedDataArray.length,vt/32)}this.lookup=null}update(e,i,a,c){for(const l in this.instancesPerModel){const d=this.instancesPerModel[l];for(const y in e)d.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(d.features[d.idToFeaturesIndex[y]],e[y],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const c of a.features){const l=this.layers[0],d=c.feature,y=this.canonical,w=l.paint.get("model-rotation").evaluate(d,{},y),A=l.paint.get("model-scale").evaluate(d,{},y),_=l.paint.get("model-translation").evaluate(d,{},y);ue.vec3.exactEquals(c.rotation,w)&&ue.vec3.exactEquals(c.scale,A)&&ue.vec3.exactEquals(c.translation,_)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a,c){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Ua(this.activeReplacements,l))return!1;this.activeReplacements=l;let d=!1;for(const y in this.instancesPerModel){const w=this.instancesPerModel[y],A=w.instancedDataArray;for(const _ of w.features){const T=_.instancedDataOffset,I=_.instancedDataCount;for(let E=0;E<I;E++){const M=16*(E+T);let z=A.float32[M+0];const B=z>vt;z=B?z-vt:z;const N=Math.floor(z),H=A.float32[M+1];let G=!1;for(const j of this.activeReplacements)if(!Cg(j,a,T1.Model,c)&&!(j.min.x>N||N>j.max.x||j.min.y>H||H>j.max.y)&&(G=f_(Va(N,H,e.canonical,j.footprintTileId.canonical),j.footprint),G))break;A.float32[M]=G?z+vt:z,d=d||G!==B}}}return d}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,XS.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,a){const c=this.layers[0],l=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!l)return Pn(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),l;S1(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new A1);const d=this.instancesPerModel[l],y=d.instancedDataArray,w=new E1(a,y.length);for(const A of i)for(const _ of A){if(_.x<0||_.x>=vt||_.y<0||_.y>=vt)continue;const T=(this.lookupDim-1)/vt,I=this.lookupDim*(_.y*T|0)+_.x*T|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const E=y.length;y.resize(E+1),d.instancesEvaluatedElevation.push(0),y.float32[16*E]=_.x,y.float32[16*E+1]=_.y}return w.instancedDataCount=d.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(w),this.evaluate(w,{},d,!1)),l}getModelUris(){return this.modelUris}evaluate(e,i,a,c){const l=this.layers[0],d=e.feature,y=this.canonical,w=e.rotation=l.paint.get("model-rotation").evaluate(d,i,y),A=e.scale=l.paint.get("model-scale").evaluate(d,i,y),_=e.translation=l.paint.get("model-translation").evaluate(d,i,y),T=l.paint.get("model-color").evaluate(d,i,y);T.a=l.paint.get("model-color-mix-intensity").evaluate(d,i,y);const I=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),b1(I,w,A);const E=Math.round(100*T.a)+T.b/1.05;for(let M=0;M<e.instancedDataCount;++M){const z=e.instancedDataOffset+M,B=16*z,N=a.instancedDataArray.float32;let H=0;c&&(H=N[B+6]-a.instancesEvaluatedElevation[z]);const G=0|N[B+1];N[B]=(0|N[B])+T.r/1.05,N[B+1]=G+T.g/1.05,N[B+2]=E,N[B+3]=1/(y.z>10?this.tileToMeter:h(y,G)),N[B+4]=_[0],N[B+5]=_[1],N[B+6]=_[2]+H,N[B+7]=I[0],N[B+8]=I[1],N[B+9]=I[2],N[B+10]=I[4],N[B+11]=I[5],N[B+12]=I[6],N[B+13]=I[8],N[B+14]=I[9],N[B+15]=I[10],a.instancesEvaluatedElevation[z]=_[2]}}}let M1,I1;Ot(kv,"ModelBucket",{omit:["layers"]}),Ot(A1,"PerModelAttributes"),Ot(E1,"ModelFeature");const ep=64,Tm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function C1(r,e,i,a,c,l,d,y,w,A=!1){const _=i.zoom,T=i.project(a),I=ba(a.lat,_),E=1/I;ue.mat4.identity(r),ue.mat4.translate(r,r,[T.x+d[0]*E,T.y+d[1]*E,d[2]]);let M=1,z=1;const B=i.worldSize;if(A){if(i.projection.name==="mercator"){let j=0;i.elevation&&(j=i.elevation.getAtPointOrZero(new t(T.x/B,T.y/B),0));const $=ue.vec4.transformMat4([],[T.x,T.y,j,1],i.projMatrix)[3]/i.cameraToCenterDistance;M=$,z=$*ba(i.center.lat,_)}else if(i.projection.name==="globe"){const j=Lv(r,i),$=ue.mat4.multiply([],i.projMatrix,j),W=[0,0,0,1];ue.vec4.transformMat4(W,W,$);const Q=W[3]/i.cameraToCenterDistance,le=wr(_),se=i.projection.pixelsPerMeter(a.lat,B)*ba(a.lat,_),ae=i.projection.pixelsPerMeter(i.center.lat,B)*ba(i.center.lat,_);M=Q/Kt(se,Pf(i.center.lat),le),z=Q*I/se,M*=ae,z*=ae}}else M=E;ue.mat4.scale(r,r,[M,M,z]);const N=[...r],H=e.orientation,G=[];if(b1(G,[H[0]+c[0],H[1]+c[1],H[2]+c[2]],l),ue.mat4.multiply(r,N,G),y&&i.elevation){let j=0;const $=[];if(w&&i.elevation){j=function(le,se,ae,be,he){const Te=se.elevation;if(!Te)return 0;const Ie=At.projectAabbCorners(ae,be),Me=Cr(1,he.lat)*se.worldSize,ze=function(ti,zt){const Zt=[0,0,1],pi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ci of pi){const yi=ti[Ci.corners[0]],Bi=ti[Ci.corners[1]],Mi=ti[Ci.corners[2]],ji=[Bi[0]-yi[0],Bi[1]-yi[1],zt*(Bi[2]-yi[2])],ln=ue.vec3.cross(ji,ji,[Mi[0]-yi[0],Mi[1]-yi[1],zt*(Mi[2]-yi[2])]);ue.vec3.normalize(ln,ln),Ci.dotProductWithUp=ue.vec3.dot(ln,Zt)}return pi.sort((Ci,yi)=>Ci.dotProductWithUp-yi.dotProductWithUp),pi[0].corners}(Ie,Me),De=Ie[ze[0]],Ne=Ie[ze[1]],ke=Ie[ze[2]],Ue=Ie[ze[3]],lt=Te.getAtPointOrZero(new t(De[0]/se.worldSize,De[1]/se.worldSize),0),ot=Te.getAtPointOrZero(new t(Ne[0]/se.worldSize,Ne[1]/se.worldSize),0),Nt=Te.getAtPointOrZero(new t(ke[0]/se.worldSize,ke[1]/se.worldSize),0),mt=Te.getAtPointOrZero(new t(Ue[0]/se.worldSize,Ue[1]/se.worldSize),0),xt=(lt+mt)/2,ut=(ot+Nt)/2;return xt>ut?ot<Nt?oy(le,Ne,Ue,De,ot,mt,lt,Me):oy(le,ke,De,Ue,Nt,lt,mt,Me):lt<mt?oy(le,De,Ne,ke,lt,ot,Nt,Me):oy(le,Ue,ke,Ne,mt,Nt,ot,Me),Math.max(xt,ut)}($,i,e.aabb,r,a);const W=ue.mat4.fromQuat([],$),Q=ue.mat4.multiply([],W,G);ue.mat4.multiply(r,N,Q)}else j=i.elevation.getAtPointOrZero(new t(T.x/B,T.y/B),0);j!==0&&(r[14]+=j)}}function z_(r,e,i=!1){r.uploaded||(r.gfxTexture=new zv(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function YS(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,qS.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,$S.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,ZS.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?GS:HS).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,WS.members,!0)),r.segments=dn.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const a=r.material;a.pbrMetallicRoughness.baseColorTexture&&z_(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&z_(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&z_(a.normalTexture,e),a.occlusionTexture&&z_(a.occlusionTexture,e,i),a.emissionTexture&&z_(a.emissionTexture,e)}function Bv(r,e,i){if(r.meshes)for(const a of r.meshes)YS(a,e,i);if(r.children)for(const a of r.children)Bv(a,e,i)}function cy(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)cy(e)}function Nv(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)Nv(i)}class Sm{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const c=a||e.findDEMTileFor(i);if(!c||!c.dem)return;const l=c.dem,d=c.tileID,y=1<<i.canonical.z-d.canonical.z;return new Sm(c,l.dim/vt/y,[(i.canonical.x/y-d.canonical.x)*l.dim,(i.canonical.y/y-d.canonical.y)*l.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(a);return new Mt(c,l)}getElevationAt(e,i,a,c){const l=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],y=Math.floor(l),w=Math.floor(d),A=this._dem;return c=!!c,a?Kt(Kt(A.get(y,w,c),A.get(y,w+1,c),d-w),Kt(A.get(y+1,w,c),A.get(y+1,w+1,c),d-w),l-y):A.get(y,w,c)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Cr(1,e)*this._dem.stride}}const Fv=new Float32Array(262144),tp=new Uint8Array(262144);function R1(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,R1(i));return e}function D1(r,e,i){if(r.meshes)for(const a of r.meshes){if(a.aabb.min[0]===1/0)continue;const c=At.applyTransform(a.aabb,r.matrix);i.insert(e,c.min[0],c.min[1],c.max[0],c.max[1])}if(r.children)for(const a of r.children)D1(a,e,i)}const z1=["","wall","door","roof","window","lamp","logo"];class P1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:R1(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new At([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new At([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=At.applyTransformFast(a.aabb,this.node.matrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class uy{constructor(e,i,a,c,l,d,y){this.id=a,this.layers=e,this.layerIds=this.layers.map(w=>w.fqid),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.modelTraits|=Tm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=Tm.HasMapboxMeshFeatures),l&&(this.modelTraits|=Tm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const w of i)this.nodesInfo.push(new P1(w)),D1(w,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const a of this.getNodesInfo()){const c=a.node;c.footprint&&i.push({footprint:c.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;if(!Aa(e,this.states))for(const c of a)this.evaluate(c,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const c=a.node;this.uploaded?this.updatePbrBuffer(c):Bv(c,e,!0)}for(const a of i)cy(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const c=e.transform.projectionOptions,l=e.style.getBrightness(),d=this.brightness!==l;if(!this.uploaded||this.dirty||c.name!==this.projection.name||P_(a.paint.get("model-color").value,d)||P_(a.paint.get("model-color-mix-intensity").value,d)||P_(a.paint.get("model-roughness").value,d)||P_(a.paint.get("model-emissive-strength").value,d)||P_(a.paint.get("model-height-based-emissive-strength-multiplier").value,d)){this.projection=c,this.brightness=l;const y=this.getNodesInfo();for(const w of y)w.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),c=this.id.canonical;for(const l of a){const d=l.feature;l.evaluatedScale=i.paint.get("model-scale").evaluate(d,{},c)}}evaluate(e,i){const a=this.getNodesInfo();for(const c of a){if(!c.node.meshes)continue;const l=c.feature,d=i&&i[l.id];if(Aa(d,c.state))continue;c.state=structuredClone(d);const y=c.node.meshes&&c.node.meshes[0].featureData,w=c.evaluatedColor[2],A=c.evaluatedRMEA[2],_=this.id.canonical;if(c.hasTranslucentParts=!1,y){for(let T=0;T<z1.length;T++){const I=z1[T];I.length&&(l.properties.part=I);const E=e.paint.get("model-color").evaluate(l,d,_).toRenderColor(null),M=e.paint.get("model-color-mix-intensity").evaluate(l,d,_);c.evaluatedColor[T]=[E.r,E.g,E.b,M],c.evaluatedRMEA[T][0]=e.paint.get("model-roughness").evaluate(l,d,_),c.evaluatedRMEA[T][2]=e.paint.get("model-emissive-strength").evaluate(l,d,_),c.evaluatedRMEA[T][3]=E.a,c.emissionHeightBasedParams[T]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,d,_),!c.hasTranslucentParts&&E.a<1&&(c.hasTranslucentParts=!0)}delete l.properties.part,JS(c,w!==c.evaluatedColor[2]||A!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,d,_);c.evaluatedScale=e.paint.get("model-scale").evaluate(l,d,_),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,c){const l=e.findDEMTileFor(a);if(l&&(l.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const d=Sm.create(e,a,l);if(!d)return;this.modelTraits&Tm.HasMapboxMeshFeatures&&this.updateDEM(e,d,a,c);for(const y of this.getNodesInfo()){const w=y.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const A=w.footprint.vertices;let _=d.getElevationAt(A[0].x,A[0].y,!0,!0);for(let T=1;T<A.length;T++)_=Math.min(_,d.getElevationAt(A[T].x,A[T].y,!0,!0));w.elevation=_}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,c){let l=i._dem._modifiedForSources[c];if(l===void 0&&(i._dem._modifiedForSources[c]=[],l=i._dem._modifiedForSources[c]),l.includes(a.canonical))return;const d=i._dem.dim;l.push(a.canonical);let y=!1;for(const w of this.getNodesInfo()){const A=w.node;if(!A.footprint||!A.footprint.grid)continue;const _=A.footprint.grid,T=i.tileCoordToPixel(_.min.x,_.min.y),I=i.tileCoordToPixel(_.max.x,_.max.y),E=Math.min(Math.min(d-I.y,T.x),Math.min(T.y,d-I.x));if(E<0)continue;const M=Di(E,2,5);let z=Math.max(0,T.x-M),B=Math.max(0,T.y-M),N=Math.min(I.x+M,d-1),H=Math.min(I.y+M,d-1);for(let W=B;W<=H;++W)for(let Q=z;Q<=N;++Q)tp[W*d+Q]=255;let G=0,j=0;for(let W=0;W<_.cellsY;++W)for(let Q=0;Q<_.cellsX;++Q){if(!_.cells[W*_.cellsX+Q])continue;const le=i.tileCoordToPixel(_.min.x+Q/_.xScale,_.min.y+W/_.yScale),se=i.tileCoordToPixel(_.min.x+(Q+1)/_.xScale,_.min.y+(W+1)/_.yScale);for(let ae=le.y;ae<=Math.min(se.y+1,d-1);++ae)for(let be=le.x;be<=Math.min(se.x+1,d-1);++be)tp[ae*d+be]===255&&(tp[ae*d+be]=0,G+=i.getElevationAtPixel(be,ae),j++)}const $=G/j;z=Math.max(1,T.x-M),B=Math.max(1,T.y-M),N=Math.min(I.x+M,d-2),H=Math.min(I.y+M,d-2),y=!0;for(let W=B;W<=H;++W)for(let Q=z;Q<=N;++Q)tp[W*d+Q]===0&&(Fv[W*d+Q]=i._dem.set(Q,W,$));for(let W=1;W<M;++W){z=Math.max(1,T.x-W),B=Math.max(1,T.y-W),N=Math.min(I.x+W,d-2),H=Math.min(I.y+W,d-2);for(let Q=B;Q<=H;++Q)for(let le=z;le<=N;++le){const se=Q*d+le;if(tp[se]===255){let ae=0,be=0,he=-1,Te=-1;for(let Ie=-1;Ie<=1;++Ie)for(let Me=-1;Me<=1;++Me){const ze=(Q+Ie)*d+le+Me;if(tp[ze]>=W)continue;const De=Fv[ze],Ne=Math.abs(De);Ne>be&&(ae=De,be=Ne,he=Me,Te=Ie)}if(be>.1){const Ie=1-(W+.5*Math.abs(he*Te))/M;let Me=i._dem.get(le,Q)+ae*Ie;const ze=i._dem.get(le+he,Q+Te),De=i._dem.get(le-he,Q-Te,!0);(Me-ze)*(Me-De)>0&&(Me=(ze+De)/2),Fv[se]=i._dem.set(le,Q,Me),tp[se]=W}}}}}y&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=We.now())}setFilter(e){this.filter=e?hc(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new hn(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)cy(i.node),Nv(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped()),c=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const d=c[l].node;c[l].hiddenByReplacement=!!d.footprint&&!a.find(y=>y.footprint===d.footprint)}}getHeightAtTileCoord(e,i){const a=this.getNodesInfo(),c=[],l=[0,0,0],d=ue.mat4.identity([]);for(let y=0;y<this.nodesInfo.length;y++){const w=a[y],A=w.node.meshes[0],_=A.transformedAabb;if(e<_.min[0]||i<_.min[1]||e>_.max[0]||i>_.max[1])continue;if(w.node.hidden===!0)return{height:1/0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};ue.mat4.invert(d,w.node.matrix),l[0]=e,l[1]=i,ue.vec3.transformMat4(l,l,d);const T=(l[0]-A.aabb.min[0])/(A.aabb.max[0]-A.aabb.min[0])*ep|0,I=Math.min(63,(l[1]-A.aabb.min[1])/(A.aabb.max[1]-A.aabb.min[1])*ep|0)*ep+Math.min(63,T),E=A.heightmap[I];if(!(E<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:E,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new Mt(e,i),new Mt(e,i),c),c.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function P_(r,e){return!r.isLightConstant&&e}function KS(r,e,i,a,c,l,d,y){let w=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,_=240&e|(240&e)>>4;i[3]>0&&(w=Kt(w,255*i[0],i[3]),A=Kt(A,255*i[1],i[3]),_=Kt(_,255*i[2],i[3]));const T=w<<8|A,I=_<<8|Math.floor(255*a[3]),E=function(W){const Q=Di(W,0,2);return Math.min(Math.round(.5*Q*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],M=Di(c[0],0,1),z=Di(c[1],0,1),B=Di(c[2],0,1),N=Di(c[3],0,1);let H,G,j,$;if(M!==z&&d!==l&&z!==M){const W=d-l;G=1/(W*(z-M)),j=-(l+W*M)/(W*(z-M));const Q=Di(c[4],-1,1);$=Math.pow(10,Q),H=255*B<<8|255*N}else H=65535,G=0,j=1,$=1;if(r.emplaceBack(T,I,E,H,G,j,$),y){const W=y.length;y.clear();for(let Q=0;Q<W;Q++)y.emplaceBack(T,I,E,H,G,j,$)}}function JS(r,e,i){const a=r.node;let c=0;const l=i&Tm.HasMeshoptCompression;for(const d of a.meshes){if(a.lights&&a.lightMeshIndex===c||!d.featureData)continue;d.featureArray=new xl,d.featureArray.reserve(d.featureData.length);let y=e;for(const w of d.featureData){const A=l?65535&w:w>>16&65535,_=l?w>>16&65535:65535&w,T=(15&_)<8?15&_:0,I=r.evaluatedRMEA[T],E=r.evaluatedColor[T],M=r.emissionHeightBasedParams[T];let z;if(y&&T===2&&a.lights&&(z=new xl,z.resize(10*a.lights.length)),KS(d.featureArray,A,E,I,M,d.aabb.min[2],d.aabb.max[2],z),z&&y){y=!1;const B=a.meshes[a.lightMeshIndex];B.featureArray=z,B.featureArray._trim()}}d.featureArray._trim(),c++}}function O1(r,e,i,a){const c=1<<r.z;e.lat=yn((a/vt+r.y)/c),e.lng=ns((i/vt+r.x)/c)}Ot(uy,"Tiled3dModelBucket",{omit:["layers"]}),Ot(P1,"Tiled3dModelFeature");const QS={circle:class extends Ir{constructor(r,e,i,a){super(r,{layout:Le||(Le=new Bn({"circle-sort-key":new Lt(Fe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new yt(Fe.layout_circle["circle-elevation-reference"]),visibility:new yt(Fe.layout_circle.visibility)})),paint:et||(et=new Bn({"circle-radius":new Lt(Fe.paint_circle["circle-radius"]),"circle-color":new Lt(Fe.paint_circle["circle-color"]),"circle-blur":new Lt(Fe.paint_circle["circle-blur"]),"circle-opacity":new Lt(Fe.paint_circle["circle-opacity"]),"circle-translate":new yt(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new yt(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yt(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yt(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Lt(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Lt(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Lt(Fe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new yt(Fe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}createBucket(r){return new Z(r)}queryRadius(r){const e=r;return Be("circle-radius",this,e)+Be("circle-stroke-width",this,e)+Qe(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,a,c,l,d,y){const w=dt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,r.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return xs(r,a,l,d,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const a=Il(this);return{config:new Sl(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}},heatmap:class extends Ir{createBucket(r){return new hg(r)}constructor(r,e,i,a){super(r,{layout:wc||(wc=new Bn({visibility:new yt(Fe.layout_heatmap.visibility)})),paint:Of||(Of=new Bn({"heatmap-radius":new Lt(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Lt(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yt(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ml(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yt(Fe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return Be("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,a,c,l,d,y){const w=this.paint.get("heatmap-radius").evaluate(e,i);return xs(r,a,l,d,y,!0,!0,new Mt(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new Sl(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Ir{constructor(r,e,i,a){super(r,{layout:Fp||(Fp=new Bn({visibility:new yt(Fe.layout_hillshade.visibility)})),paint:Sh||(Sh=new Bn({"hillshade-illumination-direction":new yt(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new yt(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yt(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yt(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yt(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yt(Fe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new yt(Fe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends Ir{constructor(r,e,i,a){super(r,{layout:Kn||(Kn=new Bn({"fill-sort-key":new Lt(Fe.layout_fill["fill-sort-key"]),visibility:new yt(Fe.layout_fill.visibility),"fill-elevation-reference":new yt(Fe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Lt(Fe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:im||(im=new Bn({"fill-antialias":new yt(Fe.paint_fill["fill-antialias"]),"fill-opacity":new Lt(Fe.paint_fill["fill-opacity"]),"fill-color":new Lt(Fe.paint_fill["fill-color"]),"fill-outline-color":new Lt(Fe.paint_fill["fill-outline-color"]),"fill-translate":new yt(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new yt(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Lt(Fe.paint_fill["fill-pattern"]),"fill-emissive-strength":new yt(Fe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Lt(Fe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Lt(Fe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Lt(Fe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new Sl(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Od(r)}queryRadius(){return Qe(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,a,c,l){return!r.queryGeometry.isAboveHorizon&&J(nt(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,r.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}},"fill-extrusion":class extends Ir{constructor(r,e,i,a){super(r,{layout:Og||(Og=new Bn({visibility:new yt(Fe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new yt(Fe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Lg||(Lg=new Bn({"fill-extrusion-opacity":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Lt(Fe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new yt(Fe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new qf(r)}queryRadius(){return Qe(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,a,c,l,d,y,w){const A=dt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,r.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(e,i),T=this.paint.get("fill-extrusion-base").evaluate(e,i),I=[0,0],E=y&&l.elevation,M=l.elevation?l.elevation.exaggeration():1,z=r.tile.getBucket(this);if(E&&z instanceof qf){const j=z.centroidVertexArray,$=w+1;$<j.length&&(I[0]=j.geta_centroid_pos0($),I[1]=j.geta_centroid_pos1($))}if(I[0]===0&&I[1]===1)return!1;l.projection.name==="globe"&&(a=qd([a],[new Mt(0,0),new Mt(vt,vt)],r.tileID.canonical).map(j=>j.polygon).flat());const B=E?y:null,[N,H]=function(j,$,W,Q,le,se,ae,be,he,Te,Ie){return j.projection.name==="globe"?function(Me,ze,De,Ne,ke,Ue,lt,ot,Nt,mt,xt){const ut=[],ti=[],zt=Me.projection.upVectorScale(xt,Me.center.lat,Me.worldSize).metersToTile,Zt=[0,0,0,1],pi=[0,0,0,1],Ci=(Bi,Mi,ji,ln)=>{Bi[0]=Mi,Bi[1]=ji,Bi[2]=ln,Bi[3]=1},yi=x_();De>0&&(De+=yi),Ne+=yi;for(const Bi of ze){const Mi=[],ji=[];for(const ln of Bi){const Dn=ln.x+ke.x,gi=ln.y+ke.y,Yi=Me.projection.projectTilePoint(Dn,gi,xt),Fn=Me.projection.upVector(xt,ln.x,ln.y);let $n=De,Jn=Ne;if(lt){const tr=cm(Dn,gi,De,Ne,lt,ot,Nt,mt);$n+=tr.base,Jn+=tr.top}De!==0?Ci(Zt,Yi.x+Fn[0]*zt*$n,Yi.y+Fn[1]*zt*$n,Yi.z+Fn[2]*zt*$n):Ci(Zt,Yi.x,Yi.y,Yi.z),Ci(pi,Yi.x+Fn[0]*zt*Jn,Yi.y+Fn[1]*zt*Jn,Yi.z+Fn[2]*zt*Jn),ue.vec3.transformMat4(Zt,Zt,Ue),ue.vec3.transformMat4(pi,pi,Ue),Mi.push(new xu(Zt[0],Zt[1],Zt[2])),ji.push(new xu(pi[0],pi[1],pi[2]))}ut.push(Mi),ti.push(ji)}return[ut,ti]}(j,$,W,Q,le,se,ae,be,he,Te,Ie):ae?function(Me,ze,De,Ne,ke,Ue,lt,ot,Nt){const mt=[],xt=[],ut=[0,0,0,1];for(const ti of Me){const zt=[],Zt=[];for(const pi of ti){const Ci=pi.x+Ne.x,yi=pi.y+Ne.y,Bi=cm(Ci,yi,ze,De,Ue,lt,ot,Nt);ut[0]=Ci,ut[1]=yi,ut[2]=Bi.base,ut[3]=1,ue.vec4.transformMat4(ut,ut,ke),ut[3]=Math.max(ut[3],1e-5);const Mi=new xu(ut[0]/ut[3],ut[1]/ut[3],ut[2]/ut[3]);ut[0]=Ci,ut[1]=yi,ut[2]=Bi.top,ut[3]=1,ue.vec4.transformMat4(ut,ut,ke),ut[3]=Math.max(ut[3],1e-5);const ji=new xu(ut[0]/ut[3],ut[1]/ut[3],ut[2]/ut[3]);zt.push(Mi),Zt.push(ji)}mt.push(zt),xt.push(Zt)}return[mt,xt]}($,W,Q,le,se,ae,be,he,Te):function(Me,ze,De,Ne,ke){const Ue=[],lt=[],ot=ke[8]*ze,Nt=ke[9]*ze,mt=ke[10]*ze,xt=ke[11]*ze,ut=ke[8]*De,ti=ke[9]*De,zt=ke[10]*De,Zt=ke[11]*De;for(const pi of Me){const Ci=[],yi=[];for(const Bi of pi){const Mi=Bi.x+Ne.x,ji=Bi.y+Ne.y,ln=ke[0]*Mi+ke[4]*ji+ke[12],Dn=ke[1]*Mi+ke[5]*ji+ke[13],gi=ke[2]*Mi+ke[6]*ji+ke[14],Yi=ke[3]*Mi+ke[7]*ji+ke[15],Fn=ln+ot,$n=Dn+Nt,Jn=gi+mt,tr=Math.max(Yi+xt,1e-5),In=ln+ut,Yr=Dn+ti,ra=gi+zt,Sr=Math.max(Yi+Zt,1e-5);Ci.push(new xu(Fn/tr,$n/tr,Jn/tr)),yi.push(new xu(In/Sr,Yr/Sr,ra/Sr))}Ue.push(Ci),lt.push(yi)}return[Ue,lt]}($,W,Q,le,se)}(l,a,T,_,A,d,B,I,M,l.center.lat,r.tileID.canonical),G=r.queryGeometry;return function(j,$,W){let Q=1/0;J(W,$)&&(Q=Hf(W,$[0]));for(let le=0;le<$.length;le++){const se=$[le],ae=j[le];for(let be=0;be<se.length-1;be++){const he=se[be],Te=[he,se[be+1],ae[be+1],ae[be],he];Y(W,Te)&&(Q=Math.min(Q,Hf(W,Te)))}}return Q!==1/0&&Q}(N,H,G.isPointQuery()?G.screenBounds:G.screenGeometry)}},line:class extends Ir{constructor(r,e,i,a){const c=Gd();super(r,c,e,i,a),c.layout&&(this.layout=new uc(c.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Rs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(Wf)return Wf;const i=Gd();return Wf=new Tu(i.paint.properties["line-width"].specification),Wf.useIntegerZoom=!0,Wf})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new b_(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const a=Mc(this);return{config:new Sl(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(r){const e=r,i=T_(Be("line-width",this,e),Be("line-gap-width",this,e)),a=Be("line-offset",this,e);return i/2+Math.abs(a)+Qe(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,a,c,l){if(r.queryGeometry.isAboveHorizon)return!1;const d=nt(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,r.pixelToTileUnitsFactor),y=r.pixelToTileUnitsFactor/2*T_(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(a=function(A,_){const T=[],I=new Mt(0,0);for(let E=0;E<A.length;E++){const M=A[E],z=[];for(let B=0;B<M.length;B++){const N=M[B],H=M[B+1],G=B===0?I:N.sub(M[B-1])._unit()._perp(),j=B===M.length-1?I:H.sub(N)._unit()._perp(),$=G._add(j)._unit();$._mult(1/($.x*j.x+$.y*j.y)),z.push($._mult(_)._add(N))}T.push(z)}return T}(a,w*r.pixelToTileUnitsFactor)),function(A,_,T){for(let I=0;I<_.length;I++){const E=_[I];if(A.length>=3){for(let M=0;M<E.length;M++)if(ge(A,E[M]))return!0}if(ee(A,E,T))return!0}return!1}(d,a,y)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets}},symbol:iy,background:class extends Ir{constructor(r,e,i,a){super(r,{layout:s1||(s1=new Bn({visibility:new yt(Fe.layout_background.visibility)})),paint:a1||(a1=new Bn({"background-pitch-alignment":new yt(Fe.paint_background["background-pitch-alignment"]),"background-color":new yt(Fe.paint_background["background-color"]),"background-pattern":new yt(Fe.paint_background["background-pattern"]),"background-opacity":new yt(Fe.paint_background["background-opacity"]),"background-emissive-strength":new yt(Fe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:h1,"raster-particle":g1,sky:class extends Ir{constructor(r,e,i,a){super(r,{layout:p1||(p1=new Bn({visibility:new yt(Fe.layout_sky.visibility)})),paint:m1||(m1=new Bn({"sky-type":new yt(Fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new yt(Fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new yt(Fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new yt(Fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new yt(Fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new ml(Fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new yt(Fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new yt(Fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new yt(Fe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Lf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),c=!a,l=r.style.light,d=l.properties.get("position");return c&&l.properties.get("anchor")==="viewport"&&Pn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?Pv(d.azimuthal,90-d.polar,e):Pv(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return Pv(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Ir{constructor(r,e,i,a){super(r,{paint:_1||(_1=new Bn({}))},e,null)}},model:class extends Ir{constructor(r,e,i,a){super(r,{layout:M1||(M1=new Bn({visibility:new yt(Fe.layout_model.visibility),"model-id":new Lt(Fe.layout_model["model-id"])})),paint:I1||(I1=new Bn({"model-opacity":new Lt(Fe.paint_model["model-opacity"]),"model-rotation":new Lt(Fe.paint_model["model-rotation"]),"model-scale":new Lt(Fe.paint_model["model-scale"]),"model-translation":new Lt(Fe.paint_model["model-translation"]),"model-color":new Lt(Fe.paint_model["model-color"]),"model-color-mix-intensity":new Lt(Fe.paint_model["model-color-mix-intensity"]),"model-type":new yt(Fe.paint_model["model-type"]),"model-cast-shadows":new yt(Fe.paint_model["model-cast-shadows"]),"model-receive-shadows":new yt(Fe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new yt(Fe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Lt(Fe.paint_model["model-emissive-strength"]),"model-roughness":new Lt(Fe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Lt(Fe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new yt(Fe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new yt(Fe.paint_model["model-front-cutoff"]),"model-color-use-theme":new Lt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new kv(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof uy?vt-1:0}queryIntersectsFeature(r,e,i,a,c,l){if(!this.modelManager)return!1;const d=this.modelManager,y=r.tile.getBucket(this);if(!(y&&y instanceof kv))return!1;for(const w in y.instancesPerModel){const A=y.instancesPerModel[w],_=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(_)){const T=A.features[A.idToFeaturesIndex[_]],I=d.getModel(w,this.scope);if(!I)return!1;let E=ue.mat4.create();const M=new rn(0,0),z=y.canonical;let B=Number.MAX_VALUE;for(let N=0;N<T.instancedDataCount;++N){const H=16*(T.instancedDataOffset+N),G=A.instancedDataArray.float32,j=[G[H+4],G[H+5],G[H+6]];O1(z,M,G[H],0|G[H+1]),C1(E,I,l,M,T.rotation,T.scale,j,!1,!1,!1),l.projection.name==="globe"&&(E=Lv(E,l));const $=ue.mat4.multiply([],l.projMatrix,E),W=r.queryGeometry,Q=w1(W.isPointQuery()?W.screenBounds:W.screenGeometry,l,$,I.aabb);Q!=null&&(B=Math.min(Q,B))}return B!==Number.MAX_VALUE&&B}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ol}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ir{constructor(r,e,i,a){super(r,{layout:bs||(bs=new Bn({"clip-layer-types":new yt(Fe.layout_clip["clip-layer-types"]),"clip-layer-scope":new yt(Fe.layout_clip["clip-layer-scope"])})),paint:Sg||(Sg=new Bn({}))},e,i,a)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new Ff(r)}is3D(r){return!0}}};class e2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class t2{constructor(){this.tasks={},this.taskQueue=[],Du(["process"],this),this.invoker=new e2(this.process),this.nextId=0}add(e,i){const a=this.nextId++,c=function({type:l,isSymbolTile:d,zoom:y}){return y=y||0,l==="message"?0:l!=="maybePrepare"||d?l!=="parseTile"||d?l==="parseTile"&&d?300-y:l==="maybePrepare"&&d?400-y:500:200-y:100-y}(i);if(c===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const l=this.tasks[this.taskQueue[c]];l.priority<i&&(i=l.priority,e=c)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class L1{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Du(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new t2}send(e,i,a,c,l=!1,d){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=d,this.callbacks[y]=a);const w=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!a,targetMapId:c,mustQueue:l,sourceMapId:this.mapId,data:Ro(i,w)},w),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(i.mustQueue||rs()){const c=this.callbacks[a],l=this.scheduler.add(()=>this.processTask(a,i),c&&c.metadata||{type:"message"});l&&(this.cancelCallbacks[a]=l)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(Nr(i.error)):a(null,Nr(i.data)))}else{const a=new Set,c=i.hasCallback?(d,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?Ro(d):null,data:Ro(y,a)},a)}:()=>{},l=Nr(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,l,c);else if(this.parent.getWorkerSource){const d=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,d[0],l.source,l.scope)[d[1]](l,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var O_={workerUrl:"",workerClass:null,workerParams:void 0};const Uv="mapboxgl_preloaded_worker_pool";class ip{constructor(){this.active={}}acquire(e,i=ip.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(O_.workerClass!=null?new O_.workerClass:new self.Worker(O_.workerUrl,O_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Uv]}numActive(){return Object.keys(this.active).length}}ip.workerCount=2;class Em{constructor(e,i,a="Worker",c=ip.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Wa();const l=this.workerPool.acquire(this.id,c);for(let d=0;d<l.length;d++){const y=new Em.Actor(l[d],i,this.id);y.name=`${a} ${d}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,a){qr(this.actors,(c,l)=>{c.send(e,i,l)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let L_,Vv;function hy(){return L_||(L_=new ip),L_}Em.Actor=L1;const jv=new on(0,0,0);var qv=(r=>(r[r.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",r[r.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",r[r.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",r))(qv||{}),dy=(r=>(r[r.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",r[r.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",r[r.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",r[r.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",r))(dy||{}),k_=(r=>(r[r.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",r[r.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",r[r.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",r[r.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",r[r.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",r))(k_||{}),k1=(r=>(r[r.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",r[r.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",r[r.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",r))(k1||{}),Am=(r=>(r[r.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",r[r.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",r[r.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",r[r.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",r[r.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",r[r.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",r))(Am||{}),B1=(r=>(r[r.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",r[r.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",r[r.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",r))(B1||{});function i2(r,e,i){r===1&&e.icons.push(function(a,c){return function(l){if(l.usvg_tree.height||(l.usvg_tree.height=l.usvg_tree.width),!l.metadata)return l;const{metadata:d}=l;if(d.content_area){const{content_area:y}=d;y.top==null&&(y.top=y.left),y.width==null&&(y.width=l.usvg_tree.width),y.height==null&&(y.height=y.width)}return d.stretch_x&&d.stretch_x.length&&N1(d,"x"),d.stretch_y&&d.stretch_y.length&&N1(d,"y"),l}(a.readFields(n2,{name:void 0},c))}(i,i.readVarint()+i.pos))}function N1(r,e){const i=[],a=r[`stretch_${e}`];let c=null;for(let l=0;l<a.length;l++)c===null?c=i.length===0?a[0]:i[i.length-1][1]+a[l]:(i.push([c,c+a[l]]),c=null);r[`stretch_${e}_areas`]=i}function n2(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=function(a,c){return a.readFields(r2,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},c)}(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=function(a,c){return a.readFields(o2,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},c)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function r2(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=function(a,c){return a.readFields(s2,{left:0},c)}(i,i.readVarint()+i.pos):r===4&&e.variables.push(function(a,c){return a.readFields(a2,{name:void 0},c)}(i,i.readVarint()+i.pos))}function s2(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function a2(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=my(i.readVarint()),e.value="rgb_color")}function o2(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(fy(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push(function(a,c){return a.readFields(p2,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},c)}(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push(function(a,c){return a.readFields(_2,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},c)}(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push(function(a,c){return a.readFields(g2,{children:[]},c)}(i,i.readVarint()+i.pos)):r===8&&e.masks.push(function(a,c){const l=a.readFields(y2,{left:0,width:20,mask_type:1,children:[]},c);return l.height==null&&(l.height=l.width),l.top==null&&(l.top=l.left),l}(i,i.readVarint()+i.pos))}function fy(r,e){return r.readFields(l2,{},e)}function l2(r,e,i){r===1?(e.group=function(a,c){return a.readFields(c2,{opacity:255,children:[]},c)}(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=function(a,c){return a.readFields(h2,{paint_order:1,commands:[],step:1,diffs:[],rule:1},c)}(i,i.readVarint()+i.pos),e.node="path")}function c2(r,e,i){r===1?e.transform=py(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(fy(i,i.readVarint()+i.pos))}function py(r,e){return r.readFields(u2,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function u2(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function h2(r,e,i){r===1?e.fill=function(a,c){return a.readFields(d2,{rgb_color:jv,paint:"rgb_color",opacity:255},c)}(i,i.readVarint()+i.pos):r===2?e.stroke=function(a,c){return a.readFields(f2,{rgb_color:jv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},c)}(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function d2(r,e,i){r===1?(e.rgb_color=my(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function my(r){return new on((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function f2(r,e,i){r===1?(e.rgb_color=my(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function p2(r,e,i){r===1?e.transform=py(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(F1(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function F1(r,e){return r.readFields(m2,{offset:0,opacity:255,rgb_color:jv},e)}function m2(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=my(i.readVarint()))}function _2(r,e,i){r===1?e.transform=py(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(F1(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function g2(r,e,i){r===1?e.transform=py(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(fy(i,i.readVarint()+i.pos))}function y2(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(fy(i,i.readVarint()+i.pos))}class v2{static calculate(e={},i=[]){const a=new Map,c=new Map;if(Object.keys(e).length===0)return a;i.forEach(l=>{c.set(l.name,l.rgb_color||new on(0,0,0))});for(const[l,d]of Object.entries(e))c.has(l)?a.set(c.get(l).toStringPremultipliedAlpha(),d):console.warn(`Ignoring unknown image variable "${l}"`);return a}}function Mm(r,e=255,i){const a=e/255,c=r.toStringPremultipliedAlpha(),l=i.has(c)?i.get(c).clone():r.clone();return l.a*=a,l.toString()}function B_(r,e){if(!Je()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}function x2(r,e){const i=v2.calculate(e.params,r.metadata?r.metadata.variables:[]),a=r.usvg_tree,c=a.width,l=a.height,d=e.transform?e.transform:new DOMMatrix,y=Math.max(1,Math.round(c*d.a)),w=Math.max(1,Math.round(l*d.d)),A=new DOMMatrix([y/c,0,0,w/l,0,0]),_=B_(y,w).getContext("2d");return Gv(_,A,a,a,i),_.getImageData(0,0,y,w)}function Gv(r,e,i,a,c){for(const l of a.children)U1(r,e,i,l,c)}function U1(r,e,i,a,c){a.group?(r.save(),function(l,d,y,w,A){const _=w.mask_idx!=null?y.masks[w.mask_idx]:null,T=w.clip_path_idx!=null?y.clip_paths[w.clip_path_idx]:null;if(w.transform&&(d=_y(w.transform).preMultiplySelf(d)),!function(M,z,B){return M.opacity!==255||z||B}(w,T!=null,_!=null))return void Gv(l,d,y,w,A);const I=B_(l.canvas.width,l.canvas.height),E=I.getContext("2d");Gv(E,d,y,w,A),T&&$1(E,d,y,T),_&&X1(E,d,y,_,A),l.globalAlpha=w.opacity/255,l.drawImage(I,0,0)}(r,e,i,a.group,c),r.restore()):a.path&&(r.save(),function(l,d,y,w,A){const _=W1(w);l.setTransform(d),w.paint_order===k1.PAINT_ORDER_FILL_AND_STROKE?(V1(l,y,w,_,A),q1(l,y,w,_,A)):(q1(l,y,w,_,A),V1(l,y,w,_,A))}(r,e,i,a.path,c),r.restore())}function V1(r,e,i,a,c){const l=i.fill;if(!l)return;const d=l.opacity/255;switch(l.paint){case"rgb_color":r.fillStyle=Mm(l.rgb_color,l.opacity,c);break;case"linear_gradient_idx":r.fillStyle=G1(r,e.linear_gradients[l.linear_gradient_idx],d,c);break;case"radial_gradient_idx":r.fillStyle=H1(r,e.radial_gradients[l.radial_gradient_idx],d,c)}r.fill(a,j1(i))}function j1(r){return r.rule===qv.PATH_RULE_NON_ZERO?"nonzero":r.rule===qv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function q1(r,e,i,a,c){const l=i.stroke;if(!l)return;r.lineWidth=l.width,r.miterLimit=l.miterlimit,r.setLineDash(l.dasharray),r.lineDashOffset=l.dashoffset;const d=l.opacity/255;switch(l.paint){case"rgb_color":r.strokeStyle=Mm(l.rgb_color,l.opacity,c);break;case"linear_gradient_idx":r.strokeStyle=G1(r,e.linear_gradients[l.linear_gradient_idx],d,c);break;case"radial_gradient_idx":r.strokeStyle=H1(r,e.radial_gradients[l.radial_gradient_idx],d,c)}switch(l.linejoin){case k_.LINE_JOIN_MITER_CLIP:case k_.LINE_JOIN_MITER:r.lineJoin="miter";break;case k_.LINE_JOIN_ROUND:r.lineJoin="round";break;case k_.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(l.linecap){case dy.LINE_CAP_BUTT:r.lineCap="butt";break;case dy.LINE_CAP_ROUND:r.lineCap="round";break;case dy.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(a)}function G1(r,e,i,a){if(e.stops.length===1){const I=e.stops[0];return Mm(I.rgb_color,I.opacity*i,a)}const c=_y(e.transform),{x1:l,y1:d,x2:y,y2:w}=e,A=c.transformPoint(new DOMPoint(l,d)),_=c.transformPoint(new DOMPoint(y,w)),T=r.createLinearGradient(A.x,A.y,_.x,_.y);for(const I of e.stops)T.addColorStop(I.offset,Mm(I.rgb_color,I.opacity*i,a));return T}function H1(r,e,i,a){if(e.stops.length===1){const I=e.stops[0];return Mm(I.rgb_color,I.opacity*i,a)}const c=_y(e.transform),{fx:l,fy:d,cx:y,cy:w}=e,A=c.transformPoint(new DOMPoint(l,d)),_=c.transformPoint(new DOMPoint(y,w)),T=r.createRadialGradient(A.x,A.y,0,_.x,_.y,e.r*((c.a+c.d)/2));for(const I of e.stops)T.addColorStop(I.offset,Mm(I.rgb_color,I.opacity*i,a));return T}function Z1(r,e,i,a){const c=a.transform?_y(a.transform).preMultiplySelf(e):e,l=B_(r.canvas.width,r.canvas.height),d=l.getContext("2d");for(const w of a.children)if(w.group)Z1(d,c,i,w.group);else if(w.path){const A=w.path,_=new Path2D;_.addPath(W1(A),c),d.fill(_,j1(A))}const y=a.clip_path_idx!=null?i.clip_paths[a.clip_path_idx]:null;y&&$1(d,c,i,y),r.globalCompositeOperation="source-over",r.drawImage(l,0,0)}function $1(r,e,i,a){const c=B_(r.canvas.width,r.canvas.height);Z1(c.getContext("2d"),e,i,a),r.globalCompositeOperation="destination-in",r.drawImage(c,0,0)}function X1(r,e,i,a,c){if(a.children.length===0)return;const l=a.mask_idx!=null?i.masks[a.mask_idx]:null;l&&X1(r,e,i,l,c);const d=r.canvas.width,y=r.canvas.height,w=B_(d,y),A=w.getContext("2d"),_=a.width,T=a.height,I=a.left,E=a.top,M=new Path2D,z=new Path2D;z.rect(I,E,_,T),M.addPath(z,e),A.clip(M);for(const H of a.children)U1(A,e,i,H,c);const B=A.getImageData(0,0,d,y),N=B.data;if(a.mask_type===B1.MASK_TYPE_LUMINANCE)for(let H=0;H<N.length;H+=4)N[H+3]=N[H+3]/255*(.2126*N[H]+.7152*N[H+1]+.0722*N[H+2]);A.putImageData(B,0,0),r.globalCompositeOperation="destination-in",r.drawImage(w,0,0)}function _y(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function W1(r){const e=new Path2D,i=r.step;let a=r.diffs[0]*i,c=r.diffs[1]*i;e.moveTo(a,c);for(let l=0,d=2;l<r.commands.length;l++)switch(r.commands[l]){case Am.PATH_COMMAND_MOVE:a+=r.diffs[d++]*i,c+=r.diffs[d++]*i,e.moveTo(a,c);break;case Am.PATH_COMMAND_LINE:a+=r.diffs[d++]*i,c+=r.diffs[d++]*i,e.lineTo(a,c);break;case Am.PATH_COMMAND_QUAD:{const y=a+r.diffs[d++]*i,w=c+r.diffs[d++]*i;a=y+r.diffs[d++]*i,c=w+r.diffs[d++]*i,e.quadraticCurveTo(y,w,a,c);break}case Am.PATH_COMMAND_CUBIC:{const y=a+r.diffs[d++]*i,w=c+r.diffs[d++]*i,A=y+r.diffs[d++]*i,_=w+r.diffs[d++]*i;a=A+r.diffs[d++]*i,c=_+r.diffs[d++]*i,e.bezierCurveTo(y,w,A,_,a,c);break}case Am.PATH_COMMAND_CLOSE:e.closePath()}return e}class gy{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Ot(gy,"LRUCache");class Hv{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Ur(e,e.data)}getFromCache(e,i,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new gy(150)),this.cacheMap.get(a).get(gl(e.toString(),i))}setInCache(e,i,a,c){this.cacheDependenciesMap.has(c)||this.cacheDependenciesMap.set(c,new Map),this.cacheMap.has(c)||this.cacheMap.set(c,new gy(150));const l=this.cacheDependenciesMap.get(c),d=gl(e.id.toString(),a);l.get(d)||l.set(d,new Set);const y=this.cacheMap.get(c),w=e.toString();l.get(d).add(w),y.put(gl(e.toString(),a),i)}removeImagesFromCacheByIds(e,i,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const c=this.cacheMap.get(a),l=this.cacheDependenciesMap.get(a);for(const d of e){const y=gl(d.toString(),i);if(l.has(y)){for(const w of l.get(y))c.delete(w);l.delete(y)}}}rasterize(e,i,a,c,l=x2){const d=this.getFromCache(e,a,c);if(d)return d.clone();const y=l(i.icon,e.options),w=Hv._getImage(y);return this.setInCache(e,w,a,c),w.clone()}}class Y1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function K1(r,e,i,a){let c=0,l=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(a[d])<1e-15){if(i[d]<r[d]||i[d]>e[d])return null}else{const y=1/a[d];let w=(r[d]-i[d])*y,A=(e[d]-i[d])*y;if(w>A){const _=w;w=A,A=_}if(w>c&&(c=w),A<l&&(l=A),c>l)return null}return c}function J1(r,e,i,a,c,l,d,y,w,A,_){const T=a-r,I=c-e,E=l-i,M=d-r,z=y-e,B=w-i,N=_[1]*B-_[2]*z,H=_[2]*M-_[0]*B,G=_[0]*z-_[1]*M,j=T*N+I*H+E*G;if(Math.abs(j)<1e-15)return null;const $=1/j,W=A[0]-r,Q=A[1]-e,le=A[2]-i,se=(W*N+Q*H+le*G)*$;if(se<0||se>1)return null;const ae=Q*E-le*I,be=le*T-W*E,he=W*I-Q*T,Te=(_[0]*ae+_[1]*be+_[2]*he)*$;return Te<0||se+Te>1?null:(M*ae+z*be+B*he)*$}function Q1(r,e,i){return(r-e)/(i-e)}function eb(r,e,i,a,c,l,d,y,w){const A=1<<i,_=l-a,T=d-c,I=(r+1)/A*_+a,E=(e+0)/A*T+c,M=(e+1)/A*T+c;y[0]=(r+0)/A*_+a,y[1]=E,w[0]=I,w[1]=M}class tb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(l){const d=Math.ceil(Math.log2(l.dim/8)),y=[];let w=Math.ceil(Math.pow(2,d));const A=1/w,_=(E,M,z,B,N)=>{const H=B?1:0,G=(E+1)*z-H,j=M*z,$=(M+1)*z-H;N[0]=E*z,N[1]=j,N[2]=G,N[3]=$};let T=new Y1(w);const I=[];for(let E=0;E<w*w;E++){_(E%w,Math.floor(E/w),A,!1,I);const M=Xd(I[0],I[1],l),z=Xd(I[2],I[1],l),B=Xd(I[2],I[3],l),N=Xd(I[0],I[3],l);T.minimums.push(Math.min(M,z,B,N)),T.maximums.push(Math.max(M,z,B,N)),T.leaves.push(1)}for(y.push(T),w/=2;w>=1;w/=2){const E=y[y.length-1];T=new Y1(w);for(let M=0;M<w*w;M++){_(M%w,Math.floor(M/w),2,!0,I);const z=E.getElevation(I[0],I[1]),B=E.getElevation(I[2],I[1]),N=E.getElevation(I[2],I[3]),H=E.getElevation(I[0],I[3]),G=E.isLeaf(I[0],I[1]),j=E.isLeaf(I[2],I[1]),$=E.isLeaf(I[2],I[3]),W=E.isLeaf(I[0],I[3]),Q=Math.min(z.min,B.min,N.min,H.min),le=Math.max(z.max,B.max,N.max,H.max),se=G&&j&&$&&W;T.maximums.push(le),T.minimums.push(Q),T.leaves.push(le-Q<=5&&se?1:0)}y.push(T)}return y}(this.dem),a=i.length-1,c=i[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,c,l,d,y=1){return K1([e,i,-100],[a,c,this.maximums[0]*y],l,d)}raycast(e,i,a,c,l,d,y=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,a,c,l,d,y);if(w==null)return null;const A=[],_=[],T=[],I=[],E=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;E.length>0;){const{idx:M,t:z,nodex:B,nodey:N,depth:H}=E.pop();if(this.leaves[M]){eb(B,N,H,e,i,a,c,T,I);const j=1<<H,$=(B+0)/j,W=(B+1)/j,Q=(N+0)/j,le=(N+1)/j,se=Xd($,Q,this.dem)*y,ae=Xd(W,Q,this.dem)*y,be=Xd(W,le,this.dem)*y,he=Xd($,le,this.dem)*y,Te=J1(T[0],T[1],se,I[0],T[1],ae,I[0],I[1],be,l,d),Ie=J1(I[0],I[1],be,T[0],I[1],he,T[0],T[1],se,l,d),Me=Math.min(Te!==null?Te:Number.MAX_VALUE,Ie!==null?Ie:Number.MAX_VALUE);if(Me!==Number.MAX_VALUE)return Me;{const ze=ue.vec3.scaleAndAdd([],l,d,z);if(ib(se,ae,he,be,Q1(ze[0],T[0],I[0]),Q1(ze[1],T[1],I[1]))>=ze[2])return z}continue}let G=0;for(let j=0;j<this._siblingOffset.length;j++){eb((B<<1)+this._siblingOffset[j][0],(N<<1)+this._siblingOffset[j][1],H+1,e,i,a,c,T,I),T[2]=-100,I[2]=this.maximums[this.childOffsets[M]+j]*y;const $=K1(T,I,l,d);if($!=null){const W=$;A[j]=W;let Q=!1;for(let le=0;le<G&&!Q;le++)W>=A[_[le]]&&(_.splice(le,0,j),Q=!0);Q||(_[G]=j),G++}}for(let j=0;j<G;j++){const $=_[j];E.push({idx:this.childOffsets[M]+$,t:A[$],nodex:(B<<1)+this._siblingOffset[$][0],nodey:(N<<1)+this._siblingOffset[$][1],depth:H+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,c,l){if(e[c].isLeaf(i,a)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const d=c-1,y=e[d];let w=0,A=0;for(let _=0;_<this._siblingOffset.length;_++){const T=2*i+this._siblingOffset[_][0],I=2*a+this._siblingOffset[_][1],E=y.getElevation(T,I),M=y.isLeaf(T,I),z=this._addNode(E.min,E.max,M);M&&(w|=1<<_),A||(A=z)}for(let _=0;_<this._siblingOffset.length;_++)w&1<<_||this._construct(e,2*i+this._siblingOffset[_][0],2*a+this._siblingOffset[_][1],d,A+_)}}function ib(r,e,i,a,c,l){return Kt(Kt(r,i,l),Kt(e,a,l),c)}function Xd(r,e,i){const a=i.dim,c=Di(r*a-.5,0,a-1),l=Di(e*a-.5,0,a-1),d=Math.floor(c),y=Math.floor(l),w=Math.min(d+1,a-1),A=Math.min(y+1,a-1);return ib(i.get(d,y),i.get(w,y),i.get(d,A),i.get(w,A),c-d,l-y)}const b2={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function w2(r,e,i){return(256*r*256+256*e+i)/10-1e4}function T2(r,e,i){return 256*r+e+i/256-32768}class yy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Pn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const l=this.dim=i.height-2,d=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let w=0;w<l;w++)d[this._idx(-1,w)]=d[this._idx(0,w)],d[this._idx(l,w)]=d[this._idx(l-1,w)],d[this._idx(w,-1)]=d[this._idx(w,0)],d[this._idx(w,l)]=d[this._idx(w,l-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(l,-1)]=d[this._idx(l-1,0)],d[this._idx(-1,l)]=d[this._idx(0,l-1)],d[this._idx(l,l)]=d[this._idx(l-1,l-1)]}const y=a==="terrarium"?T2:w2;for(let w=0;w<d.length;++w){const A=4*w;this.floatView[w]=y(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=We.now()}_buildQuadTree(){this._tree=new tb(this)}get(e,i,a=!1){a&&(e=Di(e,-1,this.dim),i=Di(i,-1,this.dim));const c=this._idx(e,i);return this.floatView[c]}set(e,i,a){const c=this._idx(e,i),l=this.floatView[c];return this.floatView[c]=a,a-l}static getUnpackVector(e){return b2[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],c=yy.getUnpackVector(i);let l=Math.floor((e+c[3])/c[2]);return a[2]=l%256,l=Math.floor(l/256),a[1]=l%256,l=Math.floor(l/256),a[0]=l,a}getPixels(){return new dg({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,l=i*this.dim+this.dim,d=a*this.dim,y=a*this.dim+this.dim;switch(i){case-1:c=l-1;break;case 1:l=c+1}switch(a){case-1:d=y-1;break;case 1:y=d+1}const w=-i*this.dim,A=-a*this.dim;for(let _=d;_<y;_++)for(let T=c;T<l;T++){const I=4*this._idx(T,_),E=4*this._idx(T+w,_+A);this.pixels[I+0]=e.pixels[E+0],this.pixels[I+1]=e.pixels[E+1],this.pixels[I+2]=e.pixels[E+2],this.pixels[I+3]=e.pixels[E+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function S2(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push(function(a,c){return a.readFields(C2,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},c)}(i,i.readVarint()+i.pos))}function E2(r,e,i){r===1?(e.delta_filter=function(a,c){return a.readFields(A2,{blockSize:0},c)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function A2(r,e,i){r===1&&(e.blockSize=i.readVarint())}function M2(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function I2(r,e,i){let a=0,c=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push(function(l,d){return l.readFields(E2,{},d)}(i,i.readVarint()+i.pos)):r===4?e.codec=function(l,d){return l.readFields(M2,{},d)}(i,i.readVarint()+i.pos):r===5?c=i.readFloat():r===6?a=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=c),e.scale===0&&(e.scale=a)}function C2(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push(function(a,c){return a.readFields(I2,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)}(i,i.readVarint()+i.pos))}function R2(r,e,i){if(r===2)(function(a,c,l){a.readFields(D2,l,c)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function D2(r,e,i){if(r===1){let a=0;const c=i.readVarint()+i.pos;for(;i.pos<c;)e[a++]=i.readVarint()}}function z2(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){const c=a===1?1:0,l=a===2?1:0;for(let d=0;d<e[0];d++){const y=e[1]*d;for(let w=c;w<e[1];w++){const A=e[2]*(w+y);for(let _=l;_<e[2];_++){const T=e[3]*(_+A);for(let I=0;I<e[3];I++){const E=T+I;r[E]+=r[E-i]}}}}i*=e[a]}return r}function P2(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function O2(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const a=r[i],c=r[i+1];r[i]=(240&a)>>4|(61440&a)>>8|(240&c)<<4|61440&c,r[i+1]=15&a|(3840&a)>>4|(15&c)<<8|(3840&c)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const a=r[i],c=r[i+1],l=r[i+2],d=r[i+3];r[i+0]=(192&a)>>6|(192&c)>>4|(192&l)>>2|192&d,r[i+1]=(48&a)>>4|(48&c)>>2|48&l|(48&d)<<2,r[i+2]=(12&a)>>2|12&c|(12&l)<<2|(12&d)<<4,r[i+3]=3&a|(3&c)<<2|(3&l)<<4|(3&d)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ot(yy,"DEMData"),Ot(tb,"DemMinMaxQuadTree",{omit:["dem"]});var No=Uint8Array,N_=Uint16Array,L2=Int32Array,nb=new No([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),rb=new No([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),k2=new No([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sb=function(r,e){for(var i=new N_(31),a=0;a<31;++a)i[a]=e+=1<<r[a-1];var c=new L2(i[30]);for(a=1;a<30;++a)for(var l=i[a];l<i[a+1];++l)c[l]=l-i[a]<<5|a;return{b:i,r:c}},ab=sb(nb,2),ob=ab.b,B2=ab.r;ob[28]=258,B2[258]=28;for(var N2=sb(rb,0).b,lb=new N_(32768),Pr=0;Pr<32768;++Pr){var Im=(43690&Pr)>>1|(21845&Pr)<<1;lb[Pr]=((65280&(Im=(61680&(Im=(52428&Im)>>2|(13107&Im)<<2))>>4|(3855&Im)<<4))>>8|(255&Im)<<8)>>1}var F_=function(r,e,i){for(var a=r.length,c=0,l=new N_(e);c<a;++c)r[c]&&++l[r[c]-1];var d,y=new N_(e);for(c=1;c<e;++c)y[c]=y[c-1]+l[c-1]<<1;d=new N_(1<<e);var w=15-e;for(c=0;c<a;++c)if(r[c])for(var A=c<<4|r[c],_=e-r[c],T=y[r[c]-1]++<<_,I=T|(1<<_)-1;T<=I;++T)d[lb[T]>>w]=A;return d},U_=new No(288);for(Pr=0;Pr<144;++Pr)U_[Pr]=8;for(Pr=144;Pr<256;++Pr)U_[Pr]=9;for(Pr=256;Pr<280;++Pr)U_[Pr]=7;for(Pr=280;Pr<288;++Pr)U_[Pr]=8;var cb=new No(32);for(Pr=0;Pr<32;++Pr)cb[Pr]=5;var F2=F_(U_,9),U2=F_(cb,5),Zv=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},zc=function(r,e,i){var a=e/8|0;return(r[a]|r[a+1]<<8)>>(7&e)&i},$v=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},V2=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Pc=function(r,e,i){var a=new Error(e||V2[r]);if(a.code=r,Error.captureStackTrace&&Error.captureStackTrace(a,Pc),!i)throw a;return a},j2=new No(0),q2=typeof TextDecoder<"u"&&new TextDecoder;try{q2.decode(j2,{stream:!0})}catch{}const G2={gzip_data:"gzip"};class Dl extends Error{constructor(e){super(e),this.name="MRTError"}}const H2={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ub={uint32:1,uint16:2,uint8:4},Z2={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Xv;class vy{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Dl(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new Dl("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new Dl(`Expected header with length >= ${a} but got buffer of length ${i.length}`);const c=function(l,d){return l.readFields(S2,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Xv(i.subarray(0,a)));if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new Dl(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const l of c.layers)this.layers[l.name]=new hb(l,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],a=this.getLayer(e.layerName);for(let c of e.blockIndices){const l=a.dataIndex[c],d=l.firstByte-e.firstByte,y=l.lastByte-e.firstByte;if(a._blocksInProgress.has(c))continue;const w={layerName:a.name,firstByte:d,lastByte:y,pixelFormat:a.pixelFormat,blockIndex:c,blockShape:[l.bands.length].concat(a.bandShape),buffer:a.buffer,codec:l.codec.codec,filters:l.filters.map(A=>A.filter)};a._blocksInProgress.add(c),i.push(w)}return new db(i,()=>{i.forEach(c=>a._blocksInProgress.delete(c.blockIndex))},(c,l)=>{if(i.forEach(d=>a._blocksInProgress.delete(d.blockIndex)),c)throw c;l.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class hb{constructor({version:e,name:i,units:a,tileSize:c,pixelFormat:l,buffer:d,dataIndex:y},w){if(this.version=e,this.version!==1)throw new Dl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=c,this.buffer=d,this.pixelFormat=H2[l],this.dataIndex=y,this.bandShape=[c+2*d,c+2*d,ub[this.pixelFormat]],this._decodedBlocks=new gy(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return ub[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[a,c]of this.dataIndex.entries()){for(const[l,d]of c.bands.entries())if(d===e)return{bandIndex:i+l,blockIndex:a,blockBandIndex:l};i+=c.bands.length}break;case"number":for(const[a,c]of this.dataIndex.entries()){if(e>=i&&e<i+c.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=c.bands.length}break;default:throw new Dl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,a=-1/0;const c=[],l=new Set;for(const d of e){const{blockIndex:y}=this.getBlockForBand(d);if(y<0)throw new Dl(`Invalid band: ${JSON.stringify(d)}`);const w=this.dataIndex[y];c.includes(y)||c.push(y),l.add(y),i=Math.min(i,w.firstByte),a=Math.max(a,w.lastByte)}if(l.size>this.cacheSize)throw new Dl(`Number of blocks to decode (${l.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:a,blockIndices:c}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e);if(i<0)throw new Dl(`Band not found: ${JSON.stringify(e)}`);const c=this._decodedBlocks.get(i.toString());if(!c)throw new Dl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const l=this.dataIndex[i],d=this.bandShape.reduce((A,_)=>A*_,1),y=a*d,w=c.subarray(y,y+d);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:l.offset,scale:l.scale}}}vy.setPbf=function(r){Xv=r};class db{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}vy.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map(a=>{const{layerName:c,firstByte:l,lastByte:d,pixelFormat:y,blockShape:w,blockIndex:A,filters:_,codec:T}=a,I=i.subarray(l,d+1),E=new Uint32Array(w[0]*w[1]*w[2]);let M;if(T!=="gzip_data")throw new Dl(`Unhandled codec: ${T}`);return M=function(z,B){if(!globalThis.DecompressionStream&&B==="gzip_data")return Promise.resolve(((j=function(Q){Q[0]==31&&Q[1]==139&&Q[2]==8||Pc(6,"invalid gzip data");var le=Q[3],se=10;4&le&&(se+=2+(Q[10]|Q[11]<<8));for(var ae=(le>>3&1)+(le>>4&1);ae>0;ae-=!Q[se++]);return se+(2&le)}(G=z))+8>G.length&&Pc(6,"invalid gzip data"),function(Q,le,se,ae){var be=Q.length;if(!be||le.f&&!le.l)return se||new No(0);var he=!se,Te=he||le.i!=2,Ie=le.i;he&&(se=new No(3*be));var Me,ze,De=function(Yd){var Kd=se.length;if(Yd>Kd){var rp=new No(Math.max(2*Kd,Yd));rp.set(se),se=rp}},Ne=le.f||0,ke=le.p||0,Ue=le.b||0,lt=le.l,ot=le.d,Nt=le.m,mt=le.n,xt=8*be;do{if(!lt){Ne=zc(Q,ke,1);var ut=zc(Q,ke+1,3);if(ke+=3,!ut){var ti=Q[(gi=4+((ke+7)/8|0))-4]|Q[gi-3]<<8,zt=gi+ti;if(zt>be){Ie&&Pc(0);break}Te&&De(Ue+ti),se.set(Q.subarray(gi,zt),Ue),le.b=Ue+=ti,le.p=ke=8*zt,le.f=Ne;continue}if(ut==1)lt=F2,ot=U2,Nt=9,mt=5;else if(ut==2){var Zt=zc(Q,ke,31)+257,pi=zc(Q,ke+10,15)+4,Ci=Zt+zc(Q,ke+5,31)+1;ke+=14;for(var yi=new No(Ci),Bi=new No(19),Mi=0;Mi<pi;++Mi)Bi[k2[Mi]]=zc(Q,ke+3*Mi,7);ke+=3*pi;var ji=Zv(Bi),ln=(1<<ji)-1,Dn=F_(Bi,ji);for(Mi=0;Mi<Ci;){var gi,Yi=Dn[zc(Q,ke,ln)];if(ke+=15&Yi,(gi=Yi>>4)<16)yi[Mi++]=gi;else{var Fn=0,$n=0;for(gi==16?($n=3+zc(Q,ke,3),ke+=2,Fn=yi[Mi-1]):gi==17?($n=3+zc(Q,ke,7),ke+=3):gi==18&&($n=11+zc(Q,ke,127),ke+=7);$n--;)yi[Mi++]=Fn}}var Jn=yi.subarray(0,Zt),tr=yi.subarray(Zt);Nt=Zv(Jn),mt=Zv(tr),lt=F_(Jn,Nt),ot=F_(tr,mt)}else Pc(1);if(ke>xt){Ie&&Pc(0);break}}Te&&De(Ue+131072);for(var In=(1<<Nt)-1,Yr=(1<<mt)-1,ra=ke;;ra=ke){var Sr=(Fn=lt[$v(Q,ke)&In])>>4;if((ke+=15&Fn)>xt){Ie&&Pc(0);break}if(Fn||Pc(2),Sr<256)se[Ue++]=Sr;else{if(Sr==256){ra=ke,lt=null;break}var Or=Sr-254;Sr>264&&(Or=zc(Q,ke,(1<<(Fo=nb[Mi=Sr-257]))-1)+ob[Mi],ke+=Fo);var Fs=ot[$v(Q,ke)&Yr],ds=Fs>>4;if(Fs||Pc(3),ke+=15&Fs,tr=N2[ds],ds>3){var Fo=rb[ds];tr+=$v(Q,ke)&(1<<Fo)-1,ke+=Fo}if(ke>xt){Ie&&Pc(0);break}Te&&De(Ue+131072);var Wd=Ue+Or;if(Ue<tr){var zl=0-tr,Lc=Math.min(tr,Wd);for(zl+Ue<0&&Pc(3);Ue<Lc;++Ue)se[Ue]=(void 0)[zl+Ue]}for(;Ue<Wd;++Ue)se[Ue]=se[Ue-tr]}}le.l=lt,le.p=ra,le.b=Ue,le.f=Ne,lt&&(Ne=1,le.m=Nt,le.d=ot,le.n=mt)}while(!Ne);return Ue!=se.length&&he?(Me=se,((ze=Ue)==null||ze>Me.length)&&(ze=Me.length),new No(Me.subarray(0,ze))):se.subarray(0,Ue)}(G.subarray(j,-8),{i:2},new No(((N=G)[(H=N.length)-4]|N[H-3]<<8|N[H-2]<<16|N[H-1]<<24)>>>0))));var N,H,G,j;const $=G2[B];if(!$)throw new Error(`Unhandled codec: ${B}`);const W=new globalThis.DecompressionStream($);return new Response(new Blob([z]).stream().pipeThrough(W)).arrayBuffer().then(Q=>new Uint8Array(Q))}(I,T).then(z=>(function(B,N){B.readFields(R2,N)}(new Xv(z),E),new Z2[y](E.buffer))),M.then(z=>{for(let B=_.length-1;B>=0;B--)switch(_[B]){case"delta_filter":z2(z,w);break;case"zigzag_filter":P2(z);break;case"bitshuffle_filter":O2(z,y);break;default:throw new Dl(`Unhandled filter "${_[B]}"`)}return{layerName:c,blockIndex:A,data:z}}).catch(z=>{throw z})}))},Ot(db,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ot(vy,"MapboxRasterTile"),Ot(hb,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let V_,Wv,Oc,Cm,Yv,Rm=null;function fb(){return rs()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Wv||te.DRACO_URL}function pb(){if(rs()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Cm)return Cm;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Cm=WebAssembly.validate(r)?te.MESHOPT_SIMD_URL:te.MESHOPT_URL,Cm}const xy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},$2={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},j_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function mb(r,e,i){const a=i.json.bufferViews.length,c=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:c,byteLength:r.byteLength},i.buffers[c]=r}const Kv="KHR_draco_mesh_compression";function X2(r,e){const i=r.extensions&&r.extensions[Kv];if(!i)return;const a=new Oc.Decoder,c=vb(e,i.bufferView),l=new Oc.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,l))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[r.indices],y=xy[d.componentType],w=d.count*y.BYTES_PER_ELEMENT,A=Oc._malloc(w);y===Uint16Array?a.GetTrianglesUInt16Array(l,w,A):a.GetTrianglesUInt32Array(l,w,A),mb(Oc.memory.buffer.slice(A,A+w),d,e),Oc._free(A);for(const _ of Object.keys(i.attributes)){const T=a.GetAttributeByUniqueId(l,i.attributes[_]),I=e.json.accessors[r.attributes[_]],E=$2[I.componentType],M=I.count*j_[I.type]*xy[I.componentType].BYTES_PER_ELEMENT,z=Oc._malloc(M);a.GetAttributeDataArrayForAllPoints(l,T,Oc[E],M,z),mb(Oc.memory.buffer.slice(z,z+M),I,e),Oc._free(z)}a.destroy(),l.destroy(),delete r.extensions[Kv]}const by="EXT_meshopt_compression";function W2(r,e){if(!r.extensions||!r.extensions[by])return;const i=r.extensions[by],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),c=new Uint8Array(i.count*i.byteStride);Yv.decodeGltfBuffer(c,i.count,i.byteStride,a,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=c.buffer,delete r.extensions[by]}const _b=1179937895,gb=new TextDecoder("utf8");function yb(r,e){return new URL(r,e).href}function Y2(r,e,i,a){return fetch(yb(r.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[i]=c})}function vb(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function K2(r,e,i,a){if(r.uri){const c=yb(r.uri,a);return fetch(c).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[i]=l})}if(r.bufferView!==void 0){const c=vb(e,r.bufferView),l=new Blob([c],{type:r.mimeType});return createImageBitmap(l).then(d=>{e.images[i]=d})}}function xb(r,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===_b){const _=new Uint32Array(r,e);let T=2;const I=(_[T++]>>2)-3,E=_[T++]>>2;if(T++,a.json=JSON.parse(gb.decode(_.subarray(T,T+E))),T+=E,T<I){const M=_[T++];T++;const z=e+(T<<2);a.buffers[0]=r.slice(z,z+M)}}else a.json=JSON.parse(gb.decode(new Uint8Array(r,e)));const{buffers:c,images:l,meshes:d,extensionsUsed:y,bufferViews:w}=a.json;let A=Promise.resolve();if(c){const _=[];for(let T=0;T<c.length;T++){const I=c[T];I.uri?_.push(Y2(I,a,T,i)):a.buffers[T]||(a.buffers[T]=null)}A=Promise.all(_)}return A.then(()=>{const _=[],T=y&&y.includes(Kv),I=y&&y.includes(by);if(T&&_.push(function(){if(!Oc)return V_??(V_=function(E){let M,z=null;function B(){M=new Uint8Array(z.buffer)}function N(){throw new Error("Unexpected Draco error.")}const H={a:{a:N,d:function(G,j,$){return M.copyWithin(G,j,j+$)},c:function(G){const j=M.length,$=Math.max(G>>>0,Math.ceil(1.2*j)),W=Math.ceil(($-j)/65536);try{return z.grow(W),B(),!0}catch{return!1}},b:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,H):E.then(G=>G.arrayBuffer()).then(G=>WebAssembly.instantiate(G,H))).then(G=>{const{Rb:j,Qb:$,P:W,T:Q,X:le,Ja:se,La:ae,Qa:be,Va:he,Wa:Te,eb:Ie,jb:Me,f:ze,e:De,yb:Ne,zb:ke,Ab:Ue,Bb:lt,Db:ot,Gb:Nt}=G.instance.exports;z=De;const mt=(()=>{let xt=0,ut=0,ti=0,zt=0;return Zt=>{ti&&(j(zt),j(xt),ut+=ti,ti=xt=0),xt||(ut+=128,xt=$(ut));const pi=Zt.length+7&-8;let Ci=xt;pi>=ut&&(ti=pi,Ci=zt=$(pi));for(let yi=0;yi<Zt.length;yi++)M[Ci+yi]=Zt[yi];return Ci}})();return B(),ze(),{memory:De,_free:j,_malloc:$,Mesh:class{constructor(){this.ptr=W()}destroy(){Q(this.ptr)}},Decoder:class{constructor(){this.ptr=se()}destroy(){Me(this.ptr)}DecodeArrayToMesh(xt,ut,ti){const zt=mt(xt),Zt=ae(this.ptr,zt,ut,ti.ptr);return!!le(Zt)}GetAttributeByUniqueId(xt,ut){return{ptr:be(this.ptr,xt.ptr,ut)}}GetTrianglesUInt16Array(xt,ut,ti){he(this.ptr,xt.ptr,ut,ti)}GetTrianglesUInt32Array(xt,ut,ti){Te(this.ptr,xt.ptr,ut,ti)}GetAttributeDataArrayForAllPoints(xt,ut,ti,zt,Zt){Ie(this.ptr,xt.ptr,ut.ptr,ti,zt,Zt)}},DT_INT8:Ne(),DT_UINT8:ke(),DT_INT16:Ue(),DT_UINT16:lt(),DT_UINT32:ot(),DT_FLOAT32:Nt()}})}(fetch(fb())),V_.then(E=>{Oc=E,V_=void 0}))}()),I&&_.push(function(){if(Yv)return;const E=function(M){let z;const B=WebAssembly.instantiateStreaming(M,{}).then(G=>{z=G.instance,z.exports.__wasm_call_ctors()}),N={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},H={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(G,j,$,W,Q,le){(function(se,ae,be,he,Te,Ie,Me){const ze=se.exports.sbrk,De=he+3&-4,Ne=ze(De*Te),ke=ze(Ie.length),Ue=new Uint8Array(se.exports.memory.buffer);Ue.set(Ie,ke);const lt=ae(Ne,he,Te,ke,Ie.length);if(lt===0&&Me&&Me(Ne,De,Te),be.set(Ue.subarray(Ne,Ne+he*Te)),ze(Ne-ze(0)),lt!==0)throw new Error(`Malformed buffer data: ${lt}`)})(z,z.exports[H[Q]],G,j,$,W,z.exports[N[le]])}}}(fetch(pb()));return E.ready.then(()=>{Yv=E})}()),l)for(let E=0;E<l.length;E++)_.push(K2(l[E],a,E,i));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(T&&d)for(const{primitives:E}of d)for(const M of E)X2(M,a);if(I&&d&&w)for(const E of w)W2(E,a);return a})})}function np(r,e){const i=r.json.bufferViews[e.bufferView],a=xy[e.componentType];return new a(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==j_[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:j_[e.type]))}function Jv(r,e,i,a){const c=xy[e.componentType],l=function(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),d=r.json.bufferViews[e.bufferView],y=d.byteStride?d.byteStride/c.BYTES_PER_ELEMENT:j_[e.type],w=i.float32,A=w.length/i.capacity;for(let _=0,T=0;_<e.count*y;_+=y,T+=A)for(let I=0;I<A;I++)w[T+I]=a[_+I]*l;i._trim()}function J2(r,e,i){const a=r.indices,c=r.attributes,l={};l.indexArray=new Fr;const d=e.json.accessors[a],y=d.count/3;l.indexArray.reserve(y);const w=np(e,d);for(let I=0;I<y;I++)l.indexArray.emplaceBack(w[3*I],w[3*I+1],w[3*I+2]);l.indexArray._trim(),l.vertexArray=new $s;const A=e.json.accessors[c.POSITION];l.vertexArray.reserve(A.count);const _=np(e,A);for(let I=0;I<A.count;I++)l.vertexArray.emplaceBack(_[3*I],_[3*I+1],_[3*I+2]);if(l.vertexArray._trim(),l.aabb=new At(A.min,A.max),l.centroid=function(I,E){const M=[0,0,0],z=I.length;if(z>0){for(let B=0;B<z;B++){const N=3*I[B];M[0]+=E[N],M[1]+=E[N+1],M[2]+=E[N+2]}M[0]/=z,M[1]/=z,M[2]/=z}return M}(w,_),c.COLOR_0!==void 0){const I=e.json.accessors[c.COLOR_0],E=j_[I.type],M=np(e,I);l.colorArray=E===3?new $s:new vl,l.colorArray.resize(I.count),Jv(e,I,l.colorArray,M)}if(c.NORMAL!==void 0){l.normalArray=new $s;const I=e.json.accessors[c.NORMAL];l.normalArray.resize(I.count);const E=np(e,I);Jv(e,I,l.normalArray,E)}if(c.TEXCOORD_0!==void 0&&i.length>0){l.texcoordArray=new pc;const I=e.json.accessors[c.TEXCOORD_0];l.texcoordArray.resize(I.count);const E=np(e,I);Jv(e,I,l.texcoordArray,E)}if(c._FEATURE_ID_RGBA4444!==void 0){const I=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=np(e,I))}c._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(np(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const T=r.material;return l.material=function(I,E){const{emissiveFactor:M=[0,0,0],alphaMode:z="OPAQUE",alphaCutoff:B=.5,normalTexture:N,occlusionTexture:H,emissiveTexture:G,doubleSided:j}=I,{baseColorFactor:$=[1,1,1,1],metallicFactor:W=1,roughnessFactor:Q=1,baseColorTexture:le,metallicRoughnessTexture:se}=I.pbrMetallicRoughness||{},ae=H?E[H.index]:void 0;if(H&&H.extensions&&H.extensions.KHR_texture_transform&&ae){const be=H.extensions.KHR_texture_transform;ae.offsetScale=[be.offset[0],be.offset[1],be.scale[0],be.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new on(...$),metallicFactor:W,roughnessFactor:Q,baseColorTexture:le?E[le.index]:void 0,metallicRoughnessTexture:se?E[se.index]:void 0},doubleSided:j,emissiveFactor:M,alphaMode:z,alphaCutoff:B,normalTexture:N?E[N.index]:void 0,occlusionTexture:ae,emissionTexture:G?E[G.index]:void 0,defined:I.defined===void 0}}(T!==void 0?e.json.materials[T]:{defined:!1},i),l}function bb(r,e,i){const{matrix:a,rotation:c,translation:l,scale:d,mesh:y,extras:w,children:A}=r,_={};if(_.matrix=a||ue.mat4.fromRotationTranslationScale([],c||[0,0,0,1],l||[0,0,0],d||[1,1,1]),y!==void 0){_.meshes=i[y];const T=_.anchor=[0,0];for(const I of _.meshes){const{min:E,max:M}=I.aabb;T[0]+=E[0]+M[0],T[1]+=E[1]+M[1]}T[0]=Math.floor(T[0]/_.meshes.length/2),T[1]=Math.floor(T[1]/_.meshes.length/2)}if(w&&(w.id&&(_.id=w.id),w.lights&&(_.lights=function(T){if(!T.length)return[];const I=function(N){const H=atob(N),G=new Uint8Array(H.length);for(let j=0;j<H.length;j++)G[j]=H.codePointAt(j);return G}(T),E=[],M=I.length/24,z=new Uint16Array(I.buffer),B=new Float32Array(I.buffer);for(let N=0;N<M;N++){const H=z[2*N*6]/30,G=z[2*N*6+1]/30,j=z[2*N*6+10]/100,$=B[6*N+1],W=B[6*N+2],Q=B[6*N+3],le=B[6*N+4],se=Q-$,ae=le-W,be=Math.hypot(se,ae);E.push({pos:[$+.5*se,W+.5*ae,G],normal:[ae/be,-se/be,0],width:be,height:H,depth:j,points:[$,W,Q,le]})}return E}(w.lights))),A){const T=[];for(const I of A)T.push(bb(e.json.nodes[I],e,i));_.children=T}return _}function Q2(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Nf(r.vertices,r.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:a}}function eE(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const d of i){if(!Array.isArray(d)||d.length!==2)continue;const y=d[0],w=d[1];typeof y=="number"&&typeof w=="number"&&a.push(new Mt(y,w))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let d=0;d<a.length;d++){const y=a[d],w=a[(d+1)%a.length],A=a[(d+2)%a.length];c+=(y.x-w.x)*(A.y-w.y)-(A.x-w.x)*(y.y-w.y)}c>0&&a.reverse();const l=_u(a.flatMap(d=>[d.x,d.y]),[]);return l.length===0?null:{vertices:a,indices:l}}function tE(r,e){const i=[],a=[];let c=0;const l=[];for(const d of r){c=i.length;const y=d.vertexArray.float32,w=d.indexArray.uint16;for(let A=0;A<d.vertexArray.length;A++)l[0]=y[3*A+0],l[1]=y[3*A+1],l[2]=y[3*A+2],ue.vec3.transformMat4(l,l,e),i.push(new Mt(l[0],l[1]));for(let A=0;A<3*d.indexArray.length;A++)a.push(w[A]+c)}if(a.length%3!=0)return null;for(let d=0;d<a.length;d+=3){const y=i[a[d+0]],w=i[a[d+1]],A=i[a[d+2]];(y.x-w.x)*(A.y-w.y)-(A.x-w.x)*(y.y-w.y)>0&&([a[d+1],a[d+2]]=[a[d+2],a[d+1]])}return{vertices:i,indices:a}}function wb(r){const e=function(w,A){const _=[],T=WebGL2RenderingContext;if(w.json.textures)for(const I of w.json.textures){const E={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};I.sampler!==void 0&&Object.assign(E,w.json.samplers[I.sampler]),_.push({image:A[I.source],sampler:E,uploaded:!1})}return _}(r,r.images),i=function(w,A){const _=[];for(const T of w.json.meshes){const I=[];for(const E of T.primitives)I.push(J2(E,w,A));_.push(I)}return _}(r,e),{scenes:a,scene:c,nodes:l}=r.json,d=a?a[c||0].nodes:l,y=[];for(const w of d)y.push(bb(l[w],r,i));return function(w,A,_){const T={},I=new Set;for(let E=0;E<w.length;E++){const M=_[A[E]];if(!M.extras)continue;const z=M.extras["mapbox:footprint:version"],B=M.extras["mapbox:footprint:id"];(z||B)&&I.add(E),z==="1.0.0"&&B&&(T[B]=E)}for(let E=0;E<w.length;E++){if(I.has(E))continue;const M=w[E],z=_[A[E]];if(!z.extras)continue;let B=null;M.id in T&&(B=tE(w[T[M.id]].meshes,M.matrix)),B||(B=eE(z)),B&&(M.footprint=Q2(B))}if(I.size>0){const E=Array.from(I.values()).sort((M,z)=>M-z);for(let M=E.length-1;M>=0;M--)w.splice(E[M],1)}}(y,d,r.json.nodes),y}function iE(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,a=r.aabb.min[1]-1,c=ep/(r.aabb.max[0]-i+2),l=ep/(r.aabb.max[1]-a+2);for(let d=0;d<e.length;d+=3){const y=e[d+2],w=(e[d+0]-i)*c|0,A=(e[d+1]-a)*l|0;y>r.heightmap[A*ep+w]&&(r.heightmap[A*ep+w]=y)}}function nE(r,e){const i={};i.indexArray=new Fr,i.indexArray.reserve(4*r.length),i.vertexArray=new $s,i.vertexArray.reserve(10*r.length),i.colorArray=new vl,i.vertexArray.reserve(10*r.length);let a=0;for(const d of r){const y=Math.min(10,Math.max(4,1.3*d.height))*e,w=[-d.normal[1],d.normal[0],0],A=Math.min(.29,.1*d.width/d.depth),_=d.width-2*d.depth*e*(A+.01),T=ue.vec3.scaleAndAdd([],d.pos,w,_/2),I=ue.vec3.scaleAndAdd([],d.pos,w,-_/2),E=[T[0],T[1],T[2]+d.height],M=[I[0],I[1],I[2]+d.height],z=ue.vec3.scaleAndAdd([],d.normal,w,A);ue.vec3.scale(z,z,y);const B=ue.vec3.scaleAndAdd([],d.normal,w,-A);ue.vec3.scale(B,B,y),ue.vec3.add(z,T,z),ue.vec3.add(B,I,B),T[2]+=.1,I[2]+=.1,i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]);const N=_/y/2;i.colorArray.emplaceBack(-N-A,-1,N,.8),i.colorArray.emplaceBack(N+A,-1,N,.8),i.colorArray.emplaceBack(-N,0,N,1.3),i.colorArray.emplaceBack(N,0,N,1.3),i.colorArray.emplaceBack(N+A,-.8,N,.7),i.colorArray.emplaceBack(N+A,-.8,N,.7),i.colorArray.emplaceBack(0,0,N,1.3),i.colorArray.emplaceBack(0,0,N,1.3),i.colorArray.emplaceBack(N+A,-1.2,N,.8),i.colorArray.emplaceBack(N+A,-1.2,N,.8),i.indexArray.emplaceBack(6+a,4+a,8+a),i.indexArray.emplaceBack(7+a,9+a,5+a),i.indexArray.emplaceBack(0+a,1+a,2+a),i.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const c={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=on.white,c.pbrMetallicRoughness=l,i.material=c,i.aabb=new At([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class Tb{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const rE=["id","tile","layer","source","sourceLayer","state"];class Dm{constructor(e,i,a,c,l){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=c,this.properties=e.properties,this.id=l}clone(){const e=new Dm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of rE)this[i]!==void 0&&(e[i]=this[i]);return e}}class Sb{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new sc(vt,16,0),this.featureIndexArray=new ts,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,a,c,l,d=0,y=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,l,d);const A=this.grid;for(let _=0;_<i.length;_++){const T=i[_],I=[1/0,1/0,-1/0,-1/0];for(let E=0;E<T.length;E++){const M=T[E];I[0]=Math.min(I[0],M.x),I[1]=Math.min(I[1],M.y),I[2]=Math.max(I[2],M.x),I[3]=Math.max(I[3],M.y)}y!==0&&(I[0]-=y,I[1]-=y,I[2]+=y,I[3]+=y),I[0]<vt&&I[1]<vt&&I[2]>=0&&I[3]>=0&&A.insert(w,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Sc.VectorTile(new Bt(this.rawTileData)).layers,this.sourceLayerCoder=new Tb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:a,transform:c,tileTransform:l,pixelPosMatrix:d,availableImages:y}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const w=a.bufferedTilespaceBounds,A=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(E,M,z,B)=>ye(a.bufferedTilespaceGeometry,E,M,z,B));A.sort(sE);let _=null;c.elevation&&A.length>0&&(_=Sm.create(c.elevation,this.tileID));const T={};let I;for(let E=0;E<A.length;E++){const M=A[E];if(M===I)continue;I=M;const z=this.featureIndexArray.get(M);let B=null;this.is3DTile?this.loadMatchingModelFeature(T,z,e,a,c):this.loadMatchingFeature(T,z,e,y,(N,H,G,j=0)=>(B||(B=O(N,this.tileID.canonical,l)),H.queryIntersectsFeature(a,N,G,B,this.z,c,d,_,j)))}return T}loadMatchingFeature(e,i,a,c,l){const{featureIndex:d,bucketIndex:y,sourceLayerIndex:w,layoutVertexArrayOffset:A}=i,_=this.bucketLayerIDs[y],T=a.layers,I=Object.keys(T);if(I.length&&!function(N,H){for(let G=0;G<N.length;G++)if(H.indexOf(N[G])>=0)return!0;return!1}(I,_))return;const E=a.sourceCache,M=this.sourceLayerCoder.decode(w),z=this.vtLayers[M].feature(d),B=this.getId(z,M);for(let N=0;N<_.length;N++){const H=_[N];if(!T[H])continue;const{styleLayer:G,targets:j}=T[H];let $={};B!==void 0&&($=E.getFeatureState(G.sourceLayer,B));const W=!l||l(z,G,$,A);if(!W)continue;const Q=new Dm(z,this.z,this.x,this.y,B);Q.tile=this.tileID.canonical,Q.state=$;let le=this.serializedLayersCache.get(H);le||(le=G.serialize(),le.id=H,this.serializedLayersCache.set(H,le)),Q.source=le.source,Q.sourceLayer=le["source-layer"],Q.layer=fr({},le),Q.layer.paint=Eb(le.paint,G.paint,z,$,c),Q.layer.layout=Eb(le.layout,G.layout,z,$,c);let se=!1;for(const ae of j){this.updateFeatureProperties(Q,ae);const{filter:be}=ae;if(be){if(z.properties=Q.properties,be.needGeometry){const he=k(z,!0);if(!be.filter(new hn(this.tileID.overscaledZ),he,this.tileID.canonical))continue}else if(!be.filter(new hn(this.tileID.overscaledZ),z))continue}se=!0,ae.targetId&&this.addFeatureVariant(Q,ae)}se&&this.appendToResult(e,H,d,Q,W)}}loadMatchingModelFeature(e,i,a,c,l){const d=this.bucketLayerIDs[0][0],y=a.layers;if(!y[d])return;const{styleLayer:w,targets:A}=y[d];if(w.type!=="model")return;const _=c.tile,T=i.featureIndex,I=_.getBucket(w);if(!(I&&I instanceof uy))return;const E=function(le,se,ae,be){const he=le.getNodesInfo()[se];if(he.hiddenByReplacement||!he.node.meshes)return;let Te=Number.MAX_VALUE;const Ie=he.node,Me=ae.tile,ze=be.calculatePosMatrix(Me.tileID.toUnwrapped(),be.worldSize),De=he.evaluatedScale;let Ne=0;be.elevation&&Ie.elevation&&(Ne=Ie.elevation*be.elevation.exaggeration()),ue.mat4.translate(ze,ze,[(Ie.anchor?Ie.anchor[0]:0)*(De[0]-1),(Ie.anchor?Ie.anchor[1]:0)*(De[1]-1),Ne]),ue.mat4.scale(ze,ze,De);const ke=ae.queryGeometry,Ue=ke.isPointQuery()?ke.screenBounds:ke.screenGeometry,lt=function(Nt){const mt=ue.mat4.multiply([],ze,Nt.matrix);ue.mat4.multiply(mt,be.expandedFarZProjMatrix,mt);for(let xt=0;xt<Nt.meshes.length;++xt){const ut=Nt.meshes[xt];if(xt===Nt.lightMeshIndex)continue;const ti=w1(Ue,be,mt,ut.aabb);ti!=null&&(Te=Math.min(ti,Te))}if(Nt.children)for(const xt of Nt.children)lt(xt)};if(lt(Ie),Te===Number.MAX_VALUE)return;const ot=new rn(0,0);return O1(Me.tileID.canonical,ot,he.node.anchor[0],he.node.anchor[1]),{intersectionZ:Te,position:ot,feature:he.feature}}(I,T,c,l);if(!E)return;const{z:M,x:z,y:B}=_.tileID.canonical,{feature:N,intersectionZ:H,position:G}=E;let j={};N.id!==void 0&&(j=a.sourceCache.getFeatureState(w.sourceLayer,N.id));const $=new Dm({},M,z,B,N.id);$.tile=this.tileID.canonical,$.state=j,$.properties=N.properties,$.geometry={type:"Point",coordinates:[G.lng,G.lat]};let W=this.serializedLayersCache.get(d);W||(W=w.serialize(),W.id=d,this.serializedLayersCache.set(d,W)),$.source=W.source,$.sourceLayer=W["source-layer"],$.layer=fr({},W);let Q=!1;for(const le of A){this.updateFeatureProperties($,le);const{filter:se}=le;if(se){if(N.properties=$.properties,se.needGeometry){if(!se.filter(new hn(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!se.filter(new hn(this.tileID.overscaledZ),N))continue}Q=!0,le.targetId&&this.addFeatureVariant($,le)}Q&&this.appendToResult(e,d,T,$,H)}updateFeatureProperties(e,i,a){if(i.properties){const c={};for(const l in i.properties){const d=i.properties[l].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);d!=null&&(c[l]=d)}e.properties=c}}addFeatureVariant(e,i,a){const c={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(c.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(c)}appendToResult(e,i,a,c,l){let d=e[i];d===void 0&&(d=e[i]=[]),d.push({featureIndex:a,feature:c,intersectionZ:l})}lookupSymbolFeatures(e,i,a,c,l){const d={};this.loadVTLayers();for(const y of e)this.loadMatchingFeature(d,{bucketIndex:i,sourceLayerIndex:a,featureIndex:y,layoutVertexArrayOffset:0},c,l);return d}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(a),l=this.vtFeatures[c];if(l[i])return l[i];const d=this.vtLayers[c].feature(i);return l[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const c=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(c!=null)if(Array.isArray(c)){if(!this.promoteIdExpression){const l=rc(c);if(l.result!=="success"){const d=l.value.map(y=>`${y.key}: ${y.message}`).join(", ");return void Pn(`Failed to create expression for promoteId: ${d}`)}this.promoteIdExpression=l.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Fh),a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[c];typeof a=="boolean"&&(a=Number(a))}return a}}function Eb(r,e,i,a,c){return Ya(r,(l,d)=>{const y=e instanceof uc?e.get(d):null;return y&&y.evaluate?y.evaluate(i,a,c):y})}function sE(r,e){return e-r}Ot(Sb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Ab=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Qv{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const l=Ab[15&a];if(!l)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Qv(y,d,l,e)}constructor(e,i=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=Ab.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-y%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+y+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return e0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:y}=this,w=[0,l.length-1,0],A=[];for(;w.length;){const _=w.pop()||0,T=w.pop()||0,I=w.pop()||0;if(T-I<=y){for(let B=I;B<=T;B++){const N=d[2*B],H=d[2*B+1];N>=e&&N<=a&&H>=i&&H<=c&&A.push(l[B])}continue}const E=I+T>>1,M=d[2*E],z=d[2*E+1];M>=e&&M<=a&&z>=i&&z<=c&&A.push(l[E]),(_===0?e<=M:i<=z)&&(w.push(I),w.push(E-1),w.push(1-_)),(_===0?a>=M:c>=z)&&(w.push(E+1),w.push(T),w.push(1-_))}return A}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:l,nodeSize:d}=this,y=[0,c.length-1,0],w=[],A=a*a;for(;y.length;){const _=y.pop()||0,T=y.pop()||0,I=y.pop()||0;if(T-I<=d){for(let B=I;B<=T;B++)Ib(l[2*B],l[2*B+1],e,i)<=A&&w.push(c[B]);continue}const E=I+T>>1,M=l[2*E],z=l[2*E+1];Ib(M,z,e,i)<=A&&w.push(c[E]),(_===0?e-a<=M:i-a<=z)&&(y.push(I),y.push(E-1),y.push(1-_)),(_===0?e+a>=M:i+a>=z)&&(y.push(E+1),y.push(T),y.push(1-_))}return w}}function e0(r,e,i,a,c,l){if(c-a<=i)return;const d=a+c>>1;Mb(r,e,d,a,c,l),e0(r,e,i,a,d-1,1-l),e0(r,e,i,d+1,c,1-l)}function Mb(r,e,i,a,c,l){for(;c>a;){if(c-a>600){const A=c-a+1,_=i-a+1,T=Math.log(A),I=.5*Math.exp(2*T/3),E=.5*Math.sqrt(T*I*(A-I)/A)*(_-A/2<0?-1:1);Mb(r,e,i,Math.max(a,Math.floor(i-_*I/A+E)),Math.min(c,Math.floor(i+(A-_)*I/A+E)),l)}const d=e[2*i+l];let y=a,w=c;for(q_(r,e,a,i),e[2*c+l]>d&&q_(r,e,a,c);y<w;){for(q_(r,e,y,w),y++,w--;e[2*y+l]<d;)y++;for(;e[2*w+l]>d;)w--}e[2*a+l]===d?q_(r,e,a,w):(w++,q_(r,e,w,c)),w<=i&&(a=w+1),i<=w&&(c=w-1)}}function q_(r,e,i,a){t0(r,i,a),t0(e,2*i,2*a),t0(e,2*i+1,2*a+1)}function t0(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}function Ib(r,e,i,a){const c=r-i,l=e-a;return c*c+l*l}s.$=ms,s.A=Ms,s.B=Ja,s.C=gl,s.D=Em,s.E=la,s.F=2,s.G=E_,s.H=Lx,s.I=as,s.J=class extends ly{},s.K=xo,s.L=Hi,s.M=Os,s.N=vf,s.O=ic,s.P=Mt,s.Q=Cp,s.R=nr,s.S=id,s.T=zv,s.U=gr,s.V=ly,s.W=tu,s.X=rc,s.Y=Wc,s.Z=Br,s._=_s,s.a=function(r){return te.API_CDN_URL_REGEX.test(r)},s.a$=k,s.a0=Is,s.a1=ch,s.a2=br,s.a3=Jh,s.a4=function(r){const e=r.value;let i=[];if(!e)return i;const a=xo(e);return a!=="string"?(i=i.concat([new ly(r.key,e,`string expected, "${a}" found`)]),i):(S1(e,!0)||(i=i.concat([new ly(r.key,e,`invalid url "${e}"`)])),i)},s.a5=Fe,s.a6=dl,s.a7=Bn,s.a8=yt,s.a9=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Bl(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Kt(r.x,e.x,i),y:Kt(r.y,e.y,i),z:Kt(r.z,e.z,i),azimuthal:Kt(r.azimuthal,e.azimuthal,i),polar:Kt(r.polar,e.polar,i)}}},s.aA=function(r,e){const i={};for(let a=0;a<e.length;a++){const c=e[a];c in r&&(i[c]=r[c])}return i},s.aB=vs,s.aC=Zr,s.aD=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,a){const c=this.entries[r]=this.entries[r]||{callbacks:[]};if(c.result){const[l,d]=c.result;return this.scheduler?this.scheduler.add(()=>{a(l,d)},e):a(l,d),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=i((l,d)=>{c.result=[l,d];for(const y of c.callbacks)this.scheduler?this.scheduler.add(()=>{y(l,d)},e):y(l,d);setTimeout(()=>delete this.entries[r],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(l=>l!==a),c.callbacks.length||(c.cancel(),delete this.entries[r]))}}},s.aE=function(r,e,i){const a=JSON.stringify(r.request);return r.data&&(this.deduped.entries[a]={result:[null,r.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},c=>{const l=Ca(r.request,(d,y,w,A)=>{d?c(d):y&&c(null,{vectorTile:i?void 0:new Sc.VectorTile(new Bt(y)),rawData:y,cacheControl:w,expires:A})});return()=>{l.cancel(),c()}},e)},s.aF=function(r){cn++,cn>ai&&(r.getActor().send("enforceCacheSizeLimit",fi),cn=0)},s.aG=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},s.aH=rt,s.aI=h1,s.aJ=g1,s.aK=u1,s.aL=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<r.length;a++){const c=document.createElement("source");Vs(r[a])||(i.crossOrigin="Anonymous"),c.src=r[a],i.appendChild(c)}return{cancel:()=>{}}},s.aM=ny,s.aN=function(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>xb(e,0,r))},s.aO=wb,s.aP=class{constructor(r,e,i,a){this.id=r,this.position=e!=null?new rn(e[0],e[1]):new rn(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new At([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,e){if(ue.mat4.multiply(r.matrix,e,r.matrix),r.meshes)for(const i of r.meshes){const a=At.applyTransformFast(i.aabb,r.matrix);this.aabb.encapsulate(a)}if(r.children)for(const i of r.children)this._applyTransformations(i,r.matrix)}computeBoundsAndApplyParent(){const r=ue.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,r)}computeModelMatrix(r,e,i,a,c,l,d=!1){C1(this.matrix,this,r.transform,this.position,e,i,a,c,l,d)}upload(r){if(!this.uploaded){for(const e of this.nodes)Bv(e,r);for(const e of this.nodes)cy(e);this.uploaded=!0}}destroy(){for(const r of this.nodes)Nv(r)}},s.aQ=Du,s.aR=M_,s.aS=ns,s.aT=yn,s.aU=lo,s.aV=Fr,s.aW=Wa,s.aX=uu,s.aY=ty,s.aZ=function(){cs.isLoading()||cs.isLoaded()||_r()!=="deferred"||lh()},s.a_=hc,s.aa=hn,s.ab=ol,s.ac=t,s.ad=ue,s.ae=As,s.af=uc,s.ag=wr,s.ah=Kt,s.ai=vt,s.aj=Ul,s.ak=Gi,s.al=on,s.am=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([i,a]){const c=Bl([1,i,a]);return{x:c.x,y:c.y,z:c.z}}(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Kt(r.x,e.x,i),y:Kt(r.y,e.y,i),z:Kt(r.z,e.z,i)}}},s.an=function(r,e,i=0,a=!0){const c=new Mt(i,i),l=r.sub(c),d=e.add(c),y=[l,new Mt(d.x,l.y),d,new Mt(l.x,d.y)];return a&&y.push(l.clone()),y},s.ao=function(r,e){const i=[];for(let a=0;a<r.length;a++){const c=aa(a-1,-1,r.length-1),l=aa(a+1,-1,r.length-1),d=r[a],y=r[l],w=r[c].sub(d).unit(),A=y.sub(d).unit(),_=A.angleWithSep(w.x,w.y),T=w.add(A).unit().mult(-1*e/Math.sin(_/2));i.push(d.add(T))}return i},s.ap=Yx,s.aq=ye,s.ar=function(r,e,i=0){return ue.vec3.fromValues(((e.x-i)*r.scale-r.x)*vt,(e.y*r.scale-r.y)*vt,zf(e.z,e.y))},s.as=li,s.at=fm,s.au=function(r){let e=1/0,i=1/0,a=-1/0,c=-1/0;for(const l of r)e=Math.min(e,l.x),i=Math.min(i,l.y),a=Math.max(a,l.x),c=Math.max(c,l.y);return{min:new Mt(e,i),max:new Mt(a,c)}},s.av=is,s.aw=ge,s.ax=u,s.ay=Di,s.az=us,s.b=function(r){return te.API_FONTS_REGEX.test(r)},s.b$=ay,s.b0=Dm,s.b1=Ia,s.b2=b_,s.b3=Od,s.b4=O,s.b5=oo,s.b6=wd,s.b7=Qt,s.b8=dn,s.b9=_u,s.bA=f_,s.bB=wv,s.bC=qx,s.bD=S_,s.bE=Qv,s.bF=aa,s.bG=Nl,s.bH=Cr,s.bI=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},s.bJ=du,s.bK=ia,s.bL=xa,s.bM=Qn,s.bN=gc,s.bO=rn,s.bP=t1,s.bQ=Ge,s.bR=Ht,s.bS=v1,s.bT=st,s.bU=Xr,s.bV=function(r,e,i,a,c,l,d,y,w){if(w.name==="globe")return Xr(r,e,new st(i,a,c),!1);const A=M_({z:i,x:a,y:c},w);return new At([(l+A.x/A.scale)*e,e*(A.y/A.scale),d],[(l+A.x2/A.scale)*e,e*(A.y2/A.scale),y])},s.bW=function(r,e,i){let a=0;for(let c=0;c<2;++c)r[c]>0&&(a+=(r[c]-0)*(r[c]-0)),e[c]<0&&(a+=(0-e[c])*(0-e[c]));return a},s.bX=Ns,s.bY=Rf,s.bZ=function(r){const e=ue.mat4.identity(new Float64Array(16));ue.mat4.multiply(e,r.pixelMatrix,r.globeMatrix);const i=[0,Xs,0],a=[0,Bs,0];return ue.vec3.transformMat4(i,i,e),ue.vec3.transformMat4(a,a,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!Wr(r,new rn(r.center.lat,90)),a[0]>0&&a[0]<=r.width&&a[1]>0&&a[1]<=r.height&&!Wr(r,new rn(r.center.lat,-90))]},s.b_=function(r,e){const{scale:i}=r.tileTransform,a=i*vt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return ue.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},s.ba=Cv,s.bb=function(r,e){const i=wr(e.zoom);if(i===0)return fn(r);const a=Ri(r),c=Sn(a),l=is(a.getWest())*e.worldSize,d=is(a.getEast())*e.worldSize,y=Zr(a.getNorth())*e.worldSize,w=Zr(a.getSouth())*e.worldSize,A=[l,y,0],_=[d,y,0],T=[l,w,0],I=[d,w,0],E=ue.mat4.invert([],e.globeMatrix);return ue.vec3.transformMat4(A,A,E),ue.vec3.transformMat4(_,_,E),ue.vec3.transformMat4(T,T,E),ue.vec3.transformMat4(I,I,E),c[0]=Wn(c[0],T,i),c[1]=Wn(c[1],I,i),c[2]=Wn(c[2],_,i),c[3]=Wn(c[3],A,i),At.fromPoints(c)},s.bc=Rn,s.bd=Wi,s.be=Wn,s.bf=dc,s.bg=di,s.bh=vy,s.bi=Bt,s.bj=Ca,s.bk=function(r,e){const i=[];for(const a in r)a in e||i.push(a);return i},s.bl=qr,s.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bn=Aa,s.bo=function(r,e){const{x:i,y:a}=r.point,c=Yn(i,a,r.worldSize/r._pixelsPerMercatorPixel,0,0);return ue.mat4.multiply(c,c,ar(fn(e)))},s.bp=Cc,s.bq=it,s.br=ym,s.bs=function(r,e,i,a,c){const l=5*e+2;r.float32[l+0]=i,r.float32[l+1]=a,r.float32[l+2]=c},s.bt=ey,s.bu=Ox,s.bv=Y,s.bw=Tr,s.bx=Cg,s.by=T1,s.bz=Va,s.c=me,s.c$=Mc,s.c0=y1,s.c1=function(r){const e=y1(r,!0);return ue.mat2.invert([],[e[0],e[1],e[4],e[5]])},s.c2=Ui,s.c3=function(r){const{x:e,y:i}=r.point,{lng:a,lat:c}=r._center;return Yn(e,i,r.worldSize,a,c)},s.c4=Er,s.c5=St,s.c6=xc,s.c7=function(r){const e=Math.round((r+45+360)%360/90)%4;return Ma[e]},s.c8=45,s.c9=df,s.cA=If,s.cB=class extends va{constructor(r){super(r),this.current=fu}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.cC=Xa,s.cD=function(r,e,i){const a=wr(i.zoom),c=r.style.map._antialias,l=r.terrain&&r.terrain.exaggeration()>0;return a===0&&!c&&!l},s.cE=function(r){const e=r.pixelsPerMeter,i=e/Cr(1,r.center.lat),a=ue.mat4.identity(new Float64Array(16));return ue.mat4.translate(a,a,[r.point.x,r.point.y,0]),ue.mat4.scale(a,a,[i,i,e]),Float32Array.from(a)},s.cF=Ri,s.cG=function(r){const e=Ns-5;r=Di(r,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Gi(r))),3);return Math.round(i*(mu.length-1))},s.cH=function(r,e,i,a){const c=e.getNorth(),l=e.getSouth(),d=e.getWest(),y=e.getEast(),w=1<<r.z,A=y-d,_=c-l,T=A/El,I=-_/mu[i],E=[0,T,0,I,0,0,c,d,0];if(r.z>0){const M=180/a;ue.mat3.multiply(E,E,[M/A+1,0,0,0,M/_+1,0,-.5*M/T,.5*M/I,1])}return E[2]=w,E[5]=r.x,E[8]=r.y,E},s.cI=fn,s.cJ=function(r,e,i){const a=ue.mat4.identity(new Float64Array(16)),c=(e/(1<<r)-.5)*Math.PI*2;return ue.mat4.rotateY(a,i.globeMatrix,c),Float32Array.from(a)},s.cK=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,c=Math.floor(r.x),l=Math.floor((r.x-c)*a),d=Math.floor(r.y*a),y=this.findDEMTileFor(new rt(i,c,i,l,d));return!(!y||!y.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||r.y<0||r.y>1)return e;const c=a.getSource().maxzoom,l=1<<c,d=Math.floor(r.x),y=r.x-d,w=new rt(c,d,c,Math.floor(y*l),Math.floor(r.y*l)),A=this.findDEMTileFor(w);if(!A||!A.dem)return e;const _=A.dem,T=1<<A.tileID.canonical.z,I=(y*T-A.tileID.canonical.x)*_.dim,E=(r.y*T-A.tileID.canonical.y)*_.dim,M=Math.floor(I),z=Math.floor(E);return(i?this.exaggeration():1)*Kt(Kt(_.get(M,z),_.get(M,z+1),E-z),Kt(_.get(M+1,z),_.get(M+1,z+1),E-z),I-M)}getAtTileOffset(r,e,i){const a=1<<r.canonical.z;return this.getAtPointOrZero(new t(r.wrap+(r.canonical.x+e/vt)/a,(r.canonical.y+i/vt)/a))}getAtTileOffsetFunc(r,e,i,a){return c=>{const l=this.getAtTileOffset(r,c.x,c.y),d=a.upVector(r.canonical,c.x,c.y),y=a.upVectorScale(r.canonical,e,i).metersToTile;return ue.vec3.scale(d,d,l*y),d}}getForTilePoints(r,e,i,a){if(this.isUsingMockSource())return!1;const c=Sm.create(this,r,a);return!!c&&(e.forEach(l=>{l[2]=this.exaggeration()*c.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,c=1<<r.canonical.z-a.canonical.z;let l=r.canonical.x/c-a.canonical.x,d=r.canonical.y/c-a.canonical.y,y=0;for(let w=0;w<r.canonical.z-a.canonical.z&&!i.leaves[y];w++){l*=2,d*=2;const A=2*Math.floor(d)+Math.floor(l);y=i.childOffsets[y]+A,l%=1,d%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const c of r){const l=this.getMinMaxForTile(c.tileID);l&&(i=Math.min(i,l.min),a=Math.max(a,l.max),e=!0)}return e?{min:i,max:a}:null}},s.cL=dg,s.cM=Ei,s.cN=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},s.cO=Dr,s.cP=Ye,s.cQ=Fl,s.cR=256,s.cS=function(r,e){const i=[0,0,0],a=Rn(fn(e.canonical));return ue.vec3.transformMat4(i,i,a),ue.vec3.transformMat4(i,i,r),i},s.cT=r=>({u_camera_to_center_distance:new Qn(r),u_extrude_scale:new bh(r),u_device_pixel_ratio:new Qn(r),u_matrix:new du(r),u_inv_rot_matrix:new du(r),u_merc_center:new ia(r),u_tile_id:new xa(r),u_zoom_transition:new Qn(r),u_up_dir:new xa(r),u_emissive_strength:new Qn(r)}),s.cU=r=>({u_matrix:new du(r),u_pixels_to_tile_units:new bh(r),u_device_pixel_ratio:new Qn(r),u_width_scale:new Qn(r),u_floor_width_scale:new Qn(r),u_units_to_pixels:new ia(r),u_dash_image:new gc(r),u_gradient_image:new gc(r),u_image_height:new Qn(r),u_texsize:new ia(r),u_tile_units_to_pixels:new Qn(r),u_alpha_discard_threshold:new Qn(r),u_trim_offset:new ia(r),u_trim_fade_range:new ia(r),u_trim_color:new Tl(r),u_emissive_strength:new Qn(r),u_zbias_factor:new Qn(r),u_tile_to_meter:new Qn(r)}),s.cV=r=>({u_matrix:new du(r),u_texsize:new ia(r),u_pixels_to_tile_units:new bh(r),u_device_pixel_ratio:new Qn(r),u_width_scale:new Qn(r),u_floor_width_scale:new Qn(r),u_image:new gc(r),u_units_to_pixels:new ia(r),u_tile_units_to_pixels:new Qn(r),u_alpha_discard_threshold:new Qn(r),u_trim_offset:new ia(r),u_trim_fade_range:new ia(r),u_trim_color:new Tl(r),u_emissive_strength:new Qn(r),u_zbias_factor:new Qn(r),u_tile_to_meter:new Qn(r)}),s.cW=mh,s.cX=qg,s.cY=o,s.cZ=Il,s.c_=(r,e,i,a,c,l)=>{const d=r.transform,y=d.projection.name==="globe";let w;if(l.paint.get("circle-pitch-alignment")==="map")if(y){const _=Dr(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;w=Float32Array.from([_,0,0,_])}else w=d.calculatePixelsToTileUnitsMatrix(i);else w=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(d.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:We.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:bc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(y){A.u_inv_rot_matrix=a,A.u_merc_center=c,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=wr(d.zoom);const _=c[0]*vt,T=c[1]*vt;A.u_up_dir=d.projection.upVector(new st(0,0,0),_,T)}return A},s.ca=Th,s.cb=Tl,s.cc=function(r,e,i){const a=Math.sqrt(r*r+e*e+i*i),c=a>0?Math.acos(i/a)*jr:0;let l=r!==0||e!==0?Math.atan2(-e,-r)*jr+90:0;return l<0&&(l+=360),[a,l,c]},s.cd=h,s.ce=At,s.cf=Bl,s.cg=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},s.ch=function(r,e){return r.readFields(i2,{icons:[]},e)},s.ci=function(r){return r({pluginStatus:ls,pluginURL:so}),Ln.on("pluginStateChange",r),r},s.cj=hy,s.ck=xm,s.cl=xv,s.cm=Go,s.cn=_a,s.co=Ct,s.cp=Gs,s.cq=Gr,s.cr=function(r){const e=r.indexOf(dh);return e>=0?r.slice(0,e):r},s.cs=function(r){return r.indexOf(dh)>=0},s.ct=function(r){const e=r.indexOf(dh);return e>=0?r.slice(e+1):""},s.cu=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.cv=function(r,e,i,a){return r.type==="custom"?new jS(r,e):new QS[r.type](r,e,i,a)},s.cw=Ka,s.cx=class extends Dm{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},s.cy=Ln,s.cz=oa,s.d=function(r){return te.API_TILEJSON_REGEX.test(r)},s.d$=Tb,s.d0=os,s.d1=(r,e,i,a,c,l,d,y)=>{const w=r.transform,A=w.pitch<15?w_(.07,.7,Di((14-w.zoom)/5,0,1)):.07,_=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Ac(r,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_width_scale:l,u_floor_width_scale:d,u_image:0,u_tile_units_to_pixels:pm(e,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(_?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:h(e.tileID.canonical,0)}},s.d2=(r,e,i,a,c,l,d,y,w)=>{const A=r.transform,_=A.calculatePixelsToTileUnitsMatrix(e),T=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",I=A.pitch<15?w_(.07,.7,Di((14-A.zoom)/5,0,1)):.07;return{u_matrix:Ac(r,e,i,a),u_pixels_to_tile_units:_,u_device_pixel_ratio:l,u_width_scale:d,u_floor_width_scale:y,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:Ic(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:pm(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(T?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:h(e.tileID.canonical,0)}},s.d3=Ru,s.d4=Lf,s.d5=zf,s.d6=x_,s.d7=Et,s.d8=qf,s.d9=bu,s.dA=Ld,s.dB=_o,s.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.dD=kl,s.dE=Ml,s.dF=Bo,s.dG=function([r,e,i]){const a=Math.hypot(r,e,i),c=Math.atan2(r,i),l=.5*Math.PI-Math.acos(-e/a);return new rn(Er(c),Er(l))},s.dH=Ov,s.dI=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(i){if(zu==null){const a=i.navigator?i.navigator.userAgent:null;zu=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return zu}(r)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dJ=function(r,e){fi=r,ai=e},s.dK=Wr,s.dL=hs,s.dM=function(r){const e=[0,0,0],i=ue.mat4.identity(new Float64Array(16));return ue.mat4.multiply(i,r.pixelMatrix,r.globeMatrix),ue.vec3.transformMat4(e,e,i),new Mt(e[0],e[1])},s.dN=function(r,e,i=!1){if(ls===ad||ls===Ps||ls===nu)throw new Error("setRTLTextPlugin cannot be called multiple times.");so=We.resolveURL(r),ls=ad,od=e,_n(),i||lh()},s.dO=_r,s.dP=function(){hy().acquire(Uv)},s.dQ=function(){const r=L_;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Uv),L_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dR=ip,s.dS=function(r){const e=Cn();if(!e)return;const i=e.delete(Pt);r&&i.catch(r).then(()=>r())},s.dT=O_,s.dU=fb,s.dV=function(r){Wv=We.resolveURL(r),Rm||(Rm=new Em(hy(),new la)),Rm.broadcast("setDracoUrl",Wv)},s.dW=pb,s.dX=function(r){Cm=We.resolveURL(r),Rm||(Rm=new Em(hy(),new la)),Rm.broadcast("setMeshoptUrl",Cm)},s.dY=Ot,s.dZ=Cl,s.d_=Dc,s.da=450,s.db=7,s.dc=VS,s.dd=nn,s.de=lu,s.df=256,s.dg=ar,s.dh=$s,s.di=ks,s.dj=_h,s.dk=function(r,e,i,a,c){return Di((r-e)/(i-e)*(c-a)+a,a,c)},s.dl=La,s.dm=ba,s.dn=class{constructor(r,e,i,a){this.context=r,this.format=a,this.size=i,this.texture=r.gl.createTexture();const[c,l,d]=this.size,{gl:y}=r;y.bindTexture(y.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),y.texImage3D(y.TEXTURE_3D,0,this.format,c,l,d,0,Rv(this.format),Dv(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),r!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,r),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},s.dp=Lv,s.dq=[1,1,1],s.dr=Sm,s.ds=Tm,s.dt=co,s.du=pc,s.dv=Al,s.dw=bd,s.dx=gh,s.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Mt(1/0,1/0),max:new Mt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=am(new Mt(0,0),new Mt(vt,vt),r),a=[];if(e&&!h_(i,this._globalClipBounds))return a;for(const c of this._activeRegions){if(c.hiddenByOverlap||!h_(i,c))continue;const l=Rg(c.min,c.max,r);a.push({min:l.min,max:l.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask,clipScope:c.clipScope})}return a}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(a).buckets[e.layer];c&&c.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),a=r.getClipMask(),c=r.getClipScope();for(const l of e){if(!l.footprint)continue;const d=am(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:i,clipMask:a,clipScope:c})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||rm(e.min,i.min)||rm(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(a,c){const l=(d,y)=>d+y;return a.length-c.length||a.reduce(l,"").localeCompare(c.reduce(l,""))}(e.clipScope,i.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],a=this._prevRegions[e];r=i.priority!==a.priority||!sm(i,a)||i.order!==a.order||i.clipMask!==a.clipMask||!Aa(i.clipScope,a.clipScope),++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==Ld&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const c=a[i].priority;for(;i<a.length&&a[i].priority===c;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let c=i;const l=i;for(;c!==a;){const d=this._activeRegions[c];d.hiddenByOverlap=!1;for(let y=0;y<l;y++){const w=this._activeRegions[y];if(!w.hiddenByOverlap&&d.order===Ld&&h_(d,w)&&(d.hiddenByOverlap=kd(d.footprint,d.tileId,w.footprint,w.tileId),d.hiddenByOverlap))break}++c}i=a,a=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},s.dz=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new oo,a=new Fr,c=[],l=r+1+2,d=e[0]+1,y=e[0]+1+(1+e.length),w=(A,_,T)=>{let I=A===l-1?A-2:A===0?A:A-1;return I+=T?24575:0,[I,_]};for(let A=0;A<l;++A)i.emplaceBack(...w(A,0,!0));for(let A=0;A<d;++A)for(let _=0;_<l;++_)i.emplaceBack(...w(_,A,(_===0||_===l-1)&&!0));for(let A=0;A<e.length;++A){const _=e[A];for(let T=0;T<l;++T)i.emplaceBack(...w(T,_,!0))}for(let A=0;A<e.length;++A){const _=a.length,T=e[A]+1+2,I=new Fr;for(let z=0;z<T-1;z++){const B=z===T-2,N=B?l*(y-e.length+A-z):l;for(let H=0;H<l-1;H++){const G=z*l+H;z===0||B||H===0||H===l-2?(I.emplaceBack(G+1,G,G+N),I.emplaceBack(G+N,G+N+1,G+1)):(a.emplaceBack(G+1,G,G+N),a.emplaceBack(G+N,G+N+1,G+1))}}const E=dn.simpleSegment(0,_,i.length,a.length-_);for(let z=0;z<I.uint16.length;z+=3)a.emplaceBack(I.uint16[z],I.uint16[z+1],I.uint16[z+2]);const M=dn.simpleSegment(0,_,i.length,a.length-_);c.push({withoutSkirts:E,withSkirts:M})}return{vertices:i,indices:a,segments:c}}_createGrid(r){const e=this._fillGridMeshWithLods(El,mu);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,Qt.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new Fr;for(let d=0;d<=El;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new ks,a=new ks,c=new ks,l=new ks;this._poleSegments=[];for(let d=0,y=0;d<xc;d++){const w=360/(1<<d);i.emplaceBack(0,-us,0,.5,0),a.emplaceBack(0,-us,0,.5,1),c.emplaceBack(0,-us,0,.5,.5),l.emplaceBack(0,-us,0,.5,.5);for(let A=0;A<=El;A++){let _=A/El,T=0;const I=Kt(0,w,_),[E,M,z]=ko(wa,fo,I,us);i.emplaceBack(E,M,z,_,T),a.emplaceBack(E,M,z,_,1-T);const B=Gi(I);_=.5+.5*Math.sin(B),T=.5+.5*Math.cos(B),c.emplaceBack(E,M,z,_,T),l.emplaceBack(E,M,z,_,1-T)}this._poleSegments.push(dn.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,Vt,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(a,Vt,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(c,Vt,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(l,Vt,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},s.e=te,s.e0=Sb,s.e1=um,s.e2=vn,s.e3="hd_road_elevation",s.e4=class{static parseFrom(r,e){const i=Fa.parse(r);if(!i)return[];let{vertices:a,features:c}=i;const l=1/h(e);c.sort((A,_)=>A.id-_.id),a.sort((A,_)=>A.id-_.id||A.idx-_.idx),a=a.filter((A,_,T)=>_===T.findIndex(I=>I.id===A.id&&I.idx===A.idx));const d=new Array;let y=0;const w=a.length;for(const A of c){if(A.constantHeight){d.push(new zd(A.id,A.bounds,A.constantHeight));continue}for(;y!==w&&a[y].id<A.id;)y++;if(y===w||a[y].id!==A.id)continue;const _=new Array,T=new Array,I=y;for(;y!==w&&a[y].id===A.id;){const E=a[y];if(_.push({position:E.position,height:E.height,extent:E.extent}),y!==I&&a[y-1].idx===E.idx-1){const M=y-I;T.push({a:M-1,b:M})}y++}d.push(new zd(A.id,A.bounds,void 0,_,T,l))}return d}},s.e5=Ya,s.e6=Mh,s.e7=kx,s.e8=vm,s.e9=function(r,e,i,a,c,l,d,y=1,w){r.createArrays(),r.tilePixelRatio=vt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const A=r.layers[0].layout,_=r.layers[0]._unevaluatedLayout._values,T={};T.scaleFactor=y,T.textSizeScaleRange=A.get("text-size-scale-range"),T.iconSizeScaleRange=A.get("icon-size-scale-range");const[I,E]=T.textSizeScaleRange,[M,z]=T.iconSizeScaleRange;T.textScaleFactor=Di(T.scaleFactor,I,E),T.iconScaleFactor=Di(T.scaleFactor,M,z);const B=_["text-size"],N=_["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:Q,maxZoom:le}=r.textSizeData;T.compositeTextSizes=[B.possiblyEvaluate(new hn(Q),l),B.possiblyEvaluate(new hn(le),l)]}if(r.iconSizeData.kind==="composite"){const{minZoom:Q,maxZoom:le}=r.iconSizeData;T.compositeIconSizes=[N.possiblyEvaluate(new hn(Q),l),N.possiblyEvaluate(new hn(le),l)]}T.layoutTextSize=B.possiblyEvaluate(new hn(d+1),l),T.layoutIconSize=N.possiblyEvaluate(new hn(d+1),l),T.textMaxSize=B.possiblyEvaluate(new hn(18),l);const H=A.get("symbol-placement"),G=A.get("text-rotation-alignment")==="map"&&H!=="point",j=A.get("text-size");let $=!1;const W=[];for(const Q of r.features){const le=A.get("text-font").evaluate(Q,{},l).join(","),se=j.evaluate(Q,{},l)*T.textScaleFactor,ae=T.layoutTextSize.evaluate(Q,{},l)*T.textScaleFactor,be=T.layoutIconSize.evaluate(Q,{},l)*T.iconScaleFactor,he={horizontal:{},vertical:void 0},Te=Q.text;let Ie,Me=[0,0];if(Te){const ut=Te.toString(),ti=A.get("text-letter-spacing").evaluate(Q,{},l)*Tr,zt=A.get("text-line-height").evaluate(Q,{},l)*Tr,Zt=cl(ut)?ti:0,pi=A.get("text-anchor").evaluate(Q,{},l),Ci=A.get("text-variable-anchor");if(!Ci){const ln=A.get("text-radial-offset").evaluate(Q,{},l);Me=ln?qx(pi,[ln*Tr,bv]):A.get("text-offset").evaluate(Q,{},l).map(Dn=>Dn*Tr)}let yi=G?"center":A.get("text-justify").evaluate(Q,{},l);const Bi=H==="point",Mi=Bi?A.get("text-max-width").evaluate(Q,{},l)*Tr:1/0,ji=ln=>{r.allowVerticalPlacement&&ah(ut)&&(he.vertical=Dt(Te,e,i,c,le,Mi,zt,pi,ln,Zt,Me,it.vertical,!0,ae,se,w))};if(!G&&Ci){const ln=yi==="auto"?Ci.map(gi=>wv(gi)):[yi];let Dn=!1;for(let gi=0;gi<ln.length;gi++){const Yi=ln[gi];if(!he.horizontal[Yi])if(Dn)he.horizontal[Yi]=he.horizontal[0];else{const Fn=Dt(Te,e,i,c,le,Mi,zt,"center",Yi,Zt,Me,it.horizontal,!1,ae,se,w);Fn&&(he.horizontal[Yi]=Fn,Dn=Fn.positionedLines.length===1)}}ji("left")}else{if(yi==="auto"&&(yi=wv(pi)),Bi||A.get("text-writing-mode").indexOf("horizontal")>=0||!ah(ut)){const ln=Dt(Te,e,i,c,le,Mi,zt,pi,yi,Zt,Me,it.horizontal,!1,ae,se,w);ln&&(he.horizontal[yi]=ln)}ji(Bi?"left":yi)}}let ze,De,Ne,ke,Ue,lt=!1;if(Q.icon&&Q.icon.hasPrimary()){const ut=Hx(Q.icon,r.iconSizeData,_["icon-size"],l,r.zoom,Q,w,T.iconScaleFactor);ze=ut.iconPrimary,De=ut.iconSecondary;const ti=ze.toString(),zt=a.get(ti);zt&&(Ne=A.get("icon-offset").evaluate(Q,{},l),ke=A.get("icon-anchor").evaluate(Q,{},l),Ue=A.get("icon-text-fit").evaluate(Q,{},l),Ie=vS(c.get(ti),De?c.get(De.toString()):void 0,Ne,ke),lt=zt.sdf,r.sdfIcons===void 0?r.sdfIcons=zt.sdf:r.sdfIcons!==zt.sdf&&Pn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(zt.pixelRatio!==r.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}$=$||!(!Q.icon||!Q.icon.hasSecondary());const ot=Tv(he.horizontal)||he.vertical;r.iconsInText||(r.iconsInText=!!ot&&ot.iconsInText);const Nt=ae*T.textScaleFactor/Tr,{defaultShapedIcon:mt,verticallyShapedIcon:xt}=MS(r,Ie,A,Q,l,he,Nt,Ne,Ue);Ie=mt,W.push({feature:Q,shapedTextOrientations:he,shapedText:ot,shapedIcon:Ie,iconPrimary:ze,iconSecondary:De,iconOffset:Ne,iconAnchor:ke,verticallyShapedIcon:xt,layoutTextSize:ae,layoutIconSize:be,textOffset:Me,isSDFIcon:lt,iconTextFit:Ue})}return{featureData:W,sizes:T,hasAnySecondaryIcon:$,textAlongLine:G,symbolPlacement:H}},s.ea=Bx,s.eb=function(r,e,i,a,c,l,d,y,w,A){const{featureData:_,hasAnySecondaryIcon:T,sizes:I,textAlongLine:E,symbolPlacement:M}=e;for(const z of _){const{shapedIcon:B,verticallyShapedIcon:N,feature:H,shapedTextOrientations:G,shapedText:j,layoutTextSize:$,textOffset:W,isSDFIcon:Q,iconPrimary:le,iconSecondary:se,iconTextFit:ae,iconOffset:be}=z;Zx(B,A.iconPositions,le,se),Zx(N,A.iconPositions,le,se),AS(G,A.iconPositions),(j||B)&&IS(r,H,G,B,N,w,I,$,0,W,Q,a,c,d,y,T,ae,be,E,M)}i&&r.generateCollisionDebugBuffers(l,r.collisionBoxArray,I.textScaleFactor)},s.ec=Sc,s.ed=yy,s.ee=$a,s.ef=wg,s.eg=Rt,s.eh=pe,s.ei=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==_b){const i=new Uint32Array(r,0,7),[,,a,c,l,d]=i;e=i.byteLength+c+l+d+l,(a!==r.byteLength||e>=r.byteLength)&&Pn("Invalid b3dm header information.")}return xb(r,e)},s.ej=function(r,e){const i=wb(r);for(const a of i){for(const c of a.meshes)iE(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(nE(a.lights,e)))}return i},s.ek=uy,s.el=L1,s.em=cs,s.en=function(r){ki(),Ai!=null&&Ai.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-r;a++)e.delete(i[a])})})},s.f=function(r){return r.indexOf("mapbox:")===0},s.g=function(r,e){return oa(fr(r,{method:"GET"}),e)},s.h=ie,s.i=function(r){return te.API_STYLE_REGEX.test(r)&&!me(r)},s.j=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},s.l=fr,s.m=un,s.n=function(r,e){return oa(fr(r,{type:"json"}),e)},s.o=Nh,s.p=function(r,e){return oa(fr(r,{method:"POST"}),e)},s.q=We,s.r=Ur,s.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=Je,s.u=function(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()},s.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},s.w=Pn,s.x=function(){return Vv||(Vv=new ip),Vv},s.y=Hv,s.z=Ra}),K(["./shared"],function(s){function pe(Ye){const te=Ye?Ye.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function Ce(Ye){if(typeof Ye=="number"||typeof Ye=="boolean"||typeof Ye=="string"||Ye==null)return JSON.stringify(Ye);if(Array.isArray(Ye)){let ie="[";for(const me of Ye)ie+=`${Ce(me)},`;return`${ie}]`}let te="{";for(const ie of Object.keys(Ye).sort())te+=`${ie}:${Ce(Ye[ie])},`;return`${te}}`}function He(Ye){let te="";for(const ie of s.bm)(Ye.type!=="model"||ie!=="minzoom"&&ie!=="maxzoom")&&(te+=`/${Ce(Ye[ie])}`);return te}class wt{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,ie){this._layerConfigs={},this._layers={},this.update(te,[],ie)}update(te,ie,me){this._options=me;for(const Ee of te)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=s.cv(Ee,this.scope,null,this._options)).compileFilter(me),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of ie)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const Se=function(Ee,Re){const qe={};for(let $e=0;$e<Ee.length;$e++){const Je=Ee[$e];let We=Re&&Re[Je.id];!We&&(We=He(Je),Je.type==="line"&&Je.paint)&&function Ct(Pt){return typeof Pt=="string"&&Pt==="line-progress"||(Array.isArray(Pt)?Pt.some(Ct):!(!Pt||typeof Pt!="object")&&Object.values(Pt).some(Ct))}(Je.paint["line-width"])&&(We+=`/${Ce(Je.paint["line-width"])}`),Re&&(Re[Je.id]=We);let pt=qe[We];pt||(pt=qe[We]=[]),pt.push(Je)}const Pe=[];for(const $e in qe)Pe.push(qe[$e]);return Pe}(Object.values(this._layerConfigs),this.keyCache);for(const Ee of Se){const Re=Ee.map(pt=>this._layers[pt.id]),qe=Re[0];if(qe.visibility==="none")continue;const Pe=qe.source||"";let $e=this.familiesBySource[Pe];$e||($e=this.familiesBySource[Pe]={});const Je=qe.sourceLayer||"_geojsonTileLayer";let We=$e[Je];We||(We=$e[Je]=[]),We.push(Re)}}}const gt=1*s.d_;class Xt{constructor(te){const ie={},me=[];for(const qe in te){const Pe=te[qe],$e=ie[qe]={};for(const Je in Pe.glyphs){const We=Pe.glyphs[+Je];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const pt=We.metrics.localGlyph?gt:1,Ct={x:0,y:0,w:We.bitmap.width+2*pt,h:We.bitmap.height+2*pt};me.push(Ct),$e[Je]=Ct}}const{w:Se,h:Ee}=s.H(me),Re=new s.dZ({width:Se||1,height:Ee||1});for(const qe in te){const Pe=te[qe];for(const $e in Pe.glyphs){const Je=Pe.glyphs[+$e];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const We=ie[qe][$e],pt=Je.metrics.localGlyph?gt:1;s.dZ.copy(Je.bitmap,Re,{x:0,y:0},{x:We.x+pt,y:We.y+pt},Je.bitmap)}}this.image=Re,this.positions=ie}}s.dY(Xt,"GlyphAtlas");class jt{constructor(te){this.tileID=new s.aH(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.request&&te.request.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=s.aR(te.tileID.canonical,te.projection),this.projection=te.projection,this.worldview=te.worldview,this.localizableLayerIds=te.localizableLayerIds,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep,this.scaleFactor=te.scaleFactor}parse(te,ie,me,Se,Ee){this.status="parsing",this.data=te,this.collisionBoxArray=new s.aX;const Re=new s.d$(Object.keys(te.layers).sort()),qe=new s.e0(this.tileID,this.promoteId);qe.bucketLayerIDs=[];const Pe={},$e=new s.e1(256,256),Je={featureIndex:qe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:$e,availableImages:me,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},We=ie.familiesBySource[this.source];for(const ki in We){const cn=te.layers[ki];if(!cn)continue;let un=!1,mn=!1,Gn=!1;for(const ss of We[ki])ss[0].type==="symbol"?un=!0:mn=!0,ss[0].is3D()&&ss[0].type!=="model"&&(Gn=!0);if(this.extraShadowCaster&&!Gn||this.isSymbolTile===!0&&!un||this.isSymbolTile===!1&&!mn)continue;cn.version===1&&s.w(`Vector tile source "${this.source}" layer "${ki}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pr=Re.encode(ki),ir=[];let Us=!1;for(let ss=0,nr=0;ss<cn.length;ss++){const Mr=cn.feature(ss),Go=qe.getId(Mr,ki);if(this.localizableLayerIds&&this.localizableLayerIds.has(ki)){const oa=Mr.properties?Mr.properties.worldview:null;if(this.worldview&&typeof oa=="string")if(oa==="all")Mr.properties.$localized=!0;else{if(!oa.split(",").includes(this.worldview))continue;Mr.properties.$localized=!0,Mr.properties.worldview=this.worldview}}!Us&&Mr.properties&&Mr.properties.hasOwnProperty(s.e2)&&(Us=!0),ir.push({feature:Mr,id:Go,index:nr,sourceLayerIndex:pr}),nr++}Us&&!Je.elevationFeatures&&te.layers.hasOwnProperty(s.e3)&&(Je.elevationFeatures=s.e4.parseFrom(te.layers[s.e3],this.canonical));for(const ss of We[ki]){const nr=ss[0];(!this.extraShadowCaster||nr.is3D()&&nr.type!=="model")&&(this.isSymbolTile!==void 0&&nr.type==="symbol"!==this.isSymbolTile||nr.minzoom&&this.zoom<Math.floor(nr.minzoom)||nr.maxzoom&&this.zoom>=nr.maxzoom||nr.visibility!=="none"&&(hi(ss,this.zoom,Je.brightness,me),(Pe[nr.id]=nr.createBucket({index:qe.bucketLayerIDs.length,layers:ss,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(ir,Je,this.tileID.canonical,this.tileTransform),qe.bucketLayerIDs.push(ss.map(Mr=>s.C(Mr.id,Mr.scope)))))}}let pt,Ct,Pt,fi,ai,Ti;$e.trim();const Ai={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},gn=()=>{if(pt)return this.status="done",Ee(pt);if(this.extraShadowCaster)this.status="done",Ee(null,{buckets:Object.values(Pe).filter(ki=>!ki.isEmpty()),featureIndex:qe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Je.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ct&&Pt&&fi){const ki=new Xt(Ct),cn=new Map;for(const[Gn,pr]of Pt.entries()){const{imagePosition:ir}=s.e7(Gn,pr,s.e8);cn.set(Gn,ir)}const un={};for(const Gn in Pe){const pr=Pe[Gn];pr instanceof s.aY&&(hi(pr.layers,this.zoom,Je.brightness,me),un[Gn]=s.e9(pr,Ct,ki.positions,Pt,cn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const mn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Se,Pt,ai,()=>{mn.iconsPending=!1,Cn(un,ki,mn)}),this.rasterizeIfNeeded(Se,fi,Ti,()=>{mn.patternsPending=!1,Cn(un,ki,mn)})}},Cn=(ki,cn,un,mn)=>{if(un.iconsPending||un.patternsPending)return;const Gn=new s.ea(Pt,fi,this.lut);for(const pr in Pe){const ir=Pe[pr];if(pr in ki)s.eb(ir,ki[pr],this.showCollisionBoxes,me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Pt,Gn);else if(ir.hasPattern&&(ir instanceof s.b2||ir instanceof s.b3||ir instanceof s.d8)){hi(ir.layers,this.zoom,Je.brightness,me);const Us=Object.fromEntries(Gn.patternPositions);ir.addFeatures(Je,this.tileID.canonical,Us,me,this.tileTransform,this.brightness)}}this.status="done",Ee(null,{buckets:Object.values(Pe).filter(pr=>!pr.isEmpty()),featureIndex:qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:cn.image,lineAtlas:$e,imageAtlas:Gn,brightness:Je.brightness})};if(!this.extraShadowCaster){const ki=s.e5(Je.glyphDependencies,mn=>Object.keys(mn).map(Number));Object.keys(ki).length?Se.send("getGlyphs",{uid:this.uid,stacks:ki,scope:this.scope},(mn,Gn)=>{pt||(pt=mn,Ct=Gn,gn())},void 0,!1,Ai):Ct={};const cn=Array.from(Je.iconDependencies.keys()).map(mn=>s.I.parse(mn));cn.length?Se.send("getImages",{images:cn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(mn,Gn)=>{pt||(pt=mn,Pt=new Map,ai=this.updateImageMapAndGetImageTaskQueue(Pt,Gn,Je.iconDependencies),gn())},void 0,!1,Ai):(Pt=new Map,ai=new Map);const un=Array.from(Je.patternDependencies.keys()).map(mn=>s.I.parse(mn));un.length?Se.send("getImages",{images:un,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(mn,Gn)=>{pt||(pt=mn,fi=new Map,Ti=this.updateImageMapAndGetImageTaskQueue(fi,Gn,Je.patternDependencies),gn())},void 0,!1,Ai):(fi=new Map,Ti=new Map)}if(Je.elevationFeatures&&Je.elevationFeatures.length>0){const ki=[];for(const un of Object.values(Pe))if(un instanceof s.b3){const mn=un.getUnevaluatedPortalGraph();mn&&ki.push(mn)}const cn=s.e6.evaluate(ki);for(const un of Object.values(Pe))un instanceof s.b3&&un.setEvaluatedPortalGraph(cn)}gn()}rasterizeIfNeeded(te,ie,me,Se){Array.from(ie.values()).some(Ee=>Ee.usvg)?this.rasterize(te,ie,me,Se):Se()}updateImageMapAndGetImageTaskQueue(te,ie,me){const Se=new Map;for(const Ee of ie.keys()){const Re=me.get(Ee)||[];for(const qe of Re){const Pe=qe.toString(),$e=ie.get(qe.id.toString());$e.usvg?Se.has(Pe)||(Se.set(Pe,qe),te.set(Pe,Object.assign({},$e))):te.set(Pe,$e)}}return Se}rasterize(te,ie,me,Se){this.rasterizeTask=te.send("rasterizeImages",{scope:this.scope,tasks:me},(Ee,Re)=>{if(!Ee)for(const[qe,Pe]of Re.entries()){const $e=Object.assign(ie.get(qe),{data:Pe});ie.set(qe,$e)}Se()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function hi(Ye,te,ie,me){const Se=new s.aa(te,{brightness:ie});for(const Ee of Ye)Ee.recalculate(Se,me)}class vi extends s.E{constructor(te,ie,me,Se,Ee,Re){super(),this.actor=te,this.layerIndex=ie,this.availableImages=me,this.loadVectorData=Ee||s.aE,this.loading={},this.loaded={},this.deduped=new s.aD(te.scheduler),this.isSpriteLoaded=Se,this.scheduler=te.scheduler,this.brightness=Re}loadTile(te,ie){const me=te.uid,Se=te&&te.request,Ee=Se&&Se.collectResourceTiming,Re=this.loading[me]=new jt(te);Re.abort=this.loadVectorData(te,(qe,Pe)=>{const $e=!this.loading[me];if(delete this.loading[me],Re.cancelRasterize(),$e||qe||!Pe)return Re.status="done",$e||(this.loaded[me]=Re),ie(qe);const Je=Pe.rawData,We={};Pe.expires&&(We.expires=Pe.expires),Pe.cacheControl&&(We.cacheControl=Pe.cacheControl),Re.vectorTile=Pe.vectorTile||new s.ec.VectorTile(new s.bi(Je));const pt=()=>{Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ct,Pt)=>{if(Ct||!Pt)return ie(Ct);const fi={};if(Ee){const ai=pe(Se);ai.length>0&&(fi.resourceTiming=JSON.parse(JSON.stringify(ai)))}ie(null,s.l({rawTileData:Je.slice(0)},Pt,We,fi))})};this.isSpriteLoaded?pt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(pt,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):pt()}),this.loaded=this.loaded||{},this.loaded[me]=Re})}reloadTile(te,ie){const me=this.loaded,Se=te.uid;if(me&&me[Se]){const Ee=me[Se];Ee.scaleFactor=te.scaleFactor,Ee.showCollisionBoxes=te.showCollisionBoxes,Ee.projection=te.projection,Ee.brightness=te.brightness,Ee.tileTransform=s.aR(te.tileID.canonical,te.projection),Ee.extraShadowCaster=te.extraShadowCaster,Ee.lut=te.lut;const Re=(qe,Pe)=>{const $e=Ee.reloadCallback;$e&&(delete Ee.reloadCallback,Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,$e)),ie(qe,Pe)};Ee.status==="parsing"?Ee.reloadCallback=Re:Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,Re):Re())}else ie(null,void 0)}abortTile(te,ie){const me=te.uid,Se=this.loading[me];Se&&(Se.abort&&Se.abort(),delete this.loading[me]),ie()}removeTile(te,ie){const me=this.loaded,Se=te.uid;me&&me[Se]&&delete me[Se],ie()}}class at{loadTile(te,ie){const{uid:me,encoding:Se,rawImageData:Ee,padding:Re}=te,qe=ImageBitmap&&Ee instanceof ImageBitmap?this.getImageData(Ee,Re):Ee;ie(null,new s.ed(me,qe,Se,Re<1))}reloadTile(te,ie){ie(null,null)}abortTile(te,ie){ie()}removeTile(te,ie){ie()}getImageData(te,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const me=this.offscreenCanvasContext.getImageData(-ie,-ie,te.width+2*ie,te.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}s.bh.setPbf(s.bi);class ni{constructor(te){this._mrt=new s.bh(te.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=te.uid,this.tileID=te.tileID,this.source=te.source}parse(te,ie){const me=this._mrt;this.status="parsing",this._entireBuffer=te;try{me.parseHeader(te),this._isHeaderLoaded=!0;const Se=[];for(const Ee in me.layers){const Re=me.getLayer(Ee),qe=Re.getDataRange(Re.getBandList()),Pe=me.createDecodingTask(qe),$e=te.slice(qe.firstByte,qe.lastByte+1),Je=s.bh.performDecoding($e,Pe).then(We=>Pe.complete(null,We)).catch(We=>Pe.complete(We,null));Se.push(Je)}Promise.allSettled(Se).then(()=>ie(null,me))}catch(Se){ie(Se)}}}class qt{constructor(te){this.actor=te,this.loading={},this.loaded={}}loadTile(te,ie){const me=te.uid,Se=te.request,Ee=this.loading[me]=new ni(te),{cancel:Re}=s.bj(Se,(qe,Pe,$e,Je)=>{const We=!this.loading[me];if(delete this.loading[me],We||qe||!Pe)return Ee.status="done",We||(this.loaded[me]=Ee),ie(qe);Ee.parse(Pe,(pt,Ct)=>{if(pt||!Ct)return ie(pt);ie(null,Ct,$e,Je)}),this.loaded[me]=Ee});Ee.abort=Re}reloadTile(te,ie){ie(null,void 0)}abortTile(te,ie){const me=te.uid,Se=this.loading[me];Se&&(Se.abort&&Se.abort(),delete this.loading[me]),ie()}removeTile(te,ie){const me=te.uid;this.loaded[me]&&delete this.loaded[me],ie()}decodeRasterArray({task:te,buffer:ie},me){s.bh.performDecoding(ie,te).then(Se=>me(null,Se)).catch(Se=>me(Se))}}const $t=s.ec.VectorTileFeature.prototype.toGeoJSON;class kt{constructor(te){this._feature=te,this.extent=s.ai,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const ie of this._feature.geometry)te.push([new s.P(ie[0],ie[1])]);return te}{const te=[];for(const ie of this._feature.geometry){const me=[];for(const Se of ie)me.push(new s.P(Se[0],Se[1]));te.push(me)}return te}}toGeoJSON(te,ie,me){return $t.call(this,te,ie,me)}}class Oi{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.ai,this.length=te.length,this._features=te}feature(te){return new kt(this._features[te])}}const Gt=64/4096,oi=128;class tn{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],ie){for(const me of te){const Se=me.id;if(Se==null)continue;let Ee=this.features.get(Se);Ee&&this.updateCache(Ee,ie),me.geometry?(Ee=ei(me),this.updateCache(Ee,ie),this.features.set(Se,Ee)):this.features.delete(Se),this.updateCache(Ee,ie)}}updateCache(te,ie){for(const{canonical:me,uid:Se}of Object.values(ie)){const{z:Ee,x:Re,y:qe}=me;Jt(te,Math.pow(2,Ee),Re,qe)&&delete ie[Se]}}getTile(te,ie,me){const Se=Math.pow(2,te),Ee=[];for(const Re of this.features.values())Jt(Re,Se,ie,me)&&Ee.push(mi(Re,Se,ie,me));return{features:Ee}}getFeatures(){return[...this.features.values()]}}function Jt({minX:Ye,minY:te,maxX:ie,maxY:me},Se,Ee,Re){return Ye<(Ee+1+Gt)/Se&&te<(Re+1+Gt)/Se&&ie>(Ee-Gt)/Se&&me>(Re-Gt)/Se}function ei(Ye){const{id:te,geometry:ie,properties:me}=Ye;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Se,coordinates:Ee}=ie,Re={id:te,type:1,geometry:[],tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},qe=Re.geometry;if(Se==="Point")Vn(Ee,qe,Re);else if(Se==="MultiPoint")for(const Pe of Ee)Vn(Pe,qe,Re);else if(Se==="LineString")Re.type=2,fs(Ee,qe,Re);else if(Se==="MultiLineString")Re.type=2,Ss(Ee,qe,Re);else if(Se==="Polygon")Re.type=3,Ss(Ee,qe,Re,!0);else{if(Se!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Re.type=3;for(const Pe of Ee)Ss(Pe,qe,Re,!0)}return Re}function Vn([Ye,te],ie,me){const Se=s.av(Ye);let Ee=s.aC(te);Ee=Ee<0?0:Ee>1?1:Ee,ie.push(Se,Ee),me.minX=Math.min(me.minX,Se),me.minY=Math.min(me.minY,Ee),me.maxX=Math.max(me.maxX,Se),me.maxY=Math.max(me.maxY,Ee)}function fs(Ye,te,ie,me=!1,Se=!1){const Ee=[];for(const Re of Ye)Vn(Re,Ee,ie);te.push(Ee),me&&function(Re,qe){let Pe=0;for(let $e=0,Je=Re.length,We=Je-2;$e<Je;We=$e,$e+=2)Pe+=(Re[$e]-Re[We])*(Re[$e+1]+Re[We+1]);if(Pe>0===qe)for(let $e=0,Je=Re.length;$e<Je/2;$e+=2){const We=Re[$e],pt=Re[$e+1];Re[$e]=Re[Je-2-$e],Re[$e+1]=Re[Je-1-$e],Re[Je-2-$e]=We,Re[Je-1-$e]=pt}}(Ee,Se)}function Ss(Ye,te,ie,me=!1){for(let Se=0;Se<Ye.length;Se++)fs(Ye[Se],te,ie,me,Se===0)}function mi(Ye,te,ie,me){const{id:Se,type:Ee,geometry:Re,tags:qe}=Ye,Pe=[];if(Ee===1)(function($e,Je,We,pt,Ct){for(let Pt=0;Pt<$e.length;Pt+=2){const fi=Math.round(s.ai*($e[Pt+0]*Je-We)),ai=Math.round(s.ai*($e[Pt+1]*Je-pt));Ct.push([fi,ai])}})(Re,te,ie,me,Pe);else for(const $e of Re)bt($e,te,ie,me,Pe);return{id:Se,type:Ee,geometry:Pe,tags:qe}}function bt(Ye,te,ie,me,Se){const Re=s.ai+oi;let qe;for(let Pe=0;Pe<Ye.length-2;Pe+=2){let $e=Math.round(s.ai*(Ye[Pe+0]*te-ie)),Je=Math.round(s.ai*(Ye[Pe+1]*te-me)),We=Math.round(s.ai*(Ye[Pe+2]*te-ie)),pt=Math.round(s.ai*(Ye[Pe+3]*te-me));const Ct=We-$e,Pt=pt-Je;$e<-128&&We<-128||($e<-128?(Je+=Math.round(Pt*((-128-$e)/Ct)),$e=-128):We<-128&&(pt=Je+Math.round(Pt*((-128-$e)/Ct)),We=-128),Je<-128&&pt<-128||(Je<-128?($e+=Math.round(Ct*((-128-Je)/Pt)),Je=-128):pt<-128&&(We=$e+Math.round(Ct*((-128-Je)/Pt)),pt=-128),$e>=Re&&We>=Re||($e>=Re?(Je+=Math.round(Pt*((Re-$e)/Ct)),$e=Re):We>=Re&&(pt=Je+Math.round(Pt*((Re-$e)/Ct)),We=Re),Je>=Re&&pt>=Re||(Je>=Re?($e+=Math.round(Ct*((Re-Je)/Pt)),Je=Re):pt>=Re&&(We=$e+Math.round(Ct*((Re-Je)/Pt)),pt=Re),qe&&$e===qe[qe.length-1][0]&&Je===qe[qe.length-1][1]||(qe=[[$e,Je]],Se.push(qe)),qe.push([We,pt])))))}}var ri,Ni,si,Ze={exports:{}},Ft=function(){if(si)return Ze.exports;si=1;var Ye=s.eg(),te=function(){if(Ni)return ri;Ni=1;var Je=s.ee(),We=s.ef().VectorTileFeature;function pt(Pt,fi){this.options=fi||{},this.features=Pt,this.length=Pt.length}function Ct(Pt,fi){this.id=typeof Pt.id=="number"?Pt.id:void 0,this.type=Pt.type,this.rawGeometry=Pt.type===1?[Pt.geometry]:Pt.geometry,this.properties=Pt.tags,this.extent=fi||4096}return ri=pt,pt.prototype.feature=function(Pt){return new Ct(this.features[Pt],this.options.extent)},Ct.prototype.loadGeometry=function(){var Pt=this.rawGeometry;this.geometry=[];for(var fi=0;fi<Pt.length;fi++){for(var ai=Pt[fi],Ti=[],Ai=0;Ai<ai.length;Ai++)Ti.push(new Je(ai[Ai][0],ai[Ai][1]));this.geometry.push(Ti)}return this.geometry},Ct.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Pt=this.geometry,fi=1/0,ai=-1/0,Ti=1/0,Ai=-1/0,gn=0;gn<Pt.length;gn++)for(var Cn=Pt[gn],ki=0;ki<Cn.length;ki++){var cn=Cn[ki];fi=Math.min(fi,cn.x),ai=Math.max(ai,cn.x),Ti=Math.min(Ti,cn.y),Ai=Math.max(Ai,cn.y)}return[fi,Ti,ai,Ai]},Ct.prototype.toGeoJSON=We.prototype.toGeoJSON,ri}();function ie(Je){var We=new Ye;return function(pt,Ct){for(var Pt in pt.layers)Ct.writeMessage(3,me,pt.layers[Pt])}(Je,We),We.finish()}function me(Je,We){var pt;We.writeVarintField(15,Je.version||1),We.writeStringField(1,Je.name||""),We.writeVarintField(5,Je.extent||4096);var Ct={keys:[],values:[],keycache:{},valuecache:{}};for(pt=0;pt<Je.length;pt++)Ct.feature=Je.feature(pt),We.writeMessage(2,Se,Ct);var Pt=Ct.keys;for(pt=0;pt<Pt.length;pt++)We.writeStringField(3,Pt[pt]);var fi=Ct.values;for(pt=0;pt<fi.length;pt++)We.writeMessage(4,$e,fi[pt])}function Se(Je,We){var pt=Je.feature;pt.id!==void 0&&We.writeVarintField(1,pt.id),We.writeMessage(2,Ee,Je),We.writeVarintField(3,pt.type),We.writeMessage(4,Pe,pt)}function Ee(Je,We){var pt=Je.feature,Ct=Je.keys,Pt=Je.values,fi=Je.keycache,ai=Je.valuecache;for(var Ti in pt.properties){var Ai=pt.properties[Ti],gn=fi[Ti];if(Ai!==null){gn===void 0&&(Ct.push(Ti),fi[Ti]=gn=Ct.length-1),We.writeVarint(gn);var Cn=typeof Ai;Cn!=="string"&&Cn!=="boolean"&&Cn!=="number"&&(Ai=JSON.stringify(Ai));var ki=Cn+":"+Ai,cn=ai[ki];cn===void 0&&(Pt.push(Ai),ai[ki]=cn=Pt.length-1),We.writeVarint(cn)}}}function Re(Je,We){return(We<<3)+(7&Je)}function qe(Je){return Je<<1^Je>>31}function Pe(Je,We){for(var pt=Je.loadGeometry(),Ct=Je.type,Pt=0,fi=0,ai=pt.length,Ti=0;Ti<ai;Ti++){var Ai=pt[Ti],gn=1;Ct===1&&(gn=Ai.length),We.writeVarint(Re(1,gn));for(var Cn=Ct===3?Ai.length-1:Ai.length,ki=0;ki<Cn;ki++){ki===1&&Ct!==1&&We.writeVarint(Re(2,Cn-1));var cn=Ai[ki].x-Pt,un=Ai[ki].y-fi;We.writeVarint(qe(cn)),We.writeVarint(qe(un)),Pt+=cn,fi+=un}Ct===3&&We.writeVarint(Re(7,1))}}function $e(Je,We){var pt=typeof Je;pt==="string"?We.writeStringField(1,Je):pt==="boolean"?We.writeBooleanField(7,Je):pt==="number"&&(Je%1!=0?We.writeDoubleField(3,Je):Je<0?We.writeSVarintField(6,Je):We.writeVarintField(5,Je))}return Ze.exports=ie,Ze.exports.fromVectorTileJs=ie,Ze.exports.fromGeojsonVt=function(Je,We){We=We||{};var pt={};for(var Ct in Je)pt[Ct]=new te(Je[Ct].features,We),pt[Ct].name=Ct,pt[Ct].version=We.version,pt[Ct].extent=We.extent;return ie({layers:pt})},Ze.exports.GeoJSONWrapper=te,Ze.exports}(),_i=s.eh(Ft);const Tt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ye=>Ye},Fi=Math.fround||(wn=new Float32Array(1),Ye=>(wn[0]=+Ye,wn[0]));var wn;const Li=3,lr=5,qn=6;class Ws{constructor(te){this.options=Object.assign(Object.create(Tt),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:ie,minZoom:me,maxZoom:Se}=this.options;ie&&console.time("total time");const Ee=`prepare ${te.length} points`;ie&&console.time(Ee),this.points=te;const Re=[];for(let Pe=0;Pe<te.length;Pe++){const $e=te[Pe];if(!$e.geometry)continue;const[Je,We]=$e.geometry.coordinates,pt=Fi(Za(Je)),Ct=Fi($a(We));Re.push(pt,Ct,1/0,Pe,-1,1),this.options.reduce&&Re.push(0)}let qe=this.trees[Se+1]=this._createTree(Re);ie&&console.timeEnd(Ee);for(let Pe=Se;Pe>=me;Pe--){const $e=+Date.now();qe=this.trees[Pe]=this._createTree(this._cluster(qe,Pe)),ie&&console.log("z%d: %d clusters in %dms",Pe,qe.numItems,+Date.now()-$e)}return ie&&console.timeEnd("total time"),this}getClusters(te,ie){let me=((te[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,te[1]));let Ee=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)me=-180,Ee=180;else if(me>Ee){const We=this.getClusters([me,Se,180,Re],ie),pt=this.getClusters([-180,Se,Ee,Re],ie);return We.concat(pt)}const qe=this.trees[this._limitZoom(ie)],Pe=qe.range(Za(me),$a(Re),Za(Ee),$a(Se)),$e=qe.data,Je=[];for(const We of Pe){const pt=this.stride*We;Je.push($e[pt+lr]>1?ue($e,pt,this.clusterProps):this.points[$e[pt+Li]])}return Je}getChildren(te){const ie=this._getOriginId(te),me=this._getOriginZoom(te),Se="No cluster with the specified id.",Ee=this.trees[me];if(!Ee)throw new Error(Se);const Re=Ee.data;if(ie*this.stride>=Re.length)throw new Error(Se);const qe=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Pe=Ee.within(Re[ie*this.stride],Re[ie*this.stride+1],qe),$e=[];for(const Je of Pe){const We=Je*this.stride;Re[We+4]===te&&$e.push(Re[We+lr]>1?ue(Re,We,this.clusterProps):this.points[Re[We+Li]])}if($e.length===0)throw new Error(Se);return $e}getLeaves(te,ie,me){const Se=[];return this._appendLeaves(Se,te,ie=ie||10,me=me||0,0),Se}getTile(te,ie,me){const Se=this.trees[this._limitZoom(te)],Ee=Math.pow(2,te),{extent:Re,radius:qe}=this.options,Pe=qe/Re,$e=(me-Pe)/Ee,Je=(me+1+Pe)/Ee,We={features:[]};return this._addTileFeatures(Se.range((ie-Pe)/Ee,$e,(ie+1+Pe)/Ee,Je),Se.data,ie,me,Ee,We),ie===0&&this._addTileFeatures(Se.range(1-Pe/Ee,$e,1,Je),Se.data,Ee,me,Ee,We),ie===Ee-1&&this._addTileFeatures(Se.range(0,$e,Pe/Ee,Je),Se.data,-1,me,Ee,We),We.features.length?We:null}getClusterExpansionZoom(te){let ie=this._getOriginZoom(te)-1;for(;ie<=this.options.maxZoom;){const me=this.getChildren(te);if(ie++,me.length!==1)break;te=me[0].properties.cluster_id}return ie}_appendLeaves(te,ie,me,Se,Ee){const Re=this.getChildren(ie);for(const qe of Re){const Pe=qe.properties;if(Pe&&Pe.cluster?Ee+Pe.point_count<=Se?Ee+=Pe.point_count:Ee=this._appendLeaves(te,Pe.cluster_id,me,Se,Ee):Ee<Se?Ee++:te.push(qe),te.length===me)break}return Ee}_createTree(te){const ie=new s.bE(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<te.length;me+=this.stride)ie.add(te[me],te[me+1]);return ie.finish(),ie.data=te,ie}_addTileFeatures(te,ie,me,Se,Ee,Re){for(const qe of te){const Pe=qe*this.stride,$e=ie[Pe+lr]>1;let Je,We,pt;if($e)Je=Ha(ie,Pe,this.clusterProps),We=ie[Pe],pt=ie[Pe+1];else{const fi=this.points[ie[Pe+Li]];Je=fi.properties;const[ai,Ti]=fi.geometry.coordinates;We=Za(ai),pt=$a(Ti)}const Ct={type:1,geometry:[[Math.round(this.options.extent*(We*Ee-me)),Math.round(this.options.extent*(pt*Ee-Se))]],tags:Je};let Pt;Pt=$e||this.options.generateId?ie[Pe+Li]:this.points[ie[Pe+Li]].id,Pt!==void 0&&(Ct.id=Pt),Re.features.push(Ct)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,ie){const{radius:me,extent:Se,reduce:Ee,minPoints:Re}=this.options,qe=me/(Se*Math.pow(2,ie)),Pe=te.data,$e=[],Je=this.stride;for(let We=0;We<Pe.length;We+=Je){if(Pe[We+2]<=ie)continue;Pe[We+2]=ie;const pt=Pe[We],Ct=Pe[We+1],Pt=te.within(Pe[We],Pe[We+1],qe),fi=Pe[We+lr];let ai=fi;for(const Ti of Pt){const Ai=Ti*Je;Pe[Ai+2]>ie&&(ai+=Pe[Ai+lr])}if(ai>fi&&ai>=Re){let Ti,Ai=pt*fi,gn=Ct*fi,Cn=-1;const ki=(We/Je<<5)+(ie+1)+this.points.length;for(const cn of Pt){const un=cn*Je;if(Pe[un+2]<=ie)continue;Pe[un+2]=ie;const mn=Pe[un+lr];Ai+=Pe[un]*mn,gn+=Pe[un+1]*mn,Pe[un+4]=ki,Ee&&(Ti||(Ti=this._map(Pe,We,!0),Cn=this.clusterProps.length,this.clusterProps.push(Ti)),Ee(Ti,this._map(Pe,un)))}Pe[We+4]=ki,$e.push(Ai/ai,gn/ai,1/0,ki,-1,ai),Ee&&$e.push(Cn)}else{for(let Ti=0;Ti<Je;Ti++)$e.push(Pe[We+Ti]);if(ai>1)for(const Ti of Pt){const Ai=Ti*Je;if(!(Pe[Ai+2]<=ie)){Pe[Ai+2]=ie;for(let gn=0;gn<Je;gn++)$e.push(Pe[Ai+gn])}}}}return $e}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,ie,me){if(te[ie+lr]>1){const Re=this.clusterProps[te[ie+qn]];return me?Object.assign({},Re):Re}const Se=this.points[te[ie+Li]].properties,Ee=this.options.map(Se);return me&&Ee===Se?Object.assign({},Ee):Ee}}function ue(Ye,te,ie){return{type:"Feature",id:Ye[te+Li],properties:Ha(Ye,te,ie),geometry:{type:"Point",coordinates:[(me=Ye[te],360*(me-.5)),Mt(Ye[te+1])]}};var me}function Ha(Ye,te,ie){const me=Ye[te+lr],Se=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Ee=Ye[te+qn],Re=Ee===-1?{}:Object.assign({},ie[Ee]);return Object.assign(Re,{cluster:!0,cluster_id:Ye[te+Li],point_count:me,point_count_abbreviated:Se})}function Za(Ye){return Ye/360+.5}function $a(Ye){const te=Math.sin(Ye*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function Mt(Ye){const te=(180-360*Ye)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Aa(Ye,te,ie,me){let Se=me;const Ee=te+(ie-te>>1);let Re,qe=ie-te;const Pe=Ye[te],$e=Ye[te+1],Je=Ye[ie],We=Ye[ie+1];for(let pt=te+3;pt<ie;pt+=3){const Ct=Es(Ye[pt],Ye[pt+1],Pe,$e,Je,We);if(Ct>Se)Re=pt,Se=Ct;else if(Ct===Se){const Pt=Math.abs(pt-Ee);Pt<qe&&(Re=pt,qe=Pt)}}Se>me&&(Re-te>3&&Aa(Ye,te,Re,me),Ye[Re+2]=Se,ie-Re>3&&Aa(Ye,Re,ie,me))}function Es(Ye,te,ie,me,Se,Ee){let Re=Se-ie,qe=Ee-me;if(Re!==0||qe!==0){const Pe=((Ye-ie)*Re+(te-me)*qe)/(Re*Re+qe*qe);Pe>1?(ie=Se,me=Ee):Pe>0&&(ie+=Re*Pe,me+=qe*Pe)}return Re=Ye-ie,qe=te-me,Re*Re+qe*qe}function jr(Ye,te,ie,me){const Se={id:Ye??null,type:te,geometry:ie,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")Gi(Se,ie);else if(te==="Polygon")Gi(Se,ie[0]);else if(te==="MultiLineString")for(const Ee of ie)Gi(Se,Ee);else if(te==="MultiPolygon")for(const Ee of ie)Gi(Se,Ee[0]);return Se}function Gi(Ye,te){for(let ie=0;ie<te.length;ie+=3)Ye.minX=Math.min(Ye.minX,te[ie]),Ye.minY=Math.min(Ye.minY,te[ie+1]),Ye.maxX=Math.max(Ye.maxX,te[ie]),Ye.maxY=Math.max(Ye.maxY,te[ie+1])}function Er(Ye,te,ie,me){if(!te.geometry)return;const Se=te.geometry.coordinates;if(Se&&Se.length===0)return;const Ee=te.geometry.type,Re=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let qe=[],Pe=te.id;if(ie.promoteId?Pe=te.properties[ie.promoteId]:ie.generateId&&(Pe=me||0),Ee==="Point")Ma(Se,qe);else if(Ee==="MultiPoint")for(const $e of Se)Ma($e,qe);else if(Ee==="LineString")Xa(Se,qe,Re,!1);else if(Ee==="MultiLineString"){if(ie.lineMetrics){for(const $e of Se)qe=[],Xa($e,qe,Re,!1),Ye.push(jr(Pe,"LineString",qe,te.properties));return}_o(Se,qe,Re,!1)}else if(Ee==="Polygon")_o(Se,qe,Re,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const $e of te.geometry.geometries)Er(Ye,{id:Pe,geometry:$e,properties:te.properties},ie,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const $e of Se){const Je=[];_o($e,Je,Re,!0),qe.push(Je)}}Ye.push(jr(Pe,Ee,qe,te.properties))}function Ma(Ye,te){te.push(kl(Ye[0]),Di(Ye[1]),0)}function Xa(Ye,te,ie,me){let Se,Ee,Re=0;for(let Pe=0;Pe<Ye.length;Pe++){const $e=kl(Ye[Pe][0]),Je=Di(Ye[Pe][1]);te.push($e,Je,0),Pe>0&&(Re+=me?(Se*Je-$e*Ee)/2:Math.sqrt(Math.pow($e-Se,2)+Math.pow(Je-Ee,2))),Se=$e,Ee=Je}const qe=te.length-3;te[2]=1,Aa(te,0,qe,ie),te[qe+2]=1,te.size=Math.abs(Re),te.start=0,te.end=te.size}function _o(Ye,te,ie,me){for(let Se=0;Se<Ye.length;Se++){const Ee=[];Xa(Ye[Se],Ee,ie,me),te.push(Ee)}}function kl(Ye){return Ye/360+.5}function Di(Ye){const te=Math.sin(Ye*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function As(Ye,te,ie,me,Se,Ee,Re,qe){if(me/=te,Ee>=(ie/=te)&&Re<me)return Ye;if(Re<ie||Ee>=me)return null;const Pe=[];for(const $e of Ye){const Je=$e.geometry;let We=$e.type;const pt=Se===0?$e.minX:$e.minY,Ct=Se===0?$e.maxX:$e.maxY;if(pt>=ie&&Ct<me){Pe.push($e);continue}if(Ct<ie||pt>=me)continue;let Pt=[];if(We==="Point"||We==="MultiPoint")aa(Je,Pt,ie,me,Se);else if(We==="LineString")qr(Je,Pt,ie,me,Se,!1,qe.lineMetrics);else if(We==="MultiLineString")Ar(Je,Pt,ie,me,Se,!1);else if(We==="Polygon")Ar(Je,Pt,ie,me,Se,!0);else if(We==="MultiPolygon")for(const fi of Je){const ai=[];Ar(fi,ai,ie,me,Se,!0),ai.length&&Pt.push(ai)}if(Pt.length){if(qe.lineMetrics&&We==="LineString"){for(const fi of Pt)Pe.push(jr($e.id,We,fi,$e.tags));continue}We!=="LineString"&&We!=="MultiLineString"||(Pt.length===1?(We="LineString",Pt=Pt[0]):We="MultiLineString"),We!=="Point"&&We!=="MultiPoint"||(We=Pt.length===3?"Point":"MultiPoint"),Pe.push(jr($e.id,We,Pt,$e.tags))}}return Pe.length?Pe:null}function aa(Ye,te,ie,me,Se){for(let Ee=0;Ee<Ye.length;Ee+=3){const Re=Ye[Ee+Se];Re>=ie&&Re<=me&&Wa(te,Ye[Ee],Ye[Ee+1],Ye[Ee+2])}}function qr(Ye,te,ie,me,Se,Ee,Re){let qe=fr(Ye);const Pe=Se===0?Ru:Du;let $e,Je,We=Ye.start;for(let ai=0;ai<Ye.length-3;ai+=3){const Ti=Ye[ai],Ai=Ye[ai+1],gn=Ye[ai+2],Cn=Ye[ai+3],ki=Ye[ai+4],cn=Se===0?Ti:Ai,un=Se===0?Cn:ki;let mn=!1;Re&&($e=Math.sqrt(Math.pow(Ti-Cn,2)+Math.pow(Ai-ki,2))),cn<ie?un>ie&&(Je=Pe(qe,Ti,Ai,Cn,ki,ie),Re&&(qe.start=We+$e*Je)):cn>me?un<me&&(Je=Pe(qe,Ti,Ai,Cn,ki,me),Re&&(qe.start=We+$e*Je)):Wa(qe,Ti,Ai,gn),un<ie&&cn>=ie&&(Je=Pe(qe,Ti,Ai,Cn,ki,ie),mn=!0),un>me&&cn<=me&&(Je=Pe(qe,Ti,Ai,Cn,ki,me),mn=!0),!Ee&&mn&&(Re&&(qe.end=We+$e*Je),te.push(qe),qe=fr(Ye)),Re&&(We+=$e)}let pt=Ye.length-3;const Ct=Ye[pt],Pt=Ye[pt+1],fi=Se===0?Ct:Pt;fi>=ie&&fi<=me&&Wa(qe,Ct,Pt,Ye[pt+2]),pt=qe.length-3,Ee&&pt>=3&&(qe[pt]!==qe[0]||qe[pt+1]!==qe[1])&&Wa(qe,qe[0],qe[1],qe[2]),qe.length&&te.push(qe)}function fr(Ye){const te=[];return te.size=Ye.size,te.start=Ye.start,te.end=Ye.end,te}function Ar(Ye,te,ie,me,Se,Ee){for(const Re of Ye)qr(Re,te,ie,me,Se,Ee,!1)}function Wa(Ye,te,ie,me){Ye.push(te,ie,me)}function Ru(Ye,te,ie,me,Se,Ee){const Re=(Ee-te)/(me-te);return Wa(Ye,Ee,ie+(Se-ie)*Re,1),Re}function Du(Ye,te,ie,me,Se,Ee){const Re=(Ee-ie)/(Se-ie);return Wa(Ye,te+(me-te)*Re,Ee,1),Re}function Ya(Ye,te){const ie=[];for(let me=0;me<Ye.length;me++){const Se=Ye[me],Ee=Se.type;let Re;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")Re=Ka(Se.geometry,te);else if(Ee==="MultiLineString"||Ee==="Polygon"){Re=[];for(const qe of Se.geometry)Re.push(Ka(qe,te))}else if(Ee==="MultiPolygon"){Re=[];for(const qe of Se.geometry){const Pe=[];for(const $e of qe)Pe.push(Ka($e,te));Re.push(Pe)}}ie.push(jr(Se.id,Ee,Re,Se.tags))}return ie}function Ka(Ye,te){const ie=[];ie.size=Ye.size,Ye.start!==void 0&&(ie.start=Ye.start,ie.end=Ye.end);for(let me=0;me<Ye.length;me+=3)ie.push(Ye[me]+te,Ye[me+1],Ye[me+2]);return ie}function Gr(Ye,te){if(Ye.transformed)return Ye;const ie=1<<Ye.z,me=Ye.x,Se=Ye.y;for(const Ee of Ye.features){const Re=Ee.geometry,qe=Ee.type;if(Ee.geometry=[],qe===1)for(let Pe=0;Pe<Re.length;Pe+=2)Ee.geometry.push(go(Re[Pe],Re[Pe+1],te,ie,me,Se));else for(let Pe=0;Pe<Re.length;Pe++){const $e=[];for(let Je=0;Je<Re[Pe].length;Je+=2)$e.push(go(Re[Pe][Je],Re[Pe][Je+1],te,ie,me,Se));Ee.geometry.push($e)}}return Ye.transformed=!0,Ye}function go(Ye,te,ie,me,Se,Ee){return[Math.round(ie*(Ye*me-Se)),Math.round(ie*(te*me-Ee))]}function Pn(Ye,te,ie,me,Se){const Ee=te===Se.maxZoom?0:Se.tolerance/((1<<te)*Se.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:Ye.length,source:null,x:ie,y:me,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const qe of Ye)bn(Re,qe,Ee,Se);return Re}function bn(Ye,te,ie,me){const Se=te.geometry,Ee=te.type,Re=[];if(Ye.minX=Math.min(Ye.minX,te.minX),Ye.minY=Math.min(Ye.minY,te.minY),Ye.maxX=Math.max(Ye.maxX,te.maxX),Ye.maxY=Math.max(Ye.maxY,te.maxY),Ee==="Point"||Ee==="MultiPoint")for(let qe=0;qe<Se.length;qe+=3)Re.push(Se[qe],Se[qe+1]),Ye.numPoints++,Ye.numSimplified++;else if(Ee==="LineString")Vc(Re,Se,Ye,ie,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let qe=0;qe<Se.length;qe++)Vc(Re,Se[qe],Ye,ie,Ee==="Polygon",qe===0);else if(Ee==="MultiPolygon")for(let qe=0;qe<Se.length;qe++){const Pe=Se[qe];for(let $e=0;$e<Pe.length;$e++)Vc(Re,Pe[$e],Ye,ie,!0,$e===0)}if(Re.length){let qe=te.tags||null;if(Ee==="LineString"&&me.lineMetrics){qe={};for(const $e in te.tags)qe[$e]=te.tags[$e];qe.mapbox_clip_start=Se.start/Se.size,qe.mapbox_clip_end=Se.end/Se.size}const Pe={geometry:Re,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:qe};te.id!==null&&(Pe.id=te.id),Ye.features.push(Pe)}}function Vc(Ye,te,ie,me,Se,Ee){const Re=me*me;if(me>0&&te.size<(Se?Re:me))return void(ie.numPoints+=te.length/3);const qe=[];for(let Pe=0;Pe<te.length;Pe+=3)(me===0||te[Pe+2]>Re)&&(ie.numSimplified++,qe.push(te[Pe],te[Pe+1])),ie.numPoints++;Se&&function(Pe,$e){let Je=0;for(let We=0,pt=Pe.length,Ct=pt-2;We<pt;Ct=We,We+=2)Je+=(Pe[We]-Pe[Ct])*(Pe[We+1]+Pe[Ct+1]);if(Je>0===$e)for(let We=0,pt=Pe.length;We<pt/2;We+=2){const Ct=Pe[We],Pt=Pe[We+1];Pe[We]=Pe[pt-2-We],Pe[We+1]=Pe[pt-1-We],Pe[pt-2-We]=Ct,Pe[pt-1-We]=Pt}}(qe,Ee),Ye.push(qe)}const Bl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class rs{constructor(te,ie){const me=(ie=this.options=function(Ee,Re){for(const qe in Re)Ee[qe]=Re[qe];return Ee}(Object.create(Bl),ie)).debug;if(me&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=function(Ee,Re){const qe=[];if(Ee.type==="FeatureCollection")for(let Pe=0;Pe<Ee.features.length;Pe++)Er(qe,Ee.features[Pe],Re,Pe);else Er(qe,Ee.type==="Feature"?Ee:{geometry:Ee},Re);return qe}(te,ie);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=function(Ee,Re){const qe=Re.buffer/Re.extent;let Pe=Ee;const $e=As(Ee,1,-1-qe,qe,0,-1,2,Re),Je=As(Ee,1,1-qe,2+qe,0,-1,2,Re);return($e||Je)&&(Pe=As(Ee,1,-qe,1+qe,0,-1,2,Re)||[],$e&&(Pe=Ya($e,1).concat(Pe)),Je&&(Pe=Pe.concat(Ya(Je,-1)))),Pe}(Se,ie),Se.length&&this.splitTile(Se,0,0,0),me&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,ie,me,Se,Ee,Re,qe){const Pe=[te,ie,me,Se],$e=this.options,Je=$e.debug;for(;Pe.length;){Se=Pe.pop(),me=Pe.pop(),ie=Pe.pop(),te=Pe.pop();const We=1<<ie,pt=Ia(ie,me,Se);let Ct=this.tiles[pt];if(!Ct&&(Je>1&&console.time("creation"),Ct=this.tiles[pt]=Pn(te,ie,me,Se,$e),this.tileCoords.push({z:ie,x:me,y:Se}),Je)){Je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,me,Se,Ct.numFeatures,Ct.numPoints,Ct.numSimplified),console.timeEnd("creation"));const mn=`z${ie}`;this.stats[mn]=(this.stats[mn]||0)+1,this.total++}if(Ct.source=te,Ee==null){if(ie===$e.indexMaxZoom||Ct.numPoints<=$e.indexMaxPoints)continue}else{if(ie===$e.maxZoom||ie===Ee)continue;if(Ee!=null){const mn=Ee-ie;if(me!==Re>>mn||Se!==qe>>mn)continue}}if(Ct.source=null,te.length===0)continue;Je>1&&console.time("clipping");const Pt=.5*$e.buffer/$e.extent,fi=.5-Pt,ai=.5+Pt,Ti=1+Pt;let Ai=null,gn=null,Cn=null,ki=null,cn=As(te,We,me-Pt,me+ai,0,Ct.minX,Ct.maxX,$e),un=As(te,We,me+fi,me+Ti,0,Ct.minX,Ct.maxX,$e);te=null,cn&&(Ai=As(cn,We,Se-Pt,Se+ai,1,Ct.minY,Ct.maxY,$e),gn=As(cn,We,Se+fi,Se+Ti,1,Ct.minY,Ct.maxY,$e),cn=null),un&&(Cn=As(un,We,Se-Pt,Se+ai,1,Ct.minY,Ct.maxY,$e),ki=As(un,We,Se+fi,Se+Ti,1,Ct.minY,Ct.maxY,$e),un=null),Je>1&&console.timeEnd("clipping"),Pe.push(Ai||[],ie+1,2*me,2*Se),Pe.push(gn||[],ie+1,2*me,2*Se+1),Pe.push(Cn||[],ie+1,2*me+1,2*Se),Pe.push(ki||[],ie+1,2*me+1,2*Se+1)}}getTile(te,ie,me){te=+te,ie=+ie,me=+me;const Se=this.options,{extent:Ee,debug:Re}=Se;if(te<0||te>24)return null;const qe=1<<te,Pe=Ia(te,ie=ie+qe&qe-1,me);if(this.tiles[Pe])return Gr(this.tiles[Pe],Ee);Re>1&&console.log("drilling down to z%d-%d-%d",te,ie,me);let $e,Je=te,We=ie,pt=me;for(;!$e&&Je>0;)Je--,We>>=1,pt>>=1,$e=this.tiles[Ia(Je,We,pt)];return $e&&$e.source?(Re>1&&(console.log("found parent tile z%d-%d-%d",Je,We,pt),console.time("drilling down")),this.splitTile($e.source,Je,We,pt,te,ie,me),Re>1&&console.timeEnd("drilling down"),this.tiles[Pe]?Gr(this.tiles[Pe],Ee):null):null}}function Ia(Ye,te,ie){return 32*((1<<Ye)*ie+te)+Ye}function zu(Ye,te){const ie=Ye.tileID.canonical;if(!this._geoJSONIndex)return void te(null,null);const me=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!me)return void te(null,null);const Se=new Oi(me.features);let Ee=_i(Se);Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),te(null,{vectorTile:Se,rawData:Ee.buffer})}class Nl extends vi{constructor(te,ie,me,Se,Ee,Re){super(te,ie,me,Se,zu,Re),Ee&&(this.loadGeoJSON=Ee),this._dynamicIndex=new tn}loadData(te,ie){const me=te&&te.request,Se=me&&me.collectResourceTiming;this.loadGeoJSON(te,(Ee,Re)=>{if(Ee||!Re)return ie(Ee);if(typeof Re!="object")return ie(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const Pe=s.X(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map($e=>`${$e.key}: ${$e.message}`).join(", "));Re.features=Re.features.filter($e=>Pe.value.evaluate({zoom:0},$e))}te.dynamic?(Re.type==="Feature"&&(Re={type:"FeatureCollection",features:[Re]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Re.features,this.loaded),te.cluster&&(Re.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new Ws(function({superclusterOptions:Pe,clusterProperties:$e}){if(!$e||!Pe)return Pe;const Je={},We={},pt={accumulated:null,zoom:0},Ct={properties:null},Pt=Object.keys($e);for(const fi of Pt){const[ai,Ti]=$e[fi],Ai=s.X(Ti),gn=s.X(typeof ai=="string"?[ai,["accumulated"],["get",fi]]:ai);Je[fi]=Ai.value,We[fi]=gn.value}return Pe.map=fi=>{Ct.properties=fi;const ai={};for(const Ti of Pt)ai[Ti]=Je[Ti].evaluate(pt,Ct);return ai},Pe.reduce=(fi,ai)=>{Ct.properties=ai;for(const Ti of Pt)pt.accumulated=fi[Ti],fi[Ti]=We[Ti].evaluate(pt,Ct)},Pe}(te)).load(Re.features):te.dynamic?this._dynamicIndex:function(Pe,$e){return new rs(Pe,$e)}(Re,te.geojsonVtOptions)}catch(Pe){return ie(Pe)}const qe={};if(Se){const Pe=pe(me);Pe&&(qe.resourceTiming={},qe.resourceTiming[te.source]=JSON.parse(JSON.stringify(Pe)))}ie(null,qe)}})}reloadTile(te,ie){const me=this.loaded;return me&&me[te.uid]?te.partial?ie(null,void 0):super.reloadTile(te,ie):this.loadTile(te,ie)}loadGeoJSON(te,ie){if(te.request)s.n(te.request,ie);else{if(typeof te.data!="string")return ie(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(te.data))}catch{return ie(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(me){ie(me)}}getClusterChildren(te,ie){try{ie(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(me){ie(me)}}getClusterLeaves(te,ie){try{ie(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(me){ie(me)}}}class Pu{constructor(te,ie){this.tileID=new s.aH(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=ie}parse(te,ie,me,Se){this.status="parsing";const Ee=new s.aH(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),Re=[],qe=ie.familiesBySource[me.source],Pe=new s.e0(Ee,me.promoteId);return Pe.bucketLayerIDs=[],Pe.is3DTile=!0,s.ei(te).then($e=>{if(!$e)return Se(new Error("Could not parse tile"));const Je=s.ej($e,1/s.cd(me.tileID.canonical)),We=$e.json.extensionsUsed&&$e.json.extensionsUsed.includes("MAPBOX_mesh_features")||$e.json.asset.extras&&$e.json.asset.extras.MAPBOX_mesh_features,pt=$e.json.extensionsUsed&&$e.json.extensionsUsed.includes("EXT_meshopt_compression"),Ct=new s.aa(this.zoom,{brightness:this.brightness});for(const Pt in qe)for(const fi of qe[Pt]){const ai=fi[0];Pe.bucketLayerIDs.push(fi.map(Ai=>s.C(Ai.id,Ai.scope))),ai.recalculate(Ct,[]);const Ti=new s.ek(fi,Je,Ee,We,pt,this.brightness,Pe);We||(Ti.needsUpload=!0),Re.push(Ti),Ti.evaluate(ai)}this.status="done",Se(null,{buckets:Re,featureIndex:Pe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch($e=>Se(new Error($e.message)))}}class jc{constructor(te,ie,me,Se,Ee,Re){this.actor=te,this.layerIndex=ie,this.availableImages=me,this.brightness=Re,this.loading={},this.loaded={}}loadTile(te,ie){const me=te.uid,Se=this.loading[me]=new Pu(te,this.brightness);s.bj(te.request,(Ee,Re)=>{const qe=!this.loading[me];return delete this.loading[me],qe||Ee?(Se.status="done",qe||(this.loaded[me]=Se),ie(Ee)):Re&&Re.byteLength!==0?void Se.parse(Re,this.layerIndex,te,(Pe,$e)=>{Se.status="done",this.loaded=this.loaded||{},this.loaded[me]=Se,Pe||!$e?ie(Pe):ie(null,$e)}):(Se.status="done",this.loaded[me]=Se,ie())})}reloadTile(te,ie){const me=this.loaded,Se=te.uid;if(me&&me[Se]){const Ee=me[Se];Ee.projection=te.projection,Ee.brightness=te.brightness;const Re=(qe,Pe)=>{Ee.reloadCallback&&(delete Ee.reloadCallback,this.loadTile(te,ie)),ie(qe,Pe)};Ee.status==="parsing"?Ee.reloadCallback=Re:Ee.status==="done"&&this.loadTile(te,ie)}}abortTile(te,ie){const me=te.uid;this.loading[me]&&delete this.loading[me],ie()}removeTile(te,ie){const me=this.loaded,Se=te.uid;me&&me[Se]&&delete me[Se],ie()}}class Fl{constructor(te){this.self=te,this.actor=new s.el(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.projections={},this.defaultProjection=s.bP({name:"mercator"}),this.workerSourceTypes={vector:vi,geojson:Nl,"raster-dem":at,"raster-array":qt,"batched-model":jc},this.workerSources={},this.self.registerWorkerSource=(ie,me)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=me},this.self.registerRTLTextPlugin=ie=>{if(s.em.isParsed())throw new Error("RTL text plugin already registered.");s.em.applyArabicShaping=ie.applyArabicShaping,s.em.processBidirectionalText=ie.processBidirectionalText,s.em.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(te,ie,me){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],me()}checkIfReady(te,ie,me){me()}setReferrer(te,ie){this.referrer=ie}spriteLoaded(te,{scope:ie,isLoaded:me}){if(this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.isSpriteLoaded[te][ie]=me,this.workerSources[te]&&this.workerSources[te][ie])for(const Se in this.workerSources[te][ie]){const Ee=this.workerSources[te][ie][Se];for(const Re in Ee){const qe=Ee[Re];qe instanceof vi&&(qe.isSpriteLoaded=me,qe.fire(new s.A("isSpriteLoaded")))}}}setImages(te,{scope:ie,images:me},Se){if(this.availableImages[te]||(this.availableImages[te]={}),this.availableImages[te][ie]=me,this.workerSources[te]&&this.workerSources[te][ie]){for(const Ee in this.workerSources[te][ie]){const Re=this.workerSources[te][ie][Ee];for(const qe in Re)Re[qe].availableImages=me}Se()}else Se()}setProjection(te,ie){this.projections[te]=s.bP(ie)}setBrightness(te,ie,me){this.brightness=ie,me()}setLayers(te,ie,me){this.getLayerIndex(te,ie.scope).replace(ie.layers,ie.options),me()}updateLayers(te,ie,me){this.getLayerIndex(te,ie.scope).update(ie.layers,ie.removedIds,ie.options),me()}loadTile(te,ie,me){ie.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,ie.type,ie.source,ie.scope).loadTile(ie,me)}decodeRasterArray(te,ie,me){this.getWorkerSource(te,ie.type,ie.source,ie.scope).decodeRasterArray(ie,me)}reloadTile(te,ie,me){ie.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,ie.type,ie.source,ie.scope).reloadTile(ie,me)}abortTile(te,ie,me){this.getWorkerSource(te,ie.type,ie.source,ie.scope).abortTile(ie,me)}removeTile(te,ie,me){this.getWorkerSource(te,ie.type,ie.source,ie.scope).removeTile(ie,me)}removeSource(te,ie,me){if(!(this.workerSources[te]&&this.workerSources[te][ie.scope]&&this.workerSources[te][ie.scope][ie.type]&&this.workerSources[te][ie.scope][ie.type][ie.source]))return;const Se=this.workerSources[te][ie.scope][ie.type][ie.source];delete this.workerSources[te][ie.scope][ie.type][ie.source],Se.removeSource!==void 0?Se.removeSource(ie,me):me()}loadWorkerSource(te,ie,me){try{this.self.importScripts(ie.url),me()}catch(Se){me(Se.toString())}}syncRTLPluginState(te,ie,me){try{s.em.setState(ie);const Se=s.em.getPluginURL();if(s.em.isLoaded()&&!s.em.isParsed()&&Se!=null){this.self.importScripts(Se);const Ee=s.em.isParsed();me(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Se}`),Ee)}}catch(Se){me(Se.toString())}}setDracoUrl(te,ie){this.dracoUrl=ie}getAvailableImages(te,ie){this.availableImages[te]||(this.availableImages[te]={});let me=this.availableImages[te][ie];return me||(me=[]),me}getLayerIndex(te,ie){this.layerIndexes[te]||(this.layerIndexes[te]={});let me=this.layerIndexes[te][ie];return me||(me=this.layerIndexes[te][ie]=new wt,me.scope=ie),me}getWorkerSource(te,ie,me,Se){const Ee=this.workerSources;return Ee[te]||(Ee[te]={}),Ee[te][Se]||(Ee[te][Se]={}),Ee[te][Se][ie]||(Ee[te][Se][ie]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),Ee[te][Se][ie][me]||(Ee[te][Se][ie][me]=new this.workerSourceTypes[ie]({send:(Re,qe,Pe,$e,Je,We)=>{this.actor.send(Re,qe,Pe,te,Je,We)},scheduler:this.actor.scheduler},this.getLayerIndex(te,Se),this.getAvailableImages(te,Se),this.isSpriteLoaded[te][Se],void 0,this.brightness)),Ee[te][Se][ie][me]}rasterizeImages(te,ie,me){const Se=new Map;for(const[Ee,{image:Re,imageVariant:qe}]of ie.tasks.entries()){const Pe=this.imageRasterizer.rasterize(qe,Re,ie.scope,te);Se.set(Ee,Pe)}me(void 0,Se)}removeRasterizedImages(te,ie,me){this.imageRasterizer.removeImagesFromCacheByIds(ie.imageIds,ie.scope,te),me()}enforceCacheSizeLimit(te,ie){s.en(ie)}getWorkerPerformanceMetrics(te,ie,me){me(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Fl(self)),Fl}),K(["./shared"],function(s){var pe="3.11.1";const Ce={create:"create",load:"load",fullLoad:"fullLoad"},He={mark(h){performance.mark(h)},measure(h,t,n){performance.measure(h,t,n)}};function wt(h){const t=h.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var gt,Xt={},jt=function(){if(gt)return Xt;function h(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,C=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(C);try{x=new Worker(P),g=!0}catch{g=!1}return x&&x.terminate(),URL.revokeObjectURL(P),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var C=x.getImageData(0,0,1,1);return C&&C.width===g.width}()?(n[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(n[p]=function(g){var x,C=function(P){var O=document.createElement("canvas"),k=Object.create(h.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=P,O.getContext("webgl2",k)}(g);if(!C)return!1;try{x=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!x||C.isContextLost())&&(C.shaderSource(x,"void main() {}"),C.compileShader(x),C.getShaderParameter(x,C.COMPILE_STATUS)===!0)}(p)),n[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}gt=1,Xt.supported=h,Xt.notSupportedReason=t;var n={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Xt}();function hi(h,t,n){const u=document.createElement(h);return t!=null&&(u.className=t),n&&n.appendChild(u),u}function vi(h,t,n){const u=document.createElementNS("http://www.w3.org/2000/svg",h);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return n&&n.appendChild(u),u}const at=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ni=at&&at.userSelect!==void 0?"userSelect":"WebkitUserSelect";let qt;function $t(){at&&ni&&(qt=at[ni],at[ni]="none")}function kt(){at&&ni&&(at[ni]=qt)}function Oi(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",Oi,!0)}function Gt(){window.addEventListener("click",Oi,!0),window.setTimeout(()=>{window.removeEventListener("click",Oi,!0)},0)}function oi(h,t){const n=h.getBoundingClientRect();return ei(h,n,t)}function tn(h,t){const n=h.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(ei(h,n,t[p]));return u}function Jt(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function ei(h,t,n){const u=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new s.P((n.clientX-t.left)*u,(n.clientY-t.top)*u)}const Vn="01",fs="NO_ACCESS_TOKEN";class Ss{constructor(t,n,u){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let u=0;u<10;u++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Vn,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!s.f(t))return t;const u=bt(t);return u.params.push(`sdk=js-${pe}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!s.f(t))return t;const u=bt(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeModelURL(t,n){if(!s.f(t))return t;const u=bt(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeSourceURL(t,n,u,p){if(!s.f(t))return t;const g=bt(t);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),u&&g.params.push(`language=${u}`),p&&g.params.push(`worldview=${p}`),this._makeAPIURL(g,this._customAccessToken||n)}normalizeIconsetURL(t,n){const u=bt(t);return s.f(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||n)):ri(u)}normalizeSpriteURL(t,n,u,p){const g=bt(t);return s.f(t)?(g.path=`/styles/v1${g.path}/sprite${n}${u}`,this._makeAPIURL(g,this._customAccessToken||p)):(g.path+=`${n}${u}`,ri(g))}normalizeTileURL(t,n,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.f(t))return t;const p=bt(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||u&&p.authority!=="raster"&&u===512?"@2x":""}${s.m.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${s.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${s.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${s.e.TILE_URL_VERSION}${p.path}`);const g=this._customAccessToken||function(x){for(const C of x){const P=C.match(/^access_token=(.*)$/);if(P)return P[1]}return null}(p.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,g)}canonicalizeTileURL(t,n){const u=bt(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let g=u.params;return n&&(g=g.filter(x=>!x.match(/^access_token=/))),g.length&&(p+=`?${g.join("&")}`),p}canonicalizeTileset(t,n){const u=!!n&&s.f(n),p=[];for(const g of t.tiles||[])s.h(g)?p.push(this.canonicalizeTileURL(g,u)):p.push(g);return p}_makeAPIURL(t,n){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=bt(s.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return ri(t);if(n=n||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(g=>g.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),ri(t)}}const mi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function bt(h){const t=h.match(mi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ri(h){const t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}const Ni="mapbox.eventData";function si(h){if(!h)return null;const t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.j(t[1]))}catch{return null}}class Ze{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=si(s.e.ACCESS_TOKEN);let u="";return u=n&&n.u?s.k(n.u):s.e.ACCESS_TOKEN||"",t?`${Ni}.${t}:${u}`:`${Ni}:${u}`}fetchEventData(){const t=s.s("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(n);p&&(this.eventData=JSON.parse(p));const g=localStorage.getItem(u);g&&(this.anonId=g)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(u,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,u,p){if(!s.e.EVENTS_URL)return;const g=bt(s.e.EVENTS_URL);g.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(t).toISOString()},C=n?s.l(x,n):x,P={url:ri(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=s.p(P,O=>{this.pendingRequest=null,u(O),this.saveEventData(),this.processRequests(p)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const Ft=new class extends Ze{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(n=>s.f(n)||s.h(n))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=si(s.e.ACCESS_TOKEN),n=t?t.u:s.e.ACCESS_TOKEN;let u=n!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),x=new Date(p),C=(p-this.eventData.lastSuccess)/864e5;u=u||C>=1||C<-1||g.getDate()!==x.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:pe,skuId:Vn,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=n)},h):this.processRequests()}},_i=Ft.postTurnstileEvent.bind(Ft),Tt=new class extends Ze{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,n,u){this.skuToken=t,this.errorCb=u,s.e.EVENTS_URL&&(n||s.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},n):this.errorCb(new Error(fs)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:pe,skuId:Vn,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},h))}remove(){this.errorCb=null}},Fi=Tt.postMapLoadEvent.bind(Tt),wn=new class extends Ze{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=s.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){const t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){const{map:n,style:u,importedStyles:p}=t;if(!s.e.EVENTS_URL||!h&&!s.e.ACCESS_TOKEN)return;const g=this.getMapInstanceId(n),x={mapInstanceId:g,eventId:this.getEventId(g),style:u};p.length&&(x.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:x},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},h)}},Li=wn.postStyleLoadEvent.bind(wn),lr=new class extends Ze{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){s.e.EVENTS_URL&&(h||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),u=function(p){const g=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),C=function(Z){const Y={};if(Z){for(const X in Z)if(X!=="other")for(const J of Z[X]){const ee=`${X}ResolveRangeMin`,oe=`${X}ResolveRangeMax`,fe=`${X}RequestCount`,ce=`${X}RequestCachedCount`;Y[ee]=Math.min(Y[ee]||1/0,J.startTime),Y[oe]=Math.max(Y[oe]||-1/0,J.responseEnd);const xe=_e=>{Y[_e]===void 0&&(Y[_e]=0),++Y[_e]};J.transferSize!==void 0&&J.transferSize===0&&xe(ce),xe(fe)}}return Y}(function(Z,Y){const X={};if(Z)for(const J of Z){const ee=Y(J);X[ee]===void 0&&(X[ee]=[]),X[ee].push(J)}return X}(g,wt)),P=window.devicePixelRatio,O=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=O?O.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},F=(Z,Y,X)=>{X!=null&&Z.push({name:Y,value:X.toString()})};for(const Z in C)F(U.counters,Z,C[Z]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(F(U.counters,"interactionRangeMin",p.interactionRange[0]),F(U.counters,"interactionRangeMax",p.interactionRange[1])),x)for(const Z of Object.keys(Ce)){const Y=Ce[Z],X=x.find(J=>J.name===Y);X&&F(U.counters,Y,X.startTime)}return F(U.counters,"visibilityHidden",p.visibilityHidden),F(U.attributes,"style",function(Z){if(Z)for(const Y of Z){const X=Y.name.split("?")[0];if(s.i(X)){const J=X.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}}(g)),F(U.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),F(U.attributes,"fogEnabled",p.fogEnabled?"true":"false"),F(U.attributes,"projection",p.projection),F(U.attributes,"zoom",p.zoom),F(U.metadata,"devicePixelRatio",P),F(U.metadata,"connectionEffectiveType",k),F(U.metadata,"navigatorUserAgent",navigator.userAgent),F(U.metadata,"screenWidth",window.screen.width),F(U.metadata,"screenHeight",window.screen.height),F(U.metadata,"windowWidth",window.innerWidth),F(U.metadata,"windowHeight",window.innerHeight),F(U.metadata,"mapWidth",p.width/P),F(U.metadata,"mapHeight",p.height/P),F(U.metadata,"webglRenderer",p.renderer),F(U.metadata,"webglVendor",p.vendor),F(U.metadata,"sdkVersion",pe),F(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(n);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},h)}},qn=lr.postPerformanceEvent.bind(lr),Ws=new class extends Ze{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,n,u){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const p=bt(s.e.API_URL+s.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||s.e.ACCESS_TOKEN||""}`);const g={url:ri(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(g,x=>{this.pendingRequest=null,n(x),this.saveEventData(),this.processRequests(u)})}getSessionAPI(h,t,n,u){this.skuToken=t,this.errorCb=u,s.e.SESSION_PATH&&s.e.API_URL&&(n||s.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},n):this.errorCb(new Error(fs)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},h)}remove(){this.errorCb=null}},ue=Ws.getSessionAPI.bind(Ws),Ha=new Set;function Za(h,t){t?Ha.add(h):Ha.delete(h)}class $a{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,n){this._updatedImages[n]=this._updatedImages[n]||new Set,this._updatedImages[n].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Mt(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class Aa extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const n=this.atlasTexture.get(t);n&&(n.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,n){this.imageProviders.has(n)||this.imageProviders.set(n,new Map),this.imageProviders.get(n).set(t.id,t)}removeImageProvider(t,n){this.imageProviders.has(n)&&this.imageProviders.get(n).delete(t)}getPendingImageProviders(){const t=[];for(const n of this.imageProviders.values())for(const u of n.values())u.hasPendingRequests()&&t.push(u);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,n){if(this.loaded.get(n)!==t&&(this.loaded.set(n,t),t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,n,p);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images.get(n).get(t.toString())}addImage(t,n,u){this._validate(t,u)&&this.images.get(n).set(t.toString(),u)}_validate(t,n){let u=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(n.content,n)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "content" value`))),u=!1),u}_validateStretch(t,n){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||n<p[1])return!1;u=p[1]}return!0}_validateContent(t,n){return t?t.length!==4||!n.usvg&&(t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,n,u){const p=this.images.get(n).get(t.toString());u.version=p.version+1,this.images.get(n).set(t.toString(),u),this.updatedImages.get(n).add(t),this.removeFromImageRasterizerCache(t,n)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,n){if(this.spriteFormat!=="raster")if(s.t()){const u={imageIds:[t],scope:n};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",u)}else this.imageRasterizer.removeImagesFromCacheByIds([t],n)}removeImage(t,n){const u=this.images.get(n),p=u.get(t.toString());u.delete(t.toString()),this.patterns.get(n).delete(t.toString()),this.removeFromImageRasterizerCache(t,n),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(n=>s.I.from(n))}getImages(t,n,u){const p=[],g=[],x=this.imageProviders.get(n);for(const k of t){if(!k.iconsetId){p.push(k);continue}const U=x.get(k.iconsetId);U&&(this.getImage(k,n)?g.push(k):U.addPendingRequest(k))}if(p.length===0)return void this._notify(g,n,u);let C=!0;const P=!!this.loaded.get(n),O=this.images.get(n);if(!P)for(const k of p)O.has(k.toString())||(C=!1);P||C?this._notify(p,n,u):this.requestors.push({ids:p,scope:n,callback:u})}rasterizeImages({scope:t,tasks:n},u){const p=new Map;for(const[g,x]of n.entries()){const C=this.getImage(x.id,t);C&&p.set(g,{image:C,imageVariant:x})}this._rasterizeImages(t,p,u)}_rasterizeImages(t,n,u){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:n,scope:t},u);else{const p=new Map;for(const[g,{image:x,imageVariant:C}]of n.entries())p.set(g,this.imageRasterizer.rasterize(C,x,t,0));u(void 0,p)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,n,u){const p=this.images.get(n),g=new Map;for(const x of t){const C=p.get(x.toString());if(!C){if(x.iconsetId)continue;s.w(`Image "${x.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new s.A("styleimagemissing",{id:x.name}));continue}const P={data:C.usvg?null:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,usvg:C.usvg,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!!(C.userImage&&C.userImage.render)};C.usvg&&Object.assign(P,{width:C.icon.usvg_tree.width,height:C.icon.usvg_tree.height}),g.set(s.I.toString(x),P)}u(null,g)}getPixelSize(t){const{width:n,height:u}=this.atlasImage.get(t);return{width:n,height:u}}getPattern(t,n,u){const p=t.toString(),g=this.patterns.get(n),x=g.get(p),C=this.getImage(t,n);if(!C)return null;if(x){if(x.position.version===C.version)return x.position;x.position.version=C.version}else{if(C.usvg&&!C.data){const P=this.getPatternInFlightId(p,n);if(this.patternsInFlight.has(P))return null;this.patternsInFlight.add(P);const O=new s.B(t).scaleSelf(s.q.devicePixelRatio),k=new Map([[O.toString(),{image:C,imageVariant:O}]]);return this._rasterizeImages(n,k,(U,F)=>this.storePatternImage(O,n,C,u,F)),null}this.storePattern(t,n,C)}return this._updatePatternAtlas(n,u),g.get(p).position}getPatternInFlightId(t,n){return s.C(t,n)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,n,u,p,g){const x=t.toString(),C=g?g.get(x):void 0;C&&(u.data=C,this.storePattern(t.id,n,u),this._updatePatternAtlas(n,p),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),n)))}storePattern(t,n,u){const p={w:u.data.width+2*s.F,h:u.data.height+2*s.F,x:0,y:0},g=new s.G(p,u,s.F);this.patterns.get(n).set(t.toString(),{bin:p,position:g})}bind(t,n){const u=t.gl;let p=this.atlasTexture.get(n);p?this.dirty&&(p.update(this.atlasImage.get(n)),this.dirty=!1):(p=new s.T(t,this.atlasImage.get(n),u.RGBA8),this.atlasTexture.set(n,p)),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const u=this.patterns.get(t),p=Array.from(u.values()).map(({bin:O})=>O),{w:g,h:x}=s.H(p),C=this.atlasImage.get(t);C.resize({width:g||1,height:x||1});const P=this.images.get(t);for(const[O,{bin:k,position:U}]of u.entries()){let F=U.padding;const Z=k.x+F,Y=k.y+F,X=P.get(O).data,J=X.width,ee=X.height;F=F>1?F-1:F,s.r.copy(X,C,{x:0,y:0},{x:Z,y:Y},{width:J,height:ee},n),s.r.copy(X,C,{x:0,y:ee-F},{x:Z,y:Y-F},{width:J,height:F},n),s.r.copy(X,C,{x:0,y:0},{x:Z,y:Y+ee},{width:J,height:F},n),s.r.copy(X,C,{x:J-F,y:0},{x:Z-F,y:Y},{width:F,height:ee},n),s.r.copy(X,C,{x:0,y:0},{x:Z+J,y:Y},{width:F,height:ee},n),s.r.copy(X,C,{x:J-F,y:ee-F},{x:Z-F,y:Y-F},{width:F,height:F},n),s.r.copy(X,C,{x:0,y:ee-F},{x:Z+J,y:Y-F},{width:F,height:F},n),s.r.copy(X,C,{x:0,y:0},{x:Z+J,y:Y+ee},{width:F,height:F},n),s.r.copy(X,C,{x:J-F,y:0},{x:Z-F,y:Y+ee},{width:F,height:F},n)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,n){const u=this.images.get(n);for(const p of t){if(this.callbackDispatchedThisFrame.get(n).has(p.toString()))continue;this.callbackDispatchedThisFrame.get(n).add(p.toString());const g=u.get(p.toString());Mt(g)&&this.updateImage(p,n,g)}}}function Es(h){const t=h.key,n=h.value,u=h.valueSpec||{},p=h.objectElementValidators||{},g=h.style,x=h.styleSpec;let C=[];const P=s.K(n);if(P!=="object")return[new s.V(t,n,`object expected, ${P} found`)];for(const O in n){const k=O.split(".")[0];let U;p[k]?U=p[k]:u[k]?U=bn:p["*"]?U=p["*"]:u["*"]&&(U=bn),U?C=C.concat(U({key:(t&&`${t}.`)+O,value:n[O],valueSpec:u[k]||u["*"],style:g,styleSpec:x,object:n,objectKey:O},n)):C.push(new s.J(t,n[O],`unknown property "${O}"`))}for(const O in u)p[O]||u[O].required&&u[O].default===void 0&&n[O]===void 0&&C.push(new s.V(t,n,`missing required property "${O}"`));return C}function jr(h){const t=h.value,n=h.valueSpec,u=h.style,p=h.styleSpec,g=h.key,x=h.arrayElementValidator||bn;if(s.K(t)!=="array")return[new s.V(g,t,`array expected, ${s.K(t)} found`)];if(n.length&&t.length!==n.length)return[new s.V(g,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new s.V(g,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let C={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};p.$version<7&&(C.function=n.function),s.K(n.value)==="object"&&(C=n.value);let P=[];for(let O=0;O<t.length;O++)P=P.concat(x({array:t,arrayIndex:O,value:t[O],valueSpec:C,style:u,styleSpec:p,key:`${g}[${O}]`},!0));return P}function Gi(h){const t=h.key,n=h.value,u=h.valueSpec;let p=s.K(n);if(p==="number"&&n!=n&&(p="NaN"),p!=="number")return[new s.V(t,n,`number expected, ${p} found`)];if("minimum"in u){let g=u.minimum;if(s.K(u.minimum)==="array"&&(g=u.minimum[h.arrayIndex]),n<g)return[new s.V(t,n,`${n} is less than the minimum value ${g}`)]}if("maximum"in u){let g=u.maximum;if(s.K(u.maximum)==="array"&&(g=u.maximum[h.arrayIndex]),n>g)return[new s.V(t,n,`${n} is greater than the maximum value ${g}`)]}return[]}function Er(h){const t=h.valueSpec,n=s.M(h.value.type);let u,p,g,x={};const C=n!=="categorical"&&h.value.property===void 0,P=!C,O=s.K(h.value.stops)==="array"&&s.K(h.value.stops[0])==="array"&&s.K(h.value.stops[0][0])==="object",k=Es({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Z){if(n==="identity")return[new s.V(Z.key,Z.value,'identity function may not have a "stops" property')];let Y=[];const X=Z.value;return Y=Y.concat(jr({key:Z.key,value:X,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:U})),s.K(X)==="array"&&X.length===0&&Y.push(new s.V(Z.key,X,"array must have at least one stop")),Y},default:function(Z){return bn({key:Z.key,value:Z.value,valueSpec:t,style:Z.style,styleSpec:Z.styleSpec})}}});return n==="identity"&&C&&k.push(new s.V(h.key,h.value,'missing required property "property"')),n==="identity"||h.value.stops||k.push(new s.V(h.key,h.value,'missing required property "stops"')),n==="exponential"&&h.valueSpec.expression&&!s.N(h.valueSpec)&&k.push(new s.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(P&&!s.O(h.valueSpec)?k.push(new s.V(h.key,h.value,"property functions not supported")):C&&!s.Q(h.valueSpec)&&k.push(new s.V(h.key,h.value,"zoom functions not supported"))),n!=="categorical"&&!O||h.value.property!==void 0||k.push(new s.V(h.key,h.value,'"property" property is required')),k;function U(Z){let Y=[];const X=Z.value,J=Z.key;if(s.K(X)!=="array")return[new s.V(J,X,`array expected, ${s.K(X)} found`)];if(X.length!==2)return[new s.V(J,X,`array length 2 expected, length ${X.length} found`)];if(O){if(s.K(X[0])!=="object")return[new s.V(J,X,`object expected, ${s.K(X[0])} found`)];if(X[0].zoom===void 0)return[new s.V(J,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new s.V(J,X,"object stop key must have value")];const ee=s.M(X[0].zoom);if(typeof ee!="number")return[new s.V(J,X[0].zoom,"stop zoom values must be numbers")];if(g&&g>ee)return[new s.V(J,X[0].zoom,"stop zoom values must appear in ascending order")];ee!==g&&(g=ee,p=void 0,x={}),Y=Y.concat(Es({key:`${J}[0]`,value:X[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:Gi,value:F}}))}else Y=Y.concat(F({key:`${J}[0]`,value:X[0],style:Z.style,styleSpec:Z.styleSpec},X));return s.S(s.U(X[1]))?Y.concat([new s.V(`${J}[1]`,X[1],"expressions are not allowed in function stops.")]):Y.concat(bn({key:`${J}[1]`,value:X[1],valueSpec:t,style:Z.style,styleSpec:Z.styleSpec}))}function F(Z,Y){const X=s.K(Z.value),J=s.M(Z.value),ee=Z.value!==null?Z.value:Y;if(u){if(X!==u)return[new s.V(Z.key,ee,`${X} stop domain type must match previous stop domain type ${u}`)]}else u=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof J!="number"&&typeof J!="string"&&typeof J!="boolean")return[new s.V(Z.key,ee,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&n!=="categorical"){let oe=`number expected, ${X} found`;return s.O(t)&&n===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(Z.key,ee,oe)]}return n!=="categorical"||X!=="number"||typeof J=="number"&&isFinite(J)&&Math.floor(J)===J?n!=="categorical"&&X==="number"&&typeof J=="number"&&typeof p=="number"&&p!==void 0&&J<p?[new s.V(Z.key,ee,"stop domain values must appear in ascending order")]:(p=J,n==="categorical"&&J in x?[new s.V(Z.key,ee,"stop domain values must be unique")]:(x[J]=!0,[])):[new s.V(Z.key,ee,`integer expected, found ${String(J)}`)]}}function Ma(h){const t=(h.expressionContext==="property"?s.W:s.X)(s.U(h.value),h.valueSpec);if(t.result==="error")return t.value.map(u=>new s.V(`${h.key}${u.key}`,h.value,u.message));const n=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!n.outputDefined())return[new s.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!s.Y(n))return[new s.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return Xa(n,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!s.Z(n,["zoom","feature-state"]))return[new s.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!s._(n))return[new s.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xa(h,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)n.delete(p);if(n.size===0)return[];const u=[];return h instanceof s.$&&n.has(h.name)?[new s.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild(p=>{u.push(...Xa(p,t))}),u)}function _o(h){const t=h.key,n=h.value,u=h.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(s.M(n))===-1&&p.push(new s.V(t,n,`expected one of [${u.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(u.values).indexOf(s.M(n))===-1&&p.push(new s.V(t,n,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(n)} found`)),p}function kl(h){return s.a1(s.U(h.value))?Ma(s.L({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):Di(h)}function Di(h){const t=h.value,n=h.key;if(s.K(t)!=="array")return[new s.V(n,t,`array expected, ${s.K(t)} found`)];const u=h.styleSpec;let p,g=[];if(t.length<1)return[new s.V(n,t,"filter array must have at least 1 element")];switch(g=g.concat(_o({key:`${n}[0]`,value:t[0],valueSpec:u.filter_operator,style:h.style,styleSpec:h.styleSpec})),s.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.M(t[1])==="$type"&&g.push(new s.V(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new s.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=s.K(t[1]),p!=="string"&&g.push(new s.V(`${n}[1]`,t[1],`string expected, ${p} found`)));for(let x=2;x<t.length;x++)p=s.K(t[x]),s.M(t[1])==="$type"?g=g.concat(_o({key:`${n}[${x}]`,value:t[x],valueSpec:u.geometry_type,style:h.style,styleSpec:h.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new s.V(`${n}[${x}]`,t[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)g=g.concat(Di({key:`${n}[${x}]`,value:t[x],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":p=s.K(t[1]),t.length!==2?g.push(new s.V(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new s.V(`${n}[1]`,t[1],`string expected, ${p} found`))}return g}function As(h,t){const n=h.key,u=h.style,p=h.layer,g=h.styleSpec,x=h.value,C=h.objectKey,P=g[`${t}_${h.layerType}`];if(!P)return[];const O=C.match(/^(.*)-use-theme$/);if(t==="paint"&&O&&P[O[1]])return s.S(x)?[].concat(bn({key:h.key,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:C})):bn({key:n,value:x,valueSpec:{type:"string"},style:u,styleSpec:g});const k=C.match(/^(.*)-transition$/);if(t==="paint"&&k&&P[k[1]]&&P[k[1]].transition)return bn({key:n,value:x,valueSpec:g.transition,style:u,styleSpec:g});const U=h.valueSpec||P[C];if(!U)return[new s.J(n,x,`unknown property "${C}"`)];let F;if(s.K(x)==="string"&&s.O(U)&&!U.tokens&&(F=/^{([^}]+)}$/.exec(x))){const Y=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new s.V(n,x,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${Y}.`)]}const Z=[];if(h.layerType==="symbol")C!=="text-field"||!u||u.glyphs||u.imports||Z.push(new s.V(n,x,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&s.a2(s.U(x))&&s.M(x.type)==="identity"&&Z.push(new s.V(n,x,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&s.O(U)&&(s.a3(U)||s.Q(U))){const Y=s.W(s.U(x),U),X=Y.value.expression||Y.value._styleExpression.expression;X&&!s.Z(X,["measure-light"])&&(C==="model-emissive-strength"&&s._(X)&&s.Y(X)||Z.push(new s.V(n,x,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Z.concat(bn({key:h.key,value:x,valueSpec:U,style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:C}))}function aa(h){return As(h,"paint")}function qr(h){return As(h,"layout")}function fr(h){let t=[];const n=h.value,u=h.key,p=h.style,g=h.styleSpec;n.type||n.ref||t.push(new s.V(u,n,'either "type" or "ref" is required'));let x=s.M(n.type);const C=s.M(n.ref);if(n.id){const P=s.M(n.id);for(let O=0;O<h.arrayIndex;O++){const k=p.layers[O];s.M(k.id)===P&&t.push(new s.V(u,n.id,`duplicate layer id "${n.id}", previously used at line ${k.id.__line__}`))}}if("ref"in n){let P;["type","source","source-layer","filter","layout"].forEach(O=>{O in n&&t.push(new s.V(u,n[O],`"${O}" is prohibited for ref layers`))}),p.layers.forEach(O=>{s.M(O.id)===C&&(P=O)}),P?P.ref?t.push(new s.V(u,n.ref,"ref cannot reference another ref layer")):x=s.M(P.type):typeof C=="string"&&t.push(new s.V(u,n.ref,`ref layer "${C}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(n.source){const P=p.sources&&p.sources[n.source],O=P&&s.M(P.type);P?O==="vector"&&x==="raster"?t.push(new s.V(u,n.source,`layer "${n.id}" requires a raster source`)):O==="raster"&&x!=="raster"?t.push(new s.V(u,n.source,`layer "${n.id}" requires a vector source`)):O!=="vector"||n["source-layer"]?O==="raster-dem"&&x!=="hillshade"?t.push(new s.V(u,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||O==="geojson"&&P.lineMetrics?x==="raster-particle"&&O!=="raster-array"&&t.push(new s.V(u,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):t.push(new s.V(u,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new s.V(u,n.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(u,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new s.V(u,n.source,`source "${n.source}" not found`))}else t.push(new s.V(u,n,'missing required property "source"'));return t=t.concat(Es({key:u,value:n,valueSpec:g.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bn({key:`${u}.type`,value:n.type,valueSpec:g.layer.type,style:h.style,styleSpec:h.styleSpec,object:n,objectKey:"type"}),filter:P=>kl(s.L({layerType:x},P)),layout:P=>Es({layer:n,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":O=>qr(s.L({layerType:x},O))}}),paint:P=>Es({layer:n,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":O=>aa(s.L({layerType:x,layer:n},O))}})}})),t}function Ar(h){const t=h.value,n=h.key,u=s.K(t);return u!=="string"?[new s.V(n,t,`string expected, ${u} found`)]:[]}const Wa={promoteId:function h({key:t,value:n}){if(s.K(n)==="string")return Ar({key:t,value:n});if(Array.isArray(n)){const u=[],p=s.U(n),g=s.X(p);return g.result==="error"&&g.value.forEach(x=>{u.push(new s.V(`${t}${x.key}`,null,`${x.message}`))}),s.Z(g.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||u.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),u}{const u=[];for(const p in n)u.push(...h({key:`${t}.${p}`,value:n[p]}));return u}}};function Ru(h){const t=h.value,n=h.key,u=h.styleSpec,p=h.style;if(!t.type)return[new s.V(n,t,'"type" is required')];const g=s.M(t.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&(t.url||t.tiles||x.push(new s.J(n,t,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Es({key:n,value:t,valueSpec:u[`source_${g.replace("-","_")}`],style:h.style,styleSpec:u,objectElementValidators:Wa})),x;case"geojson":if(x=Es({key:n,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:Wa}),t.cluster)for(const C in t.clusterProperties){const[P,O]=t.clusterProperties[C],k=typeof P=="string"?[P,["accumulated"],["get",C]]:P;x.push(...Ma({key:`${n}.${C}.map`,value:O,expressionContext:"cluster-map"})),x.push(...Ma({key:`${n}.${C}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return x;case"video":return Es({key:n,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return Es({key:n,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new s.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _o({key:`${n}.type`,value:t.type,valueSpec:{values:Du(u)}})}}function Du(h){return h.source.reduce((t,n)=>{const u=h[n];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function Ya(h){const t=h.value,n=h.styleSpec,u=n.light,p=h.style;let g=[];const x=s.K(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new s.V("light",t,`object expected, ${x} found`)]),g;for(const C in t){const P=C.match(/^(.*)-transition$/),O=C.match(/^(.*)-use-theme$/);g=g.concat(O&&u[O[1]]?bn({key:C,value:t[C],valueSpec:{type:"string"},style:p,styleSpec:n}):P&&u[P[1]]&&u[P[1]].transition?bn({key:C,value:t[C],valueSpec:n.transition,style:p,styleSpec:n}):u[C]?bn({key:C,value:t[C],valueSpec:u[C],style:p,styleSpec:n}):[new s.V(C,t[C],`unknown property "${C}"`)])}return g}function Ka(h){const t=h.value;let n=[];if(!t)return n;const u=s.K(t);if(u!=="object")return n=n.concat([new s.V("light-3d",t,`object expected, ${u} found`)]),n;const p=h.styleSpec,g=p["light-3d"],x=h.key,C=h.style,P=h.style.lights;for(const U of["type","id"])if(!(U in t))return n=n.concat([new s.V("light-3d",t,`missing property ${U} on light`)]),n;if(t.type&&P)for(let U=0;U<h.arrayIndex;U++){const F=s.M(t.type),Z=P[U];s.M(Z.type)===F&&n.push(new s.V(x,t.id,`duplicate light type "${t.type}", previously defined at line ${Z.id.__line__}`))}const O=`properties_light_${t.type}`;if(!(O in p))return n=n.concat([new s.V("light-3d",t,`Invalid light type ${t.type}`)]),n;const k=p[O];for(const U in t)if(U==="properties"){const F=t[U],Z=s.K(F);if(Z!=="object")return n=n.concat([new s.V("properties",F,`object expected, ${Z} found`)]),n;for(const Y in F)n=n.concat(k[Y]?bn({key:Y,value:F[Y],valueSpec:k[Y],style:C,styleSpec:p}):[new s.J(h.key,F[Y],`unknown property "${Y}"`)])}else{const F=U.match(/^(.*)-transition$/),Z=U.match(/^(.*)-use-theme$/);n=n.concat(Z&&g[Z[1]]?bn({key:U,value:t[U],valueSpec:{type:"string"},style:C,styleSpec:p}):F&&g[F[1]]&&g[F[1]].transition?bn({key:U,value:t[U],valueSpec:p.transition,style:C,styleSpec:p}):g[U]?bn({key:U,value:t[U],valueSpec:g[U],style:C,styleSpec:p}):[new s.J(U,t[U],`unknown property "${U}"`)])}return n}function Gr(h){const t=h.value,n=h.key,u=h.style,p=h.styleSpec,g=p.terrain;let x=[];const C=s.K(t);if(t===void 0||C==="null")return x;if(C!=="object")return x=x.concat([new s.V("terrain",t,`object expected, ${C} found`)]),x;for(const P in t){const O=P.match(/^(.*)-transition$/),k=P.match(/^(.*)-use-theme$/);x=x.concat(k&&g[k[1]]?bn({key:P,value:t[P],valueSpec:{type:"string"},style:u,styleSpec:p}):O&&g[O[1]]&&g[O[1]].transition?bn({key:P,value:t[P],valueSpec:p.transition,style:u,styleSpec:p}):g[P]?bn({key:P,value:t[P],valueSpec:g[P],style:u,styleSpec:p}):[new s.J(P,t[P],`unknown property "${P}"`)])}if(t.source){const P=u.sources&&u.sources[t.source],O=P&&s.M(P.type);P?O!=="raster-dem"&&x.push(new s.V(n,t.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):x.push(new s.V(n,t.source,`source "${t.source}" not found`))}else x.push(new s.V(n,t,'terrain is missing required property "source"'));return x}function go(h){const t=h.value,n=h.style,u=h.styleSpec,p=u.fog;let g=[];const x=s.K(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new s.V("fog",t,`object expected, ${x} found`)]),g;for(const C in t){const P=C.match(/^(.*)-transition$/),O=C.match(/^(.*)-use-theme$/);g=g.concat(O&&p[O[1]]?bn({key:C,value:t[C],valueSpec:{type:"string"},style:n,styleSpec:u}):P&&p[P[1]]&&p[P[1]].transition?bn({key:C,value:t[C],valueSpec:u.transition,style:n,styleSpec:u}):p[C]?bn({key:C,value:t[C],valueSpec:p[C],style:n,styleSpec:u}):[new s.J(C,t[C],`unknown property "${C}"`)])}return g}const Pn={"*":()=>[],array:jr,boolean:function(h){const t=h.value,n=h.key,u=s.K(t);return u!=="boolean"?[new s.V(n,t,`boolean expected, ${u} found`)]:[]},number:Gi,color:function(h){const t=h.key,n=h.value,u=s.K(n);return u!=="string"?[new s.V(t,n,`color expected, ${u} found`)]:s.a0.parseCSSColor(n)===null?[new s.V(t,n,`color expected, "${n}" found`)]:[]},enum:_o,filter:kl,function:Er,layer:fr,object:Es,source:Ru,model:s.a4,light:Ya,"light-3d":Ka,terrain:Gr,fog:go,string:Ar,formatted:function(h){return Ar(h).length===0?[]:Ma(h)},resolvedImage:function(h){return Ar(h).length===0?[]:Ma(h)},projection:function(h){const t=h.value,n=h.styleSpec,u=n.projection,p=h.style;let g=[];const x=s.K(t);if(x==="object")for(const C in t)g=g.concat(bn({key:C,value:t[C],valueSpec:u[C],style:p,styleSpec:n}));else x!=="string"&&(g=g.concat([new s.V("projection",t,`object or string expected, ${x} found`)]));return g},import:function(h){const{value:t,styleSpec:n}=h,{data:u,...p}=t;Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let g=Es(s.L({},h,{value:p,valueSpec:n.import}));return s.M(p.id)===""&&g.push(new s.V(`${h.key}.id`,p,"import id can't be an empty string")),u&&(g=g.concat(Bl(u,n,{key:`${h.key}.data`}))),g},iconset:function(h){const t=h.value,n=h.key,u=h.styleSpec,p=h.style;if(!t.type)return[new s.V(n,t,'"type" is required')];const g=s.M(t.type);let x=[];if(x=x.concat(Es({key:n,value:t,valueSpec:u[`iconset_${g}`],style:p,styleSpec:u})),g==="source"&&t.source){const C=p.sources&&p.sources[t.source],P=C&&s.M(C.type);C?P!=="raster-array"&&x.push(new s.V(n,t.source,`iconset cannot be used with a source of type ${String(P)}, it only be used with a "raster-array" source type`)):x.push(new s.V(n,t.source,`source "${t.source}" not found`))}return x}};function bn(h,t=!1){const n=h.value,u=h.valueSpec,p=h.styleSpec;if(u.expression&&s.a2(s.M(n)))return Er(h);if(u.expression&&s.S(s.U(n)))return Ma(h);if(u.type&&Pn[u.type]){const g=Pn[u.type](h);return t===!0&&g.length>0&&s.K(h.value)==="array"?Ma(h):g}return Es(s.L({},h,{valueSpec:u.type?p[u.type]:u}))}function Vc(h){const t=h.value,n=h.key,u=Ar(h);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new s.V(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new s.V(n,t,'"glyphs" url must include a "{range}" token'))),u}function Bl(h,t=s.a5,n={}){return bn({key:n.key||"",value:h,valueSpec:t.$root,styleSpec:t,style:h,objectElementValidators:{glyphs:Vc,"*":()=>[]}})}function rs(h,t=s.a5){return Re(Bl(h,t))}const Ia=h=>Re(Ru(h)),zu=h=>Re(Ya(h)),Nl=h=>Re(Ka(h)),Pu=h=>Re(Gr(h)),jc=h=>Re(go(h)),Fl=h=>Re(function(t){const n=t.value,u=t.style,p=t.styleSpec,g=p.snow;let x=[];const C=s.K(n);if(n===void 0)return x;if(C!=="object")return x=x.concat([new s.V("snow",n,`object expected, ${C} found`)]),x;for(const P in n){const O=P.match(/^(.*)-transition$/);x=x.concat(O&&g[O[1]]&&g[O[1]].transition?bn({key:P,value:n[P],valueSpec:p.transition,style:u,styleSpec:p}):g[P]?bn({key:P,value:n[P],valueSpec:g[P],style:u,styleSpec:p}):[new s.J(P,n[P],`unknown property "${P}"`)])}return x}(h)),Ye=h=>Re(function(t){const n=t.value,u=t.style,p=t.styleSpec,g=p.rain;let x=[];const C=s.K(n);if(n===void 0)return x;if(C!=="object")return x=x.concat([new s.V("rain",n,`object expected, ${C} found`)]),x;for(const P in n){const O=P.match(/^(.*)-transition$/);x=x.concat(O&&g[O[1]]&&g[O[1]].transition?bn({key:P,value:n[P],valueSpec:p.transition,style:u,styleSpec:p}):g[P]?bn({key:P,value:n[P],valueSpec:g[P],style:u,styleSpec:p}):[new s.J(P,n[P],`unknown property "${P}"`)])}return x}(h)),te=h=>Re(fr(h)),ie=h=>Re(kl(h)),me=h=>Re(aa(h)),Se=h=>Re(qr(h)),Ee=h=>Re(s.a4(h));function Re(h){return h.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function qe(h,t){let n=!1;if(t&&t.length)for(const u of t)u instanceof s.J?s.w(u.message):(h.fire(new s.z(new Error(u.message))),n=!0);return n}let Pe;class $e extends s.E{constructor(t,n="flat"){super(),this._transitionable=new s.a6(Pe||(Pe=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,u={}){this._validate(zu,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&qe(this,t.call(rs,s.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let Je=class extends s.E{constructor(h,t,n,u){super(),this.scope=n,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),n,u),this._transitionable.setTransitionOrValue(h,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new s.aa(h)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const t=h.value.expression;if(!t)return null;let n=-1,u=-1,p=1;for(const g of t.zoomStops)p=t.evaluate(new s.aa(g)),p>.01?(n=g,u=-1):u=g;return p<.01&&n>0&&u>n?[n,u]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof s.ab}};const We=45,pt=65,Ct=.05;function Pt(h,t,n,u){const p=s.ae(We,pt,n),[g,x]=fi(h,u);let C=1-Math.min(1,Math.exp((t-g)/(x-g)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*p*h.alpha}function fi(h,t){const n=.5/Math.tan(.5*t);return[h.range[0]+n,h.range[1]+n]}function ai(h,t,n,u,p){const g=s.ad.vec3.transformMat4([],[t,n,u],p.mercatorFogMatrix);return Pt(h,s.ad.vec3.length(g),p.pitch,p._fov)}function Ti(h,t,n,u,p,g,x){const C=[[n,u,0],[p,u,0],[p,g,0],[n,g,0]];let P=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(const k of C){const U=s.ad.vec3.transformMat4([],k,t),F=s.ad.vec3.length(U);P=Math.min(P,F),O=Math.max(O,F)}return[Pt(h,P,x.pitch,x._fov),Pt(h,O,x.pitch,x._fov)]}class Ai extends s.E{constructor(t,n,u,p){super();const g=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(g,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new s.af(g),this.scope=u}get state(){const t=this._transform,n=t.projection.name==="globe",u=s.ag(t.zoom),p=this.properties.get("range"),g=[.5,3];return{range:n?[s.ah(g[0],p[0],u),s.ah(g[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n,u={}){if(this._validate(jc,t,u))return;const p=s.l({},t);for(const g of Object.keys(s.a5.fog))p[g]===void 0&&(p[g]=s.a5.fog[g].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ae(We,pt,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(u,p,g){const x=s.ac.fromLngLat(p),C=g.elevation?g.elevation.getAtPointOrZero(x):0;return ai(u,x.x,x.y,C,g)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ti(this.state,n,0,0,s.ai,s.ai,this._transform)}getOpacityForBounds(t,n,u,p,g){return this._transform.projection.supportsFog?Ti(this.state,t,n,u,p,g,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?fi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const u of n){const p=t.points[u];let g;if(p[2]>=0)g=p;else{const x=t.points[u-4];g=s.aj(x,p,x[2]/(x[2]-p[2]))}if(ai(this.state,g[0],g[1],0,this._transform)>=Ct)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&qe(this,t.call(rs,s.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let gn,Cn,ki,cn,un=class extends s.E{constructor(h,t,n,u){super();const p=gn||(gn=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(p,n,new Map(u)),this.set(h,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.af(p),this.scope=n}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),u=s.ak(n[0]),p=-Math.max(s.ak(n[1]),.01),g=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],x=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.al(t.r,t.g,t.b,t.a*h),direction:g,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(h,t,n={}){if(this._validate(Fl,h,n))return;const u=s.l({},h);for(const p of Object.keys(s.a5.snow))u[p]===void 0&&(u[p]=s.a5.snow[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,n){return(!n||n.validate!==!1)&&qe(this,h.call(rs,s.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},mn=class extends s.E{constructor(h,t,n,u){super();const p=Cn||(Cn=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(p,n,new Map(u)),this.set(h,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.af(p),this.scope=n}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),u=s.ak(n[0]),p=-Math.max(s.ak(n[1]),.01),g=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.al(t.r,t.g,t.b,t.a*h),direction:g,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(h,t,n={}){if(this._validate(Ye,h,n))return;const u=s.l({},h);for(const p of Object.keys(s.a5.rain))u[p]===void 0&&(u[p]=s.a5.rain[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,n){return(!n||n.validate!==!1)&&qe(this,h.call(rs,s.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class Gn extends s.E{constructor(t,n,u,p){super(),this.scope=u,this._options=t,this.properties=new s.af(n),this._transitionable=new s.a6(n,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class pr{constructor(t,n,u,p){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,n){let u,p;if(t instanceof s.P||typeof t[0]=="number"){const g=s.P.convert(t);u=[g],p=n.isPointAboveHorizon(g)}else{const g=s.P.convert(t[0]),x=s.P.convert(t[1]);u=[g,x],p=s.an(g,x).every(C=>n.isPointAboveHorizon(C))}return new pr(u,n.getCameraPoint(),p,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],p=s.an(n,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(p[3]=this.cameraPoint)),s.ao(p,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],p=s.an(n,u,t),g=this.cameraPoint.clone();switch(3*((g.y>n.y)+(g.y>u.y))+((g.x>n.x)+(g.x>u.x))){case 0:p[0]=g,p[4]=g.clone();break;case 1:p.splice(1,0,g);break;case 2:p[1]=g;break;case 3:p.splice(4,0,g);break;case 5:p.splice(2,0,g);break;case 6:p[3]=g;break;case 7:p.splice(3,0,g);break;case 8:p[2]=g}return p}containsTile(t,n,u,p=0){const g=t.queryPadding/n._pixelsPerMercatorPixel+1,x=u?this._bufferedCameraMercator(g,n):this._bufferedScreenMercator(g,n);let C=t.tileID.wrap+(x.unwrapped?p:0);const P=x.polygon.map(J=>s.ap(t.tileTransform,J,C));if(!s.aq(P,0,0,s.ai,s.ai))return;C=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const O=this.screenGeometryMercator.polygon.map(J=>s.ar(t.tileTransform,J,C)),k=O.map(J=>new s.P(J[0],J[1])),U=n.getFreeCameraOptions().position||new s.ac(0,0,0),F=s.ar(t.tileTransform,U,C),Z=O.map(J=>{const ee=s.ad.vec3.sub(J,J,F);return s.ad.vec3.normalize(ee,ee),new s.as(F,ee)}),Y=s.at(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:Z,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(X=s.au(P),X.min.x=s.ay(X.min.x,0,s.ai),X.min.y=s.ay(X.min.y,0,s.ai),X.max.x=s.ay(X.max.x,0,s.ai),X.max.y=s.ay(X.max.y,0,s.ai),X),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Y};var X}_bufferedScreenMercator(t,n){const u=ss(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(g=>n.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,n){const u=ss(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(g=>n.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,n){const u=function(g,x){const C=s.ad.mat4.multiply([],x.pixelMatrix,x.globeMatrix),P=[0,-s.az,0,1],O=[0,s.az,0,1],k=[0,0,0,1];s.ad.vec4.transformMat4(P,P,C),s.ad.vec4.transformMat4(O,O,C),s.ad.vec4.transformMat4(k,k,C);const U=new s.P(P[0]/P[3],P[1]/P[3]),F=new s.P(O[0]/O[3],O[1]/O[3]),Z=s.aw(g,U)&&P[3]<k[3],Y=s.aw(g,F)&&O[3]<k[3];if(!Z&&!Y)return null;const X=function(ge,ye,we){for(let Ae=1;Ae<ge.length;Ae++){const je=Us(ye.pointCoordinate3D(ge[Ae-1]).x),Be=Us(ye.pointCoordinate3D(ge[Ae]).x);if(we<0){if(je<Be)return{idx:Ae,t:-je/(Be-1-je)}}else if(Be<je)return{idx:Ae,t:(1-je)/(Be+1-je)}}return null}(g,x,Z?-1:1);if(!X)return null;const{idx:J,t:ee}=X;let oe=J>1?ir(g.slice(0,J),x):[],fe=J<g.length?ir(g.slice(J),x):[];oe=oe.map(ge=>new s.P(Us(ge.x),ge.y)),fe=fe.map(ge=>new s.P(Us(ge.x),ge.y));const ce=[...oe];ce.length===0&&ce.push(fe[fe.length-1]);const xe=s.ah(ce[ce.length-1].y,(fe.length===0?oe[0]:fe[0]).y,ee);let _e;return _e=Z?[new s.P(0,xe),new s.P(0,0),new s.P(1,0),new s.P(1,xe)]:[new s.P(1,xe),new s.P(1,1),new s.P(0,1),new s.P(0,xe)],ce.push(..._e),fe.length===0?ce.push(oe[0]):ce.push(...fe),{polygon:ce.map(ge=>new s.ac(ge.x,ge.y)),unwrapped:!1}}(t,n);if(u)return u;const p=function(g,x){let C=!1,P=-1/0,O=0;for(let U=0;U<g.length-1;U++)g[U].x>P&&(P=g[U].x,O=U);for(let U=0;U<g.length-1;U++){const F=(O+U)%(g.length-1),Z=g[F],Y=g[F+1];Math.abs(Z.x-Y.x)>.5&&(Z.x<Y.x?(Z.x+=1,F===0&&(g[g.length-1].x+=1)):(Y.x+=1,F+1===g.length-1&&(g[0].x+=1)),C=!0)}const k=s.av(x.center.lng);return C&&k<Math.abs(k-1)&&g.forEach(U=>{U.x-=1}),{polygon:g,unwrapped:C}}(ir(t,n).map(g=>new s.P(Us(g.x),g.y)),n);return{polygon:p.polygon.map(g=>new s.ac(g.x,g.y)),unwrapped:p.unwrapped}}}function ir(h,t){return s.ax(h,n=>{const u=t.pointCoordinate3D(n);n.x=u.x,n.y=u.y},1/256)}function Us(h){return h<0?1+h%1:h%1}function ss(h){return 100*h|0}function nr(h,t,n,u,p){const g=function(C,P){if(C)return p(C);if(P){if(h.url&&P.tiles&&h.tiles&&delete h.tiles,P.variants){if(!Array.isArray(P.variants))return p(new Error("variants must be an array"));for(const k of P.variants){if(k==null||typeof k!="object"||k.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return p(new Error("capabilities must be an array"));if(k.capabilities.length===1&&k.capabilities[0]==="meshopt"){P=s.l(P,k);break}}}const O=s.aA(s.l({},P,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);O.tiles=t.canonicalizeTileset(O,h.url),p(null,O)}},x=function(C,P,O){if(!C)return null;if(!P&&!O)return C;O=O||C.worldview_default;const k=Object.values(C.language||{});if(k.length===0)return null;const U=Object.values(C.worldview||{});if(U.length===0)return null;const F=k.every(Y=>Y===P),Z=U.every(Y=>Y===O);return F&&Z?C:P in(C.language_options||{})||O in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(h.data,n,u);return x?s.q.frame(()=>g(null,x)):h.url?s.n(t.transformRequest(t.normalizeSourceURL(h.url,null,n,u),s.R.Source),g):s.q.frame(()=>{const{data:C,...P}=h;g(null,P)})}class Mr{constructor(t,n,u){this.bounds=s.aB.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),u=Math.floor(s.av(this.bounds.getWest())*n),p=Math.floor(s.aC(this.bounds.getNorth())*n),g=Math.ceil(s.av(this.bounds.getEast())*n),x=Math.ceil(s.aC(this.bounds.getSouth())*n);return t.x>=u&&t.x<g&&t.y>=p&&t.y<x}}class Go extends s.E{constructor(t,n,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.aA(n,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new s.aD}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=nr(this._options,this.map._requestManager,n,u,(p,g)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new s.z(p));else if(g){if(s.l(this,g),this.hasWorldviews=!!g.worldview_options,g.worldview_default&&(this.worldviewDefault=g.worldview_default),g.vector_layers){this.vectorLayers=g.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const x of g.vector_layers)this.vectorLayerIds.push(x.id),g.worldview&&g.worldview[x.source]&&this.localizableLayerIds.add(x.id)}g.bounds&&(this.tileBounds=new Mr(g.bounds,this.minzoom,this.maxzoom)),_i(g.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(t,n){const u=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(u),g=this.map._requestManager.transformRequest(p,s.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,C=x?{image:x.image.clone()}:null,P={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&s.f(u)&&(P.worldview=this.map.getWorldview()||this.worldviewDefault,P.localizableLayerIds=this.localizableLayerIds),P.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",P,O.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",P,O.bind(this),void 0,!0);else{const k=s.aE.call({deduped:this._deduped},P,(U,F)=>{U||!F?O.call(this,U):(P.data={cacheControl:F.cacheControl,expires:F.expires,rawData:F.rawData.slice(0)},t.actor&&t.actor.send("loadTile",P,O.bind(this),void 0,!0))},!0);t.request={cancel:k}}function O(k,U){return delete t.request,t.aborted?n(null):k&&k.status!==404?n(k):(U&&U.resourceTiming&&(t.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&t.setExpiryData(U),t.loadVectorData(U,this.map.painter),s.aF(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class oa extends s.E{constructor(t,n,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},n),s.l(this,s.aA(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._tileJSONRequest=nr(this._options,this.map._requestManager,null,null,(n,u)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new s.z(n)):u&&(s.l(this,u),u.raster_layers&&(this.rasterLayers=u.raster_layers,this.rasterLayerIds=this.rasterLayers.map(p=>p.id)),u.bounds&&(this.tileBounds=new Mr(u.bounds,this.minzoom,this.maxzoom)),_i(u.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const u=s.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=s.o(this.map._requestManager.transformRequest(p,s.R.Tile),(g,x,C,P)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):g?(t.state="errored",n(g)):x?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:C,expires:P}),t.setTexture(x,this.map.painter),t.state="loaded",s.aF(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n&&n()}unloadTile(t,n){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ca extends oa{constructor(t,n,u,p){super(t,n,u,p),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=s.l({type:"raster-array"},n)}triggerRepaint(t){const n=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);n&&n.enabled&&u&&n._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,n){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,s.R.Tile),g={request:p,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor());const x=(C,P,O,k)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(C)return C.name==="AbortError"?void 0:(t.state="errored",n(C));if(this.map._refreshExpiredTiles&&P&&t.setExpiryData({cacheControl:O,expires:k}),this.partial)t.state="empty";else{if(!P)return n(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=P}n(null)};t.request=this.partial?t.fetchHeader(void 0,x.bind(this)):t.actor.send("loadTile",g,x.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){const u=t.texture;u&&u instanceof s.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,n,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(n,u,(p,g)=>{if(p)return t.state="errored",this.fire(new s.z(p)),void this.triggerRepaint(t);g&&(t._isHeaderLoaded=!0,t.setTexture(g,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:g})=>g===t),u=n&&n.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,n,u){if(!t)return;const p=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let g=null;n instanceof s.aI?g=n.paint.get("raster-array-band"):n instanceof s.aJ&&(g=n.paint.get("raster-particle-array-band"));const x=g||this.getInitialBand(p);if(x!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,x)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,x)}getImages(t,n){const u=new Map;for(const p of t)for(const g of n){const[x,C]=g.split("/"),P=p.getLayer(x);if(!P||!P.hasBand(C)||!P.hasDataForBand(C))continue;const{bytes:O,tileSize:k,buffer:U}=P.getBandView(C),F=k+2*U,Z={data:new s.r({width:F,height:F},O),pixelRatio:2,sdf:!1,usvg:!1,version:0};u.set(g,Z)}return u}}const Vs={vector:Go,raster:oa,"raster-dem":class extends oa{constructor(h,t,n,u){super(h,t,n,u),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const n=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,g){p&&(h.state="errored",t(p)),g&&(h.dem=g,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=s.o(this.map._requestManager.transformRequest(n,s.R.Tile),(function(p,g,x,C){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(p)h.state="errored",t(p);else if(g){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:x,expires:C});const P=ImageBitmap&&g instanceof ImageBitmap&&s.t(),O=1-(g.width-s.aG(g.width))/2;O<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const k=P?g:s.q.getImageData(g,O),U={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:O};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",U,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const t=h.canonical,n=Math.pow(2,t.z),u=(t.x-1+n)%n,p=t.x===0?h.wrap-1:h.wrap,g=(t.x+1+n)%n,x=t.x+1===n?h.wrap+1:h.wrap,C={};return C[new s.aH(h.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},C[new s.aH(h.overscaledZ,x,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(C[new s.aH(h.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},C[new s.aH(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},C[new s.aH(h.overscaledZ,x,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<n&&(C[new s.aH(h.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},C[new s.aH(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},C[new s.aH(h.overscaledZ,x,t.z,g,t.y+1).key]={backfilled:!1}),C}},"raster-array":Ca,geojson:class extends s.E{constructor(h,t,n,u){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(u),this._data=t.data,this._options=s.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=s.ai/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:s.ai,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.ai,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const n of this._data.features)t.set(n.id,n);for(const n of h.features)t.set(n.id,n);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,n,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:n},u),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=s.l({append:h},this.workerOptions);t.scope=this.scope;const n=this._data;typeof n=="string"?(t.request=this.map._requestManager.transformRequest(s.q.resolveURL(n),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new s.z(u));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(g.resourceTiming=p.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new s.A("data",g)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const h=s.C(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,t){const n=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=u?{image:u.image.clone()}:null,g=this._partialReload,x={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:g};h.request=this.actor.send(n,x,(C,P)=>g&&!P?(h.state="loaded",t(null)):(delete h.request,h.destroy(),h.aborted?t(null):C?t(C):(h.loadVectorData(P,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aK{constructor(h,t,n,u){super(h,t,n,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aL(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new s.z(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aK,model:class extends s.E{constructor(h,t,n,u){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const h=[];for(const t in this._options.models){const n=this._options.models[t],u=s.aN(this.map._requestManager.transformRequest(n.uri,s.R.Model).url).then(p=>{if(!p)return;const g=s.aO(p),x=new s.aP(t,n.position,n.orientation,g);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(p=>{this.fire(new s.z(new Error(`Could not load model ${t} from ${n.uri}: ${p.message}`)))});h.push(u)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new s.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,t){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(h,t,n,u){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(h))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=nr(this._options,this.map._requestManager,t,n,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new s.z(u))):p&&(s.l(this,p),p.bounds&&(this.tileBounds=new Mr(p.bounds,this.minzoom,this.maxzoom)),_i(p.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),h&&h(u)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){const n=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(n,s.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){const g=Object.values(h.buckets);for(const x of g)x.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",u,p.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(g,x){return h.aborted?t(null):g&&g.status!==404?t(g):(this.map._refreshExpiredTiles&&x&&h.setExpiryData(x),h.loadModelData(x,this.map.painter),h.state="loaded",void t(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aK{constructor(h,t,n,u){super(h,t,n,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(g=>typeof g!="number"))||this.fire(new s.z(new s.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof s.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends s.E{constructor(h,t,n,u){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Mr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.aA(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:n,z:u}=h.canonical;return this._implementation.hasTile({x:t,y:n,z:u})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:n,y:u,z:p}=h.tileID.canonical,g=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:n,y:u,z:p},{signal:g.signal})).then((function(x){return delete h.request,h.aborted?(h.state="unloaded",t(null)):x===void 0?(h.state="errored",t(null)):x===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(x)?(this.loadTileData(h,x),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.name!=="AbortError"&&(h.state="errored",t(x))}),h.request.cancel=()=>g.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof s.T?(h.destroy(!0),h.texture&&h.texture instanceof s.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:n,y:u,z:p}=h.tileID.canonical;this._implementation.unloadTile({x:n,y:u,z:p})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=s.C(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},Ou=function(h,t,n,u){const p=new Vs[t.type](h,t,n,u);if(p.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${p.id}`);return s.aQ(["load","abort","unload","serialize","prepare"],p),p};function Lu(h,t,n=""){return`${n}:${t.id||""}:${t.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:p,importId:g}=u;return`featureset:${p}${g?`:import:${g}`:""}`}}(h.target)}`}function yo(h,t,n,u=""){if(h.uniqueFeatureID){const p=Lu(h,t,u);if(n.has(p))return!0;n.add(p)}return!1}function Nh(h,t,n,u,p=!1){const g=t.sourceCache.transform,x=t.sourceCache.tilesIn(h,t.has3DLayers,p);x.sort(js);const C=[];for(const P of x){const O=P.tile.queryRenderedFeatures(t,P,n,u,g,p);Object.keys(O).length&&C.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:O})}return C.length===0?{}:function(P){const O={},k={};for(const U of P){const F=U.queryResults,Z=U.wrappedTileID,Y=k[Z]=k[Z]||{};for(const X in F){const J=F[X],ee=Y[X]=Y[X]||{},oe=O[X]=O[X]||[];for(const fe of J)ee[fe.featureIndex]||(ee[fe.featureIndex]=!0,oe.push(fe))}}return O}(C)}function ku(h,t,n,u,p){const g={},x=u.queryRenderedSymbols(h),C=[];for(const P of Object.keys(x).map(Number))C.push(p[P]);C.sort(js);for(const P of C){const O=P.featureIndex.lookupSymbolFeatures(x[P.bucketInstanceId],P.bucketIndex,P.sourceLayerIndex,t,n);for(const k in O){const U=g[k]=g[k]||[],F=O[k];F.sort((Z,Y)=>{const X=P.featureSortOrder;if(X){const J=X.indexOf(Z.featureIndex);return X.indexOf(Y.featureIndex)-J}return Y.featureIndex-Z.featureIndex});for(const Z of F)U.push(Z)}}return g}function pp(h,t){const n=h.getRenderableIds().map(g=>h.getTileByID(g)),u=[],p={};for(let g=0;g<n.length;g++){const x=n[g],C=x.tileID.canonical.key;p[C]||(p[C]=!0,x.querySourceFeatures(u,t))}return u}function js(h,t){const n=h.tileID,u=t.tileID;return n.overscaledZ-u.overscaledZ||n.canonical.y-u.canonical.y||n.wrap-u.wrap||n.canonical.x-u.canonical.x}function Ho(h,t){const n={};if(!t)return n;for(const u of h){const p=u.layerIds.map(g=>t.getLayer(g)).filter(Boolean);if(p.length!==0){u.layers=p,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(g=>p.filter(x=>x.id===g)[0]));for(const g of p)n[g.fqid]=u}}return n}const qs=32,Ys=33,Ks=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,n=0,u=0,p=0,g=0,x=0,C=0;for(1&t?p=g=x=qs:n=u=C=qs;(t>>=1)>1;){const O=n+p>>1,k=u+g>>1;1&t?(p=n,g=u,n=x,u=C):(n=p,u=g,p=x,g=C),x=O,C=k}const P=4*h;Ks[P+0]=n,Ks[P+1]=u,Ks[P+2]=p,Ks[P+3]=g}const Gs=new Uint16Array(2178),Ms=new Uint8Array(1089),Ra=new Uint16Array(1089);function uf(h){return h===0?-.03125:h===32?.03125:0}const Bu={type:2,extent:s.ai,loadGeometry:()=>[[new s.P(0,0),new s.P(s.ai+1,0),new s.P(s.ai+1,s.ai+1),new s.P(0,s.ai+1),new s.P(0,0)]]};class la{constructor(t,n,u,p,g){this.tileID=t,this.uid=s.aW(),this.uses=0,this.tileSize=n,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<s.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Ho(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof s.aY){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof s.aY&&g.hasRTLText){this.hasRTLText=!0,s.aZ();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p],x=n.style.getOwnLayer(p);if(!x)continue;const C=x.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,C)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.aX}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,n,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Ho(t.buckets,n.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const g=this.buckets[p];g.uploadPending()&&g.upload(t)}const n=t.gl,u=this.imageAtlas;u&&!u.uploaded&&(this.imageAtlasTexture=new s.T(t,u.image,n.RGBA8,{useMipmap:!!u.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(t,n,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=n.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(n,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}queryRenderedFeatures(t,n,u,p,g,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=function(P,O){const k=s.ad.mat4.fromScaling([],[.5*P.width,.5*-P.height,1]);return s.ad.mat4.translate(k,k,[1,-1,0]),s.ad.mat4.multiply(k,k,P.calculateProjMatrix(O.toUnwrapped())),Float32Array.from(k)}(g,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:C,transform:p,availableImages:u,tileTransform:this.tileTransform})}querySourceFeatures(t,n){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),g=n?n.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(!x)return;const C=s.a_(n&&n.filter),{z:P,x:O,y:k}=this.tileID.canonical,U={z:P,x:O,y:k};for(let F=0;F<x.length;F++){const Z=x.feature(F);if(C.needGeometry){const J=s.a$(Z,!0);if(!C.filter(new s.aa(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!C.filter(new s.aa(this.tileID.overscaledZ),Z))continue;const Y=u.getId(Z,g),X=new s.b0(Z,P,O,k,Y);X.tile=U,t.push(X)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const u=s.b1(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(n)if(this.expirationTime<n)p=!0;else{const g=this.expirationTime-n;g?this.expirationTime=u+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,n){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),g=t.style.getBrightness();for(const x in this.buckets){if(!t.style.hasLayer(x))continue;const C=this.buckets[x],P=C.layers[0],O=P.sourceLayer||"_geojsonTileLayer",k=u[O],U=t.style.getLayerSourceCache(P);let F={};U&&(F=U._state.getState(O,void 0));const Z=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Y=Object.keys(F).length>0&&!n;Y&&!C.stateDependentLayers.length&&!n||C.update(F,k,p,Z,Y?C.stateDependentLayers:C.layers,n,g),(C instanceof s.b2||C instanceof s.b3)&&t._terrain&&t._terrain.enabled&&U&&C.uploadPending()&&t._terrain._clearRenderCacheForTile(U.id,this.tileID);const X=t&&t.style&&t.style.getOwnLayer(x);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.q.now()+t}setTexture(t,n){const u=n.context,p=u.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,n){const u={};for(const p of n)u[p]=!0;this.dependencies[t]=u}hasDependency(t,n){for(const u of t){const p=this.dependencies[u];if(p){for(const g of n)if(p[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const u=s.b4(Bu,this.tileID.canonical,this.tileTransform)[0],p=new s.b5,g=new s.b6;for(let x=0;x<u.length;x++){const{x:C,y:P}=u[x];p.emplaceBack(C,P),g.emplaceBack(x)}g.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(p,s.b7.members),this._tileDebugSegments=s.b8.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const u=s.b4(Bu,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const x=function(C,P){const O=s.aR(C,P),k=Math.pow(2,C.z);for(let J=0;J<Ys;J++)for(let ee=0;ee<Ys;ee++){const oe=s.aS((C.x+(ee+uf(ee))/qs)/k),fe=s.aT((C.y+(J+uf(J))/qs)/k),ce=P.project(oe,fe),xe=J*Ys+ee;Gs[2*xe+0]=Math.round((ce.x*O.scale-O.x)*s.ai),Gs[2*xe+1]=Math.round((ce.y*O.scale-O.y)*s.ai)}Ms.fill(0),Ra.fill(0);for(let J=2045;J>=0;J--){const ee=4*J,oe=Ks[ee+0],fe=Ks[ee+1],ce=Ks[ee+2],xe=Ks[ee+3],_e=oe+ce>>1,ge=fe+xe>>1,ye=_e+ge-fe,we=ge+oe-_e,Ae=fe*Ys+oe,je=xe*Ys+ce,Be=ge*Ys+_e,Qe=Math.hypot((Gs[2*Ae+0]+Gs[2*je+0])/2-Gs[2*Be+0],(Gs[2*Ae+1]+Gs[2*je+1])/2-Gs[2*Be+1])>=16;Ms[Be]=Ms[Be]||(Qe?1:0),J<1022&&(Ms[Be]=Ms[Be]||Ms[(fe+we>>1)*Ys+(oe+ye>>1)]||Ms[(xe+we>>1)*Ys+(ce+ye>>1)])}const U=new s.aU,F=new s.aV;let Z=0;function Y(J,ee){const oe=ee*Ys+J;return Ra[oe]===0&&(U.emplaceBack(Gs[2*oe+0],Gs[2*oe+1],J*s.ai/qs,ee*s.ai/qs),Ra[oe]=++Z),Ra[oe]-1}function X(J,ee,oe,fe,ce,xe){const _e=J+oe>>1,ge=ee+fe>>1;if(Math.abs(J-ce)+Math.abs(ee-xe)>1&&Ms[ge*Ys+_e])X(ce,xe,J,ee,_e,ge),X(oe,fe,ce,xe,_e,ge);else{const ye=Y(J,ee),we=Y(oe,fe),Ae=Y(ce,xe);F.emplaceBack(ye,we,Ae)}}return X(0,0,qs,qs,qs,0),X(qs,qs,0,0,0,qs),{vertices:U,indices:F}}(this.tileID.canonical,n);p=x.vertices,g=x.indices}else{p=new s.aU,g=new s.aV;for(const{x:C,y:P}of u)p.emplaceBack(C,P,0,0);const x=s.b9(p.int16,void 0,4);for(let C=0;C<x.length;C+=3)g.emplaceBack(x[C],x[C+1],x[C+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,s.ba.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(g),this._tileBoundsSegments=s.b8.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(t,n){const u=n.projection;if(!u||u.name!=="globe"||n.freezeTileCoverage)return;const p=this.tileID.canonical,g=s.bb(p,n),x=s.bc(g),C=s.ag(n.zoom);let P;C>0&&(P=s.ad.mat4.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,n,x,P,C),this._makeGlobeTileDebugTextBuffer(t,p,n,x,P,C)}_globePoint(t,n,u,p,g,x,C){let P=s.bd(t,n,u);if(x){const O=1<<u.z,k=s.av(p.center.lng),U=s.aC(p.center.lat),F=(u.x+.5)/O-k;let Z=0;F>.5?Z=-1:F<-.5&&(Z=1);let Y=(t/s.ai+u.x)/O+Z,X=(n/s.ai+u.y)/O;Y=(Y-k)*p._pixelsPerMercatorPixel+k,X=(X-U)*p._pixelsPerMercatorPixel+U;const J=[Y*p.worldSize,X*p.worldSize,0];s.ad.vec3.transformMat4(J,J,x),P=s.be(P,J,C)}return s.ad.vec3.transformMat4(P,P,g)}_makeGlobeTileDebugBorderBuffer(t,n,u,p,g,x){const C=new s.b5,P=new s.b6,O=new s.bf,k=(F,Z,Y,X,J)=>{const ee=(Y-F)/(J-1),oe=(X-Z)/(J-1),fe=C.length;for(let ce=0;ce<J;ce++){const xe=F+ce*ee,_e=Z+ce*oe;C.emplaceBack(xe,_e);const ge=this._globePoint(xe,_e,n,u,p,g,x);O.emplaceBack(ge[0],ge[1],ge[2]),P.emplaceBack(fe+ce)}},U=s.ai;k(0,0,U,0,16),k(U,0,U,U,16),k(U,U,0,U,16),k(0,U,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(P),this._tileDebugBuffer=t.createVertexBuffer(C,s.b7.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(O,s.bg.members),this._tileDebugSegments=s.b8.simpleSegment(0,0,C.length,P.length)}_makeGlobeTileDebugTextBuffer(t,n,u,p,g,x){const C=s.ai/4,P=new s.b5,O=new s.aV,k=new s.bf,U=25;O.reserve(32),P.reserve(U),k.reserve(U);const F=(Z,Y)=>U*Z+Y;for(let Z=0;Z<U;Z++){const Y=Z*C;for(let X=0;X<U;X++){const J=X*C;P.emplaceBack(J,Y);const ee=this._globePoint(J,Y,n,u,p,g,x);k.emplaceBack(ee[0],ee[1],ee[2])}}for(let Z=0;Z<4;Z++)for(let Y=0;Y<4;Y++){const X=F(Z,Y),J=F(Z,Y+1),ee=F(Z+1,Y),oe=F(Z+1,Y+1);O.emplaceBack(X,J,ee),O.emplaceBack(ee,J,oe)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(O),this._tileDebugTextBuffer=t.createVertexBuffer(P,s.b7.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(k,s.bg.members),this._tileDebugTextSegments=s.b8.simpleSegment(0,0,U,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bh.setPbf(s.bi);class as extends la{constructor(t,n,u,p,g){super(t,n,u,p,g),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,n){const u=n.context,p=u.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t,{premultiply:!1}):this.texture=new s.T(u,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,n){const u=this._mrt=new s.bh(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.bj(p,(g,x,C,P)=>{if(g)n(g);else try{const O=u.getHeaderLength(x);if(O>t)return void(this.request=this.fetchHeader(O,n));u.parseHeader(x),this._isHeaderLoaded=!0;let k=0;for(const U of Object.values(u.layers))k=Math.max(k,U.dataIndex[U.dataIndex.length-1].lastByte);x.byteLength>=k&&(this.entireBuffer=x),n(null,this.entireBuffer||x,C,P)}catch(O){n(O)}}),this.request}fetchBand(t,n,u){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void u(new Error("Tile header is not ready"));const g=this.actor;if(!g)return void u(new Error("Can't fetch tile band without an actor"));let x;const C=(U,F)=>{x.complete(U,F),U?u(U):(this.updateTextureDescriptor(t,n),u(null,this.textureDescriptor&&this.textureDescriptor.img))},P=(U,F)=>{if(U)return u(U);const Z=g.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:F,task:x},C,void 0,!0);this._workQueue.push(()=>{Z&&Z.cancel(),x.cancel()})},O=p.getLayer(t);if(!O)return void u(new Error(`Unknown sourceLayer "${t}"`));if(O.hasDataForBand(n))return this.updateTextureDescriptor(t,n),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const k=O.getDataRange([n]);if(x=p.createDecodingTask(k),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)P(null,this.entireBuffer.slice(k.firstByte,k.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${k.firstByte}-${k.lastByte}`}}),F=s.bj(U,P);this._fetchQueue.push(()=>{F.cancel(),x.cancel()})}else u(null)}updateNeeded(t,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,n){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(n)||!u.hasDataForBand(n))return;const{bytes:p,tileSize:g,buffer:x,offset:C,scale:P}=u.getBandView(n),O=g+2*x,k=new s.r({width:O,height:O},p),U=this.texture;U&&U instanceof s.T&&U.update(k,{premultiply:!1}),this.textureDescriptor={layer:t,band:n,img:k,buffer:x,offset:C,tileSize:g,format:u.pixelFormat,mix:[P,256*P,65536*P,16777216*P]}}}class mp{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:n,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},u)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const u=t.wrapped().key,p=n===void 0?0:this.data[u].indexOf(n),g=this.data[u][p];return this.data[u].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||n.push(p);for(const u of n)this.remove(u.value.tileID,u)}}class hf{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,u){const p=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},s.l(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==p&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const g in this.state[t][p])u[g]||(this.deletedStates[t][p][g]=null)}else for(const g in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][g]===null&&delete this.deletedStates[t][p][g]}removeFeatureState(t,n,u){if(this.deletedStates[t]===null)return;const p=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&n!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,n){const u=this.state[t]||{},p=this.stateChanges[t]||{},g=this.deletedStates[t];if(g===null)return{};if(n!==void 0){const C=String(n),P=s.l({},u[C],p[C]);if(g){const O=g[n];if(O===null)return{};for(const k in O)delete P[k]}return P}const x=s.l({},u,p);if(g)for(const C in g)delete x[C];return x}initializeTileState(t,n){t.refreshFeatureState(n)}coalesceChanges(t,n){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),s.l(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];u[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const x in this.state[p])g[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else if(this.state[p][x])for(const C of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][C];g[x]=this.state[p][x]}u[p]=u[p]||{},s.l(u[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].refreshFeatureState(n)}}class Is extends s.E{constructor(t,n,u){super(),this.id=t,this._onlySymbols=u,n.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new mp(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new hf,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const u=this._tiles[n];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(on).map(t=>t.key)}getRenderableIds(t,n){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,n)&&u.push(this._tiles[p]);return t?u.sort((p,g)=>{const x=p.tileID,C=g.tileID,P=new s.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),O=new s.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-C.overscaledZ||O.y-P.y||O.x-P.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(on).map(p=>p.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=n),this._loadTile(u,this._tileLoaded.bind(this,u,t,n)))}_tileLoaded(t,n,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new s.z(p,{tile:t}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let p=0;p<n.length;p++){const g=n[p];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);u(t,x),u(x,t)}}function u(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let x=g.tileID.canonical.x-p.tileID.canonical.x;const C=g.tileID.canonical.y-p.tileID.canonical.y,P=Math.pow(2,p.tileID.canonical.z),O=g.tileID.key;x===0&&C===0||Math.abs(C)>1||(Math.abs(x)>1&&(Math.abs(x+P)===1?x+=P:Math.abs(x-P)===1&&(x-=P)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,x,C),p.neighboringTiles&&p.neighboringTiles[O]&&(p.neighboringTiles[O].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,u,p){for(const g in this._tiles){let x=this._tiles[g];if(p[g]||!x.hasData()||x.tileID.overscaledZ<=n||x.tileID.overscaledZ>u)continue;let C=x.tileID;for(;x&&x.tileID.overscaledZ>n+1;){const O=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[O.key],x&&x.hasData()&&(C=O)}let P=C;for(;P.overscaledZ>n;)if(P=P.scaledTo(P.overscaledZ-1),t[P.key]){p[C.key]=C;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=n?u:null}for(let u=t.overscaledZ-1;u>=n;u--){const p=t.scaledTo(u),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const u=Math.ceil(t.width/n)+1,p=Math.ceil(t.height/n)+1,g=Math.floor(u*p*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(C)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const u={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+n),u[g.tileID.key]=g}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,n,u,p){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const g=this._source.type==="batched-model";let x,C=this._source.maxzoom;const P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){const U=P.attenuationRange()[0],F=Math.floor(U)-Math.log2(P.getDemUpscale());C>F&&(C=F)}if(this.used||this.usedForTerrain){if(this._source.tileID)x=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new s.aH(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y));else if(this.tileCoverLift!==0){const U=t.clone();U.tileCoverLift=this.tileCoverLift,x=U.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.minzoom<=1&&t.projection.name==="globe"&&(x.push(new s.aH(1,0,1,0,0)),x.push(new s.aH(1,0,1,1,0)),x.push(new s.aH(1,0,1,0,1)),x.push(new s.aH(1,0,1,1,1)))}else if(x=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.hasTile){const U=this._source.hasTile.bind(this._source);x=x.filter(F=>U(F))}}else x=[];if(x.length>0&&this.castsShadows&&p&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Nu(this._source.type)){const U=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),F=Math.min(U,this._source.maxzoom);if(g){const Z=t.extendTileCover(x,F);for(const Y of Z)x.push(Y)}else{const Z=t.extendTileCover(x,F,p);for(const Y of Z)this._shadowCasterTiles[Y.key]=!0,x.push(Y)}}const O=this._updateRetainedTiles(x);if(Nu(this._source.type)&&x.length!==0){const U={},F={},Z=Object.keys(O);for(const X of Z){const J=O[X],ee=this._tiles[X];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=s.q.now())continue;const oe=this.findLoadedParent(J,Math.max(J.overscaledZ-Is.maxOverzooming,this._source.minzoom));oe&&(this._addTile(oe.tileID),U[oe.tileID.key]=oe.tileID),F[X]=J}const Y=x[x.length-1].overscaledZ;for(const X in this._tiles){const J=this._tiles[X];if(O[X]||!J.hasData())continue;let ee=J.tileID;for(;ee.overscaledZ>Y;){ee=ee.scaledTo(ee.overscaledZ-1);const oe=this._tiles[ee.key];if(oe&&oe.hasData()&&F[ee.key]){O[X]=J.tileID;break}}}for(const X in U)O[X]||(this._coveredTiles[X]=!0,O[X]=U[X])}for(const U in O)this._tiles[U].clearFadeHold();const k=s.bk(this._tiles,O);for(const U of k){const F=this._tiles[U];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const u={},p=t.reduce((O,k)=>Math.min(O,k.overscaledZ),1/0),g=t[0].overscaledZ,x=Math.max(g-Is.maxOverzooming,this._source.minzoom),C=Math.max(g+Is.maxUnderzooming,this._source.minzoom),P={};for(const O of t){const k=this._addTile(O);n[O.key]=O,k.hasData()||p<this._source.maxzoom&&(P[O.key]=O)}this._retainLoadedChildren(P,p,C,n);for(const O of t){let k=this._tiles[O.key];if(k.hasData())continue;if(O.canonical.z>=this._source.maxzoom){const F=O.children(this._source.maxzoom)[0],Z=this.getTile(F);if(Z&&Z.hasData()){n[F.key]=F;continue}}else{const F=O.children(this._source.maxzoom);if(n[F[0].key]&&n[F[1].key]&&n[F[2].key]&&n[F[3].key])continue}let U=k.wasRequested();for(let F=O.overscaledZ-1;F>=x;--F){const Z=O.scaledTo(F);if(u[Z.key]||(u[Z.key]=!0,k=this.getTile(Z),!k&&U&&(k=this._addTile(Z)),k&&(n[Z.key]=Z,U=k.wasRequested(),k.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}n.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;p=g}for(const g of n)this._loadedParentTiles[g]=u}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const u=!!n;if(!u){const p=this.map?this.map.painter:null,g=this._source.tileSize*t.overscaleFactor();n=this._source.type==="raster-array"?new as(t,g,this.transform.tileZoom,p,this._isRaster):new la(t,g,this.transform.tileZoom,p,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,u||this._source.fire(new s.A("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=n.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,u){const p=[],g=this.transform;if(!g)return p;const x=g.projection.name==="globe",C=s.av(g.center.lng);for(const P in this._tiles){const O=this._tiles[P];if(u&&O.clearQueryDebugViz(),O.holdingForFade())continue;let k;if(x){const U=O.tileID.canonical;if(U.z===0){const F=[Math.abs(s.ay(C,...Kt(U,-1))-C),Math.abs(s.ay(C,...Kt(U,1))-C)];k=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(s.ay(C,...Kt(U,-1))-C),Math.abs(s.ay(C,...Kt(U,0))-C),Math.abs(s.ay(C,...Kt(U,1))-C)];k=[F.indexOf(Math.min(...F))-1]}}else k=[0];for(const U of k){const F=t.containsTile(O,g,n,U);F&&p.push(F)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const u=this.getRenderableIds(t,n).map(g=>this._tiles[g].tileID),p=this.transform.projection.name==="globe";for(const g of u)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=p?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return u}sortCoordinatesByDistance(t){const n=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),g={};for(const x of n){const C=1/(1<<x.canonical.z);g[x.key]=((x.canonical.x+.5)*C+x.wrap-u[0])*p[0]+((x.canonical.y+.5)*C-u[1])*p[1]-u[2]*p[2]}return n.sort((x,C)=>g[x.key]-g[C.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Nu(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(t,n,u){this._state.updateState(t=t||"_geojsonTileLayer",n,u)}removeFeatureState(t,n,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,u)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,u){const p=this._tiles[t];p&&p.setDependencies(n,u)}reloadTilesForDependencies(t,n){for(const u in this._tiles)this._tiles[u].hasDependency(t,n)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const P=()=>{this._sourceLoaded&&(this._source.off("data",P),this._preloadTiles(t,n))};return void this._source.on("data",P)}const u=new Map,p=Array.isArray(t)?t:[t],g=this.map.painter.terrain,x=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const P of p){const O=P.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of O)u.set(k.key,k);this.usedForTerrain&&P.updateElevation(!1)}const C=Array.from(u.values());s.bl(C,(P,O)=>{const k=new la(P,this._source.tileSize*P.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(k,U=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),O(U,k)})},n)}}function on(h,t){const n=Math.abs(2*h.wrap)-+(h.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||u-n||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function Nu(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Kt(h,t){const n=1<<h.z;return[h.x/n+t,(h.x+1)/n+t]}Is.maxOverzooming=10,Is.maxUnderzooming=3;class Ul{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,n=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:t,visibilityChanged:n});else if(p.type==="model"){const g=this.style.getLayerSource(p);g&&g.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:n})}}}onNewFrame(t){this.layersGotHidden=!1;for(const n of this.layers){const u=n.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&n.visible,n.visible=p}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(const p of this.layers){const g=p.layer,x=this.style.getLayerSourceCache(g);let C=1;g.type==="fill-extrusion"&&(C=p.visible?g.paint.get("fill-extrusion-vertical-scale"):0);let P=x?x.getTile(n):null;if(!P&&x&&n.canonical.z>x.getSource().minzoom){let O=n.scaledTo(Math.min(x.getSource().maxzoom,n.overscaledZ-1));for(;O.overscaledZ>=x.getSource().minzoom&&(P=x.getTile(O),!P&&O.overscaledZ!==0);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:P?P.getBucket(g):null,tileID:P?P.tileID:n,verticalScale:C})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const g=t.symbolInstances.get(p),x=g.zOffset,C=this._getHeightAtTileOffset(n,g.tileAnchorX,g.tileAnchorY);g.zOffset=C!==Number.NEGATIVE_INFINITY?C:x,u||x===g.zOffset||(u=!0),t.hasAnyZOffset||g.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,u,p){let g=n,x=u;if(t.canonical.z!==p.canonical.z){const C=p.canonical,P=1/(1<<t.canonical.z-C.z);g=(n+t.canonical.x*s.ai)*P-C.x*s.ai|0,x=(u+t.canonical.y*s.ai)*P-C.y*s.ai|0}return{tileX:g,tileY:x}}_getHeightAtTileOffset(t,n,u){let p,g;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:P,verticalScale:O}=this.currentBuildingBuckets[x];if(!C)continue;const{tileX:k,tileY:U}=this._mapCoordToOverlappingTile(t,n,u,P),F=C.getHeightAtTileCoord(k,U);F&&F.height!==void 0&&(F.hidden?p=F.height:g=Math.max(F.height*O,g||0))}if(g!==void 0)return g;for(let x=0;x<this.layers.length;++x){const C=this.layers[x];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:P,tileID:O}=this.currentBuildingBuckets[x];if(!P)continue;const{tileX:k,tileY:U}=this._mapCoordToOverlappingTile(t,n,u,O),F=P.getHeightAtTileCoord(k,U);if(F&&!F.hidden)return F.height===void 0&&p!==void 0?Math.min(F.maxHeight,p)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function df(h,t){const n={};for(const u in h)u!=="ref"&&(n[u]=h[u]);return s.bm.forEach(u=>{u in t&&(n[u]=t[u])}),n}function Vl(h){h=h.slice();const t=Object.create(null);for(let n=0;n<h.length;n++)t[h[n].id]=h[n];for(let n=0;n<h.length;n++)"ref"in h[n]&&(h[n]=df(h[n],t[h[n].ref]));return h}const Hi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ps(h,t,n){n.push({command:Hi.addSource,args:[h,t[h]]})}function ca(h,t,n){t.push({command:Hi.removeSource,args:[h]}),n[h]=!0}function Zo(h,t,n,u){ca(h,n,u),ps(h,t,n)}function Ut(h,t,n){let u;for(u in h[n])if(h[n].hasOwnProperty(u)&&u!=="data"&&!s.bn(h[n][u],t[n][u]))return!1;for(u in t[n])if(t[n].hasOwnProperty(u)&&u!=="data"&&!s.bn(h[n][u],t[n][u]))return!1;return!0}function Zi(h,t,n,u,p,g){let x;for(x in t=t||{},h=h||{})h.hasOwnProperty(x)&&(s.bn(h[x],t[x])||n.push({command:g,args:[u,x,t[x],p]}));for(x in t)t.hasOwnProperty(x)&&!h.hasOwnProperty(x)&&(s.bn(h[x],t[x])||n.push({command:g,args:[u,x,t[x],p]}))}function Ki(h){return h.id}function Lr(h,t){return h[t.id]=t,h}class jl{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ay(t,0,1);let n=1,u=this._distances[n];const p=t*this.paddedLength+this.padding;for(;u<p&&n<this._distances.length;)u=this._distances[++n];const g=n-1,x=this._distances[g],C=u-x,P=C>0?(p-x)/C:0;return this.points[g].mult(1-P).add(this.points[n].mult(P))}}class Ji{constructor(t,n,u){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(n/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,u,p,g){this._forEachCell(n,u,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(t,n,u,p){this._forEachCell(n-p,u-p,n+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,n,u,p,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,n,u,p,g,x){this.circleCells[g].push(x)}_query(t,n,u,p,g,x){if(u<0||t>this.width||p<0||n>this.height)return!g&&[];const C=[];if(t<=0&&n<=0&&this.width<=u&&this.height<=p){if(g)return!0;for(let P=0;P<this.boxKeys.length;P++)C.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const O=this.circles[3*P],k=this.circles[3*P+1],U=this.circles[3*P+2];C.push({key:this.circleKeys[P],x1:O-U,y1:k-U,x2:O+U,y2:k+U})}return x?C.filter(x):C}return this._forEachCell(t,n,u,p,this._queryCell,C,{hitTest:g,seenUids:{box:{},circle:{}}},x),g?C.length>0:C}_queryCircle(t,n,u,p,g){const x=t-u,C=t+u,P=n-u,O=n+u;if(C<0||x>this.width||O<0||P>this.height)return!p&&[];const k=[];return this._forEachCell(x,P,C,O,this._queryCellCircle,k,{hitTest:p,circle:{x:t,y:n,radius:u},seenUids:{box:{},circle:{}}},g),p?k.length>0:k}query(t,n,u,p,g){return this._query(t,n,u,p,!1,g)}hitTest(t,n,u,p,g){return this._query(t,n,u,p,!0,g)}hitTestCircle(t,n,u,p){return this._queryCircle(t,n,u,!0,p)}_queryCell(t,n,u,p,g,x,C,P){const O=C.seenUids,k=this.boxCells[g];if(k!==null){const F=this.bboxes;for(const Z of k)if(!O.box[Z]){O.box[Z]=!0;const Y=4*Z;if(t<=F[Y+2]&&n<=F[Y+3]&&u>=F[Y+0]&&p>=F[Y+1]&&(!P||P(this.boxKeys[Z]))){if(C.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[Z],x1:F[Y],y1:F[Y+1],x2:F[Y+2],y2:F[Y+3]})}}}const U=this.circleCells[g];if(U!==null){const F=this.circles;for(const Z of U)if(!O.circle[Z]){O.circle[Z]=!0;const Y=3*Z;if(this._circleAndRectCollide(F[Y],F[Y+1],F[Y+2],t,n,u,p)&&(!P||P(this.circleKeys[Z]))){if(C.hitTest)return x.push(!0),!0;{const X=F[Y],J=F[Y+1],ee=F[Y+2];x.push({key:this.circleKeys[Z],x1:X-ee,y1:J-ee,x2:X+ee,y2:J+ee})}}}}}_queryCellCircle(t,n,u,p,g,x,C,P){const O=C.circle,k=C.seenUids,U=this.boxCells[g];if(U!==null){const Z=this.bboxes;for(const Y of U)if(!k.box[Y]){k.box[Y]=!0;const X=4*Y;if(this._circleAndRectCollide(O.x,O.y,O.radius,Z[X+0],Z[X+1],Z[X+2],Z[X+3])&&(!P||P(this.boxKeys[Y])))return x.push(!0),!0}}const F=this.circleCells[g];if(F!==null){const Z=this.circles;for(const Y of F)if(!k.circle[Y]){k.circle[Y]=!0;const X=3*Y;if(this._circlesCollide(Z[X],Z[X+1],Z[X+2],O.x,O.y,O.radius)&&(!P||P(this.circleKeys[Y])))return x.push(!0),!0}}}_forEachCell(t,n,u,p,g,x,C,P){const O=this._convertToXCellCoord(t),k=this._convertToYCellCoord(n),U=this._convertToXCellCoord(u),F=this._convertToYCellCoord(p);for(let Z=O;Z<=U;Z++)for(let Y=k;Y<=F;Y++)if(g.call(this,t,n,u,p,this.xCellCount*Y+Z,x,C,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,u,p,g,x){const C=p-t,P=g-n,O=u+x;return O*O>C*C+P*P}_circleAndRectCollide(t,n,u,p,g,x,C){const P=(x-p)/2,O=Math.abs(t-(p+P));if(O>P+u)return!1;const k=(C-g)/2,U=Math.abs(n-(g+k));if(U>k+u)return!1;if(O<=P||U<=k)return!0;const F=O-P,Z=U-k;return F*F+Z*Z<=u*u}}const ua={unknown:0,flipRequired:1,flipNotRequired:2},qc=Math.tan(85*Math.PI/180);function xr(h,t,n,u,p,g,x){const C=s.ad.mat4.create();if(n)if(g.name==="globe"){const P=s.bo(p,t);s.ad.mat4.multiply(C,C,P)}else{const P=s.ad.mat2.invert([],x);C[0]=P[0],C[1]=P[1],C[4]=P[2],C[5]=P[3],u||s.ad.mat4.rotateZ(C,C,p.angle)}else s.ad.mat4.multiply(C,p.labelPlaneMatrix,h);return C}function cr(h,t,n,u,p,g,x){const C=xr(h,t,n,u,p,g,x);return g.name==="globe"&&n||(C[2]=C[6]=C[10]=C[14]=0),C}function Hn(h,t,n,u,p,g,x){if(n){if(g.name==="globe"){const C=xr(h,t,n,u,p,g,x);return s.ad.mat4.invert(C,C),s.ad.mat4.multiply(C,h,C),C}{const C=s.ad.mat4.clone(h),P=s.ad.mat4.identity([]);return P[0]=x[0],P[1]=x[1],P[4]=x[2],P[5]=x[3],s.ad.mat4.multiply(C,C,P),u||s.ad.mat4.rotateZ(C,C,-p.angle),C}}return p.glCoordMatrix}function Cs(h,t,n,u){const p=[h,t,n,1];n?s.ad.vec4.transformMat4(p,p,u):mr(p,p,u);const g=p[3];return p[0]/=g,p[1]/=g,p[2]/=g,p}function Gc(h,t){return Math.min(.5+h/t*.5,1.5)}function Fu(h,t){const n=h[0]/h[3],u=h[1]/h[3];return n>=-t[0]&&n<=t[0]&&u>=-t[1]&&u<=t[1]}function $o(h,t,n,u,p,g,x,C,P,O){const k=n.transform,U=u?h.textSizeData:h.iconSizeData,F=s.bp(U,n.transform.zoom),Z=k.projection.name==="globe",Y=[256/n.width*2+1,256/n.height*2+1],X=u?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;X.clear();let J=null;Z&&(J=u?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const ee=h.lineVertexArray,oe=u?h.text.placedSymbolArray:h.icon.placedSymbolArray,fe=n.transform.width/n.transform.height;let ce,xe=!1;for(let _e=0;_e<oe.length;_e++){const ge=oe.get(_e),{numGlyphs:ye,writingMode:we}=ge;if(we!==s.bq.vertical||xe||ce===s.bq.horizontal||(xe=!0),ce=we,(ge.hidden||we===s.bq.vertical)&&!xe){Js(ye,X);continue}xe=!1;const Ae=new s.P(ge.tileAnchorX,ge.tileAnchorY);let{x:je,y:Be,z:Qe}=k.projection.projectTilePoint(Ae.x,Ae.y,O.canonical);if(P){const[Et,It,Vt]=P(Ae);je+=Et,Be+=It,Qe+=Vt}const nt=[je,Be,Qe,1];if(s.ad.vec4.transformMat4(nt,nt,t),!Fu(nt,Y)){Js(ye,X);continue}const dt=nt[3],Le=Gc(n.transform.getCameraToCenterDistance(k.projection),dt),et=s.br(U,F,ge),Oe=x?et/Le:et*Le,tt=Cs(je,Be,Qe,p);if(tt[3]<=0){Js(ye,X);continue}let Xe={};const st=s.ak(h.layers[0].layout.get("text-max-angle")),Ge=Math.cos(st),rt=x?null:P,St=Kr(ge,Oe,!1,C,t,p,g,h.glyphOffsetArray,ee,X,J,tt,Ae,Xe,fe,rt,k.projection,O,x,Ge);xe=St.useVertical,rt&&St.needsFlipping&&(Xe={}),(St.notEnoughRoom||xe||St.needsFlipping&&Kr(ge,Oe,!0,C,t,p,g,h.glyphOffsetArray,ee,X,J,tt,Ae,Xe,fe,rt,k.projection,O,x,Ge).notEnoughRoom)&&Js(ye,X)}u?(h.text.dynamicLayoutVertexBuffer.updateData(X),J&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(J)):(h.icon.dynamicLayoutVertexBuffer.updateData(X),J&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(J))}function Xo(h,t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X,J){const{lineStartIndex:ee,glyphStartIndex:oe,segment:fe}=C,ce=oe+C.numGlyphs,xe=ee+C.lineLength,_e=t.getoffsetX(oe),ge=t.getoffsetX(ce-1),ye=Uu(h*_e,n,u,p,g,x,fe,ee,xe,P,O,k,U,F,!0,Z,Y,X,J);if(!ye)return null;const we=Uu(h*ge,n,u,p,g,x,fe,ee,xe,P,O,k,U,F,!0,Z,Y,X,J);return we?{first:ye,last:we}:null}function Wo(h,t,n,u){return h===s.bq.horizontal&&Math.abs(u)>Math.abs(n)?{useVertical:!0}:h===s.bq.vertical?u>0?{needsFlipping:!0}:null:t!==ua.unknown&&function(p,g){return p===0||Math.abs(g/p)>qc}(n,u)?t===ua.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function Kr(h,t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X,J,ee,oe,fe){const ce=t/24,xe=h.lineOffsetX*ce,_e=h.lineOffsetY*ce,{lineStartIndex:ge,glyphStartIndex:ye,numGlyphs:we,segment:Ae,writingMode:je,flipState:Be}=h,Qe=ge+h.lineLength,nt=dt=>{if(k){const[tt,Xe,st]=dt.up,Ge=O.length;s.bs(k,Ge+0,tt,Xe,st),s.bs(k,Ge+1,tt,Xe,st),s.bs(k,Ge+2,tt,Xe,st),s.bs(k,Ge+3,tt,Xe,st)}const[Le,et,Oe]=dt.point;s.bt(O,Le,et,Oe,dt.angle)};if(we>1){const dt=Xo(ce,C,xe,_e,n,U,F,h,P,g,Z,X,!1,J,ee,oe,fe);if(!dt)return{notEnoughRoom:!0};if(u&&!n){let[Le,et,Oe]=dt.first.point,[tt,Xe,st]=dt.last.point;[Le,et]=Cs(Le,et,Oe,x),[tt,Xe]=Cs(tt,Xe,st,x);const Ge=Wo(je,Be,(tt-Le)*Y,Xe-et);if(h.flipState=Ge&&Ge.needsFlipping?ua.flipRequired:ua.flipNotRequired,Ge)return Ge}nt(dt.first);for(let Le=ye+1;Le<ye+we-1;Le++){const et=Uu(ce*C.getoffsetX(Le),xe,_e,n,U,F,Ae,ge,Qe,P,g,Z,X,!1,!1,J,ee,oe,fe);if(!et)return O.length-=4*(Le-ye),{notEnoughRoom:!0};nt(et)}nt(dt.last)}else{if(u&&!n){const Le=Cs(F.x,F.y,0,p),et=ge+Ae+1,Oe=new s.P(P.getx(et),P.gety(et)),tt=Cs(Oe.x,Oe.y,0,p),Xe=tt[3]>0?tt:os(F,Oe,Le,1,p,void 0,J,ee.canonical),st=Wo(je,Be,(Xe[0]-Le[0])*Y,Xe[1]-Le[1]);if(h.flipState=st&&st.needsFlipping?ua.flipRequired:ua.flipNotRequired,st)return st}const dt=Uu(ce*C.getoffsetX(ye),xe,_e,n,U,F,Ae,ge,Qe,P,g,Z,X,!1,!1,J,ee,oe,fe);if(!dt)return{notEnoughRoom:!0};nt(dt)}return{}}function Ja(h,t,n,u,p){const{x:g,y:x,z:C}=u.projectTilePoint(h.x,h.y,t);if(!p)return Cs(g,x,C,n);const[P,O,k]=p(h);return Cs(g+P,x+O,C+k,n)}function os(h,t,n,u,p,g,x,C){const P=Ja(h.sub(t)._unit()._add(h),C,p,x,g);return s.ad.vec3.sub(P,n,P),s.ad.vec3.normalize(P,P),s.ad.vec3.scaleAndAdd(P,n,P,u)}function Uu(h,t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X,J,ee,oe){const fe=u?h-t:h+t;let ce=fe>0?1:-1,xe=0;u&&(ce*=-1,xe=Math.PI),ce<0&&(xe+=Math.PI);let _e=C+x+(ce>0?0:1)|0,ge=p,ye=p,we=0,Ae=0;const je=Math.abs(fe),Be=[],Qe=[];let nt=g,dt=nt,Le=s.ad.vec3.zero([]);const et=()=>os(dt,nt,ye,je-we+1,k,F,X,J.canonical);for(;we+Ae<=je;){if(_e+=ce,_e<C||_e>=P)return null;if(ye=ge,dt=nt,Be.push(ye),Z&&Qe.push(dt),nt=new s.P(O.getx(_e),O.gety(_e)),ge=U[_e],!ge){const Vt=Ja(nt,J.canonical,k,X,F);ge=Vt[3]>0?U[_e]=Vt:et()}we+=Ae;const Et=s.ad.vec3.sub([],ge,ye),It=s.ad.vec3.distance(ye,ge);if(n&&It>0&&Ae>0&&s.ad.vec3.dot(Le,Et)/(Ae*It)<oe)return null;Ae=It,Le=Et}Y&&F&&(U[_e]&&(ge=et(),Ae=s.ad.vec3.distance(ye,ge),Le=s.ad.vec3.sub([],ge,ye)),U[_e]=ge);const Oe=(je-we)/Ae,tt=nt.sub(dt)._mult(Oe)._add(dt),Xe=s.ad.vec3.scaleAndAdd([],ye,Le,Oe);let st=[0,0,1],Ge=Le[0],rt=Le[1];if(ee&&(st=X.upVector(J.canonical,tt.x,tt.y),st[0]!==0||st[1]!==0||st[2]!==1)){const Et=[st[2],0,-st[0]],It=s.ad.vec3.cross([],st,Et);s.ad.vec3.normalize(Et,Et),s.ad.vec3.normalize(It,It),Ge=s.ad.vec3.dot(Le,Et),rt=s.ad.vec3.dot(Le,It)}if(n){const Et=s.ad.vec3.cross([],st,Le);s.ad.vec3.normalize(Et,Et),s.ad.vec3.scaleAndAdd(Xe,Xe,Et,n*ce)}const St=xe+Math.atan2(rt,Ge);return Be.push(Xe),Z&&Qe.push(tt),{point:Xe,angle:St,path:Be,tilePath:Qe,up:st}}function Js(h,t){const n=t.length,u=n+4*h;t.resize(u),t.float32.fill(-1/0,4*n,4*u)}function mr(h,t,n){const u=t[0],p=t[1];return h[0]=n[0]*u+n[4]*p+n[12],h[1]=n[1]*u+n[5]*p+n[13],h[3]=n[3]*u+n[7]*p+n[15],h}const kr=100;class vo{constructor(t,n,u=new Ji(t.width+200,t.height+200,25),p=new Ji(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+kr,this.screenBottomBoundary=t.height+kr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,u,p,g,x,C,P){let O=u.projectedAnchorX,k=u.projectedAnchorY,U=u.projectedAnchorZ;const F=u.elevation,Z=u.tileID,Y=t.getProjection();if(F&&Z){const[_e,ge,ye]=Y.upVector(Z.canonical,u.tileAnchorX,u.tileAnchorY),we=Y.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=_e*F*we,k+=ge*F*we,U+=ye*F*we}const X=this.projectAndGetPerspectiveRatio(C,O,k,U,u.tileID,Y.name==="globe"||!!F||this.transform.pitch>0,Y),J=x*X.perspectiveRatio,ee=(u.x1*n+p.x-u.padding)*J+X.point.x,oe=(u.y1*n+p.y-u.padding)*J+X.point.y,fe=(u.x2*n+p.x+u.padding)*J+X.point.x,ce=(u.y2*n+p.y+u.padding)*J+X.point.y,xe=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(ee,oe,fe,ce)||!g&&this.grid.hitTest(ee,oe,fe,ce,P)||xe?{box:[],offscreen:!1,occluded:X.occluded}:{box:[ee,oe,fe,ce],offscreen:this.isOffscreen(ee,oe,fe,ce),occluded:!1}}placeCollisionCircles(t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X){const J=[],ee=this.transform.elevation,oe=t.getProjection(),fe=ee?ee.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,oe):null,ce=new s.P(u.tileAnchorX,u.tileAnchorY);let{x:xe,y:_e,z:ge}=oe.projectTilePoint(ce.x,ce.y,X.canonical);if(fe){const[st,Ge,rt]=fe(ce);xe+=st,_e+=Ge,ge+=rt}const ye=oe.name==="globe",we=this.projectAndGetPerspectiveRatio(C,xe,_e,ge,X,ye||!!ee||this.transform.pitch>0,oe),{perspectiveRatio:Ae}=we,je=(U?x/Ae:x*Ae)/s.bw,Be=Cs(xe,_e,ge,P),Qe=u.lineOffsetX*je,nt=u.lineOffsetY*je,dt=s.ak(t.layers[0].layout.get("text-max-angle")),Le=Math.cos(dt),et=we.signedDistanceFromCamera>0?Xo(je,g,Qe,nt,!1,Be,ce,u,p,P,{},ee&&!U?fe:null,U&&!!ee,oe,X,U,Le):null;let Oe=!1,tt=!1,Xe=!0;if(et&&!we.occluded){const st=.5*Z*Ae+Y,Ge=new s.P(-100,-100),rt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),St=new jl,{first:Et,last:It}=et,Vt=Et.path.length;let di=[];for(let li=Vt-1;li>=1;li--)di.push(Et.path[li]);for(let li=1;li<It.path.length;li++)di.push(It.path[li]);const Qt=2.5*st;O&&(di=di.map(([li,Ui,sn],Si)=>(fe&&!ye&&(sn=fe(Si<Vt-1?Et.tilePath[Vt-1-Si]:It.tilePath[Si-Vt+2])[2]),Cs(li,Ui,sn,O))),di.some(li=>li[3]<=0)&&(di=[]));let ui=[];if(di.length>0){let li=1/0,Ui=-1/0,sn=1/0,Si=-1/0;for(const ii of di)li=Math.min(li,ii[0]),sn=Math.min(sn,ii[1]),Ui=Math.max(Ui,ii[0]),Si=Math.max(Si,ii[1]);Ui>=Ge.x&&li<=rt.x&&Si>=Ge.y&&sn<=rt.y&&(ui=[di.map(ii=>new s.P(ii[0],ii[1]))],(li<Ge.x||Ui>rt.x||sn<Ge.y||Si>rt.y)&&(ui=s.bu(ui,Ge.x,Ge.y,rt.x,rt.y)))}for(const li of ui){St.reset(li,.25*st);let Ui=0;Ui=St.length<=.5*st?1:Math.ceil(St.paddedLength/Qt)+1;for(let sn=0;sn<Ui;sn++){const Si=sn/Math.max(Ui-1,1),ii=St.lerp(Si),bi=ii.x+kr,Ht=ii.y+kr;J.push(bi,Ht,st,0);const At=bi-st,Ei=Ht-st,Xi=bi+st,qi=Ht+st;if(Xe=Xe&&this.isOffscreen(At,Ei,Xi,qi),tt=tt||this.isInsideGrid(At,Ei,Xi,qi),!n&&this.grid.hitTestCircle(bi,Ht,st,F)&&(Oe=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Oe,occluded:!1}}}}return{circles:!k&&Oe||!tt?[]:J,offscreen:Xe,collisionDetected:Oe,occluded:we.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let u=1/0,p=1/0,g=-1/0,x=-1/0;for(const k of t){const U=new s.P(k.x+kr,k.y+kr);u=Math.min(u,U.x),p=Math.min(p,U.y),g=Math.max(g,U.x),x=Math.max(x,U.y),n.push(U)}const C=this.grid.query(u,p,g,x).concat(this.ignoredGrid.query(u,p,g,x)),P={},O={};for(const k of C){const U=k.key;if(P[U.bucketInstanceId]===void 0&&(P[U.bucketInstanceId]={}),P[U.bucketInstanceId][U.featureIndex])continue;const F=[new s.P(k.x1,k.y1),new s.P(k.x2,k.y1),new s.P(k.x2,k.y2),new s.P(k.x1,k.y2)];s.bv(n,F)&&(P[U.bucketInstanceId][U.featureIndex]=!0,O[U.bucketInstanceId]===void 0&&(O[U.bucketInstanceId]=[]),O[U.bucketInstanceId].push(U.featureIndex))}return O}insertCollisionBox(t,n,u,p,g){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,u,p,g){const x=n?this.ignoredGrid:this.grid,C={bucketInstanceId:u,featureIndex:p,collisionGroupID:g};for(let P=0;P<t.length;P+=4)x.insertCircle(C,t[P],t[P+1],t[P+2])}projectAndGetPerspectiveRatio(t,n,u,p,g,x,C){const P=[n,u,p,1];let O=!1;p||this.transform.pitch>0?(s.ad.vec4.transformMat4(P,P,t),this.fogState&&g&&C.name!=="globe"&&(O=function(F,Z,Y,X,J,ee){const oe=ee.calculateFogTileMatrix(J),fe=[Z,Y,X];return s.ad.vec3.transformMat4(fe,fe,oe),Pt(F,s.ad.vec3.length(fe),ee.pitch,ee._fov)}(this.fogState,n,u,p,g.toUnwrapped(),this.transform)>.9)):mr(P,P,t);const k=P[3];return{point:new s.P((P[0]/k+1)/2*this.transform.width+kr,(-P[1]/k+1)/2*this.transform.height+kr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/k*.5,1.5),signedDistanceFromCamera:k,occluded:x&&P[2]>k||O}}isOffscreen(t,n,u,p){return u<kr||t>=this.screenRightBoundary||p<kr||n>this.screenBottomBoundary}isInsideGrid(t,n,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=s.ad.mat4.identity([]);return s.ad.mat4.translate(t,t,[-100,-100,0]),t}}function rr(h,t,n){const u=t.createTileMatrix(h,h.worldSize,n.toUnwrapped());return s.ad.mat4.multiply(new Float32Array(16),h.projMatrix,u)}function ff(h,t,n){if(t.projection.name===n.projection.name)return h.projMatrix;const u=n.clone();return u.setProjection(t.projection),rr(u,t.getProjection(),h)}function Hs(h,t,n){return t.name===n.projection.name?h.projMatrix:rr(n,t,h)}class Hc{constructor(t,n,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Yo{constructor(t,n,u,p,g,x=!1){this.text=new Hc(t?t.text:null,n,u,g),this.icon=new Hc(t?t.icon:null,n,p,g),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xo{constructor(t,n,u,p=!1){this.text=t,this.icon=n,this.skipFade=u,this.clipped=p}}class $m{constructor(){this.invProjMatrix=s.ad.mat4.create(),this.viewportMatrix=s.ad.mat4.create(),this.circles=[]}}class Da{constructor(t,n,u,p,g){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=g}}class Xm{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:u=>u.collisionGroupID===n}}return this.collisionGroups[t]}}function Fh(h,t,n,u,p){const{horizontalAlign:g,verticalAlign:x}=s.bD(h),C=-(g-.5)*t,P=-(x-.5)*n,O=s.bC(h,u);return new s.P(C+O[0]*p,P+O[1]*p)}function ms(h,t,n,u,p){const g=new s.P(h,t);return n&&g._rotate(u?p:-p),g}class _p{constructor(t,n,u,p,g,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new vo(this.transform,g),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new Xm(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,u,p,g=1){const x=u.getBucket(n),C=u.latestFeatureIndex;if(!x||!C||n.fqid!==x.layerIds[0])return;const P=x.layers[0].layout,O=x.layers[0].paint,k=u.collisionBoxArray,U=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),F=u.tileSize/s.ai,Z=u.tileID.toUnwrapped();this.transform.setProjection(x.projection);const Y=(X=u.tileID,J=x.getProjection(),ee=this.transform,J.name===this.projection?ee.calculateProjMatrix(X.toUnwrapped()):rr(ee,J,X));var X,J,ee;const oe=P.get("text-pitch-alignment")==="map",fe=P.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const ce=n.dynamicFilter(),xe=n.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(u),ge=cr(Y,u.tileID.canonical,oe,fe,this.transform,x.getProjection(),_e);let ye=null;if(oe){const et=Hn(Y,u.tileID.canonical,oe,fe,this.transform,x.getProjection(),_e);ye=s.ad.mat4.multiply([],this.transform.labelPlaneMatrix,et)}let we=null;ce&&u.latestFeatureIndex&&(we={unwrappedTileID:Z,dynamicFilter:ce,dynamicFilterNeedsFeature:xe}),this.retainedQueryData[x.bucketInstanceId]=new Da(x.bucketInstanceId,C,x.sourceLayerIndex,x.index,u.tileID);const[Ae,je]=x.layers[0].layout.get("text-size-scale-range"),Be=s.ay(g,Ae,je),[Qe,nt]=P.get("icon-size-scale-range"),dt=s.ay(g,Qe,nt),Le={bucket:x,layout:P,paint:O,posMatrix:Y,textLabelPlaneMatrix:ge,labelToScreenMatrix:ye,clippingData:we,scale:U,textPixelRatio:F,holdingForFade:u.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:s.bp(x.textSizeData,this.transform.zoom,Be),partiallyEvaluatedIconSize:s.bp(x.iconSizeData,this.transform.zoom,dt),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const et of x.sortKeyRanges){const{sortKey:Oe,symbolInstanceStart:tt,symbolInstanceEnd:Xe}=et;t.push({sortKey:Oe,symbolInstanceStart:tt,symbolInstanceEnd:Xe,parameters:Le})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Le})}attemptAnchorPlacement(t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X,J,ee,oe){const{textOffset0:fe,textOffset1:ce,crossTileID:xe}=F,_e=[fe,ce],ge=Fh(t,u,p,_e,g),ye=this.collisionIndex.placeCollisionBox(Y,g,n,ms(ge.x,ge.y,x,C,this.transform.angle),U,P,O,k.predicate);if(J){const we=Y.getSymbolInstanceIconSize(oe,this.transform.zoom,F.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,we,J,ms(ge.x,ge.y,x,C,this.transform.angle),U,P,O,k.predicate).box.length===0)return}if(ye.box.length>0){let we;return this.prevPlacement&&this.prevPlacement.variableOffsets[xe]&&this.prevPlacement.placements[xe]&&this.prevPlacement.placements[xe].text&&(we=this.prevPlacement.variableOffsets[xe].anchor),this.variableOffsets[xe]={textOffset:_e,width:u,height:p,anchor:t,textScale:g,prevAnchor:we},this.markUsedJustification(Y,t,F,X),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,X,F),this.placedOrientations[xe]=X),{shift:ge,placedGlyphBoxes:ye}}}placeLayerBucketPart(t,n,u,p,g=1){const{bucket:x,layout:C,paint:P,posMatrix:O,textLabelPlaneMatrix:k,labelToScreenMatrix:U,clippingData:F,textPixelRatio:Z,holdingForFade:Y,collisionBoxArray:X,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:ee,collisionGroup:oe,latestFeatureIndex:fe}=t.parameters,ce=C.get("text-optional"),xe=C.get("icon-optional"),_e=C.get("text-allow-overlap"),ge=C.get("icon-allow-overlap"),ye=C.get("text-rotation-alignment")==="map",we=C.get("text-pitch-alignment")==="map",Ae=P.get("symbol-z-offset"),je=C.get("symbol-elevation-reference")==="sea",[Be,Qe]=C.get("text-size-scale-range"),[nt,dt]=C.get("icon-size-scale-range"),Le=s.ay(g,Be,Qe),et=s.ay(g,nt,dt);this.transform.setProjection(x.projection);let Oe=_e&&(ge||!x.hasIconData()||xe),tt=ge&&(_e||!x.hasTextData()||ce);const Xe=!Ae.isConstant();!x.collisionArrays&&X&&x.deserializeCollisionBoxes(X),u&&p&&x.updateCollisionDebugBuffers(this.transform.zoom,X,Le,et);const st=(Ge,rt,St)=>{const{crossTileID:Et,numVerticalGlyphVertices:It}=Ge;let Vt=null;if(F&&F.dynamicFilterNeedsFeature||Xe){const Ri=this.retainedQueryData[x.bucketInstanceId];Vt=fe.loadFeature({featureIndex:Ge.featureIndex,bucketIndex:Ri.bucketIndex,sourceLayerIndex:Ri.sourceLayerIndex,layoutVertexArrayOffset:0})}if(F&&!(0,F.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Vt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new s.P(Ge.tileAnchorX,Ge.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[Et]=new xo(!1,!1,!1,!0),void n.add(Et);const di=Ae.evaluate(Vt,{});if(n.has(Et))return;if(Y)return void(this.placements[Et]=new xo(!1,!1,!1));let Qt=!1,ui=!1,li=!0,Ui=!1,sn=!1,Si=null,ii={box:null,offscreen:null,occluded:null},bi={box:null},Ht=null,At=null,Ei=null,Xi=0,qi=0,jn=0;St.textFeatureIndex?Xi=St.textFeatureIndex:Ge.useRuntimeCollisionCircles&&(Xi=Ge.featureIndex),St.verticalTextFeatureIndex&&(qi=St.verticalTextFeatureIndex);const kn=Ri=>{Ri.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const Sn=this.transform.elevation;Ri.elevation=je?di:di+(Sn?Sn.getAtTileOffset(Ri.tileID,Ri.tileAnchorX,Ri.tileAnchorY):0),Ri.elevation+=Ge.zOffset},fn=St.textBox;if(fn){kn(fn);const Ri=Wi=>{let $i=s.bq.horizontal;if(x.allowVerticalPlacement&&!Wi&&this.prevPlacement){const Rr=this.prevPlacement.placedOrientations[Et];Rr&&(this.placedOrientations[Et]=Rr,$i=Rr,this.markUsedOrientation(x,$i,Ge))}return $i},Sn=(Wi,$i)=>{if(x.allowVerticalPlacement&&It>0&&St.verticalTextBox){for(const Rr of x.writingModes)if(Rr===s.bq.vertical?(ii=$i(),bi=ii):ii=Wi(),ii&&ii.box&&ii.box.length)break}else ii=Wi()};if(C.get("text-variable-anchor")){let Wi=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Et]){const Rn=this.prevPlacement.variableOffsets[Et];Wi.indexOf(Rn.anchor)>0&&(Wi=Wi.filter(ar=>ar!==Rn.anchor),Wi.unshift(Rn.anchor))}const $i=(Rn,ar,na)=>{const Dr=x.getSymbolInstanceTextSize(J,Ge,this.transform.zoom,rt),Yn=(Rn.x2-Rn.x1)*Dr+2*Rn.padding,wr=(Rn.y2-Rn.y1)*Dr+2*Rn.padding,hs=Ge.hasIconTextFit&&!ge?ar:null;hs&&kn(hs);let Wr={box:[],offscreen:!1,occluded:!1};const Na=_e?2*Wi.length:Wi.length;for(let wa=0;wa<Na;++wa){const fo=this.attemptAnchorPlacement(Wi[wa%Wi.length],Rn,Yn,wr,Dr,ye,we,Z,O,oe,wa>=Wi.length,Ge,rt,x,na,hs,J,ee);if(fo&&(Wr=fo.placedGlyphBoxes,Wr&&Wr.box&&Wr.box.length)){Qt=!0,Si=fo.shift;break}}return Wr};Sn(()=>$i(fn,St.iconBox,s.bq.horizontal),()=>{const Rn=St.verticalTextBox;return Rn&&kn(Rn),x.allowVerticalPlacement&&!(ii&&ii.box&&ii.box.length)&&It>0&&Rn?$i(Rn,St.verticalIconBox,s.bq.vertical):{box:null,offscreen:null,occluded:null}}),ii&&(Qt=ii.box,li=ii.offscreen,Ui=ii.occluded);const Rr=Ri(!(!ii||!ii.box));if(!Qt&&this.prevPlacement){const Rn=this.prevPlacement.variableOffsets[Et];Rn&&(this.variableOffsets[Et]=Rn,this.markUsedJustification(x,Rn.anchor,Ge,Rr))}}else{const Wi=($i,Rr)=>{const Rn=x.getSymbolInstanceTextSize(J,Ge,this.transform.zoom,rt,g),ar=this.collisionIndex.placeCollisionBox(x,Rn,$i,new s.P(0,0),_e,Z,O,oe.predicate);return ar&&ar.box&&ar.box.length&&(this.markUsedOrientation(x,Rr,Ge),this.placedOrientations[Et]=Rr),ar};Sn(()=>Wi(fn,s.bq.horizontal),()=>{const $i=St.verticalTextBox;return x.allowVerticalPlacement&&It>0&&$i?(kn($i),Wi($i,s.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Ri(!!(ii&&ii.box&&ii.box.length))}}if(Ht=ii,Qt=Ht&&Ht.box&&Ht.box.length>0,li=Ht&&Ht.offscreen,Ui=Ht&&Ht.occluded,Ge.useRuntimeCollisionCircles){const Ri=x.text.placedSymbolArray.get(Ge.centerJustifiedTextSymbolIndex>=0?Ge.centerJustifiedTextSymbolIndex:Ge.verticalPlacedTextSymbolIndex),Sn=s.br(x.textSizeData,J,Ri),Wi=C.get("text-padding");At=this.collisionIndex.placeCollisionCircles(x,_e,Ri,x.lineVertexArray,x.glyphOffsetArray,Sn,O,k,U,u,we,oe.predicate,Ge.collisionCircleDiameter*Sn/s.bw,Wi,this.retainedQueryData[x.bucketInstanceId].tileID),Qt=_e||At.circles.length>0&&!At.collisionDetected,li=li&&At.offscreen,Ui=At.occluded}if(St.iconFeatureIndex&&(jn=St.iconFeatureIndex),St.iconBox){const Ri=Sn=>{kn(Sn);const Wi=Ge.hasIconTextFit&&Si?ms(Si.x,Si.y,ye,we,this.transform.angle):new s.P(0,0),$i=x.getSymbolInstanceIconSize(ee,this.transform.zoom,Ge.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,$i,Sn,Wi,ge,Z,O,oe.predicate)};bi&&bi.box&&bi.box.length&&St.verticalIconBox?(Ei=Ri(St.verticalIconBox),ui=Ei.box.length>0):(Ei=Ri(St.iconBox),ui=Ei.box.length>0),li=li&&Ei.offscreen,sn=Ei.occluded}const Wn=ce||Ge.numHorizontalGlyphVertices===0&&It===0,$r=xe||Ge.numIconVertices===0;if(Wn||$r?$r?Wn||(ui=ui&&Qt):Qt=ui&&Qt:ui=Qt=ui&&Qt,Qt&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,C.get("text-ignore-placement"),x.bucketInstanceId,bi&&bi.box&&qi?qi:Xi,oe.ID),ui&&Ei&&this.collisionIndex.insertCollisionBox(Ei.box,C.get("icon-ignore-placement"),x.bucketInstanceId,jn,oe.ID),At&&(Qt&&this.collisionIndex.insertCollisionCircles(At.circles,C.get("text-ignore-placement"),x.bucketInstanceId,Xi,oe.ID),u)){const Ri=x.bucketInstanceId;let Sn=this.collisionCircleArrays[Ri];Sn===void 0&&(Sn=this.collisionCircleArrays[Ri]=new $m);for(let Wi=0;Wi<At.circles.length;Wi+=4)Sn.circles.push(At.circles[Wi+0]),Sn.circles.push(At.circles[Wi+1]),Sn.circles.push(At.circles[Wi+2]),Sn.circles.push(At.collisionDetected?1:0)}const Xr=x.projection.name!=="globe";Oe=Oe&&(Xr||!Ui),tt=tt&&(Xr||!sn),this.placements[Et]=new xo(Qt||Oe,ui||tt,li||x.justReloaded),n.add(Et)};if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.elevationType==="road"&&x.updateRoadElevation(),x.updateZOffset(),x.sortFeaturesByY){const Ge=x.getSortedSymbolIndexes(this.transform.angle);for(let rt=Ge.length-1;rt>=0;--rt){const St=Ge[rt];st(x.symbolInstances.get(St),St,x.collisionArrays[St])}x.hasAnyZOffset&&s.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const Ge=x.getSortedIndexesByZOffset();for(let rt=0;rt<Ge.length;++rt){const St=Ge[rt];st(x.symbolInstances.get(St),St,x.collisionArrays[St])}}else for(let Ge=t.symbolInstanceStart;Ge<t.symbolInstanceEnd;Ge++)st(x.symbolInstances.get(Ge),Ge,x.collisionArrays[Ge]);if(u&&x.bucketInstanceId in this.collisionCircleArrays){const Ge=this.collisionCircleArrays[x.bucketInstanceId];s.ad.mat4.invert(Ge.invProjMatrix,O),Ge.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,n,u,p){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:P,crossTileID:O}=u,k=s.bB(n),U=p===s.bq.vertical?P:k==="left"?g:k==="center"?x:k==="right"?C:-1;g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=U>=0&&g!==U?0:O),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=U>=0&&x!==U?0:O),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:O),P>=0&&(t.text.placedSymbolArray.get(P).crossTileID=U>=0&&P!==U?0:O)}markUsedOrientation(t,n,u){const p=n===s.bq.horizontal||n===s.bq.horizontalOnly?n:0,g=n===s.bq.vertical?n:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:O}=u,k=t.text.placedSymbolArray;x>=0&&(k.get(x).placedOrientation=p),C>=0&&(k.get(C).placedOrientation=p),P>=0&&(k.get(P).placedOrientation=p),O>=0&&(k.get(O).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let u=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const p=n?n.symbolFadeChange(t):1,g=n?n.opacities:{},x=n?n.variableOffsets:{},C=n?n.placedOrientations:{};for(const P in this.placements){const O=this.placements[P],k=g[P];k?(this.opacities[P]=new Yo(k,p,O.text,O.icon,null,O.clipped),u=u||O.text!==k.text.placed||O.icon!==k.icon.placed):(this.opacities[P]=new Yo(null,p,O.text,O.icon,O.skipFade,O.clipped),u=u||O.text||O.icon)}for(const P in g){const O=g[P];if(!this.opacities[P]){const k=new Yo(O,p,!1,!1);k.isHidden()||(this.opacities[P]=k,u=u||O.text.placed||O.icon.placed)}}for(const P in x)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=x[P]);for(const P in C)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=C[P]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n,u,p){const g=new Set;for(const x of n){const C=x.getBucket(t);C&&x.latestFeatureIndex&&t.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,g,x,x.collisionBoxArray,u,p,x.tileID,t.scope),C.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(C,x.tileID),C.elevationType==="road"&&C.updateRoadElevation(),C.updateZOffset())}}updateBucketOpacities(t,n,u,p,g,x,C,P){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const O=t.layers[0].layout,k=t.layers[0].paint,U=!!t.layers[0].dynamicFilter(),F=new Yo(null,0,!1,!1,!0),Z=O.get("text-allow-overlap"),Y=O.get("icon-allow-overlap"),X=O.get("text-variable-anchor"),J=O.get("text-rotation-alignment")==="map",ee=O.get("text-pitch-alignment")==="map",oe=k.get("symbol-z-offset"),fe=O.get("symbol-elevation-reference")==="sea",ce=!oe.isConstant(),xe=new Yo(null,0,Z&&(Y||!t.hasIconData()||O.get("icon-optional")),Y&&(Z||!t.hasTextData()||O.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const _e=(ye,we,Ae)=>{for(let je=0;je<we/4;je++)ye.opacityVertexArray.emplaceBack(Ae)};let ge=0;x&&t.updateReplacement(C,x);for(let ye=0;ye<t.symbolInstances.length;ye++){const we=t.symbolInstances.get(ye),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:je,crossTileID:Be,numIconVertices:Qe,tileAnchorX:nt,tileAnchorY:dt}=we;let Le=null;const et=this.retainedQueryData[t.bucketInstanceId];ce&&we&&et&&(Le=u.latestFeatureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:et.bucketIndex,sourceLayerIndex:et.sourceLayerIndex,layoutVertexArrayOffset:0}));const Oe=oe.evaluate(Le,{}),tt=n.has(Be);let Xe=this.opacities[Be];tt?Xe=F:Xe||(Xe=xe,this.opacities[Be]=Xe),n.add(Be);const st=Ae>0||je>0,Ge=Qe>0,rt=this.placedOrientations[Be],St=rt===s.bq.vertical,Et=rt===s.bq.horizontal||rt===s.bq.horizontalOnly;!st&&!Ge||Xe.isHidden()||ge++;let It=!1;if((st||Ge)&&x)for(const Vt of t.activeReplacements){if(s.bx(Vt,g,s.by.Symbol,P)||Vt.min.x>nt||nt>Vt.max.x||Vt.min.y>dt||dt>Vt.max.y)continue;const di=s.bz(nt,dt,C.canonical,Vt.footprintTileId.canonical);if(It=s.bA(di,Vt.footprint),It)break}if(st){const Vt=It?bo:Gl(Xe.text);_e(t.text,Ae,St?bo:Vt),_e(t.text,je,Et?bo:Vt);const di=Xe.text.isHidden(),{leftJustifiedTextSymbolIndex:Qt,centerJustifiedTextSymbolIndex:ui,rightJustifiedTextSymbolIndex:li,verticalPlacedTextSymbolIndex:Ui}=we,sn=t.text.placedSymbolArray,Si=di||St?1:0;Qt>=0&&(sn.get(Qt).hidden=Si),ui>=0&&(sn.get(ui).hidden=Si),li>=0&&(sn.get(li).hidden=Si),Ui>=0&&(sn.get(Ui).hidden=di||Et?1:0);const ii=this.variableOffsets[Be];ii&&this.markUsedJustification(t,ii.anchor,we,rt);const bi=this.placedOrientations[Be];bi&&(this.markUsedJustification(t,"left",we,bi),this.markUsedOrientation(t,bi,we))}if(Ge){const Vt=It?bo:Gl(Xe.icon),{placedIconSymbolIndex:di,verticalPlacedIconSymbolIndex:Qt}=we,ui=t.icon.placedSymbolArray,li=Xe.icon.isHidden()?1:0;di>=0&&(_e(t.icon,Qe,St?bo:Vt),ui.get(di).hidden=li),Qt>=0&&(_e(t.icon,we.numVerticalIconVertices,Et?bo:Vt),ui.get(Qt).hidden=li)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Vt=t.collisionArrays[ye];if(Vt){let di=new s.P(0,0),Qt=!0;if(Vt.textBox||Vt.verticalTextBox){if(X){const li=this.variableOffsets[Be];li?(di=Fh(li.anchor,li.width,li.height,li.textOffset,li.textScale),J&&di._rotate(ee?this.transform.angle:-this.transform.angle)):Qt=!1}U&&(Qt=!Xe.clipped),Vt.textBox&&ql(t.textCollisionBox.collisionVertexArray,Xe.text.placed,!Qt||St,Oe,fe,di.x,di.y),Vt.verticalTextBox&&ql(t.textCollisionBox.collisionVertexArray,Xe.text.placed,!Qt||Et,Oe,fe,di.x,di.y)}const ui=Qt&&!!(!Et&&Vt.verticalIconBox);Vt.iconBox&&ql(t.iconCollisionBox.collisionVertexArray,Xe.icon.placed,ui,Oe,fe,we.hasIconTextFit?di.x:0,we.hasIconTextFit?di.y:0),Vt.verticalIconBox&&ql(t.iconCollisionBox.collisionVertexArray,Xe.icon.placed,!ui,Oe,fe,we.hasIconTextFit?di.x:0,we.hasIconTextFit?di.y:0)}}}if(t.fullyClipped=ge===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ye.invProjMatrix,t.placementViewportMatrix=ye.viewportMatrix,t.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const u=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function ql(h,t,n,u,p,g,x){h.emplaceBack(t?1:0,n?1:0,g||0,x||0,u,p?1:0),h.emplaceBack(t?1:0,n?1:0,g||0,x||0,u,p?1:0),h.emplaceBack(t?1:0,n?1:0,g||0,x||0,u,p?1:0),h.emplaceBack(t?1:0,n?1:0,g||0,x||0,u,p?1:0)}const gp=Math.pow(2,25),Vu=Math.pow(2,24),Wm=Math.pow(2,17),Ym=Math.pow(2,16),ju=Math.pow(2,9),qu=Math.pow(2,8),Km=Math.pow(2,1);function Gl(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,n=Math.floor(127*h.opacity);return n*gp+t*Vu+n*Wm+t*Ym+n*ju+t*qu+n*Km+t}const bo=0;class Ko{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,u,p,g,x){const C=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(C,p,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((P,O)=>P.sortKey-O.sortKey));this._currentPartIndex<C.length;){const P=C[this._currentPartIndex];if(n.placeLayerBucketPart(P,this._seenCrossTileIDs,u,P.symbolInstanceStart===0,x),this._currentPartIndex++,g())return!0}return!1}}class Jo{constructor(t,n,u,p,g,x,C,P,O){this.placement=new _p(t,g,x,C,P,O),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,n,u,p,g){const x=s.q.now(),C=()=>{const P=s.q.now()-x;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=n[t[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=O)&&(!P.maxzoom||P.maxzoom>O)){const k=P,U=k.layout.get("symbol-z-elevate"),F=k.layout.get("symbol-sort-key").constantOr(1)!==void 0,Z=k.layout.get("symbol-z-order"),Y=Z==="viewport-y"||Z==="auto"&&!(Z!=="viewport-y"&&F),X=k.layout.get("text-allow-overlap")||k.layout.get("icon-allow-overlap")||k.layout.get("text-ignore-placement")||k.layout.get("icon-ignore-placement"),J=Y&&X,ee=this._inProgressLayer=this._inProgressLayer||new Ko(k),oe=s.C(P.source,P.scope);if(ee.continuePlacement(U||J?p[oe]:u[oe],this.placement,this._showCollisionBoxes,P,C,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Uh=512/s.ai/2;class yp{constructor(t,n,u){this.tileID=t,this.bucketInstanceId=u,this.index=new s.bE(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*s.ai,g=t.canonical.y*s.ai;for(let x=0;x<n.length;x++){const{key:C,crossTileID:P,tileAnchorX:O,tileAnchorY:k}=n.get(x),U=Math.floor((p+O)*Uh),F=Math.floor((g+k)*Uh);this.index.add(U,F),this.keys.push(C),this.crossTileIDs.push(P)}this.index.finish()}findMatches(t,n,u){const p=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),g=Uh/Math.pow(2,n.canonical.z-this.tileID.canonical.z),x=n.canonical.x*s.ai,C=n.canonical.y*s.ai;for(let P=0;P<t.length;P++){const O=t.get(P);if(O.crossTileID)continue;const{key:k,tileAnchorX:U,tileAnchorY:F}=O,Z=Math.floor((x+U)*g),Y=Math.floor((C+F)*g),X=this.index.range(Z-p,Y-p,Z+p,Y+p);for(const J of X){const ee=this.crossTileIDs[J];if(this.keys[J]===k&&!u.has(ee)){u.add(ee),O.crossTileID=ee;break}}}}}class vp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class pf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const u in this.indexes){const p=this.indexes[u],g={};for(const x in p){const C=p[x];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+n),g[C.tileID.key]=C}this.indexes[u]=g}this.lng=t}addBucket(t,n,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<n.symbolInstances.length;g++)n.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const C in x){const P=x[C];P.tileID.isChildOf(t)&&P.findMatches(n.symbolInstances,t,p)}else{const C=x[t.scaledTo(Number(g)).key];C&&C.findMatches(n.symbolInstances,t,p)}}for(let g=0;g<n.symbolInstances.length;g++){const x=n.symbolInstances.get(g);x.crossTileID||(x.crossTileID=u.generate(),p.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new yp(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const u of n.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let n=!1;for(const u in this.indexes){const p=this.indexes[u];for(const g in p)t[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[g]),delete p[g],n=!0)}return n}}class xp{constructor(){this.layerIndexes={},this.crossTileIDs=new vp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,u,p){let g=this.layerIndexes[t.fqid];g===void 0&&(g=this.layerIndexes[t.fqid]=new pf);let x=!1;const C={};p.name!=="globe"&&g.handleWrapJump(u);for(const P of n){const O=P.getBucket(t);O&&t.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(P.tileID,O,this.crossTileIDs)&&(x=!0),C[O.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(x=!0),x}pruneUnusedLayers(t){const n={};t.forEach(u=>{n[u]=!0});for(const u in this.layerIndexes)n[u]||delete this.layerIndexes[u]}}const Qs=771;class zi{constructor(t,n,u,p){this.blendFunction=t,this.blendColor=n,this.mask=u,this.blendEquation=p}}zi.Replace=[1,0,1,0],zi.disabled=new zi(zi.Replace,s.al.transparent,[!1,!1,!1,!1]),zi.unblended=new zi(zi.Replace,s.al.transparent,[!0,!0,!0,!0]),zi.alphaBlended=new zi([1,Qs,1,Qs],s.al.transparent,[!0,!0,!0,!0]),zi.alphaBlendedNonPremultiplied=new zi([770,Qs,770,Qs],s.al.transparent,[!0,!0,!0,!0]),zi.multiply=new zi([774,0,774,0],s.al.transparent,[!0,!0,!0,!0]);class Wt{constructor(t,n,u){this.func=t,this.mask=n,this.range=u}}Wt.ReadOnly=!1,Wt.ReadWrite=!0,Wt.disabled=new Wt(519,Wt.ReadOnly,[0,1]);const Vh=7680;class xi{constructor(t,n,u,p,g,x){this.test=t,this.ref=n,this.mask=u,this.fail=p,this.depthFail=g,this.pass=x}}xi.disabled=new xi({func:519,mask:0},0,0,Vh,Vh,Vh);const Qa=1029,eo=2305;class ci{constructor(t,n,u){this.enable=t,this.mode=n,this.frontFace=u}}function mf(h,t){const n=s.bG(h,3);s.ad.mat4.fromQuat(h,t),s.bI(h,3,n)}function to(h,t){const n=s.ad.quat.identity([]);return s.ad.quat.rotateZ(n,n,-t),s.ad.quat.rotateX(n,n,-h),n}function Hl(h,t){const n=[h[0],h[1],0],u=[t[0],t[1],0];if(s.ad.vec3.length(n)>=1e-15){const x=s.ad.vec3.normalize([],n);s.ad.vec3.scale(u,x,s.ad.vec3.dot(u,x)),t[0]=u[0],t[1]=u[1]}const p=s.ad.vec3.cross([],t,h);if(s.ad.vec3.len(p)<1e-15)return null;const g=Math.atan2(-p[1],p[0]);return to(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),g)}ci.disabled=new ci(!1,Qa,eo),ci.backCCW=new ci(!0,Qa,eo),ci.backCW=new ci(!0,Qa,2304),ci.frontCW=new ci(!0,1028,2304),ci.frontCCW=new ci(!0,1028,eo);class jh{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof s.ac?t:new s.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=s.bF(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(t)):0,g=s.ac.fromLngLat(t,p),x=[g.x-u.x,g.y-u.y,g.z-u.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Hl(x,n)}setPitchBearing(t,n){this.orientation=to(s.ak(t),s.ak(-n))}}class Qo{constructor(t,n){this._transform=s.ad.mat4.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new s.ac(t[0],t[1],t[2])}get position(){const t=s.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&s.bI(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.ad.quat.identity([]),t&&mf(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=to(t,n),mf(this._transform,this._orientation)}forward(){const t=s.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const u=new Float64Array(16);return s.ad.mat4.invert(u,this.getWorldToCamera(t,n)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,u){const p=this.position;s.ad.vec3.scale(p,p,-t);const g=new Float64Array(16);return s.ad.mat4.fromScaling(g,[u,u,u]),s.ad.mat4.translate(g,g,p),g[10]*=n,g}getWorldToCamera(t,n){const u=new Float64Array(16),p=new Float64Array(4),g=this.position;return s.ad.quat.conjugate(p,this._orientation),s.ad.vec3.scale(g,g,-t),s.ad.mat4.fromQuat(u,p),s.ad.mat4.translate(u,u,g),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=n,u[9]*=n,u[10]*=n,u[11]*=n,u}getCameraToClipPerspective(t,n,u,p){const g=new Float64Array(16);return s.ad.mat4.perspective(g,t,n,u,p),g}getCameraToClipOrthographic(t,n,u,p,g,x){const C=new Float64Array(16);return s.ad.mat4.ortho(C,t,n,u,p,g,x),C}getDistanceToElevation(t,n=!1){const u=t===0?0:s.bH(t,n?s.aT(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new Qo([...this.position],[...this.orientation])}}const Zn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Zc{constructor(t=0,n=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=u,this.right=p}interpolate(t,n,u){return n.top!=null&&t.top!=null&&(this.top=s.ah(t.top,n.top,u)),n.bottom!=null&&t.bottom!=null&&(this.bottom=s.ah(t.bottom,n.bottom,u)),n.left!=null&&t.left!=null&&(this.left=s.ah(t.left,n.left,u)),n.right!=null&&t.right!=null&&(this.right=s.ah(t.right,n.right,u)),this}getCenter(t,n){const u=s.ay((this.left+t-this.right)/2,0,t),p=s.ay((this.top+n-this.bottom)/2,0,n);return new s.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Zc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const vt=15;class Gu{constructor(t,n,u,p,g,x,C){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(x),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new s.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Zc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Qo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Gu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<vt}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return s.aA(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=s.bP(this.projectionOptions);const u=this.getProjection(),p=!s.bn(n,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bP({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=s.ad.mat2.create(),s.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=s.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.ak(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,g=0;for(let x=0;x<n.length;x++){const C=new s.P(n[x][0]*this.width,u+n[x][1]*(this.height-u)),P=t.pointCoordinate(C);if(!P)continue;const O=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);p+=P[3]*O,g+=O}return g===0?NaN:p/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*n,p=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),x=Math.max(p-u,g);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const p=s.ad.vec3.length(s.ad.vec3.sub([],this._camera.position,u));return s.ay(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!s.ad.quat.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];s.ad.vec3.exactEquals(u,this._camera.position)||(this._setCameraPosition(u),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new jh;return n.position=new s.ac(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!s.ad.quat.length(t))return!1;s.ad.quat.normalize(t,t);const n=s.ad.vec3.transformQuat([],[0,0,-1],t),u=s.ad.vec3.transformQuat([],[0,-1,0],t);if(u[2]<0)return!1;const p=Hl(n,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=s.ay(t[2],p/u,p/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,u){this._unmodified=!1,this._edgeInsets.interpolate(t,n,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new s.bQ(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new s.P(0,0)),p=this.pointCoordinate(new s.P(this.width,0)),g=this.pointCoordinate(new s.P(this.width,this.height)),x=this.pointCoordinate(new s.P(0,this.height)),C=Math.floor(Math.min(u.x,p.x,g.x,x.x)),P=Math.floor(Math.max(u.x,p.x,g.x,x.x)),O=1;for(let k=C-O;k<=P+O;k++)k!==0&&n.push(new s.bQ(k,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,u){let p=[];const g=u!==void 0,x=!g;if(x&&this.zoom<n||g&&u[0]===0&&u[1]===0)return p;const C=new Set,P=(k,U,F,Z,Y)=>{const X=s.c5(U,k,F,Z,Y);C.has(X)||(p.push(new s.aH(k,U,F,Z,Y)),C.add(X))};for(let k=0;k<t.length;k++){const U=t[k];if(x&&U.canonical.z!==n)continue;const F=U.canonical,Z=U.overscaledZ,Y=U.wrap,X=1<<F.z,J=F.x+1<X,ee=F.x>0,oe=F.y+1<X,fe=F.y>0,ce=U.wrap-(ee?0:1),xe=U.wrap+(J?0:1),_e=ee?F.x-1:X-1,ge=J?F.x+1:0;if(g)u[0]<0?(P(Z,xe,F.z,ge,F.y),u[1]<0&&oe&&(P(Z,Y,F.z,F.x,F.y+1),P(Z,xe,F.z,ge,F.y+1)),u[1]>0&&fe&&(P(Z,Y,F.z,F.x,F.y-1),P(Z,xe,F.z,ge,F.y-1))):u[0]>0?(P(Z,ce,F.z,_e,F.y),u[1]<0&&oe&&(P(Z,Y,F.z,F.x,F.y+1),P(Z,ce,F.z,_e,F.y+1)),u[1]>0&&fe&&(P(Z,Y,F.z,F.x,F.y-1),P(Z,ce,F.z,_e,F.y-1))):u[1]<0&&oe?P(Z,Y,F.z,F.x,F.y+1):fe&&P(Z,Y,F.z,F.x,F.y-1);else{const ye=U.visibleQuadrants;1&ye&&(P(Z,ce,F.z,_e,F.y),fe&&(P(Z,Y,F.z,F.x,F.y-1),P(Z,ce,F.z,_e,F.y-1))),2&ye&&(P(Z,xe,F.z,ge,F.y),fe&&(P(Z,Y,F.z,F.x,F.y-1),P(Z,xe,F.z,ge,F.y-1))),4&ye&&(P(Z,ce,F.z,_e,F.y),oe&&(P(Z,Y,F.z,F.x,F.y+1),P(Z,ce,F.z,_e,F.y+1))),8&ye&&(P(Z,xe,F.z,ge,F.y),oe&&(P(Z,Y,F.z,F.x,F.y+1),P(Z,xe,F.z,ge,F.y+1)))}}const O=[];for(const k of p)p.some(U=>k.isChildOf(U))||O.push(k);if(p=O.filter(k=>!t.some(U=>!!(k.overscaledZ<n&&U.isChildOf(k))||k.equals(U)||k.isChildOf(U))),x){const k=1<<n,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),F=[k*U.x,k*U.y],Z=4,Y=Z*Z;p=p.filter(X=>{const J=X.canonical.x+.5-F[0],ee=X.canonical.y+.5-F[1];return J*J+ee*ee<Y})}return p}coveringTiles(t){let n=this.coveringZoomLevel(t);const u=n,p=this.elevation&&this.elevation.exaggeration(),g=p&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const C=this.locationCoordinate(this.center),P=this.center.lat,O=1<<n,k=[O*C.x,O*C.y,0],U=this.projection.name==="globe",F=!U,Z=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,F),Y=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=O*s.bH(1,this.center.lat),J=this._camera.position[2]/s.bH(1,this.center.lat),ee=[O*Y.x,O*Y.y,J*(F?1:X)],oe=U||p,fe=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ce=this.isLODDisabled(!0)?n:0;let xe;if(this._elevation&&t.isTerrainDEM)xe=1e4*this._elevation.exaggeration();else if(this._elevation){const Oe=this._elevation.getMinMaxForVisibleTiles();xe=Oe?Oe.max:this._centerAltitude}else xe=this._centerAltitude;const _e=t.isTerrainDEM?-xe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ge=this.projection.isReprojectedInTileSpace?s.bS(this):1,ye=Oe=>{const Xe=new s.ac(Oe.x+25e-6,Oe.y,Oe.z),st=new s.ac(Oe.x,Oe.y+25e-6,Oe.z),Ge=Oe.toLngLat(),rt=Xe.toLngLat(),St=st.toLngLat(),Et=this.locationCoordinate(Ge),It=this.locationCoordinate(rt),Vt=this.locationCoordinate(St),di=Math.hypot(It.x-Et.x,It.y-Et.y),Qt=Math.hypot(Vt.x-Et.x,Vt.y-Et.y);return Math.sqrt(di*Qt)*ge/25e-6},we=Oe=>{const tt=xe,Xe=_e;return{aabb:s.bV(this,O,0,0,0,Oe,Xe,tt,this.projection),zoom:0,x:0,y:0,minZ:Xe,maxZ:tt,wrap:Oe,fullyVisible:!1}},Ae=[];let je=[];const Be=n,Qe=t.reparseOverscaled?u:n,nt=(J-this._centerAltitude)*X,dt=Oe=>{if(!this._elevation||!Oe.tileID||!x)return;const tt=this._elevation.getMinMaxForTile(Oe.tileID),Xe=Oe.aabb;tt?(Xe.min[2]=tt.min,Xe.max[2]=tt.max,Xe.center[2]=(Xe.min[2]+Xe.max[2])/2):(Oe.shouldSplit=et(Oe),Oe.shouldSplit||(Xe.min[2]=Xe.max[2]=Xe.center[2]=this._centerAltitude))},Le=(Oe,tt)=>{if(.707*tt<Oe)return 1;const Xe=tt/Oe;return Xe/(1.4144271570014144+(Math.pow(1.1,Xe-1.4144271570014144+1)-1)/(1.1-1)-1)},et=Oe=>{if(Oe.zoom<ce)return!0;if(Oe.zoom===Be)return!1;if(Oe.shouldSplit!=null)return Oe.shouldSplit;const tt=Oe.aabb.distanceX(ee),Xe=Oe.aabb.distanceY(ee);let st=nt,Ge=1;if(U){st=Oe.aabb.distanceZ(ee);const Qt=Math.pow(2,Oe.zoom),ui=s.aT((Oe.y+1)/Qt),li=s.aT(Oe.y/Qt),Ui=Math.min(Math.max(P,ui),li),sn=s.ca(Ui)/s.ca(P);if(Ge=Ui===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,sn/this._mercatorScaleRatio),this.zoom<=s.c6&&Oe.zoom===Be-1&&sn>=.9)return!0}else if(g&&(st=Oe.aabb.distanceZ(ee)*X),this.projection.isReprojectedInTileSpace&&u<=5){const Qt=Math.pow(2,Oe.zoom),ui=ye(new s.ac((Oe.x+.5)/Qt,(Oe.y+.5)/Qt));Ge=ui>.85?1:ui}if(!x){const Qt=Math.sqrt(tt*tt+Xe*Xe+st*st);let ui=(1<<Be-Oe.zoom)*fe*Ge;return ui*=Le(Math.max(st,nt),Qt),Qt<ui}let rt=Number.MAX_VALUE,St=0;const Et=Oe.aabb.getCorners(),It=[];for(const Qt of Et){s.ad.vec3.sub(It,Qt,ee),U||(g?It[2]*=X:It[2]=nt);const ui=s.ad.vec3.dot(It,this._camera.forward());ui<rt&&(rt=ui,St=Math.abs(It[2]))}let Vt=(1<<Be-Oe.zoom)*fe*Ge;if(Vt*=Le(Math.max(St,nt),rt),rt<Vt)return!0;const di=Oe.aabb.closestPoint(k);return di[0]===k[0]&&di[1]===k[1]};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)Ae.push(we(-Oe)),Ae.push(we(Oe));for(Ae.push(we(0));Ae.length>0;){const Oe=Ae.pop(),tt=Oe.x,Xe=Oe.y;let st=Oe.fullyVisible;const Ge=()=>this.projection.name==="globe"&&(Oe.y===0||Oe.y===(1<<Oe.zoom)-1);if(!st){let rt=oe?Oe.aabb.intersects(Z):Oe.aabb.intersectsFlat(Z);if(rt===0&&Ge()){const St=new s.bT(Oe.zoom,tt,Xe);rt=s.bU(this,O,St,!0).intersects(Z)}if(rt===0)continue;st=rt===2}if(Oe.zoom!==Be&&et(Oe))for(let rt=0;rt<4;rt++){const St=(tt<<1)+rt%2,Et=(Xe<<1)+(rt>>1),It={aabb:x?Oe.aabb.quadrant(rt):s.bV(this,O,Oe.zoom+1,St,Et,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:St,y:Et,wrap:Oe.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};g&&!U&&(It.tileID=new s.aH(Oe.zoom+1===Be?Qe:Oe.zoom+1,Oe.wrap,Oe.zoom+1,St,Et),dt(It)),Ae.push(It)}else{const rt=Oe.zoom===Be?Qe:Oe.zoom;if(t.minzoom&&t.minzoom>rt)continue;let St=0;if(!st){let di=oe?Oe.aabb.intersectsPrecise(Z):Oe.aabb.intersectsPreciseFlat(Z);if(di===0&&Ge()){const Qt=new s.bT(Oe.zoom,tt,Xe);di=s.bU(this,O,Qt,!0).intersectsPrecise(Z)}if(di===0)continue;if(t.calculateQuadrantVisibility)if(Z.containsPoint(Oe.aabb.center))St=15;else for(let Qt=0;Qt<4;Qt++)Oe.aabb.quadrant(Qt).intersects(Z)!==0&&(St|=1<<Qt)}const Et=k[0]-(.5+tt+(Oe.wrap<<Oe.zoom))*(1<<n-Oe.zoom),It=k[1]-.5-Xe,Vt=Oe.tileID?Oe.tileID:new s.aH(rt,Oe.wrap,Oe.zoom,tt,Xe);t.calculateQuadrantVisibility&&(Vt.visibleQuadrants=St),je.push({tileID:Vt,distanceSq:Et*Et+It*It})}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,tt=this.horizonLineFromTop();je=je.filter(Xe=>{const st=[0,0,0,1],Ge=[s.ai,s.ai,0,1],rt=this.calculateFogTileMatrix(Xe.tileID.toUnwrapped());s.ad.vec4.transformMat4(st,st,rt),s.ad.vec4.transformMat4(Ge,Ge,rt);const St=s.ad.vec4.min([],st,Ge),Et=s.ad.vec4.max([],st,Ge),It=s.bW(St,Et);if(It===0)return!0;let Vt=!1;const di=this._elevation;if(di&&It>Oe&&tt!==0){const Qt=this.calculateProjMatrix(Xe.tileID.toUnwrapped());let ui;t.isTerrainDEM||(ui=di.getMinMaxForTile(Xe.tileID)),ui||(ui={min:_e,max:xe});const li=s.c7(this.rotation),Ui=[li[0]*s.ai,li[1]*s.ai,ui.max];s.ad.vec3.transformMat4(Ui,Ui,Qt),Vt=(1-Ui[1])*this.height*.5<tt}return It<Oe||Vt})}return je.sort((Oe,tt)=>Oe.distanceSq-tt.distanceSq).map(Oe=>Oe.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=s.ay(t.lat,-s.bX,s.bX),u=this.projection.project(t.lng,n);return new s.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let u,p;const g=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;u=(n.x-g.x)/C,p=(n.y-g.y)/C}else{const C=this.pointCoordinate(n),P=this.pointCoordinate(g);u=C.x-P.x,p=C.y-P.y}const x=this.locationCoordinate(t);this.setLocation(new s.ac(x.x-u,x.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,n){return this.projection.locationPoint(this,t,n)}locationPoint3D(t,n){return this.projection.locationPoint(this,t,n,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,n){return this.coordinateLocation(this.pointCoordinate3D(t,n))}locationCoordinate(t,n){const u=n?s.bH(n,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new s.ac(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const u=n??this._centerAltitude,p=[t.x,t.y,0,1],g=[t.x,t.y,1,1];s.ad.vec4.transformMat4(p,p,this.pixelMatrixInverse),s.ad.vec4.transformMat4(g,g,this.pixelMatrixInverse);const x=g[3];s.ad.vec4.scale(p,p,1/p[3]),s.ad.vec4.scale(g,g,1/x);const C=p[2],P=g[2];return{p0:p,p1:g,t:C===P?0:(u-C)/(P-C)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return s.ad.vec4.transformMat4(n,n,this.pixelMatrixInverse),s.ad.vec4.transformMat4(u,u,this.pixelMatrixInverse),s.ad.vec4.scale(n,n,1/n[3]),s.ad.vec4.scale(u,u,1/u[3]),n[2]=s.bH(n[2],this._center.lat)*this.worldSize,u[2]=s.bH(u[2],this._center.lat)*this.worldSize,s.ad.vec4.scale(n,n,1/this.worldSize),s.ad.vec4.scale(u,u,1/this.worldSize),new s.as([n[0],n[1],n[2]],s.ad.vec3.normalize([],s.ad.vec3.sub([],u,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:u,t:p}=t,g=s.bH(n[2],this._center.lat),x=s.bH(u[2],this._center.lat);return new s.ac(s.ah(n[0],u[0],p)/this.worldSize,s.ah(n[1],u[1],p)/this.worldSize,s.ah(g,x,p))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t,n){if(!this.elevation)return this.pointCoordinate(t,n);let u=this.projection.pointCoordinate3D(this,t.x,t.y);if(u)return new s.ac(u[0],u[1],u[2]);let p=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t,n);const x=.02*g,C=t.clone();for(let P=0;P<10&&g-p>x;P++){C.y=s.ah(p,g,.66);const O=this.projection.pointCoordinate3D(this,C.x,C.y);O?(g=C.y,u=O):p=C.y}return u?new s.ac(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.bY)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const u=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return s.ad.vec4.transformMat4(p,p,this.pixelMatrix),p[3]>0?new s.P(p[0]/p[3],p[1]/p[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,g=this.pointLocation3D(new s.P(n,t)),x=this.pointLocation3D(new s.P(p,t)),C=this.pointLocation3D(new s.P(p,u)),P=this.pointLocation3D(new s.P(n,u));let O=Math.min(g.lng,x.lng,C.lng,P.lng),k=Math.max(g.lng,x.lng,C.lng,P.lng),U=Math.min(g.lat,x.lat,C.lat,P.lat),F=Math.max(g.lat,x.lat,C.lat,P.lat);const Z=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,X=(J,ee,oe,fe,ce)=>{const xe=(J+oe)/2,_e=(ee+fe)/2,ge=new s.P(xe,_e),{lng:ye,lat:we}=this.pointLocation3D(ge),Ae=Math.max(0,O-ye,U-we,ye-k,we-F);O=Math.min(O,ye),k=Math.max(k,ye),U=Math.min(U,we),F=Math.max(F,we),(ce<Y||Ae>Z)&&(X(J,ee,xe,_e,ce+1),X(xe,_e,oe,fe,ce+1))};if(X(n,t,p,t,1),X(p,t,p,u,1),X(p,u,n,u,1),X(n,u,n,t,1),this.projection.name==="globe"){const[J,ee]=s.bZ(this);J?(F=90,k=180,O=-180):ee&&(U=-90,k=180,O=-180)}return new s.aB(new s.bO(O,U),new s.bO(k,F))}_getBoundsRectangular(t,n){const{top:u,left:p}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,C=new s.P(p,u),P=new s.P(x,u),O=new s.P(x,g),k=new s.P(p,g);let U=this.pointCoordinate(C,t),F=this.pointCoordinate(P,t);const Z=this.pointCoordinate(O,n),Y=this.pointCoordinate(k,n),X=(J,ee)=>(ee.y-J.y)/(ee.x-J.x);return U.y>1&&F.y>=0?U=new s.ac((1-Y.y)/X(Y,U)+Y.x,1):U.y<0&&F.y<=1&&(U=new s.ac(-Y.y/X(Y,U)+Y.x,0)),F.y>1&&U.y>=0?F=new s.ac((1-Z.y)/X(Z,F)+Z.x,1):F.y<0&&U.y<=1&&(F=new s.ac(-Z.y/X(Z,F)+Z.x,0)),new s.aB().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(Z))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const g=p.dem.tree;u.min=Math.min(u.min,g.minimums[0]),u.max=Math.max(u.max,g.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.bX,this.maxLat=s.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.av(this.minLng)*this.tileSize,this.worldMaxX=s.av(this.maxLng)*this.tileSize,this.worldMinY=s.aC(this.maxLat)*this.tileSize,this.worldMaxY=s.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,u=this._distanceTileDataCache;if(u[n])return u[n];const p=t.canonical,g=1/this.height,x=this.cameraWorldSize,C=x/this.zoomScale(p.z),P=(p.x+Math.pow(2,p.z)*t.wrap)*C,O=p.y*C,k=this.point;k.x*=x/this.worldSize,k.y*=x/this.worldSize;const U=this.angle,F=Math.sin(-U),Z=-Math.cos(-U);return u[n]={bearing:[F,Z],center:[(k.x-P)*g,(k.y-O)*g],scale:C/s.ai*g},u[n]}calculateFogTileMatrix(t){const n=t.key,u=this._fogTileMatrixCache;if(u[n])return u[n];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.ad.mat4.multiply(p,this.worldToFogMatrix,p),u[n]=new Float32Array(p),u[n]}calculateProjMatrix(t,n=!1,u=!1){const p=t.key;let g;if(g=u?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,g[p])return g[p];const x=this.calculatePosMatrix(t,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,s.ad.mat4.multiply(x,C,x),g[p]=new Float32Array(x),g[p]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[n])return u[n];const p=s.b_(t,this);return u[n]=p,u[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=s.ad.mat4.fromScaling([],[t,t,t]);return s.ad.mat4.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=s.bH(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(n),p=this._camera.forward(),g=s.bH(1,this._center.lat);u[2]/=g,p[2]/=g,s.ad.vec3.normalize(p,p);const x=t.raycast(u,p,t.exaggeration());if(x){const C=s.ad.vec3.scaleAndAdd([],u,p,x),P=new s.ac(C[0],C[1],s.bH(C[2],s.aT(C[1]))),O=(P.z+s.ad.vec3.length([P.x-u[0],P.y-u[1],P.z-u[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,u=s.bH(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),g=n.getAtPointOrZero(new s.ac(...p)),x=this.pixelsPerMeter/this.worldSize*g,C=this._minimumHeightOverTerrain(),P=p[2]-x;if(P<=C)if(P<0||t){const O=this.locationCoordinate(this._center,this._centerAltitude),k=[p[0],p[1],O.z-p[2]],U=s.ad.vec3.length(k);k[2]-=(C-P)/this._pixelsPerMercatorPixel;const F=s.ad.vec3.length(k);if(F===0)return;s.ad.vec3.scale(k,k,U/F*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],O.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const F=this.center;return F.lat=s.ay(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(F.lng=s.ay(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const n=this._unmodified,{x:u,y:p}=this.point;let g=0,x=u,C=p;const P=this.width/2,O=this.height/2,k=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(p-O<k&&(C=k+O),p+O>U&&(C=U-O),U-k<this.height&&(g=Math.max(g,this.height/(U-k)),C=(U+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,Y=this.worldSize/2-(F+Z)/2;x=(u+Y+this.worldSize)%this.worldSize-Y,x-P<F&&(x=F+P),x+P>Z&&(x=Z-P),Z-F<this.width&&(g=Math.max(g,this.width/(Z-F)),x=(Z+F)/2)}x===u&&C===p||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(x,C))),g&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bH(1,this.center.lat)/s.bH(1,s.c8));const p=s.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?u:1,x=this._camera.getWorldToCamera(this.worldSize,g);let C;const P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(P[8]=2*-t.x/this.width,P[9]=2*t.y/this.height,this.isOrthographic){let we=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ae=we*this.aspect,je=-Ae,Be=-we;Ae-=t.x,je-=t.x,we+=t.y,Be+=t.y,C=this._camera.getCameraToClipOrthographic(je,Ae,Be,we,this._nearZ,this._farZ),((Qe,nt,dt,Le)=>{for(let et=0;et<16;et++)Qe[et]=s.ah(nt[et],dt[et],Le)})(C,C,P,s.c9(this.pitch>=vt?1:this.pitch/vt))}else C=P;const O=s.ad.mat4.mul([],P,x);let k=s.ad.mat4.mul([],C,x);if(this.projection.isReprojectedInTileSpace){const we=this.locationCoordinate(this.center),Ae=s.ad.mat4.identity([]);s.ad.mat4.translate(Ae,Ae,[we.x*this.worldSize,we.y*this.worldSize,0]),s.ad.mat4.multiply(Ae,Ae,s.c0(this)),s.ad.mat4.translate(Ae,Ae,[-we.x*this.worldSize,-we.y*this.worldSize,0]),s.ad.mat4.multiply(k,k,Ae),s.ad.mat4.multiply(O,O,Ae),this.inverseAdjustmentMatrix=s.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.ad.mat4.scale([],k,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=k,this.invProjMatrix=s.ad.mat4.invert(new Float64Array(16),this.projMatrix),n){const we=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);we[8]=2*-t.x/this.width,we[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.ad.mat4.mul([],we,x)}else this.expandedFarZProjMatrix=this.projMatrix;const U=s.ad.mat4.invert([],C);this.frustumCorners=s.c2.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const F=new Float32Array(16);s.ad.mat4.identity(F),s.ad.mat4.scale(F,F,[1,-1,1]),s.ad.mat4.rotateX(F,F,this._pitch),s.ad.mat4.rotateZ(F,F,this.angle);const Z=s.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.ad.mat4.clone(Z);const Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Z[8]=2*-t.x/this.width,Z[9]=2*(t.y+Y)/this.height,this.skyboxMatrix=s.ad.mat4.multiply(F,Z,F);const X=this.point,J=X.x,ee=X.y,oe=this.width%2/2,fe=this.height%2/2,ce=Math.cos(this.angle),xe=Math.sin(this.angle),_e=J-Math.round(J)+ce*oe+xe*fe,ge=ee-Math.round(ee)+ce*fe+xe*oe,ye=new Float64Array(k);if(s.ad.mat4.translate(ye,ye,[_e>.5?_e-1:_e,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=ye,k=s.ad.mat4.create(),s.ad.mat4.scale(k,k,[this.width/2,-this.height/2,1]),s.ad.mat4.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=s.ad.mat4.create(),s.ad.mat4.scale(k,k,[1,-1,1]),s.ad.mat4.translate(k,k,[-1,-1,0]),s.ad.mat4.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=s.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},k=s.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.c3(this);const we=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad.vec3.transformMat4(we,we,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,n];s.ad.vec3.scale(g,g,p),s.ad.vec3.scale(u,u,-1),s.ad.vec3.multiply(u,u,g);const x=s.ad.mat4.create();s.ad.mat4.translate(x,x,u),s.ad.mat4.scale(x,x,g),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,p)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*g,p.y/this.worldSize-u[1]*g,t/this.worldSize*this._centerAltitude-u[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(g=Math.min((n-u)/p,1)),this._camera.position=s.ad.vec3.scaleAndAdd([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),g=s.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.ak(this._maxPitch)),C=Math.max((t[2]-g)/Math.cos(u),x),P=this._zoomFromMercatorZ(C);s.ad.vec3.scaleAndAdd(t,t,n,C),this._pitch=s.ay(u,s.ak(this.minPitch),s.ak(this.maxPitch)),this.angle=s.bF(p,-Math.PI,Math.PI),this._setZoom(s.ay(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,u=s.bY,p=0,g=1/0;for(;u-n>1e-6&&u>n;){const x=n+.5*(u-n),C=this.tileSize*Math.pow(2,x),P=this.getCameraToCenterDistance(this.projection,x,C),O=this.scaleZoom(P/(t*this.tileSize)),k=Math.abs(x-O);k<g&&(g=k,p=x),x<O?n=x:u=x}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const u=Math.min(t.x,n.x),p=Math.max(t.x,n.x),g=Math.min(t.y,n.y),x=Math.max(t.y,n.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new s.P(u,g),new s.P(p,x),new s.P(u,x),new s.P(p,g)],P=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const k of C){const U=this.pointRayIntersection(k);if(U.t<0)return!0;const F=this.rayIntersectionCoordinate(U);if(F.x<P||F.y<0||F.x>O||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,n){const u=s.ad.vec3.length(s.ad.vec3.sub([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+n;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,u,p],g){const x=[n,u,p,1];s.ad.vec4.transformMat4(x,x,g);const C=x[3]=Math.max(x[3],1e-6);return x[0]/=C,x[1]/=C,x[2]/=C,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,n=this.zoom,u=this.worldSize){const p=s.b$(t,n,this.width,this.height,1024),g=t.pixelSpaceConversion(this.center.lat,u,p);let x=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(x=s.ah(1,x,s.c9(this.pitch>=vt?1:this.pitch/vt))),x}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.ad.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return s.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const wo=(h,t)=>{if(t>0&&h.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=h.transform,u=Math.max(Math.abs(n._zoom-(h.minCutoffZoom-1)),1),p=n.isLODDisabled(!1)?s.ae(60,45,n.pitch):s.ae(30,15,n.pitch),g=n._farZ-n._nearZ,x=t*n.height,C=((1-(P=p))*n.cameraToCenterDistance+P*(n._farZ+x))*u;var P;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(C-n._nearZ)/g,(C-x-n._nearZ)/g]}}},Jr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class bp{constructor(t,n){this.aabb=t,this.lastCascade=n}}class qh{add(t,n){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],n.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],n.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],n.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],n.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],n.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],n.max[2])):this.receivers[t.key]=new bp(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,u){const p=s.ce.fromPoints(t.points);let g=0;for(const x in this.receivers){const C=this.receivers[x];if(!C||!p.intersectsAabb(C.aabb))continue;C.aabb.min=p.closestPoint(C.aabb.min),C.aabb.max=p.closestPoint(C.aabb.max);const P=C.aabb.getCorners();for(let O=0;O<u.length;O++){let k=!0;for(const U of P){const F=[U[0]*n,U[1]*n,U[2]];if(s.ad.vec3.transformMat4(F,F,u[O].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){k=!1;break}}if(C.lastCascade=O,g=Math.max(g,O),k)break}}return g+1}}class To{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new qh,this._depthMode=new Wt(t.context.gl.LEQUAL,Wt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Jr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Jr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Jr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const p=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce((Y,X)=>{const J=u.style._mergedLayers[X];return Y+(J.hasShadowPass()&&!J.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const g=u.context,x=Jr.shadowMapResolution,C=Jr.shadowMapResolution;if(this._cascades.length===0||Jr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<Jr.cascadeCount;++Y){const X=u._shadowMapDebug,J=g.gl,ee=g.createFramebuffer(x,C,X,"texture"),oe=new s.T(g,{width:x,height:C,data:null},J.DEPTH_COMPONENT16);if(ee.depthAttachment.set(oe.texture),X){const fe=new s.T(g,{width:x,height:C,data:null},J.RGBA8);ee.colorAttachment.set(fe.texture)}this._cascades.push({framebuffer:ee,texture:oe,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bR,scale:0})}}this.shadowDirection=ha(n);let P=0;if(t.elevation){const Y=t.elevation,X=[1e4,-1e4];Y.visibleDemTiles.filter(J=>J.dem).forEach(J=>{const ee=J.dem.tree;X[0]=Math.min(X[0],ee.minimums[0]),X[1]=Math.max(X[1],ee.maximums[0])}),X[0]!==1e4&&(P=(X[1]-X[0])*Y.exaggeration())}const O=1.5*t.cameraToCenterDistance,k=3*O,U=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){const X=this._cascades[Y];let J=t.height/50,ee=1;Jr.cascadeCount===1?ee=k:Y===0?ee=O:(J=O,ee=k);const[oe,fe]=$l(t,this.shadowDirection,J,ee,Jr.shadowMapResolution,P);X.scale=t.scale,X.matrix=oe,X.boundingSphereRadius=fe,s.ad.mat4.invert(U,X.matrix),X.frustum=s.bR.fromInvProjectionMatrix(U,1,0,!0),X.far=ee}const F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Jr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Jr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Zn.ShadowMap0,this._uniformValues.u_shadowmap_1=Zn.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Z=u.transform.elevation;for(const Y of this._groundShadowTiles){let X={min:0,max:0};if(Z){const J=Z.getMinMaxForTile(Y);J&&(X=J)}this.addShadowReceiver(Y.toUnwrapped(),X.min,X.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,Jr.shadowMapResolution,Jr.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){u.currentShadowCascade=g,p.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),p.clear({color:s.al.white,depth:1});for(const x of t.order){const C=t._mergedLayers[x];if(!C.hasShadowPass()||C.isHidden(u.transform.zoom))continue;const P=t.getLayerSourceCache(C),O=P?n[P.id]:void 0;(C.type==="model"||O&&O.length)&&u.renderLayer(u,P,C,O)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,n=t.style,u=t.context,p=n.directionalLight,g=n.ambientLight;if(!p||!g)return;const x=[],C=wo(t,t.longestCutoffRange);C.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&x.push("NORMAL_OFFSET");const P=Zl(n,p,g),O=new Wt(u.gl.LEQUAL,Wt.ReadOnly,t.depthRangeFor3D);for(const k of this._groundShadowTiles){const U=k.toUnwrapped(),F=t.isTileAffectedByFog(k),Z=t.getOrCreateProgram("groundShadow",{defines:x,overrideFog:F});this.setupShadows(U,Z),t.uploadCommonUniforms(u,Z,U,null,C);const Y={u_matrix:t.transform.calculateProjMatrix(U),u_ground_shadow_factor:P};Z.draw(t,u.gl.TRIANGLES,O,xi.disabled,zi.multiply,ci.disabled,Y,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?zi.unblended:zi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,u=n.calculatePosMatrix(t,n.worldSize);return s.ad.mat4.multiply(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return s.ad.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,u,p=0){if(!this.enabled)return;const g=this.painter.transform,x=this.painter.context,C=x.gl,P=this._uniformValues,O=new Float64Array(16),k=g.calculatePosMatrix(t,g.worldSize);for(let U=0;U<this._cascades.length;U++)s.ad.mat4.multiply(O,this._cascades[U].matrix,k),P[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),x.activeTexture.set(C.TEXTURE0+Zn.ShadowMap0+U),this._cascades[U].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const U=s.cd(t.canonical),F=2/g.tileSize*s.ai/Jr.shadowMapResolution,Z=F*this._cascades[0].boundingSphereRadius,Y=F*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(u==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-g.zoom+Math.floor(g.zoom)));P.u_shadow_normal_offset=[U,Z*X,Y*X],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(x,P)}setupShadowsFromMatrix(t,n,u=!1){if(!this.enabled)return;const p=this.painter.context,g=p.gl,x=this._uniformValues,C=new Float64Array(16);for(let P=0;P<Jr.cascadeCount;P++)s.ad.mat4.multiply(C,this._cascades[P].matrix,t),x[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),p.activeTexture.set(g.TEXTURE0+Zn.ShadowMap0+P),this._cascades[P].texture.bind(g.NEAREST,g.CLAMP_TO_EDGE);if(this.useNormalOffset=u,u){const P=Jr.normalOffset;x.u_shadow_normal_offset=[1,P,P],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(p,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,u,p){if(p[2]>=0)return{};const g=function(P,O,k){const U=k/(1<<P.canonical.z);return new s.ce([P.canonical.x*U+P.wrap*k,P.canonical.y*U+P.wrap*k,0],[(P.canonical.x+1)*U+P.wrap*k,(P.canonical.y+1)*U+P.wrap*k,O])}(t,n,u).getCorners(),x=n/-p[2];p[0]<0?(s.ad.vec3.add(g[0],g[0],[p[0]*x,0,0]),s.ad.vec3.add(g[3],g[3],[p[0]*x,0,0])):p[0]>0&&(s.ad.vec3.add(g[1],g[1],[p[0]*x,0,0]),s.ad.vec3.add(g[2],g[2],[p[0]*x,0,0])),p[1]<0?(s.ad.vec3.add(g[0],g[0],[0,p[1]*x,0]),s.ad.vec3.add(g[1],g[1],[0,p[1]*x,0])):p[1]>0&&(s.ad.vec3.add(g[2],g[2],[0,p[1]*x,0]),s.ad.vec3.add(g[3],g[3],[0,p[1]*x,0]));const C={};return C.vertices=g,C.planes=[Qr(g[1],g[0],g[4]),Qr(g[2],g[1],g[5]),Qr(g[3],g[2],g[6]),Qr(g[0],g[3],g[7])],C}addShadowReceiver(t,n,u){this._receivers.add(t,s.ce.fromTileIdAndHeight(t,n,u))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function Qr(h,t,n){const u=s.ad.vec3.sub([],n,t),p=s.ad.vec3.sub([],h,t),g=s.ad.vec3.cross([],u,p),x=s.ad.vec3.length(g);return x===0?[0,0,1,0]:(s.ad.vec3.scale(g,g,1/x),[g[0],g[1],g[2],-s.ad.vec3.dot(g,t)])}function ha(h){const t=h.properties.get("direction"),n=s.cc(t.x,t.y,t.z);n[2]=s.ay(n[2],0,75);const u=s.cf([n[0],n[1],n[2]]);return s.ad.vec3.fromValues(u.x,u.y,u.z)}function Zl(h,t,n){const u=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),g=t.properties.get("intensity"),x=t.properties.get("direction"),C=[x.x,x.y,x.z],P=n.properties.get("color-use-theme")==="none",O=n.properties.get("color"),k=n.properties.get("intensity"),U=Math.max(s.ad.vec3.dot([0,0,1],C),0),F=[0,0,0];s.ad.vec3.scale(F,O.toRenderColor(P?null:h.getLut(t.scope)).toArray01Linear().slice(0,3),k);const Z=[0,0,0];return s.ad.vec3.scale(Z,p.toRenderColor(u?null:h.getLut(n.scope)).toArray01Linear().slice(0,3),U*g),s.cg([F[0]>0?F[0]/(F[0]+Z[0]):0,F[1]>0?F[1]/(F[1]+Z[1]):0,F[2]>0?F[2]/(F[2]+Z[2]):0])}function $l(h,t,n,u,p,g){const x=h.zoom,C=h.scale,P=h.worldSize,O=1/P,k=h.aspect,U=Math.sqrt(1+k*k)*Math.tan(.5*h.fovX),F=U*U,Z=u-n,Y=u+n;let X,J;F>Z/Y?(X=u,J=u*U):(X=.5*Y*(1+F),J=.5*Math.sqrt(Z*Z+2*(u*u+n*n)*F+Y*Y*F*F));const ee=h.projection.pixelsPerMeter(h.center.lat,P),oe=h._camera.getCameraToWorldMercator(),fe=[0,0,-X*O];s.ad.vec3.transformMat4(fe,fe,oe);let ce=J*O;const xe=h._edgeInsets;if(!(xe.left===0&&xe.top===0&&xe.right===0&&xe.bottom===0||xe.left===xe.right&&xe.top===xe.bottom)){const st=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?ee:1),Ge=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,n,u);Ge[8]=2*-h.centerOffset.x/h.width,Ge[9]=2*h.centerOffset.y/h.height;const rt=new Float64Array(16);s.ad.mat4.mul(rt,Ge,st);const St=new Float64Array(16);s.ad.mat4.invert(St,rt);const Et=s.bR.fromInvProjectionMatrix(St,P,x,!0);for(const It of Et.points){const Vt=((_e=It)[0]/=C,_e[1]/=C,_e[2]=s.bH(_e[2],h._center.lat),_e);ce=Math.max(ce,s.ad.vec3.len(s.ad.vec3.subtract([],fe,Vt)))}}var _e;ce*=p/(p-1);const ge=Math.acos(t[2]),ye=Math.atan2(-t[0],-t[1]),we=new Qo;we.position=fe,we.setPitchBearing(ge,ye);const Ae=we.getWorldToCamera(P,ee),je=ce*P,Be=Math.min(h._mercatorZfromZoom(17)*P*-2,-2*je),Qe=we.getCameraToClipOrthographic(-je,je,-je,je,Be,(je+g*ee)/t[2]),nt=new Float64Array(16);s.ad.mat4.multiply(nt,Qe,Ae);const dt=s.ad.vec3.fromValues(Math.floor(1e6*fe[0])/1e6*P,Math.floor(1e6*fe[1])/1e6*P,0),Le=.5*p,et=[0,0,0];s.ad.vec3.transformMat4(et,dt,nt),s.ad.vec3.scale(et,et,Le);const Oe=[Math.floor(et[0]),Math.floor(et[1]),Math.floor(et[2])],tt=[0,0,0];s.ad.vec3.sub(tt,et,Oe),s.ad.vec3.scale(tt,tt,-1/Le);const Xe=new Float64Array(16);return s.ad.mat4.identity(Xe),s.ad.mat4.translate(Xe,Xe,tt),s.ad.mat4.multiply(nt,Xe,nt),[nt,je]}class wp extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,n){return s.aN(this.requestManager.transformRequest(n,s.R.Model).url).then(u=>{if(!u)return;const p=s.aO(u),g=new s.aP(t,void 0,void 0,p);return g.computeBoundsAndApplyParent(),g}).catch(u=>{if(u&&u.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${t} from ${n}: ${u.message}`)))})}load(t,n,u={keepNumReferences:!1}){this.models[n]||(this.models[n]={});const p=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+p.length;const g=[];for(const x of p)g.push(this.loadModel(x,t[x]));Promise.allSettled(g).then(x=>{for(let C=0;C<x.length;C++){const{status:P,value:O}=x[C];if(P==="fulfilled"&&O){const k=this.models[n][p[C]];this.models[n][p[C]]={model:O,numReferences:u.keepNumReferences&&k?k.numReferences:1}}}this.numModelsLoading[n]-=p.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(x=>{this.fire(new s.z(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n){return!!this.getModel(t,n)}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]?this.models[n][t].model:void 0}addModel(t,n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={}),this.hasModel(t,u)&&this.models[u][t].numReferences++,this.modelUris[u][t]=this.requestManager.normalizeModelURL(n),this.load({[t]:this.modelUris[u][t]},u)}addModels(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const u=this.modelUris[n];for(const p in t)this.models[n][p]={},u[p]=this.requestManager.normalizeModelURL(t[p]);this.load(u,n,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const u={};for(const p of t)this.hasModel(p,n)?this.models[n][p].numReferences++:(this.modelUris[n][p]=this.requestManager.normalizeModelURL(p),u[p]=this.modelUris[n][p]);this.load(u,n)}removeModel(t,n){if(this.models[n]&&this.models[n][t]&&(this.models[n][t].numReferences--,this.models[n][t].numReferences===0)){const u=this.models[n][t].model;delete this.models[n][t],delete this.modelUris[n][t],u.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const u in this.models[n])this.models[n][u].model&&this.models[n][u].model.upload(t.context)}}const Tp=new s.a7({data:new s.a8(s.a5.colorTheme.data)}),Hu={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Sp(h){return h=h||{},Object.assign(h,Hu)}class Xl extends s.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},s.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(x,C){const[P,O]=x,{center:k,radius:U}=C,[F,Z]=k,Y=Math.abs(P-F);return Math.sqrt((Y>180?360-Y:Y)**2+(O-Z)**2)<=U}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.A("floorplangone")));const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=new s.P(this._map.transform.width/2,this._map.transform.height/2),p=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(t?p:u,n);g.length>0&&(this._selectedFloorplan&&g[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=g[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(g){const[[x,C],[P,O]]=g,k=(P-x+360)%360,U=k>180?360-k:k;return{center:[(x+U/2+360)%360,(C+O)/2],radius:Math.sqrt(U**2+(O-C)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const n=this._floorplanStates[this._indoorData.id].selectedBuilding,u=this._floorplanStates[this._indoorData.id].selectedLevel;let p;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const g of this._indoorData.levels)g.id===this._selectedLevel.id&&(p=g.id);if(this.fire(new s.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:p})),n){const g=this._indoorData.buildings.find(x=>x.id===n);this._buildingSelected(g,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(u){const g=this._indoorData.levels.find(x=>x.id===u);this._updateLevels(g,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,n){n&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const u=this._indoorData.levels.filter(p=>t.levels.includes(p.id));this.fire(new s.A("buildingselected",{buildingId:t.id,levels:u}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const n=this._indoorData.levels.find(u=>u.id===t);this._updateLevels(n,!0)}this.fire(new s.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,n){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(n&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function u(O){const k=O.indexOf("/floor/");if(k===-1)return O;const U=k+7,F=O.indexOf("/",U);return F===-1?O.slice(U):O.slice(U,F)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const p=[],g={},x={},C={},P={};for(const O of this._indoorData.levels)if(p.push(O.id),g[O.id]=O.height,x[O.id]=O.base,t){if(this.mergeFloors){const k=u(t.id),U=u(O.id);C[O.id]=U===k?"true":"false"}else C[O.id]=O.id===t.id?"true":"false";P[O.id]=O.base<t.base?"true":"false"}else P[O.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",p]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",C]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",P]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),n&&t.extent)){const O=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),k=this._map.getZoom(),U=O.zoom?Math.abs(k-O.zoom):0;this._map.fitBounds(t.extent,U>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:k})}}selectFloorplan(t){const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],p=this._map.queryRenderedFeatures(u,n);if(p.length>0){for(const g of p)if(JSON.parse(g.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=g,this._floorplanSelected(!0);break}}}selectBuilding(t){const n=this._indoorData.buildings.find(u=>u.id===t);this._buildingSelected(n,!0)}selectLevel(t){this._levelSelected(t)}}function Gh(h){if(!h.metadata||!h.metadata.content_area)return;const t=s.q.devicePixelRatio,{left:n,top:u,width:p,height:g}=h.metadata.content_area,x=n*t,C=u*t;return[x,C,x+p*t,C+g*t]}function el(h){if(h)return h.map(([t,n])=>[t*s.q.devicePixelRatio,n*s.q.devicePixelRatio])}class _f{constructor(t,n,u){this.id=t,this.scope=n,this.sourceCache=u,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const n=this.sourceCache.getVisibleCoordinates();if(n.length===0)return t;const u=this.sourceCache.getSource();if(!(u instanceof Ca))return t;const p=n.map(x=>this.sourceCache.getTile(x)),g=u.getImages(p,Array.from(this.pendingRequests));for(const[x,C]of g)t.set(s.I.from({name:x,iconsetId:this.id}),C),this.pendingRequests.delete(x);for(const x of this.pendingRequests)this.missingRequests.add(x);return this.pendingRequests.clear(),t}}const tl=(h,t)=>qe(h,t&&t.filter(n=>n.identifier!=="source.canvas")),Wl=s.aA(Hi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),$c=s.aA(Hi,["setCenter","setZoom","setBearing","setPitch"]),Xc=new Set(["background","sky","slot","custom"]),gf={version:8,layers:[],sources:{}},za={duration:300,delay:0};class da extends s.E{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=s.l({},za),this._buildingIndex=new Ul(this),this.crossTileSymbolIndex=new xp,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new $a,this.dispatcher=n.dispatcher?n.dispatcher:new s.D(s.cj(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new Aa(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new s.ck(t._requestManager,n.localFontFamily?s.cl.all:n.localIdeographFontFamily?s.cl.ideographs:s.cl.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new wp(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",s.cm());const u=this;this._rtlTextPluginCallback=da.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,x)=>{if(s.cn(g),x&&x.every(C=>C))for(const C in u._sourceCaches){const P=u._sourceCaches[C],O=P.getSource().type;O!=="vector"&&O!=="geojson"||P.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.getOwnSource(p.sourceId);if(g&&g.vectorLayerIds)for(const x in this._layers){const C=this._layers[x];C.source===g.id&&this._validateLayer(C)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.f(t))return t;const n=s.co(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch{return n}return n}return`json://${s.cp(JSON.stringify(t))}`}_diffStyle(t,n,u){this.globalId=this._getGlobalId(t);const p=(g,x)=>{try{x(null,this.setState(g,u))}catch(C){x(C,!1)}};if(typeof t=="string"){const g=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(g,s.R.Style);s.n(x,(C,P)=>{C?this.fire(new s.z(C)):P&&p(P,n)})}else typeof t=="object"&&p(t,n)}loadURL(t,n={}){this.fire(new s.A("dataloading",{dataType:"style"}));const u=typeof n.validate=="boolean"?n.validate:!s.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const g=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.n(g,(x,C)=>{if(this._request=null,x)this.fire(new s.z(x));else if(C)return this.importsCache.set(t,C),this._load(C,u)})}loadJSON(t,n={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.q.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(gf,!1)}_loadImports(t,n,u){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const g of t){const x=this._createFragmentStyle(g),C=new Promise(k=>{x.once("style.import.load",k),x.once("error",k)}).then(()=>this.mergeAll());if(p.push(C),this.resolvedImports.has(g.url)){x.loadEmpty();continue}const P=g.data||this.importsCache.get(g.url);P?(x.loadJSON(P,{validate:n}),this._isInternalStyle(P)&&(x.globalId=null)):g.url?x.loadURL(g.url,{validate:n}):x.loadEmpty();const O={style:x,id:g.id,config:g.config};if(u){const k=this.fragments.findIndex(({id:U})=>U===u);this.fragments=this.fragments.slice(0,k).concat(O).concat(this.fragments.slice(k))}else this.fragments.push(O)}return Promise.allSettled(p)}getImportGlobalIds(t=this,n=new Set){for(const u of t.fragments)u.style.globalId&&n.add(u.style.globalId),this.getImportGlobalIds(u.style,n);return[...n.values()]}_createFragmentStyle(t){const n=this.scope?s.C(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[n];(t.config||p)&&(u=s.l({},t.config,p));const g=new da(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,n){const u=t.indoor?Sp(t.schema):t.schema;if(this._isInternalStyle(t)){const x=s.l({},gf,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(x,n)}if(this.updateConfig(this._config,u),n&&tl(this,rs(t)))return;this._loaded=!0,this.stylesheet=s.cq(t);const p=()=>{for(const O in t.sources)this.addSource(O,t.sources[O],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const O in t.iconsets)this.addIconset(O,t.iconsets[O]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const x=Vl(this.stylesheet.layers);if(this._order=x.map(O=>O.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const O=this.stylesheet.lights[0];this.light=new $e(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new $e(this.stylesheet.light)),this._layers={};for(const O of x){const k=s.cv(O,this.scope,this._styleColorTheme.lut,this.options);k.configDependencies.size!==0&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k;const U=this.getOwnLayerSourceCache(k),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&k.canCastShadows()&&F&&(U.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const P=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new s.A(P?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(P?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const x=this._evaluateColorThemeData(g);this._loadColorTheme(x).then(()=>{p()}).catch(C=>{s.w(`Couldn't load color theme from the stylesheet: ${C}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,n,u,p,g,x,C,P,O,k;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(F=>{if(F.stylesheet){if(F.light!=null&&(t=F.light),F.stylesheet.lights)for(const Z of F.stylesheet.lights)Z.type==="ambient"&&F.ambientLight!=null&&(n=F.ambientLight),Z.type==="directional"&&F.directionalLight!=null&&(u=F.directionalLight);p=this._prioritizeTerrain(p,F.terrain,F.stylesheet.terrain),F.stylesheet.fog&&F.fog!=null&&(g=F.fog),F.stylesheet.snow&&F.snow!=null&&(x=F.snow),F.stylesheet.rain&&F.rain!=null&&(C=F.rain),F.stylesheet.camera!=null&&(k=F.stylesheet.camera),F.stylesheet.projection!=null&&(P=F.stylesheet.projection),F.stylesheet.transition!=null&&(O=F.stylesheet.transition),U[F.scope]=F._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=u,this.fog=g,this.snow=x,this.rain=C,this._styleColorThemeForScope=U,p===null?delete this.terrain:this.terrain=p,this.camera=k||{"camera-projection":"perspective"},this.projection=P||{name:"mercator"},this.transition=s.l({},za,O),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=u=>{for(const p of u.fragments)n(p.style);t(u)};n(this)}_prioritizeTerrain(t,n,u){const p=t&&t.drapeRenderMode===0;return u===null?n&&n.drapeRenderMode===0?n:p?t:null:n!=null&&(!t||p||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},u={};this.forEachFragmentStyle(p=>{for(const g in p._sourceCaches){const x=s.C(g,p.scope);t[x]=p._sourceCaches[g]}for(const g in p._otherSourceCaches){const x=s.C(g,p.scope);n[x]=p._otherSourceCaches[g]}for(const g in p._symbolSourceCaches){const x=s.C(g,p.scope);u[x]=p._symbolSourceCaches[g]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},n=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(g=>{for(const x of g._order){const C=g._layers[x];if(C.type==="slot"){const P=s.cr(x);if(t[P])continue;t[P]=[]}C.slot&&t[C.slot]?t[C.slot].push(C):n.push(C)}}),this._mergedOrder=[];const p=(g=[])=>{for(const x of g)if(x.type==="slot"){const C=s.cr(x.id);t[C]&&p(t[C]),this._mergedSlots.push(C)}else{const C=s.C(x.id,x.scope);this._mergedOrder.push(C),u[C]=x,x.is3D(!!this.terrain)&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0),x.type==="clip"&&(this._clipLayerPresent=!0)}};p(n),this._mergedOrder.sort((g,x)=>{const C=u[g],P=u[x];return C.hasInitialOcclusionOpacityProperties?P.is3D(!!this.terrain)?1:0:C.is3D(!!this.terrain)&&P.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=s.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(n,u,p){const g=s.l({},u);for(const C of Object.keys(s.a5.colorTheme))g[C]===void 0&&(g[C]=s.a5.colorTheme[C].default);const x=new s.a6(Tp,n,new Map(p));return x.setTransitionOrValue(g,p),x.untransitioned().possiblyEvaluate(new s.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,p)=>{const g="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let x=t;x.startsWith(g)||(x=g+x);const C=s.I.from("mapbox-reserved-lut"),P=new Image;P.src=x,P.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},P.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void u();this._styleColorTheme.lutLoading=!1;const{width:O,height:k,data:U}=s.q.getImageData(P);if(k>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(O!==k*k)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(C,this.scope)&&this.removeImage(C,this.scope),this.addImage(C,this.scope,{data:new s.r({width:O,height:k},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const F=this.imageManager.getImage(C,this.scope);F?(this._styleColorTheme.lut={image:F.data,data:t},u()):p(new Error("Missing LUT image."))}})}getLut(t){const n=this._styleColorThemeForScope[t];return n?n.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,u,p){let g,x,C;const P=s.q.devicePixelRatio>1?"@2x":"";let O=s.n(u.transformRequest(u.normalizeSpriteURL(n,P,".json"),s.R.SpriteJSON),(F,Z)=>{O=null,C||(C=F,g=Z,U())}),k=s.o(u.transformRequest(u.normalizeSpriteURL(n,P,".png"),s.R.SpriteImage),(F,Z)=>{k=null,C||(C=F,x=Z,U())});function U(){if(C)p(C);else if(g&&x){const F=s.q.getImageData(x),Z={};for(const Y in g){const{width:X,height:J,x:ee,y:oe,sdf:fe,pixelRatio:ce,stretchX:xe,stretchY:_e,content:ge}=g[Y],ye=new s.r({width:X,height:J});s.r.copy(F,ye,{x:ee,y:oe},{x:0,y:0},{width:X,height:J},null),Z[Y]={data:ye,pixelRatio:ce,sdf:fe,stretchX:xe,stretchY:_e,content:ge,usvg:!1}}p(null,Z)}}return{cancel(){O&&(O.cancel(),O=null),k&&(k.cancel(),k=null)}}}(t,this.map._requestManager,(n,u)=>{if(this._spriteRequest=null,n)this.fire(new s.z(n));else if(u){const p=new Map;for(const g in u)p.set(s.I.from(g),u[g]);this.addImages(p,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(t,n){if(n.type==="sprite")return void this._loadSprite(n.url);const u=this.getOwnSourceCache(n.source);if(!u)return void this.fire(new s.z(new Error(`Source "${n.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const p=u.getSource();if(p.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${n.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));p.partial=!1;const g=new _f(t,this.scope,u);this.imageManager.addImageProvider(g,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const n=this.map._spriteFormat==="auto";var u,p;this._spriteRequest=(p=(g,x)=>{if(this._spriteRequest=null,g)n?this._loadSprite(t):this.fire(new s.z(g));else if(x){const C=new Map;for(const P in x)C.set(s.I.from(P),x[P]);this.addImages(C,this.scope)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.bj((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),s.R.Iconset),(g,x)=>{if(g)return void p(g);const C={},P=s.ch(new s.bi(x));for(const O of P.icons){const k={version:1,pixelRatio:s.q.devicePixelRatio,content:Gh(O),stretchX:O.metadata?el(O.metadata.stretch_x_areas):void 0,stretchY:O.metadata?el(O.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:O};C[O.name]=k}p(null,C)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const u=t.sourceLayer;u&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(u)===-1)&&this.fire(new s.z(new Error(`Source layer "${u}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const u=this.fragments[n];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const u=this._sourceCaches[n].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const n=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&n.push(p.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new s.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new s.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,n){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const g=t.getProgramIds();if(g)for(const x of g){const C=t.getDefaultProgramParams(x,n.zoom,this._styleColorTheme.lut);C&&(u.style=this,this.fog&&(u._fogVisible=!0,C.overrideFog=!0,u.getOrCreateProgram(x,C)),u._fogVisible=!1,C.overrideFog=!1,u.getOrCreateProgram(x,C),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(C.overrideRtt=!0,u.getOrCreateProgram(x,C)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const C=this._changes.getLayerUpdatesByScope();for(const P in C){const{updatedIds:O,removedIds:k}=C[P];(O||k)&&(this._updateWorkerLayers(P,O,k),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const g={};for(const C in this._mergedSourceCaches){const P=this._mergedSourceCaches[C];g[C]=P.used,P.used=!1,P.tileCoverLift=0}for(const C of this._mergedOrder){const P=this._mergedLayers[C];if(P.recalculate(t,this._availableImages),!P.isHidden(t.zoom)){const O=this.getLayerSourceCache(P);O&&(O.used=!0,O.tileCoverLift=Math.max(O.tileCoverLift,P.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(P,t)}):this.precompilePrograms(P,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();const x=this.imageManager.getPendingImageProviders();for(const C of x)C.sourceCache.used=!0;for(const C in g){const P=this._mergedSourceCaches[C];g[C]!==P.used&&P.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:P.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new s.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const n of t){const u=n.resolvePendingRequests();this.addImages(u,n.scope)}}_updateTilesForChangedImages(){const t={};for(const n in this._mergedSourceCaches){const u=this._mergedSourceCaches[n].getSource().scope;t[u]=t[u]||this._changes.getUpdatedImages(u),t[u].length!==0&&this._mergedSourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t[u])}for(const n in t)this._changes.resetUpdatedImages(n)}_updateWorkerLayers(t,n,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:n?p._serializeLayers(n):[],scope:t,removedIds:u||[],options:p.options})}setState(t,n){if(this._checkLoaded(),tl(this,rs(t)))return!1;(t=s.cq(t)).layers=Vl(t.layers);const u=function(x,C){if(!x)return[{command:Hi.setStyle,args:[C]}];let P=[];try{if(!s.bn(x.version,C.version))return[{command:Hi.setStyle,args:[C]}];if(s.bn(x.center,C.center)||P.push({command:Hi.setCenter,args:[C.center]}),s.bn(x.zoom,C.zoom)||P.push({command:Hi.setZoom,args:[C.zoom]}),s.bn(x.bearing,C.bearing)||P.push({command:Hi.setBearing,args:[C.bearing]}),s.bn(x.pitch,C.pitch)||P.push({command:Hi.setPitch,args:[C.pitch]}),s.bn(x.sprite,C.sprite)||P.push({command:Hi.setSprite,args:[C.sprite]}),s.bn(x.glyphs,C.glyphs)||P.push({command:Hi.setGlyphs,args:[C.glyphs]}),s.bn(x.imports,C.imports)||function(Z=[],Y=[],X){Y=Y||[];const J=(Z=Z||[]).map(Ki),ee=Y.map(Ki),oe=Z.reduce(Lr,{}),fe=Y.reduce(Lr,{}),ce=J.slice();let xe,_e,ge,ye;for(xe=0,_e=0;xe<J.length;xe++)ge=J[xe],fe.hasOwnProperty(ge)?_e++:(X.push({command:Hi.removeImport,args:[ge]}),ce.splice(ce.indexOf(ge,_e),1));for(xe=0,_e=0;xe<ee.length;xe++)ge=ee[ee.length-1-xe],ce[ce.length-1-xe]!==ge&&(oe.hasOwnProperty(ge)?(X.push({command:Hi.removeImport,args:[ge]}),ce.splice(ce.lastIndexOf(ge,ce.length-_e),1)):_e++,ye=ce[ce.length-xe],X.push({command:Hi.addImport,args:[fe[ge],ye]}),ce.splice(ce.length-xe,0,ge));for(const we of Y){const Ae=oe[we.id];Ae&&!s.bn(Ae,we)&&X.push({command:Hi.updateImport,args:[we.id,we]})}}(x.imports,C.imports,P),s.bn(x.transition,C.transition)||P.push({command:Hi.setTransition,args:[C.transition]}),s.bn(x.light,C.light)||P.push({command:Hi.setLight,args:[C.light]}),s.bn(x.fog,C.fog)||P.push({command:Hi.setFog,args:[C.fog]}),s.bn(x.snow,C.snow)||P.push({command:Hi.setSnow,args:[C.snow]}),s.bn(x.rain,C.rain)||P.push({command:Hi.setRain,args:[C.rain]}),s.bn(x.projection,C.projection)||P.push({command:Hi.setProjection,args:[C.projection]}),s.bn(x.lights,C.lights)||P.push({command:Hi.setLights,args:[C.lights]}),s.bn(x.camera,C.camera)||P.push({command:Hi.setCamera,args:[C.camera]}),s.bn(x.iconsets,C.iconsets)||function(Z,Y,X){let J;for(J in Y=Y||{},Z=Z||{})Z.hasOwnProperty(J)&&(Y.hasOwnProperty(J)||X.push({command:Hi.removeIconset,args:[J]}));for(J in Y){if(!Y.hasOwnProperty(J))continue;const ee=Y[J];Z.hasOwnProperty(J)?s.bn(Z[J],ee)||(X.push({command:Hi.removeIconset,args:[J]}),X.push({command:Hi.addIconset,args:[J,ee]})):X.push({command:Hi.addIconset,args:[J,ee]})}}(x.iconsets,C.iconsets,P),!s.bn(x["color-theme"],C["color-theme"]))return[{command:Hi.setStyle,args:[C]}];const O={},k=[];(function(Z,Y,X,J){let ee;for(ee in Y=Y||{},Z=Z||{})Z.hasOwnProperty(ee)&&(Y.hasOwnProperty(ee)||ca(ee,X,J));for(ee in Y){if(!Y.hasOwnProperty(ee))continue;const oe=Y[ee];Z.hasOwnProperty(ee)?s.bn(Z[ee],oe)||(Z[ee].type==="geojson"&&oe.type==="geojson"&&Ut(Z,Y,ee)?X.push({command:Hi.setGeoJSONSourceData,args:[ee,oe.data]}):Zo(ee,Y,X,J)):ps(ee,Y,X)}})(x.sources,C.sources,k,O);const U=[];x.layers&&x.layers.forEach(Z=>{Z.source&&O[Z.source]?P.push({command:Hi.removeLayer,args:[Z.id]}):U.push(Z)});let F=x.terrain;F&&O[F.source]&&(P.push({command:Hi.setTerrain,args:[void 0]}),F=void 0),P=P.concat(k),s.bn(F,C.terrain)||P.push({command:Hi.setTerrain,args:[C.terrain]}),function(Z,Y,X){Y=Y||[];const J=(Z=Z||[]).map(Ki),ee=Y.map(Ki),oe=Z.reduce(Lr,{}),fe=Y.reduce(Lr,{}),ce=J.slice(),xe=Object.create(null);let _e,ge,ye,we,Ae,je,Be;for(_e=0,ge=0;_e<J.length;_e++)ye=J[_e],fe.hasOwnProperty(ye)?ge++:(X.push({command:Hi.removeLayer,args:[ye]}),ce.splice(ce.indexOf(ye,ge),1));for(_e=0,ge=0;_e<ee.length;_e++)ye=ee[ee.length-1-_e],ce[ce.length-1-_e]!==ye&&(oe.hasOwnProperty(ye)?(X.push({command:Hi.removeLayer,args:[ye]}),ce.splice(ce.lastIndexOf(ye,ce.length-ge),1)):ge++,je=ce[ce.length-_e],X.push({command:Hi.addLayer,args:[fe[ye],je]}),ce.splice(ce.length-_e,0,ye),xe[ye]=!0);for(_e=0;_e<ee.length;_e++)if(ye=ee[_e],we=oe[ye],Ae=fe[ye],!xe[ye]&&!s.bn(we,Ae))if(s.bn(we.source,Ae.source)&&s.bn(we["source-layer"],Ae["source-layer"])&&s.bn(we.type,Ae.type)){for(Be in Zi(we.layout,Ae.layout,X,ye,null,Hi.setLayoutProperty),Zi(we.paint,Ae.paint,X,ye,null,Hi.setPaintProperty),s.bn(we.slot,Ae.slot)||X.push({command:Hi.setSlot,args:[ye,Ae.slot]}),s.bn(we.filter,Ae.filter)||X.push({command:Hi.setFilter,args:[ye,Ae.filter]}),s.bn(we.minzoom,Ae.minzoom)&&s.bn(we.maxzoom,Ae.maxzoom)||X.push({command:Hi.setLayerZoomRange,args:[ye,Ae.minzoom,Ae.maxzoom]}),we)we.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?Zi(we[Be],Ae[Be],X,ye,Be.slice(6),Hi.setPaintProperty):s.bn(we[Be],Ae[Be])||X.push({command:Hi.setLayerProperty,args:[ye,Be,Ae[Be]]}));for(Be in Ae)Ae.hasOwnProperty(Be)&&!we.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?Zi(we[Be],Ae[Be],X,ye,Be.slice(6),Hi.setPaintProperty):s.bn(we[Be],Ae[Be])||X.push({command:Hi.setLayerProperty,args:[ye,Be,Ae[Be]]}))}else X.push({command:Hi.removeLayer,args:[ye]}),je=ce[ce.lastIndexOf(ye)+1],X.push({command:Hi.addLayer,args:[Ae,je]})}(U,C.layers,P)}catch(O){console.warn("Unable to compute style diff:",O),P=[{command:Hi.setStyle,args:[C]}]}return P}(this.serialize(),t).filter(x=>!(x.command in $c));if(u.length===0)return!1;const p=u.filter(x=>!(x.command in Wl));if(p.length>0)throw new Error(`Unimplemented: ${p.map(x=>x.command).join(", ")}.`);const g=[];return u.forEach(x=>{g.push(this[x.command].apply(this,x.args))}),n&&Promise.all(g).then(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(t){const n=this.getFragmentStyle(t);n&&(n._availableImages=n.imageManager.listImages(t),n.dispatcher.broadcast("setImages",{scope:t,images:n._availableImages}))}addImages(t,n){for(const[u,p]of t.entries()){if(this.getImage(u,n))return this.fire(new s.z(new Error(`An image with the name "${u.name}" already exists.`)));this.imageManager.addImage(u,n,p),this._changes.updateImage(u,n)}return this._updateWorkerImages(n),this.fire(new s.A("data",{dataType:"style"})),this}addImage(t,n,u){return this.getImage(t,n)?this.fire(new s.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,n,u),this._changes.updateImage(t,n),this._updateWorkerImages(n),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(t,n,u,p=!1){this.imageManager.updateImage(t,n,u),p&&(this._changes.updateImage(t,n),this._updateWorkerImages(n),this.fire(new s.A("data",{dataType:"style"})))}getImage(t,n){return this.imageManager.getImage(t,n)}removeImage(t,n){return this.getImage(t,n)?(this.imageManager.removeImage(t,n),this._changes.updateImage(t,n),this._updateWorkerImages(n),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n,u={}){return this._checkLoaded(),this._validate(Ee,`models.${t}`,n,null,u)||(this.modelManager.addModel(t,n,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(Ia,`sources.${t}`,n,null,u))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const p=Ou(t,n,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const g=x=>{const C=(x?"symbol:":"other:")+p.id,P=s.C(C,this.scope),O=this._sourceCaches[C]=new Is(P,p,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=O,O.onAdd(this.map)};g(!1),n.type!=="vector"&&n.type!=="geojson"||g(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const p=Object.entries(this.stylesheet.iconsets).find(([g,x])=>x.type==="source"&&x.source===t);if(p)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while iconset "${p[0]}" is using it.`)))}const u=this.getOwnSourceCaches(t);for(const p of u){const g=s.cr(p.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(p.id),p.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const u=this.getOwnSourceCache(n);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const n in t){const u=t[n]._tiles;for(const p in u){const g=u[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const p of t){if(this._validate(Nl,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const g=this.ambientLight;g.set(p),g.updateTransitions(n)}else this.ambientLight=new Gn(p,ki||(ki=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const g=this.directionalLight;g.set(p),g.updateTransitions(n)}else this.directionalLight=new Gn(p,cn||(cn=new s.a7({direction:new s.am(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=new s.aa(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const u=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),p=t.properties.get("color").toRenderColor(null).toArray01(),g=t.properties.get("intensity"),x=t.properties.get("direction"),C=1-s.cc(x.x,x.y,x.z)[2]/90,P=u(p)*g*C,O=n.properties.get("color").toRenderColor(null).toArray01(),k=n.properties.get("intensity"),U=u(O)*k;return Number(((P+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(s.cs(t)){const n=s.ct(t),u=this.fragments.find(({id:g})=>g===n);if(!u)throw new Error(`Style import '${t}' not found`);const p=s.cr(t);return u.style.getFragmentStyle(p)}{const n=this.fragments.find(({id:u})=>u===t);return n?n.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},u=(p,g="")=>`${p}::${g}`;this._featuresetSelectors={};for(const p in t){const g=this._featuresetSelectors[p]=[];for(const x of t[p].selectors){if(x.featureNamespace){const P=this.getOwnLayer(x.layer);if(!P){s.w(`Layer is undefined for selector: ${x.layer}`);continue}const O=u(P.source,P.sourceLayer);if(O in n&&n[O]!==x.featureNamespace){s.w(`"featureNamespace ${x.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}n[O]=x.featureNamespace}let C;if(x.properties)for(const P in x.properties){const O=s.X(x.properties[P]);O.result==="success"&&(C=C||{},C[P]=O.value)}g.push({layerId:x.layer,namespace:x.featureNamespace,properties:C,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const n=this.getFragmentStyle(t);if(!n||!n.stylesheet.featuresets)return[];const u=[];for(const p in n.stylesheet.featuresets)u.push({featuresetId:p,importId:n.scope?n.scope:void 0});return u}getFeaturesetLayers(t,n){const u=this.getFragmentStyle(n),p=u.stylesheet.featuresets;if(!p||!p[t])return this.fire(new s.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const g=[];for(const x of p[t].selectors){const C=u.getOwnLayer(x.layer);C&&g.push(C)}return g}getConfigProperty(t,n){const u=this.getFragmentStyle(t);if(!u)return null;const p=s.C(n,u.scope),g=u.options.get(p),x=g?g.value||g.default:null;return x?x.serialize():null}setConfigProperty(t,n,u){const p=this.getFragmentStyle(t);if(!p)return;const g=p.stylesheet.indoor?Sp(p.stylesheet.schema):p.stylesheet.schema;if(!g||!g[n])return;const x=s.X(u);if(x.result!=="success")return void tl(this,x.value);const C=x.value.expression,P=s.C(n,p.scope),O=p.options.get(P);if(!O)return;let k;const{minValue:U,maxValue:F,stepValue:Z,type:Y,values:X}=g[n],J=s.X(g[n].default);J.result==="success"&&(k=J.value.expression),k?(this.options.set(P,Object.assign({},O,{value:C,default:k,minValue:U,maxValue:F,stepValue:Z,type:Y,values:X})),this.updateConfigDependencies(n)):this.fire(new s.z(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const u=n.stylesheet.schema;if(!u)return null;const p={};for(const g in u){const x=s.C(g,n.scope),C=n.options.get(x),P=C?C.value||C.default:null;p[g]=P?P.serialize():null}return p}setConfig(t,n){const u=this.getFragmentStyle(t);u&&(u.updateConfig(n,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const n=this.getFragmentStyle(t);return n?n.stylesheet.schema:null}setSchema(t,n){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=n,u.updateConfig(u._config,n),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const u in n){let p,g;const x=s.X(n[u].default);if(x.result==="success"&&(p=x.value.expression),t&&t[u]!==void 0){const F=s.X(t[u]);F.result==="success"&&(g=F.value.expression)}const{minValue:C,maxValue:P,stepValue:O,type:k,values:U}=n[u];if(p){const F=s.C(u,this.scope);this.options.set(F,{default:p,value:g,minValue:C,maxValue:P,stepValue:O,type:k,values:U})}else this.fire(new s.z(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const n of this._configDependentLayers){const u=this.getLayer(n);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(n=>{const u=n._styleColorTheme.colorThemeOverride?n._styleColorTheme.colorThemeOverride:n._styleColorTheme.colorTheme;if(u){const p=n._evaluateColorThemeData(u);(!n._styleColorTheme.lut&&p!==""||n._styleColorTheme.lut&&p!==n._styleColorTheme.lut.data)&&n.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,n,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new s.z(new Error(`Layer with id "${p}" already exists on this map`)));let g;if(t.type==="custom"){if(tl(this,s.cu(t)))return;g=s.cv(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=s.cq(t),t=s.l(t,{source:p})),this._validate(te,`layers.${p}`,t,{arrayIndex:-1},u))return;g=s.cv(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}})}g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid);let x=this._order.length;if(n){const k=this._order.indexOf(n);if(k===-1)return void this.fire(new s.z(new Error(`Layer with id "${n}" does not exist on this map.`)));g.slot===this._layers[n].slot?x=k:s.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=g;const C=this.getOwnLayerSourceCache(g),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&g.canCastShadows()&&P&&(C.castsShadows=!0);const O=this._changes.getRemovedLayer(g);if(O&&g.source&&C&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const k=s.C(g.source,g.scope);O.type!==g.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),C.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===n)return;const p=this._order.indexOf(t);this._order.splice(p,1);let g=this._order.length;if(n){const x=this._order.indexOf(n);if(x===-1)return void this.fire(new s.z(new Error(`Layer with id "${n}" does not exist on this map.`)));u.slot===this._layers[n].slot?g=x:s.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const p=this.getOwnLayerSourceCache(n);if(p&&p.castsShadows){let g=!1;for(const x in this._layers)if(this._layers[x].source===n.source&&this._layers[x].canCastShadows()){g=!0;break}p.castsShadows=g}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===n&&p.maxzoom===u||(n!=null&&(p.minzoom=n),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,n){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==n&&(u.slot=n,this._updateLayer(u))}setFilter(t,n,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!s.bn(p.filter,n))return n==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(ie,`layers.${p.id}.filter`,n,{layerType:p.type},u)||(p.filter=s.cq(n),this._updateLayer(p)))}getFilter(t){const n=this._checkLayer(t);if(n)return s.cq(n.filter)}setLayoutProperty(t,n,u,p={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!s.bn(g.getLayoutProperty(n),u)){if(u!=null&&(!p||p.validate!==!1)&&tl(g,Se.call(rs,{key:`layers.${t}.layout.${n}`,layerType:g.type,objectKey:n,value:u,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(n,u),g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(t,n){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(n)}setPaintProperty(t,n,u,p={}){this._checkLoaded();const g=this._checkLayer(t);if(!g||s.bn(g.getPaintProperty(n),u)||u!=null&&(!p||p.validate!==!1)&&tl(g,me.call(rs,{key:`layers.${t}.paint.${n}`,layerType:g.type,objectKey:n,value:u,styleSpec:s.a5})))return;const x=g.setPaintProperty(n,u);g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),x&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(t,n){const u=this._checkLayer(t);if(u)return u.getPaintProperty(n)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:P,importId:O}=t.target,k=this.getFragmentStyle(O),U=k.getFeaturesetLayers(P);for(const{source:F,sourceLayer:Z}of U)k.setFeatureState({id:t.id,source:F,sourceLayer:Z},n)}else if("layerId"in t.target){const{layerId:P}=t.target,O=this.getLayer(P);this.setFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},n)}return}const u=t.source,p=t.sourceLayer,g=this._checkSource(u);if(!g)return;const x=g.type;if(x==="geojson"&&p)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!p)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(u);for(const P of C)P.setFeatureState(p,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:P,importId:O}=t.target,k=this.getFragmentStyle(O),U=k.getFeaturesetLayers(P);for(const{source:F,sourceLayer:Z}of U)k.removeFeatureState({id:t.id,source:F,sourceLayer:Z},n)}else if("layerId"in t.target){const{layerId:P}=t.target,O=this.getLayer(P);this.removeFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},n)}return}const u=t.source,p=this._checkSource(u);if(!p)return;const g=p.type,x=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!x)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(u);for(const P of C)P.removeFeatureState(x,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let g;if("featuresetId"in t.target){const{featuresetId:x,importId:C}=t.target,P=this.getFragmentStyle(C),O=P.getFeaturesetLayers(x);for(const{source:k,sourceLayer:U}of O){const F=P.getFeatureState({id:t.id,source:k,sourceLayer:U});if(F&&!g)g=F;else if(!s.bn(g,F))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:x}=t.target,C=this.getLayer(x);g=this.getFeatureState({id:t.id,source:C.source,sourceLayer:C.sourceLayer})}return g}const n=t.source,u=t.sourceLayer,p=this._checkSource(n);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(u,t.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=s.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const n of Object.values(this._mergedLayers))t(n)&&this._updateLayer(n)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),u=s.C(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=C=>this._mergedLayers[C].is3D(!!this.terrain),u=this.order,p={},g=[];for(let C=u.length-1;C>=0;C--){const P=u[C];if(n(P)){p[P]=C;for(const O of t){const k=O[P];if(k)for(const U of k)g.push(U)}}}g.sort((C,P)=>P.intersectionZ-C.intersectionZ);const x=[];for(let C=u.length-1;C>=0;C--){const P=u[C];if(n(P))for(let O=g.length-1;O>=0;O--){const k=g[O].feature;if(k.layer&&p[k.layer.id]<C)break;x.push(k),g.pop()}else for(const O of t){const k=O[P];if(k)for(const U of k)x.push(U.feature)}}return x}queryRenderedFeatures(t,n,u){let p;n&&!Array.isArray(n)&&n.filter&&(this._validate(ie,"queryRenderedFeatures.filter",n.filter,null,n),p=s.a_(n.filter));const g={},x=k=>{if(Xc.has(k.type))return;const U=this.getOwnLayerSourceCache(k),F=g[U.id]=g[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};k.is3D(!!this.terrain)&&(F.has3DLayers=!0),F.layers[k.fqid]=F.layers[k.fqid]||{styleLayer:k,targets:[]},F.layers[k.fqid].targets.push({filter:p})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const k of n.layers){const U=this._layers[k];if(!U)return this.fire(new s.z(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];x(U)}}else for(const k in this._layers)x(this._layers[k]);const C=this._queryRenderedFeatures(t,g,u),P=this._flattenAndSortRenderedFeatures(C),O=[];for(const k of P)s.ct(k.layer.id)===this.scope&&O.push(k);return O}queryRenderedFeatureset(t,n,u){let p;n&&!Array.isArray(n)&&n.filter&&(this._validate(ie,"queryRenderedFeatures.filter",n.filter,null,n),p=s.a_(n.filter));const g="mock",x=[];if(n&&n.target)x.push(Object.assign({},n,{targetId:g,filter:p}));else{const k=this.getFeaturesetDescriptors();for(const U of k)x.push({targetId:g,filter:p,target:U});for(const{style:U}of this.fragments){const F=U.getFeaturesetDescriptors();for(const Z of F)x.push({targetId:g,filter:p,target:Z})}}const C=this.queryRenderedTargets(t,x,u),P=[],O=new Set;for(const k of C)for(const U of k.variants[g])yo(U,k,O)||P.push(new s.cx(k,U));return P}queryRenderedTargets(t,n,u){const p={},g=(C,P,O,k)=>{const U=p[P.id]=p[P.id]||{sourceCache:P,layers:{},has3DLayers:!1};if(U.layers[C.fqid]=U.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D(!!this.terrain)&&(U.has3DLayers=!0),!k)return O.uniqueFeatureID=!1,void U.layers[C.fqid].targets.push(O);U.layers[C.fqid].targets.push(Object.assign({},O,{namespace:k.namespace,properties:k.properties,uniqueFeatureID:k.uniqueFeatureID}))};for(const C of n)if("featuresetId"in C.target){const{featuresetId:P,importId:O}=C.target,k=this.getFragmentStyle(O);if(!k||!k._featuresetSelectors)continue;const U=k._featuresetSelectors[P];if(!U){this.fire(new s.z(new Error(`The featureset '${P}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const F of U){const Z=k.getOwnLayer(F.layerId);Z&&!Xc.has(Z.type)&&g(Z,k.getOwnLayerSourceCache(Z),C,F)}}else if("layerId"in C.target){const{layerId:P}=C.target,O=this.getLayer(P);if(!O||Xc.has(O.type))continue;g(O,this.getLayerSourceCache(O),C)}const x=this._queryRenderedFeatures(t,p,u);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(t,n,u){const p=[],g=!!this.map._showQueryGeometry,x=pr.createFromScreenPoints(t,u);for(const C in n){const P=Nh(x,n[C],this._availableImages,u,g);Object.keys(P).length&&p.push(P)}if(this.placement)for(const C in n){if(!n[C].sourceCache._onlySymbols)continue;const P=ku(x.screenGeometry,n[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(P).length&&p.push(P)}return p}querySourceFeatures(t,n){const u=n&&n.filter;u&&this._validate(ie,"querySourceFeatures.filter",u,null,n);let p=[];const g=this.getOwnSourceCaches(t);for(const x of g)p=p.concat(pp(x,n));return p}addSourceType(t,n,u){return da.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(da.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,u={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const C in t)if(!s.bn(t[C],p[C])){g=!0;break}if(!g)return;const x=this._getTransitionParameters();this.light.setLight(t,n,u),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,n=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(n===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const C="terrain-dem-src";this.addSource(C,u.source),u=s.cq(u),u=s.l(u,{source:C})}const g=s.l({},u),x={};if(this.terrain&&p){g.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(x.style=C.serialize())}if(this._validate(Pu,"terrain",g,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&n!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,n),this.fire(new s.A("data",{dataType:"style"}))}else{const g=this.terrain,x=g.get();for(const C of Object.keys(s.a5.terrain))!u.hasOwnProperty(C)&&s.a5.terrain[C].default&&(u[C]=s.a5.terrain[C].default);for(const C in t)if(!s.bn(t[C],x[C])){g.set(t,this.options),this.stylesheet.terrain=t;const P=this._getTransitionParameters({duration:0});g.updateTransitions(P),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new Ai(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_createSnow(t){const n=this.snow=new un(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_createRain(t){const n=this.rain=new mn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!s.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!s.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!s.bn(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(n);this._loadColorTheme(u).then(()=>{this.fire(new s.A("colorthemeset")),t()}).catch(p=>{s.w(`Couldn't set color theme: ${p}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,n){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=n,u._reloadColorTheme())}_getTransitionParameters(t){return{now:s.q.now(),transition:s.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):n.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const u=this.terrain=new Je(t,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,u,p,g={}){if(g&&g.validate===!1)return!1;const x=s.l({},this.serialize());return tl(this,t.call(rs,s.l({key:n,style:x,value:u,styleSpec:s.a5},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const u of n)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const u of n)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let n;this.directionalLight&&(n=ha(this.directionalLight));for(const u in this._mergedSourceCaches)this._mergedSourceCaches[u].update(t,void 0,void 0,n)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,u,p,g,x,C=!1){let P=!1,O=!1;const k={},U={};for(const F of this._mergedOrder){const Z=this._mergedLayers[F];if(Z.type!=="symbol")continue;const Y=s.C(Z.source,Z.scope);let X=k[Y];if(!X){const ee=this.getLayerSourceCache(Z);if(!ee)continue;const oe=ee.getRenderableIds(!0).map(fe=>ee.getTileByID(fe));U[Y]=oe.slice(),X=k[Y]=oe.sort((fe,ce)=>ce.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(ce.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(Z,X,n.center.lng,n.projection);P=P||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),n.zoom))&&(this.pauseablePlacement=new Jo(n,this._mergedOrder,C,u,p,g,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),O=!0),P&&this.pauseablePlacement.placement.setStale()),O||P){this._buildingIndex.onNewFrame(n.zoom);for(let F=0;F<this._mergedOrder.length;F++){const Z=this._mergedLayers[this._mergedOrder[F]];if(Z.type!=="symbol")continue;const Y=this.isLayerClipped(Z);this.placement.updateLayerOpacities(Z,k[s.C(Z.source,Z.scope)],F,Y?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:g})=>g===t.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return u.push(t),this._loadImports([t],!0);const p=u.findIndex(({id:g})=>g===n);return p===-1&&this.fire(new s.z(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof n=="string"?(this.setImportUrl(t,n),this):(n.url&&n.url!==u[p].url&&this.setImportUrl(t,n.url),s.bn(n.config,u[p].config)||this.setImportConfig(t,n.config,n.data.schema),s.bn(n.data,u[p].data)||this.setImportData(t,n.data),this)}moveImport(t,n){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const g=this.getImportIndex(n);if(g===-1)return this;const x=u[p],C=this.fragments[p];return u=u.filter(({id:P})=>P!==t),this.fragments=this.fragments.filter(({id:P})=>P!==t),this.stylesheet.imports=u.slice(0,g).concat(x).concat(u.slice(g)),this.fragments=this.fragments.slice(0,g).concat(C).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(t,n){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=n;const g=this.fragments[p];return g.style=this._createFragmentStyle(u[p]),g.style.on("style.import.load",()=>this.mergeAll()),g.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:n?(this.fragments[u].style.setState(n),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,n,u){this._checkLoaded();const p=this.getImportIndex(t),g=this.stylesheet.imports||[];if(p===-1)return this;n?g[p].config=n:delete g[p].config;const x=this.fragments[p];u&&x.style.stylesheet&&(x.style.stylesheet.schema=u);const C=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=n,x.style.updateConfig(n,C),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(n.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return n===-1&&this.fire(new s.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[n];u&&t.push(u.getSource())}return t}getSource(t,n){const u=this.getSourceCache(t,n);return u&&u.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const u=s.C(t,n);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const n=s.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const u=t[n];u==="reload"?this.reloadSource(n):u==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const u of n){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,n,u){this.imageManager.getImages(n.images,n.scope,u),this._updateTilesForChangedImages();const p=x=>{if(x){const C=n.images.map(P=>s.I.toString(P));x.setDependencies(n.tileID.key,n.type,C)}},g=s.C(n.source,n.scope);p(this._mergedOtherSourceCaches[g]),p(this._mergedSymbolSourceCaches[g])}rasterizeImages(t,n,u){this.imageManager.rasterizeImages(n,u)}getGlyphs(t,n,u){this.glyphManager.getGlyphs(n.stacks,n.scope,u)}getResource(t,n,u){return s.cz(n,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${t}'`))),!1):n.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,n){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(u||n&&n.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}da.getSourceType=function(h){return Vs[h]},da.setSourceType=function(h,t){Vs[h]=t},da.registerForPluginStateChange=s.ci;var Hh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Zu=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,$u=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Zh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",il=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Xu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,$h=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,So=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,_s=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Wc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,gs=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Br=[];Rs(Hh,Br),Rs($u,Br),Rs(Zu,Br);const fa={"_prelude_fog.vertex.glsl":Xu,"_prelude_terrain.vertex.glsl":il,"_prelude_shadow.vertex.glsl":Wc,"_prelude_fog.fragment.glsl":$h,"_prelude_shadow.fragment.glsl":gs,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":So,"_prelude_raster_particle.glsl":_s},nl={};Vi("",il),Vi($h,Xu),Vi(gs,Wc),Vi(So,""),Vi(_s,"");const Yc=Vi(Zu,$u),Yl=Hh;var Kl={background:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Vi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Vi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Vi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Vi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Vi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Vi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Vi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Vi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Vi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Vi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Vi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Vi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Vi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Vi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Vi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Vi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Vi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Zh),skyboxGradient:Vi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Zh),skyboxCapture:Vi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Vi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Vi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Vi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Vi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Vi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Vi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Vi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Vi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Rs(h,t){const n=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of n)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const g of p)t.includes(g)||t.push(g)}}function Vi(h,t){const n=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(O=>{const k=O.split(" ");return k[k.length-1]}),p=[...new Set(p)]);const g={},x=[],C=[];if(h=h.replace(n,(O,k)=>(C.push(k),"")),(t=t.replace(n,(O,k)=>(x.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let P=[...Br];Rs(h,P),Rs(t,P);for(const O of[...x,...C])fa[O]||console.error(`Undefined include: ${O}`),nl[O]||(nl[O]=[],Rs(fa[O],nl[O])),P=[...P,...nl[O]];return{fragmentSource:h=h.replace(u,(O,k,U,F,Z)=>(g[Z]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
in ${U} ${F} ${Z};
#else
uniform ${U} ${F} u_${Z};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${Z}
    ${U} ${F} ${Z} = u_${Z};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    in ${U} ${F} ${Z};
#endif
`:k==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(O,k,U,F,Z)=>{const Y=F==="float"?"vec2":F,X=Z.match(/color/)?"color":Y;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
in ${U} ${F} a_${Z};
#endif
`:g[Z]?k==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${U} ${Y} a_${Z};
out ${U} ${F} ${Z};
#else
uniform ${U} ${F} u_${Z};
#endif
`:k==="initialize"?X==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${U} ${F} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${X}(a_${Z}, u_${Z}_t);
#else
    ${U} ${F} ${Z} = u_${Z};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    in ${U} ${F} a_${Z};
    out ${U} ${F} ${Z};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    ${Z} = a_${Z};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${U} ${Y} a_${Z};
#else
uniform ${U} ${F} u_${Z};
#endif
`:k==="define-instanced"?X==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Z}0;
in vec4 a_${Z}1;
in vec4 a_${Z}2;
in vec4 a_${Z}3;
#else
uniform ${U} ${F} u_${Z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${Y} a_${Z};
#else
uniform ${U} ${F} u_${Z};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    ${U} ${F} ${Z} = a_${Z};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${U} ${F} ${Z} = a_${Z};
#else
    ${U} ${F} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${U} ${F} ${Z} = unpack_mix_${X}(a_${Z}, u_${Z}_t);
#else
    ${U} ${F} ${Z} = u_${Z};
#endif
`}),staticAttributes:p,usedDefines:P,vertexIncludes:x,fragmentIncludes:C}}class Wu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,u,p,g,x,C,P){this.context=t;let O=this.boundPaintVertexBuffers.length!==p.length;for(let U=0;!O&&U<p.length;U++)this.boundPaintVertexBuffers[U]!==p[U]&&(O=!0);let k=this.boundDynamicVertexBuffers.length!==C.length;for(let U=0;!k&&U<C.length;U++)this.boundDynamicVertexBuffers[U]!==C[U]&&(k=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==u||O||k||this.boundIndexBuffer!==g||this.boundVertexOffset!==x)this.freshBind(n,u,p,g,x,C,P);else{t.bindVertexArrayOES.set(this.vao);for(const U of C)U&&(U.bind(),P&&U.instanceCount&&U.setVertexAttribDivisor(t.gl,n,P));g&&g.dynamicDraw&&g.bind()}}freshBind(t,n,u,p,g,x,C){const P=t.numAttributes,O=this.context,k=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=x,n.enableAttributes(k,t),n.bind(),n.setVertexAttribPointers(k,t,g);for(const U of u)U.enableAttributes(k,t),U.bind(),U.setVertexAttribPointers(k,t,g);for(const U of x)U&&(U.enableAttributes(k,t),U.bind(),U.setVertexAttribPointers(k,t,g),C&&U.instanceCount&&U.setVertexAttribDivisor(k,t,C));p&&p.bind(),O.currentNumAttributes=P}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Jl(h,t){const n=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new s.ac(0,u/n).toLngLat().lat,new s.ac(0,(u+1)/n).toLngLat().lat]}function Kc(h,t,n,u,p,g,x){const C=h.context,P=C.gl,O=n.hillshadeFBO;if(!O)return;h.prepareDrawTile();const k=h.isTileAffectedByFog(t),U=h.getOrCreateProgram("hillshade",{overrideFog:k});C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.colorAttachment.get());const F=((J,ee,oe,fe)=>{const ce=oe.paint.get("hillshade-shadow-color"),xe=oe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",_e=oe.paint.get("hillshade-highlight-color"),ge=oe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ye=oe.paint.get("hillshade-accent-color"),we=oe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ae=oe.paint.get("hillshade-emissive-strength");let je=s.ak(oe.paint.get("hillshade-illumination-direction"));if(oe.paint.get("hillshade-illumination-anchor")==="viewport")je-=J.transform.angle;else if(J.style&&J.style.enable3dLights()&&J.style.directionalLight){const Qe=J.style.directionalLight.properties.get("direction"),nt=s.cc(Qe.x,Qe.y,Qe.z);je=s.ak(nt[1])}const Be=!J.options.moving;return{u_matrix:fe||J.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),Be),u_image:0,u_latrange:Jl(0,ee.tileID),u_light:[oe.paint.get("hillshade-exaggeration"),je],u_shadow:ce.toRenderColor(xe?null:oe.lut),u_highlight:_e.toRenderColor(ge?null:oe.lut),u_emissive_strength:Ae,u_accent:ye.toRenderColor(we?null:oe.lut)}})(h,n,u,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(C,U,t.toUnwrapped());const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:Y,tileBoundsSegments:X}=h.getTileBoundsBuffers(n);U.draw(h,P.TRIANGLES,p,g,x,ci.disabled,F,u.id,Z,Y,X)}function Ds(h,t,n){if(!t.needsDEMTextureUpload)return;const u=h.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(n.stride);const g=n.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new s.T(u,g,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function yf(h,t,n){const u=h.context,p=u.gl;if(!t.dem)return;const g=t.dem;if(u.activeTexture.set(p.TEXTURE1),Ds(h,t,g),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const x=g.dim;u.activeTexture.set(p.TEXTURE0);let C=t.hillshadeFBO;if(!C){const F=new s.T(u,{width:x,height:x,data:null},p.RGBA8);F.bind(p.LINEAR,p.CLAMP_TO_EDGE),C=t.hillshadeFBO=u.createFramebuffer(x,x,!0,"renderbuffer"),C.colorAttachment.set(F.texture)}u.bindFramebuffer.set(C.framebuffer),u.viewport.set([0,0,x,x]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:O,tileBoundsSegments:k}=h.getMercatorTileBoundsBuffers(),U=[];h.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(h,p.TRIANGLES,Wt.disabled,xi.disabled,zi.unblended,ci.disabled,((F,Z)=>{const Y=Z.stride,X=s.ad.mat4.create();return s.ad.mat4.ortho(X,0,s.ai,-s.ai,0,0,1),s.ad.mat4.translate(X,X,[0,-s.ai,0]),{u_matrix:X,u_image:1,u_dimension:[Y,Y],u_zoom:F.overscaledZ}})(t.tileID,g),n.id,P,O,k),t.needsHillshadePrepare=!1}class xn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ep extends xn{getDefault(){return s.al.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Jc extends xn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Eo extends xn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Yu extends xn{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ku extends xn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ql extends xn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ec extends xn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Xh extends xn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class rl extends xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class ys extends xn{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ea extends xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Hr extends xn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Pa extends xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class pa extends xn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class io extends xn{getDefault(){return s.al.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Wh extends xn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Ju extends xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Qu extends xn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class es extends xn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let ur=class extends xn{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class On extends xn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class no extends xn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Oa extends xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Yh extends xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ma extends xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ap extends xn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Mp extends xn{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class eh extends xn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class th extends xn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ip extends xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ih extends xn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class tc extends xn{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Ao extends tc{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class La extends tc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ta extends tc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ro extends La{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Kh=(h,t,n)=>({u_matrix:h,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),nh=(h,t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:n,u_zoom_transition:p,u_merc_center:g,u_image0:0,u_frustum_tl:x,u_frustum_tr:C,u_frustum_br:P,u_frustum_bl:O,u_globe_pos:k,u_globe_radius:U,u_viewport:F,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:Z,u_far_z_cutoff:Y});function sl(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const zs=new class{constructor(){this.operations={}}newMorphing(h,t,n,u,p){if(h in this.operations){const g=this.operations[h];g.to.tileID.key!==n.tileID.key&&(g.queued=n)}else this.operations[h]={startTime:u,phase:0,duration:p,from:t,to:n,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const n=this.operations[t];for(n.phase=(h-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Mo={0:null,1:"TERRAIN_VERTEX_MORPHING"};function hr(h,t,n){if(t===0)return 0;const u=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*u}function Qc(h,t){const n=1<<h.z;return!t&&(h.x===0||h.x===n-1)||h.y===0||h.y===n-1}const ic=h=>({u_matrix:h});function Jh(h,t,n,u,p){if(p>0){const g=s.q.now(),x=(g-h.timeAdded)/p,C=t?(g-t.timeAdded)/p:-1,P=n.getSource(),O=u.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),k=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(h.tileID.overscaledZ-O),U=k&&h.refreshedUponExpiration?1:s.ay(k?x:1-C,0,1);return h.refreshedUponExpiration&&x>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class Cp extends Is{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new s.D(s.cj(),null),p=Ou("mock-dem",n,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class vf extends Is{constructor(t){const n=Ou("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new s.D(s.cj(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,x)=>{if(g[x.key]="",!this._tiles[x.key]){const C=new la(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);C.state="loaded",this._tiles[x.key]=C}return g},{});for(const g in this._tiles)g in p||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const u=Object.values(n);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class br extends s.aH{constructor(t,n,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=u}}class Qh extends s.cK{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,g]=function(P){const O=new s.b5,k=new s.aV,U=131;O.reserve(17161),k.reserve(33800);const F=s.ai/128,Z=s.ai+F/2,Y=Z+F;for(let J=-F;J<Y;J+=F)for(let ee=-F;ee<Y;ee+=F){const oe=ee<0||ee>Z||J<0||J>Z?24575:0,fe=s.ay(Math.round(ee),0,s.ai),ce=s.ay(Math.round(J),0,s.ai);O.emplaceBack(fe+oe,ce)}const X=(J,ee)=>{const oe=ee*U+J;k.emplaceBack(oe+1,oe,oe+U),k.emplaceBack(oe+U,oe+U+1,oe+1)};for(let J=1;J<129;J++)for(let ee=1;ee<129;ee++)X(ee,J);return[0,129].forEach(J=>{for(let ee=0;ee<130;ee++)X(ee,J),X(J,ee)}),[O,k,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(u,s.b7.members),this.gridIndexBuffer=x.createIndexBuffer(p),this.gridSegments=s.b8.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=s.b8.simpleSegment(0,0,u.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vf(n.map),this.orthoMatrix=s.ad.mat4.create(),s.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.ai,0,s.ai,0,1);const C=x.gl;this._overlapStencilMode=new xi({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Cp(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,g=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const C=t.terrain&&t.terrain.scope,P=p.get("source"),O=g?this._mockSourceCache:t.getSourceCache(P,C);if(!O)return void s.w(`Couldn't find terrain source "${P}".`);if(this.sourceCache=O,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(n):p.get("exaggeration"),!n.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(n,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),n.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=n!=null?u-n:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const g=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(g);let C=g-this._previousZoom;const P=this._previousUpdateTimestamp;let O=g;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(g-O)>.5&&(C=.5*(g-O+C)),C*p<0&&(O+=C)),this._evaluationZoom=O;const k=x.getExaggeration(O),U=k===x.getExaggeration(Math.max(0,O-.1));if(U&&Math.abs(k-this._exaggeration)<.01)return k;let F=Math.min(.1,.00375*(this._updateTimestamp-P));return(U||k<.1||Math.abs(C)<1e-4)&&(F=Math.min(.2,4*F)),s.ah(this._exaggeration,k,F)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=n.getIds().map(P=>{const O=n.getTileByID(P).tileID;return O.projMatrix=u.calculateProjMatrix(O.toUnwrapped()),O});(function(P,O){const k=O.transform.pointCoordinate(O.transform.getCameraPoint()),U=new s.P(k.x,k.y);P.sort((F,Z)=>{if(Z.overscaledZ-F.overscaledZ)return Z.overscaledZ-F.overscaledZ;const Y=new s.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),X=new s.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),J=U.mult(1<<F.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(Y)-J.distSqr(X)})})(p,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},p.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const P in x){const O=x[P];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,t[P],g),O.usedForTerrain))continue;const k=t[P];O.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[n.id]=p.map(P=>new br(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const O=this.terrainTileForTile[P.key];if(!O)continue;const k=O.tileID.key;k in C||(this._visibleDemTiles.push(O),C[k]=k)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const u=this._findTileCoveringTileID(n,this.sourceCache);u&&(this.terrainTileForTile[n.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],g=p.dem;!g||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),Ds(this.painter,p,g))}}_prepareDemTileUniforms(t,n,u,p){if(!n||n.demTexture==null)return!1;const g=t.tileID.canonical,x=Math.pow(2,n.tileID.canonical.z-g.z),C=p||"";return u[`u_dem_tl${C}`]=[g.x*x%1,g.y*x%1],u[`u_dem_scale${C}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const n=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const g=p.dem.tree.minimums[0];return g>0&&t++,u+g},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new s.cL({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(p,{premultiply:!1}):g=this._emptyDEMTexture=new s.T(t,p,n.R32F,{premultiply:!1}),g}setupElevationDraw(t,n,u){const p=this.painter.context,g=p.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let C=null,P=null,O=1;if(u&&u.morphing&&this._useVertexMorphing){const Z=u.morphing.srcDemTile,Y=u.morphing.dstDemTile;O=u.morphing.phase,Z&&Y&&(this._prepareDemTileUniforms(t,Z,x,"_prev")&&(P=Z),this._prepareDemTileUniforms(t,Y,x)&&(C=Y))}const k=Z=>Z&&Z.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST;let U=null;var F;if(this.enabled?P&&C?(U=C.demTexture,p.activeTexture.set(g.TEXTURE4),P.demTexture.bind(k(P),g.CLAMP_TO_EDGE),x.u_dem_lerp=O):(C=this.terrainTileForTile[t.tileID.key],U=this._prepareDemTileUniforms(t,C,x)?C.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,p.activeTexture.set(g.TEXTURE2),U&&(x.u_dem_size=(F=U).size[0]===1?1:F.size[0]-2,U.bind(k(C),g.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,n,x),u&&u.useMeterToDem&&C){const Z=(1<<C.tileID.canonical.z)*s.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=Z}if(u&&u.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),n.setTerrainUniformValues(p,x),this.painter.transform.projection.name==="globe"){const Z=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);n.setGlobeUniformValues(p,Z)}}globeUniformValues(t,n,u){const p=t.projection;return{u_tile_tl_up:p.upVector(n,0,0),u_tile_tr_up:p.upVector(n,s.ai,0),u_tile_br_up:p.upVector(n,s.ai,s.ai),u_tile_bl_up:p.upVector(n,0,s.ai),u_tile_up_scale:u?s.cM(1):p.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,g,x,C,P){if(p.transform.projection.name==="globe")(function(O,k,U,F,Z){const Y=O.context,X=Y.gl;let J,ee;const oe=O.transform,fe=s.cD(O,Y,oe),ce=(Qe,nt)=>{if(ee===nt)return;const dt=[Mo[nt],"PROJECTION_GLOBE_VIEW"];fe&&dt.push("CUSTOM_ANTIALIASING");const Le=O.isTileAffectedByFog(Qe);J=O.getOrCreateProgram("globeRaster",{defines:dt,overrideFog:Le}),ee=nt},xe=O.colorModeForRenderPass(),_e=new Wt(X.LEQUAL,Wt.ReadWrite,O.depthRangeFor3D);zs.update(Z);const ge=s.cE(oe),ye=[s.av(oe.center.lng),s.aC(oe.center.lat)],we=O.globeSharedBuffers,Ae=[oe.width*s.q.devicePixelRatio,oe.height*s.q.devicePixelRatio],je=Float32Array.from(oe.globeMatrix),Be={useDenormalizedUpVectorScale:!0};{const Qe=O.transform,nt=hr(Qe.zoom,k.exaggeration(),k.sourceCache._source.tileSize);ee=-1;const dt=X.TRIANGLES;for(const Le of F){const et=U.getTile(Le),Oe=xi.disabled,tt=k.prevTerrainTileForTile[Le.key],Xe=k.terrainTileForTile[Le.key];sl(tt,Xe)&&zs.newMorphing(Le.key,tt,Xe,Z,250),Y.activeTexture.set(X.TEXTURE0),et.texture&&et.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const st=zs.getMorphValuesForProxy(Le.key),Ge=st?1:0;st&&s.L(Be,{morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:s.cC(st.phase)}});const rt=s.cF(Le.canonical),St=s.cG(rt.getCenter().lat),Et=s.cH(Le.canonical,rt,St,Qe.worldSize/Qe._pixelsPerMercatorPixel),It=s.bc(s.cI(Le.canonical)),Vt=nh(Qe.expandedFarZProjMatrix,je,ge,It,s.ag(Qe.zoom),ye,Qe.frustumCorners.TL,Qe.frustumCorners.TR,Qe.frustumCorners.BR,Qe.frustumCorners.BL,Qe.globeCenterInViewSpace,Qe.globeRadius,Ae,nt,Qe._farZ,Et);if(ce(Le,Ge),J&&(k.setupElevationDraw(et,J,Be),O.uploadCommonUniforms(Y,J,Le.toUnwrapped()),we)){const[di,Qt,ui]=we.getGridBuffers(St,nt!==0);J.draw(O,dt,_e,Oe,xe,ci.backCCW,Vt,"globe_raster",di,Qt,ui)}}}if(we&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){const Qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];fe&&Qe.push("CUSTOM_ANTIALIASING"),J=O.getOrCreateProgram("globeRaster",{defines:Qe});for(const nt of F){const{x:dt,y:Le,z:et}=nt.canonical,Oe=Le===0,tt=Le===(1<<et)-1,[Xe,st,Ge,rt]=we.getPoleBuffers(et,!1);if(rt&&(Oe||tt)){const St=U.getTile(nt);Y.activeTexture.set(X.TEXTURE0),St.texture&&St.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let Et=s.cJ(et,dt,oe);const It=s.bc(s.cI(nt.canonical)),Vt=(di,Qt)=>di.draw(O,X.TRIANGLES,_e,xi.disabled,xe,ci.disabled,nh(oe.expandedFarZProjMatrix,Et,Et,It,0,ye,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Ae,0,oe._farZ),"globe_pole_raster",Qt,Ge,rt);k.setupElevationDraw(St,J,Be),O.uploadCommonUniforms(Y,J,nt.toUnwrapped()),Oe&&O.renderDefaultNorthPole&&Vt(J,Xe),tt&&O.renderDefaultSouthPole&&(Et=s.ad.mat4.scale(s.ad.mat4.create(),Et,[1,-1,1]),Vt(J,st))}}}})(p,g,x,C,P);else{const O=p.context,k=O.gl;let U,F;const Z=p.shadowRenderer,Y=wo(p,p.longestCutoffRange),X=xe=>{if(F===xe)return;const _e=[];_e.push(Mo[xe]),Y.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),Z&&(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Z.useNormalOffset&&_e.push("NORMAL_OFFSET")),U=p.getOrCreateProgram("terrainRaster",{defines:_e}),F=xe},J=p.colorModeForRenderPass(),ee=new Wt(k.LEQUAL,Wt.ReadWrite,p.depthRangeFor3D);zs.update(P);const oe=p.transform,fe=hr(oe.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let ce=[0,0,0];if(Z){const xe=p.style.directionalLight,_e=p.style.ambientLight;xe&&_e&&(ce=Zl(p.style,xe,_e))}{F=-1;const xe=k.TRIANGLES,[_e,ge]=[g.gridIndexBuffer,g.gridSegments];for(const ye of C){const we=x.getTile(ye),Ae=xi.disabled,je=g.prevTerrainTileForTile[ye.key],Be=g.terrainTileForTile[ye.key];sl(je,Be)&&zs.newMorphing(ye.key,je,Be,P,250),O.activeTexture.set(k.TEXTURE0),we.texture&&we.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Qe=zs.getMorphValuesForProxy(ye.key),nt=Qe?1:0;let dt;Qe&&(dt={morphing:{srcDemTile:Qe.from,dstDemTile:Qe.to,phase:s.cC(Qe.phase)}});const Le=Kh(ye.projMatrix,Qc(ye.canonical,oe.renderWorldCopies)?fe/10:fe,ce);if(X(nt),!U)continue;g.setupElevationDraw(we,U,dt);const et=ye.toUnwrapped();Z&&Z.setupShadows(et,U),p.uploadCommonUniforms(O,U,et,null,Y),U.draw(p,xe,ee,Ae,J,ci.backCCW,Le,"terrain_raster",g.gridBuffer,_e,ge)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,u=this.painter.context,p=this.proxySourceCache,g=this.proxiedCoords[p.id],x=this._drapedRenderBatches.shift(),C=n.style.order,P=[];let O=0;for(const k of g){const U=p.getTileByID(k.proxyTileKey),F=p.proxyCachedFBO[k.key]?p.proxyCachedFBO[k.key][t]:void 0,Z=F!==void 0?p.renderCache[F]:this.pool[O++],Y=F!==void 0;if(U.texture=Z.tex,Y&&!Z.dirty){P.push(U.tileID);continue}let X;u.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(u.clear({color:s.al.transparent,stencil:0}),Z.dirty=!1);for(let J=x.start;J<=x.end;++J){const ee=n.style._mergedLayers[C[J]];if(ee.isHidden(n.transform.zoom))continue;const oe=n.style.getLayerSourceCache(ee),fe=oe?this.proxyToSource[k.key][oe.id]:[k];if(!fe)continue;const ce=fe;u.viewport.set([0,0,Z.fb.width,Z.fb.height]),X!==(oe?oe.id:null)&&(this._setupStencil(Z,fe,ee,oe),X=oe?oe.id:null),n.renderLayer(n,oe,ee,ce)}if(this._drapedRenderBatches.length===0)for(const J of this._pendingGroundEffectLayers){const ee=n.style._mergedLayers[C[J]];if(ee.isHidden(n.transform.zoom))continue;const oe=n.style.getLayerSourceCache(ee),fe=oe?this.proxyToSource[k.key][oe.id]:[k];if(!fe)continue;const ce=fe;u.viewport.set([0,0,Z.fb.width,Z.fb.height]),X!==(oe?oe.id:null)&&(this._setupStencil(Z,fe,ee,oe),X=oe?oe.id:null),n.renderLayer(n,oe,ee,ce)}this.renderedToTile?(Z.dirty=!0,P.push(U.tileID)):Y||--O,O===5&&(O=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,n.width,n.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let u=-1,p=n;for(let g=0;g<n;++g)this._style.isLayerDraped(t._mergedLayers[t.order[g]])?u=Math.max(u,g):p=Math.min(p,g);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const x=g.tileID,C=1<<x.overscaledZ,{x:P,y:O}=x.canonical,k=P/C,U=(P+1)/C,F=O/C,Z=(O+1)/C;return{minx:k,miny:F,maxx:U,maxy:Z,t:g.dem.tree.raycastRoot(k,F,U,Z,t,n,u),tile:g}});p.sort((g,x)=>(g.t!==null?g.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const g of p){if(g.t==null)return null;const x=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,n,u);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,n=t.gl,u=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const p=new s.T(t,{width:u[0],height:u[1],data:null},n.RGBA8);p.bind(n.LINEAR,n.CLAMP_TO_EDGE);const g=t.createFramebuffer(u[0],u[1],!0,null);return g.colorAttachment.set(p.texture),g.depthAttachment=new ro(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],u=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!u&&n.shouldRedrape():!u&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof Go){t=!0;break}if(!t)return;const n={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],g=this._style.getLayerSourceCache(p);if(g&&!n[g.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof s.ab){n[g.id]=!0;for(const x of this.proxyCoords){const C=this.proxyToSource[x.key][g.id];if(C)for(const P of C)this._clearRenderCacheForTile(g.id,P)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof oa){t=!0;break}if(!t)return;const n={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],g=this._style.getLayerSourceCache(p);if(!g||n[g.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const x=p.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const P=this.proxyToSource[C.key][g.id];if(P)for(const O of P){const k=Jh(g.getTile(O),g.findLoadedParent(O,0),g,this.painter.transform,x);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(g.id,O)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(n===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,g=0,x=this._style._mergedLayers[t[g]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++g<n;)x=this._style._mergedLayers[t[g]];for(;g<n;++g){const C=this._style._mergedLayers[t[g]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?p===void 0&&(p=g):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),p!==void 0&&(u.push({start:p,end:g-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:g-1}),u.length!==0){const C=u[u.length-1];this._pendingGroundEffectLayers.every(P=>P>C.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const x=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let C=0;C<x.length;++C){const P=Object.values(x[C]);n.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let x=u.length-1;x>=0;x--){const C=u[x];if(n.getTileByID(C.key),n.proxyCachedFBO[C.key]!==void 0){const P=t[C.key],O=this.proxyToSource[C.key];let k=0;for(const U in O){const F=O[U],Z=P[U];if(!Z||Z.length!==F.length||F.some((Y,X)=>Y!==Z[X]||p[U]&&p[U].hasOwnProperty(Y.key))){k=-1;break}++k}for(const U in n.proxyCachedFBO[C.key])n.renderCache[n.proxyCachedFBO[C.key][U]].dirty=k<0||k!==Object.values(P).length}}const g=[...this._drapedRenderBatches];g.sort((x,C)=>C.end-C.start-(x.end-x.start));for(const x of g)for(const C of u){if(n.proxyCachedFBO[C.key])continue;let P=n.renderCachePool.pop();P===void 0&&n.renderCache.length<50&&(P=n.renderCache.length,n.renderCache.push(this._createFBO())),P!==void 0&&(n.proxyCachedFBO[C.key]={},n.proxyCachedFBO[C.key][x.start]=P,n.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,x=g.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let C;if(u.isTileClipped())C=n.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):xi.disabled}_renderTileClippingMasks(t,n){const u=this.painter,p=this.painter.context,g=p.gl;u._tileClippingMaskIDs={},p.setColorMode(zi.disabled),p.setDepthMode(Wt.disabled);const x=u.getOrCreateProgram("clippingMask");for(const C of t){const P=u._tileClippingMaskIDs[C.key]=--n;x.draw(u,g.TRIANGLES,Wt.disabled,new xi({func:g.ALWAYS,mask:0},P,255,g.KEEP,g.KEEP,g.REPLACE),zi.disabled,ci.disabled,ic(C.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const u=[t.x,t.y,1,1];s.ad.vec4.transformMat4(u,u,n.pixelMatrixInverse),s.ad.vec4.scale(u,u,1/u[3]),u[0]/=n.worldSize,u[1]/=n.worldSize;const p=n._camera.position,g=s.bH(1,n.center.lat),x=[p[0],p[1],p[2]/g,0],C=s.ad.vec3.subtract([],u.slice(0,3),x);s.ad.vec3.normalize(C,C);const P=this.raycast(x,C,this._exaggeration);return P!==null&&P?(s.ad.vec3.scaleAndAdd(x,x,C,P),x[3]=x[2],x[2]*=g,x):null}_setupProxiedCoordsForOrtho(t,n,u){if(t.getSource()instanceof s.aK)return this._setupProxiedCoordsForImageSource(t,n,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let P=0;P<g.length;P++){const O=g[P],k=this._findTileCoveringTileID(O,t);if(k){const U=this._createProxiedId(O,k,u[O.key]&&u[O.key][t.id]);p.push(U),this.proxyToSource[O.key][t.id]=[U]}}let x=!1;const C=new Set;for(let P=0;P<n.length;P++){const O=t.getTile(n[P]);if(!O||!O.hasData())continue;const k=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==O.tileID.canonical.z){const U=this.proxyToSource[k.tileID.key][t.id],F=this._createProxiedId(k.tileID,O,u[k.tileID.key]&&u[k.tileID.key][t.id]);U?U.splice(U.length-1,0,F):this.proxyToSource[k.tileID.key][t.id]=[F];const Z=this.proxyToSource[k.tileID.key][t.id];C.has(Z)||C.add(Z),p.push(F),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const P of C)P.sort((O,k)=>k.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],g=this.proxyCoords,x=t.getSource(),C=x.tileID;if(!C)return;const P=new s.P(C.x,C.y)._div(1<<C.z),O=x.coordinates.map(s.ac.fromLngLat).reduce((U,F)=>(U.min.x=Math.min(U.min.x,F.x-P.x),U.min.y=Math.min(U.min.y,F.y-P.y),U.max.x=Math.max(U.max.x,F.x-P.x),U.max.y=Math.max(U.max.y,F.y-P.y),U),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(U,F)=>{const Z=U.wrap+U.canonical.x/(1<<U.canonical.z),Y=U.canonical.y/(1<<U.canonical.z),X=s.ai/(1<<U.canonical.z),J=F.wrap+F.canonical.x/(1<<F.canonical.z),ee=F.canonical.y/(1<<F.canonical.z);return Z+X<J+O.min.x||Z>J+O.max.x||Y+X<ee+O.min.y||Y>ee+O.max.y};for(let U=0;U<g.length;U++){const F=g[U];for(let Z=0;Z<n.length;Z++){const Y=t.getTile(n[Z]);if(!Y||!Y.hasData()||k(F,Y.tileID))continue;const X=this._createProxiedId(F,Y,u[F.key]&&u[F.key][t.id]),J=this.proxyToSource[F.key][t.id];J?J.push(X):this.proxyToSource[F.key][t.id]=[X],p.push(X)}}}_createProxiedId(t,n,u){let p=this.orthoMatrix;if(u){const g=u.find(x=>x.key===n.tileID.key);if(g)return g}if(n.tileID.key!==t.key){const g=t.canonical.z-n.tileID.canonical.z;let x,C,P;p=s.ad.mat4.create();const O=n.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(x=s.ai>>g,C=x*((n.tileID.canonical.x<<g)-t.canonical.x+O),P=x*((n.tileID.canonical.y<<g)-t.canonical.y)):(x=s.ai<<-g,C=s.ai*(n.tileID.canonical.x-(t.canonical.x+O<<-g)),P=s.ai*(n.tileID.canonical.y-(t.canonical.y<<-g))),s.ad.mat4.ortho(p,0,x,0,x,0,1),s.ad.mat4.translate(p,p,[C,P,0])}return new br(n.tileID,t.key,p)}_findTileCoveringTileID(t,n){let u=n.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[n.id],g=p[t.key];if(u=g?n.getTileByID(g):null,u&&u.hasData()||g===null)return u;let x=u?u.tileID:t,C=x.overscaledZ;const P=n.getSource().minzoom,O=[];if(!g){const U=n.getSource().maxzoom;if(t.canonical.z>=U){const F=t.canonical.z-U;n.getSource().reparseOverscaled?(C=Math.max(t.canonical.z+2,n.transform.tileZoom),x=new s.aH(C,t.wrap,U,t.canonical.x>>F,t.canonical.y>>F)):F!==0&&(C=U,x=new s.aH(C,t.wrap,U,t.canonical.x>>F,t.canonical.y>>F))}x.key!==t.key&&(O.push(x.key),u=n.getTile(x))}const k=U=>{O.forEach(F=>{p[F]=U}),O.length=0};for(C-=1;C>=P&&(!u||!u.hasData());C--){u&&k(u.tileID.key);const U=x.calculateScaledKey(C);if(u=n.getTileByID(U),u&&u.hasData())break;const F=p[U];if(F===null)break;F===void 0?O.push(U):u=n.getTileByID(F)}return k(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[n.key]=!0}}function eu(h,t,n){const u=function(C,P,O){const k=s.ad.vec3.dot(P,C),U=s.ad.vec3.dot(O,[.2126,.7152,.0722]),F=(Y,X,J)=>(1-J)*Y+J*X,Z=F(1-.3*Math.min(U,1),1,Math.min(k+1,1));return F(.92,1,Math.asin(s.ay(P[2],-1,1))/Math.PI+.5)*Z}(h,[0,0,1],t),p=[0,0,0];s.ad.vec3.scale(p,n.slice(0,3),u);const g=[0,0,0];s.ad.vec3.scale(g,t.slice(0,3),h[2]);const x=[0,0,0];return s.ad.vec3.add(x,p,g),s.cg(x)}const Io=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],xf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class nc{static cacheKey(t,n,u,p){let g=`${n}${p?p.cacheKey:""}`;for(const x of u)t.usedDefines.includes(x)&&(g+=`/${x}`);return g}constructor(t,n,u,p,g,x){const C=t.gl;this.program=C.createProgram(),this.configuration=p,this.name=n,this.fixedDefines=[...x];const P=p?p.getBinderAttributes():[],O=(u.staticAttributes||[]).concat(P);let k=p?p.defines():[];k=k.concat(x.map(J=>`#define ${J}`));const U=`#version 300 es
`;let F=U+k.concat("precision mediump float;",Yl,Yc.fragmentSource).join(`
`);for(const J of u.fragmentIncludes)F+=`
${fa[J]}`;F+=`
${u.fragmentSource}`;let Z=U+k.concat("precision highp float;",Yl,Yc.vertexSource).join(`
`);for(const J of u.vertexIncludes)Z+=`
${fa[J]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Z+=`
uniform int u_instanceID;
`),Z+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Z=Z.replaceAll("gl_InstanceID","u_instanceID"));const Y=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Y,F),C.compileShader(Y),C.attachShader(this.program,Y);const X=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(X,Z),C.compileShader(X),C.attachShader(this.program,X),this.attributes={},this.numAttributes=O.length;for(let J=0;J<this.numAttributes;J++)if(O[J]){const ee=O[J].startsWith("a_")?O[J]:`a_${O[J]}`;C.bindAttribLocation(this.program,J,ee),this.attributes[ee]=J}C.linkProgram(this.program),C.deleteShader(X),C.deleteShader(Y),this.fixedUniforms=g(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(J=>({u_instanceID:new s.bN(J)}))(t)),(x.includes("TERRAIN")||n.indexOf("symbol")!==-1||n.indexOf("circle")!==-1)&&(this.terrainUniforms=(J=>({u_dem:new s.bN(J),u_dem_prev:new s.bN(J),u_dem_tl:new s.bK(J),u_dem_scale:new s.bM(J),u_dem_tl_prev:new s.bK(J),u_dem_scale_prev:new s.bM(J),u_dem_size:new s.bM(J),u_dem_lerp:new s.bM(J),u_exaggeration:new s.bM(J),u_depth:new s.bN(J),u_depth_size_inv:new s.bK(J),u_depth_range_unpack:new s.bK(J),u_occluder_half_size:new s.bM(J),u_occlusion_depth_offset:new s.bM(J),u_meter_to_dem:new s.bM(J),u_label_plane_matrix_inv:new s.bJ(J)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new s.bL(J),u_tile_tr_up:new s.bL(J),u_tile_br_up:new s.bL(J),u_tile_bl_up:new s.bL(J),u_tile_up_scale:new s.bM(J)}))(t)),x.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new s.bJ(J),u_fog_range:new s.bK(J),u_fog_color:new s.cb(J),u_fog_horizon_blend:new s.bM(J),u_fog_vertical_limit:new s.bK(J),u_fog_temporal_offset:new s.bM(J),u_frustum_tl:new s.bL(J),u_frustum_tr:new s.bL(J),u_frustum_br:new s.bL(J),u_frustum_bl:new s.bL(J),u_globe_pos:new s.bL(J),u_globe_radius:new s.bM(J),u_globe_transition:new s.bM(J),u_is_globe:new s.bN(J),u_viewport:new s.bK(J)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new s.cb(J)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new s.bL(J),u_lighting_directional_dir:new s.bL(J),u_lighting_directional_color:new s.bL(J),u_ground_radiance:new s.bL(J)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new s.bJ(J),u_light_matrix_1:new s.bJ(J),u_fade_range:new s.bK(J),u_shadow_normal_offset:new s.bL(J),u_shadow_intensity:new s.bM(J),u_shadow_texel_size:new s.bM(J),u_shadow_map_resolution:new s.bM(J),u_shadow_direction:new s.bL(J),u_shadow_bias:new s.bL(J),u_shadowmap_0:new s.bN(J),u_shadowmap_1:new s.bN(J)}))(t))}}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p]&&u[p].set(this.program,p,n[p])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p]&&u[p].set(this.program,p,n[p])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in n)u[p].set(this.program,p,n[p])}_drawDebugWireframe(t,n,u,p,g,x,C,P,O,k){const U=t.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const F=t.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||t._terrain&&t._terrain.renderingToTexture||!Io.includes(this.name))||!(!U.layers3D||!xf.includes(this.name))))return;const Z=F.gl,Y=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,g,F);if(!Y)return;const X=[...this.fixedDefines];X.push("DEBUG_WIREFRAME");const J=t.getOrCreateProgram(this.name,{config:this.configuration,defines:X});F.program.set(J.program);const ee=(ce,xe,_e)=>{if(xe[ce]&&_e[ce])for(const ge in xe[ce])_e[ce][ge]&&_e[ce][ge].set(_e.program,ge,xe[ce][ge].current)};O&&O.setUniforms(J.program,F,J.binderUniforms,C,{zoom:P}),ee("fixedUniforms",this,J),ee("terrainUniforms",this,J),ee("globeUniforms",this,J),ee("fogUniforms",this,J),ee("lightsUniforms",this,J),ee("shadowUniforms",this,J),Y.bind(),F.setColorMode(new zi([Z.ONE,Z.ONE_MINUS_SRC_ALPHA,Z.ZERO,Z.ONE],s.al.transparent,[!0,!0,!0,!1])),F.setDepthMode(new Wt(n.func===Z.LESS?Z.LEQUAL:n.func,Wt.ReadOnly,n.range)),F.setStencilMode(xi.disabled);const oe=3*x.primitiveLength*2,fe=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=k||1;for(let xe=0;xe<ce;++xe)J.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",xe),Z.drawElements(Z.LINES,oe,Z.UNSIGNED_SHORT,fe)}else k&&k>1?Z.drawElementsInstanced(Z.LINES,oe,Z.UNSIGNED_SHORT,fe,k):Z.drawElements(Z.LINES,oe,Z.UNSIGNED_SHORT,fe);g.bind(),F.program.set(this.program),F.setDepthMode(n),F.setStencilMode(u),F.setColorMode(p)}checkUniforms(t,n,u){if(this.fixedDefines.includes(n)){for(const p of Object.keys(u))if(!u[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${n} being defined`)}}draw(t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X,J){const ee=t.context,oe=ee.gl;if(this.failedToCreate)return;ee.program.set(this.program),ee.setDepthMode(u),ee.setStencilMode(p),ee.setColorMode(g),ee.setCullFace(x);for(const xe of Object.keys(this.fixedUniforms))this.fixedUniforms[xe].set(this.program,xe,C[xe]);Y&&Y.setUniforms(this.program,ee,this.binderUniforms,F,{zoom:Z});const fe={[oe.POINTS]:1,[oe.LINES]:2,[oe.TRIANGLES]:3,[oe.LINE_STRIP]:1}[n];this.checkUniforms(P,"RENDER_SHADOWS",this.shadowUniforms);const ce=J&&J>0?1:void 0;for(const xe of U.get()){const _e=xe.vaos||(xe.vaos={});if((_e[P]||(_e[P]=new Wu)).bind(ee,this,O,Y?Y.getPaintVertexBuffers():[],k,xe.vertexOffset,X||[],ce),this.forceManualRenderingForInstanceIDShaders){const ge=J||1;for(let ye=0;ye<ge;++ye)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),k?oe.drawElements(n,xe.primitiveLength*fe,oe.UNSIGNED_SHORT,xe.primitiveOffset*fe*2):oe.drawArrays(n,xe.vertexOffset,xe.vertexLength)}else J&&J>1?oe.drawElementsInstanced(n,xe.primitiveLength*fe,oe.UNSIGNED_SHORT,xe.primitiveOffset*fe*2,J):k?oe.drawElements(n,xe.primitiveLength*fe,oe.UNSIGNED_SHORT,xe.primitiveOffset*fe*2):oe.drawArrays(n,xe.vertexOffset,xe.vertexLength);n===oe.TRIANGLES&&k&&this._drawDebugWireframe(t,u,p,g,k,xe,F,Z,Y,J)}}}function al(h,t){const n=Math.pow(2,t.tileID.overscaledZ),u=t.tileSize*Math.pow(2,h.transform.tileZoom)/n,p=u*(t.tileID.canonical.x+t.tileID.wrap*n),g=u*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.at(t,1,h.transform.tileZoom),u_pixel_coord_upper:[p>>16,g>>16],u_pixel_coord_lower:[65535&p,65535&g]}}const ed={terrain:0,flat:1},td=s.ad.mat4.create(),id=(h,t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X,J,ee)=>{const oe=t.style.light,fe=oe.properties.get("position"),ce=[fe.x,fe.y,fe.z],xe=s.ad.mat3.create();oe.properties.get("anchor")==="viewport"&&(s.ad.mat3.fromRotation(xe,-t.transform.angle),s.ad.vec3.transformMat3(ce,ce,xe));const _e=oe.properties.get("color"),ge=t.transform,ye={u_matrix:h,u_lightpos:ce,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+n,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:td,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:ed[O],u_base_type:ed[k],u_ao:p,u_edge_radius:g,u_width_scale:x,u_flood_light_color:Y,u_vertical_scale:X,u_flood_light_intensity:J,u_ground_shadow_factor:ee};return ge.projection.name==="globe"&&(ye.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],ye.u_zoom_transition=U,ye.u_inv_rot_matrix=Z,ye.u_merc_center=F,ye.u_up_dir=ge.projection.upVector(new s.bT(0,0,0),F[0]*s.ai,F[1]*s.ai),ye.u_height_lift=P),ye},rc=(h,t,n,u,p,g)=>({u_matrix:h,u_edge_radius:t,u_width_scale:n,u_vertical_scale:u,u_height_type:ed[p],u_base_type:ed[g]}),Co=(h,t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X,J)=>{const ee=id(h,t,n,u,p,g,x,C,O,k,U,F,Z,Y,X,J,1,[0,0,0]),oe={u_height_factor:-Math.pow(2,C.overscaledZ)/P.tileSize/8};return s.l(ee,al(t,P),oe)},ol=(h,t)=>({u_matrix:h,u_emissive_strength:t}),tu=(h,t,n,u)=>s.l(ol(h,t),al(n,u)),rh=(h,t,n)=>({u_matrix:h,u_world:n,u_emissive_strength:t}),ll=(h,t,n,u,p)=>s.l(tu(h,t,n,u),{u_world:p}),iu=(h,t,n,u,p)=>({u_matrix:h,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:n,u_height_scale:u,u_reset_depth:p}),sh=(h,t,n,u)=>{const p=s.ai/n.tileSize;return{u_matrix:h,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},nd=(h,t,n=1)=>({u_matrix:h,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:n}),sc=s.ad.mat4.create(),ac=(h,t,n,u,p,g,x)=>{const C=h.transform,P=C.projection.name==="globe",O=P?s.cO(C.zoom,t.canonical)*C._pixelsPerMercatorPixel:s.at(n,1,g),k={u_matrix:t.projMatrix,u_extrude_scale:O,u_intensity:x,u_inv_rot_matrix:sc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){k.u_inv_rot_matrix=u,k.u_merc_center=p,k.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],k.u_zoom_transition=s.ag(C.zoom);const U=p[0]*s.ai,F=p[1]*s.ai;k.u_up_dir=C.projection.upVector(new s.bT(0,0,0),U,F)}return k};function Ot(h,[t,n,u,p],[g,x]){if(g===x)return[0,0,0,0];const C=255*(h-1)/(h*(x-g));return[t*C,n*C,u*C,p*C]}function oc(h,t,[n,u]){return n===u?0:.5/h+(t-n)*(h-1)/(h*(u-n))}const rd=(h,t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X,J,ee,oe,fe,ce)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:g,u_scale_parent:O,u_fade_t:k.mix,u_opacity:k.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:s.cP(U.paint.get("raster-saturation")),u_contrast_factor:s.cQ(U.paint.get("raster-contrast")),u_spin_weights:Ro(U.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:Z,u_zoom_transition:x,u_merc_center:C,u_cutoff_params:P,u_colorization_mix:Ot(s.cR,X,ee),u_colorization_offset:oc(s.cR,J,ee),u_color_ramp:Y,u_texture_offset:[fe/(oe+2*fe),oe/(oe+2*fe)],u_texture_res:[oe+2*fe,oe+2*fe],u_emissive_strength:ce});function Ro(h){h*=Math.PI/180;const t=Math.sin(h),n=Math.cos(h);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Nr=.05,Yt=(h,t,n,u,p,g,x,C,P,O,k,U)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:g,u_scale_parent:O,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:x,u_merc_center:C,u_cutoff_params:P}),ah=(h,t,n,u,p,g,x,C,P,O)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:u,u_color_ramp:g,u_velocity_res:p,u_max_speed:x,u_uv_offset:C,u_data_scale:[255*P[0],255*P[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[Nr,Nr]}),cl=(h,t,n,u,p,g,x,C,P,O)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:u,u_max_speed:p,u_speed_factor:g,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*P[0],255*P[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[Nr,Nr]}),Do=s.ad.mat4.create(),ul=(h,t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X,J,ee,oe,fe,ce,xe)=>{const _e=p.transform,ge={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:_e.getCameraToCenterDistance(oe),u_rotate_symbol:+n,u_aspect_ratio:_e.width/_e.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:C,u_is_text:+O,u_elevation_from_sea:P?1:0,u_pitch_with_map:+u,u_texsize:k,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Do,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Do,u_up_vector:[0,-1,0],u_color_adj_mat:fe,u_icon_transition:ce||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(oe)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:1,u_scale_factor:xe||1};return oe.name==="globe"&&(ge.u_tile_id=[Z.canonical.x,Z.canonical.y,1<<Z.canonical.z],ge.u_zoom_transition=Y,ge.u_inv_rot_matrix=J,ge.u_merc_center=X,ge.u_camera_forward=_e._camera.forward(),ge.u_ecef_origin=s.cS(_e.globeMatrix,Z.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(_e.globeMatrix),ge.u_up_vector=ee),ge},oh=(h,t,n,u)=>({u_matrix:h,u_emissive_strength:t,u_opacity:n,u_color:u}),sd=(h,t,n,u,p,g,x,C,P)=>s.l(function(O,k,U,F,Z,Y){const{width:X,height:J}=F.imageManager.getPixelSize(k),ee=Math.pow(2,Y.tileID.overscaledZ),oe=Y.tileSize*Math.pow(2,F.transform.tileZoom)/ee,fe=oe*(Y.tileID.canonical.x+Y.tileID.wrap*ee),ce=oe*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[X,J],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:Z?[F.transform.width,-1*F.transform.height]:[1/s.at(Y,1,F.transform.tileZoom),1/s.at(Y,1,F.transform.tileZoom)],u_pixel_coord_upper:[fe>>16,ce>>16],u_pixel_coord_lower:[65535&fe,65535&ce]}}(0,g,x,u,C,P),{u_matrix:h,u_emissive_strength:t,u_opacity:n}),hl=new Float32Array(s.ad.mat4.identity([])),lc=(h,t,n,u,p,g,x,C,P,O,k,U,F,Z=[0,0,0],Y)=>{const X=p.style.light,J=X.properties.get("position"),ee=[-J.x,-J.y,J.z],oe=s.ad.mat3.create();X.properties.get("anchor")==="viewport"&&(s.ad.mat3.fromRotation(oe,-p.transform.angle),s.ad.vec3.transformMat3(ee,ee,oe));const fe=k.alphaMode==="MASK",ce=X.properties.get("color").toRenderColor(null),xe=F.paint.get("model-ambient-occlusion-intensity"),_e=F.paint.get("model-color").constantOr(s.al.white).toRenderColor(null),ge=F.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:n,u_node_matrix:u||hl,u_lightpos:ee,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:Z,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+fe,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[C[0],C[1],C[2],1],u_metallicFactor:P,u_roughnessFactor:O,u_baseColorTexture:Zn.BaseColor,u_metallicRoughnessTexture:Zn.MetallicRoughness,u_normalTexture:Zn.Normal,u_occlusionTexture:Zn.Occlusion,u_emissionTexture:Zn.Emission,u_lutTexture:Zn.LUT,u_color_mix:[_e.r,_e.g,_e.b,ge],u_aoIntensity:xe,u_emissive_strength:U,u_occlusionTextureTransform:Y||[0,0,0,0]}},bf=(h,t=hl,n=hl)=>({u_matrix:h,u_instance:t,u_node_matrix:n}),ad={fillExtrusion:h=>({u_matrix:new s.bJ(h),u_lightpos:new s.bL(h),u_lightintensity:new s.bM(h),u_lightcolor:new s.bL(h),u_vertical_gradient:new s.bM(h),u_opacity:new s.bM(h),u_edge_radius:new s.bM(h),u_width_scale:new s.bM(h),u_ao:new s.bK(h),u_height_type:new s.bN(h),u_base_type:new s.bN(h),u_tile_id:new s.bL(h),u_zoom_transition:new s.bM(h),u_inv_rot_matrix:new s.bJ(h),u_merc_center:new s.bK(h),u_up_dir:new s.bL(h),u_height_lift:new s.bM(h),u_flood_light_color:new s.bL(h),u_vertical_scale:new s.bM(h),u_flood_light_intensity:new s.bM(h),u_ground_shadow_factor:new s.bL(h)}),fillExtrusionDepth:h=>({u_matrix:new s.bJ(h),u_edge_radius:new s.bM(h),u_width_scale:new s.bM(h),u_vertical_scale:new s.bM(h),u_height_type:new s.bN(h),u_base_type:new s.bN(h)}),fillExtrusionPattern:h=>({u_matrix:new s.bJ(h),u_lightpos:new s.bL(h),u_lightintensity:new s.bM(h),u_lightcolor:new s.bL(h),u_vertical_gradient:new s.bM(h),u_height_factor:new s.bM(h),u_edge_radius:new s.bM(h),u_width_scale:new s.bM(h),u_ao:new s.bK(h),u_height_type:new s.bN(h),u_base_type:new s.bN(h),u_tile_id:new s.bL(h),u_zoom_transition:new s.bM(h),u_inv_rot_matrix:new s.bJ(h),u_merc_center:new s.bK(h),u_up_dir:new s.bL(h),u_height_lift:new s.bM(h),u_image:new s.bN(h),u_texsize:new s.bK(h),u_pixel_coord_upper:new s.bK(h),u_pixel_coord_lower:new s.bK(h),u_tile_units_to_pixels:new s.bM(h),u_opacity:new s.bM(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new s.bJ(h),u_opacity:new s.bM(h),u_ao_pass:new s.bM(h),u_meter_to_tile:new s.bM(h),u_ao:new s.bK(h),u_flood_light_intensity:new s.bM(h),u_flood_light_color:new s.bL(h),u_attenuation:new s.bM(h),u_edge_radius:new s.bM(h),u_fb:new s.bN(h),u_fb_size:new s.bM(h),u_dynamic_offset:new s.bM(h)}),fill:h=>({u_matrix:new s.bJ(h),u_emissive_strength:new s.bM(h)}),fillPattern:h=>({u_matrix:new s.bJ(h),u_emissive_strength:new s.bM(h),u_image:new s.bN(h),u_texsize:new s.bK(h),u_pixel_coord_upper:new s.bK(h),u_pixel_coord_lower:new s.bK(h),u_tile_units_to_pixels:new s.bM(h)}),fillOutline:h=>({u_matrix:new s.bJ(h),u_emissive_strength:new s.bM(h),u_world:new s.bK(h)}),fillOutlinePattern:h=>({u_matrix:new s.bJ(h),u_emissive_strength:new s.bM(h),u_world:new s.bK(h),u_image:new s.bN(h),u_texsize:new s.bK(h),u_pixel_coord_upper:new s.bK(h),u_pixel_coord_lower:new s.bK(h),u_tile_units_to_pixels:new s.bM(h)}),elevatedStructures:h=>({u_matrix:new s.bJ(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new s.bJ(h),u_camera_pos:new s.bL(h),u_depth_bias:new s.bM(h),u_height_scale:new s.bM(h),u_reset_depth:new s.bM(h)}),circle:s.cT,collisionBox:h=>({u_matrix:new s.bJ(h),u_camera_to_center_distance:new s.bM(h),u_extrude_scale:new s.bK(h)}),collisionCircle:h=>({u_matrix:new s.bJ(h),u_inv_matrix:new s.bJ(h),u_camera_to_center_distance:new s.bM(h),u_viewport_size:new s.bK(h)}),debug:h=>({u_color:new s.cA(h),u_matrix:new s.bJ(h),u_overlay:new s.bN(h),u_overlay_scale:new s.bM(h)}),clippingMask:h=>({u_matrix:new s.bJ(h)}),heatmap:h=>({u_extrude_scale:new s.bM(h),u_intensity:new s.bM(h),u_matrix:new s.bJ(h),u_inv_rot_matrix:new s.bJ(h),u_merc_center:new s.bK(h),u_tile_id:new s.bL(h),u_zoom_transition:new s.bM(h),u_up_dir:new s.bL(h)}),heatmapTexture:h=>({u_image:new s.bN(h),u_color_ramp:new s.bN(h),u_opacity:new s.bM(h)}),hillshade:h=>({u_matrix:new s.bJ(h),u_image:new s.bN(h),u_latrange:new s.bK(h),u_light:new s.bK(h),u_shadow:new s.cA(h),u_highlight:new s.cA(h),u_emissive_strength:new s.bM(h),u_accent:new s.cA(h)}),hillshadePrepare:h=>({u_matrix:new s.bJ(h),u_image:new s.bN(h),u_dimension:new s.bK(h),u_zoom:new s.bM(h)}),line:s.cU,linePattern:s.cV,raster:h=>({u_matrix:new s.bJ(h),u_normalize_matrix:new s.bJ(h),u_globe_matrix:new s.bJ(h),u_merc_matrix:new s.bJ(h),u_grid_matrix:new s.cB(h),u_tl_parent:new s.bK(h),u_scale_parent:new s.bM(h),u_fade_t:new s.bM(h),u_opacity:new s.bM(h),u_image0:new s.bN(h),u_image1:new s.bN(h),u_brightness_low:new s.bM(h),u_brightness_high:new s.bM(h),u_saturation_factor:new s.bM(h),u_contrast_factor:new s.bM(h),u_spin_weights:new s.bL(h),u_perspective_transform:new s.bK(h),u_raster_elevation:new s.bM(h),u_zoom_transition:new s.bM(h),u_merc_center:new s.bK(h),u_cutoff_params:new s.cb(h),u_colorization_mix:new s.cb(h),u_colorization_offset:new s.bM(h),u_color_ramp:new s.bN(h),u_texture_offset:new s.bK(h),u_texture_res:new s.bK(h),u_emissive_strength:new s.bM(h)}),rasterParticle:h=>({u_matrix:new s.bJ(h),u_normalize_matrix:new s.bJ(h),u_globe_matrix:new s.bJ(h),u_merc_matrix:new s.bJ(h),u_grid_matrix:new s.cB(h),u_tl_parent:new s.bK(h),u_scale_parent:new s.bM(h),u_fade_t:new s.bM(h),u_opacity:new s.bM(h),u_image0:new s.bN(h),u_image1:new s.bN(h),u_raster_elevation:new s.bM(h),u_zoom_transition:new s.bM(h),u_merc_center:new s.bK(h),u_cutoff_params:new s.cb(h)}),rasterParticleTexture:h=>({u_texture:new s.bN(h),u_opacity:new s.bM(h)}),rasterParticleDraw:h=>({u_particle_texture:new s.bN(h),u_particle_texture_side_len:new s.bM(h),u_tile_offset:new s.bK(h),u_velocity:new s.bN(h),u_color_ramp:new s.bN(h),u_velocity_res:new s.bK(h),u_max_speed:new s.bM(h),u_uv_offset:new s.bK(h),u_data_scale:new s.bK(h),u_data_offset:new s.bM(h),u_particle_pos_scale:new s.bM(h),u_particle_pos_offset:new s.bK(h)}),rasterParticleUpdate:h=>({u_particle_texture:new s.bN(h),u_particle_texture_side_len:new s.bM(h),u_velocity:new s.bN(h),u_velocity_res:new s.bK(h),u_max_speed:new s.bM(h),u_speed_factor:new s.bM(h),u_reset_rate:new s.bM(h),u_rand_seed:new s.bM(h),u_uv_offset:new s.bK(h),u_data_scale:new s.bK(h),u_data_offset:new s.bM(h),u_particle_pos_scale:new s.bM(h),u_particle_pos_offset:new s.bK(h)}),symbol:h=>({u_is_size_zoom_constant:new s.bN(h),u_is_size_feature_constant:new s.bN(h),u_size_t:new s.bM(h),u_size:new s.bM(h),u_camera_to_center_distance:new s.bM(h),u_rotate_symbol:new s.bN(h),u_aspect_ratio:new s.bM(h),u_fade_change:new s.bM(h),u_matrix:new s.bJ(h),u_label_plane_matrix:new s.bJ(h),u_coord_matrix:new s.bJ(h),u_is_text:new s.bN(h),u_elevation_from_sea:new s.bN(h),u_pitch_with_map:new s.bN(h),u_texsize:new s.bK(h),u_texsize_icon:new s.bK(h),u_texture:new s.bN(h),u_texture_icon:new s.bN(h),u_gamma_scale:new s.bM(h),u_device_pixel_ratio:new s.bM(h),u_tile_id:new s.bL(h),u_zoom_transition:new s.bM(h),u_inv_rot_matrix:new s.bJ(h),u_merc_center:new s.bK(h),u_camera_forward:new s.bL(h),u_tile_matrix:new s.bJ(h),u_up_vector:new s.bL(h),u_ecef_origin:new s.bL(h),u_is_halo:new s.bN(h),u_icon_transition:new s.bM(h),u_color_adj_mat:new s.bJ(h),u_scale_factor:new s.bM(h)}),background:h=>({u_matrix:new s.bJ(h),u_emissive_strength:new s.bM(h),u_opacity:new s.bM(h),u_color:new s.cA(h)}),backgroundPattern:h=>({u_matrix:new s.bJ(h),u_emissive_strength:new s.bM(h),u_opacity:new s.bM(h),u_image:new s.bN(h),u_pattern_tl:new s.bK(h),u_pattern_br:new s.bK(h),u_texsize:new s.bK(h),u_pattern_size:new s.bK(h),u_pixel_coord_upper:new s.bK(h),u_pixel_coord_lower:new s.bK(h),u_pattern_units_to_pixels:new s.bK(h)}),terrainRaster:h=>({u_matrix:new s.bJ(h),u_image0:new s.bN(h),u_skirt_height:new s.bM(h),u_ground_shadow_factor:new s.bL(h)}),skybox:h=>({u_matrix:new s.bJ(h),u_sun_direction:new s.bL(h),u_cubemap:new s.bN(h),u_opacity:new s.bM(h),u_temporal_offset:new s.bM(h)}),skyboxGradient:h=>({u_matrix:new s.bJ(h),u_color_ramp:new s.bN(h),u_center_direction:new s.bL(h),u_radius:new s.bM(h),u_opacity:new s.bM(h),u_temporal_offset:new s.bM(h)}),skyboxCapture:h=>({u_matrix_3f:new s.cB(h),u_sun_direction:new s.bL(h),u_sun_intensity:new s.bM(h),u_color_tint_r:new s.cb(h),u_color_tint_m:new s.cb(h),u_luminance:new s.bM(h)}),globeRaster:h=>({u_proj_matrix:new s.bJ(h),u_globe_matrix:new s.bJ(h),u_normalize_matrix:new s.bJ(h),u_merc_matrix:new s.bJ(h),u_zoom_transition:new s.bM(h),u_merc_center:new s.bK(h),u_image0:new s.bN(h),u_grid_matrix:new s.cB(h),u_skirt_height:new s.bM(h),u_far_z_cutoff:new s.bM(h),u_frustum_tl:new s.bL(h),u_frustum_tr:new s.bL(h),u_frustum_br:new s.bL(h),u_frustum_bl:new s.bL(h),u_globe_pos:new s.bL(h),u_globe_radius:new s.bM(h),u_viewport:new s.bK(h)}),globeAtmosphere:h=>({u_frustum_tl:new s.bL(h),u_frustum_tr:new s.bL(h),u_frustum_br:new s.bL(h),u_frustum_bl:new s.bL(h),u_horizon:new s.bM(h),u_transition:new s.bM(h),u_fadeout_range:new s.bM(h),u_color:new s.cb(h),u_high_color:new s.cb(h),u_space_color:new s.cb(h),u_temporal_offset:new s.bM(h),u_horizon_angle:new s.bM(h)}),model:h=>({u_matrix:new s.bJ(h),u_lighting_matrix:new s.bJ(h),u_normal_matrix:new s.bJ(h),u_node_matrix:new s.bJ(h),u_lightpos:new s.bL(h),u_lightintensity:new s.bM(h),u_lightcolor:new s.bL(h),u_camera_pos:new s.bL(h),u_opacity:new s.bM(h),u_baseColorFactor:new s.cb(h),u_emissiveFactor:new s.cb(h),u_metallicFactor:new s.bM(h),u_roughnessFactor:new s.bM(h),u_baseTextureIsAlpha:new s.bN(h),u_alphaMask:new s.bN(h),u_alphaCutoff:new s.bM(h),u_baseColorTexture:new s.bN(h),u_metallicRoughnessTexture:new s.bN(h),u_normalTexture:new s.bN(h),u_occlusionTexture:new s.bN(h),u_emissionTexture:new s.bN(h),u_lutTexture:new s.bN(h),u_color_mix:new s.cb(h),u_aoIntensity:new s.bM(h),u_emissive_strength:new s.bM(h),u_occlusionTextureTransform:new s.cb(h)}),modelDepth:h=>({u_matrix:new s.bJ(h),u_instance:new s.bJ(h),u_node_matrix:new s.bJ(h)}),groundShadow:h=>({u_matrix:new s.bJ(h),u_ground_shadow_factor:new s.bL(h)}),stars:h=>({u_matrix:new s.bJ(h),u_up:new s.bL(h),u_right:new s.bL(h),u_intensity_multiplier:new s.bM(h)}),snowParticle:h=>({u_modelview:new s.bJ(h),u_projection:new s.bJ(h),u_time:new s.bM(h),u_cam_pos:new s.bL(h),u_velocityConeAperture:new s.bM(h),u_velocity:new s.bM(h),u_horizontalOscillationRadius:new s.bM(h),u_horizontalOscillationRate:new s.bM(h),u_boxSize:new s.bM(h),u_billboardSize:new s.bM(h),u_simpleShapeParameters:new s.bK(h),u_screenSize:new s.bK(h),u_thinningCenterPos:new s.bK(h),u_thinningShape:new s.bL(h),u_thinningAffectedRatio:new s.bM(h),u_thinningParticleOffset:new s.bM(h),u_particleColor:new s.cb(h),u_direction:new s.bL(h)}),rainParticle:h=>({u_modelview:new s.bJ(h),u_projection:new s.bJ(h),u_time:new s.bM(h),u_cam_pos:new s.bL(h),u_texScreen:new s.bN(h),u_velocityConeAperture:new s.bM(h),u_velocity:new s.bM(h),u_boxSize:new s.bM(h),u_rainDropletSize:new s.bK(h),u_distortionStrength:new s.bM(h),u_rainDirection:new s.bL(h),u_color:new s.cb(h),u_screenSize:new s.bK(h),u_thinningCenterPos:new s.bK(h),u_thinningShape:new s.bL(h),u_thinningAffectedRatio:new s.bM(h),u_thinningParticleOffset:new s.bM(h),u_shapeDirectionalPower:new s.bM(h),u_shapeNormalPower:new s.bM(h),u_mode:new s.bM(h)}),vignette:h=>({u_vignetteShape:new s.bL(h),u_vignetteColor:new s.cb(h)}),occlusion:h=>({u_matrix:new s.bJ(h),u_anchorPos:new s.bL(h),u_screenSizePx:new s.bK(h),u_occluderSizePx:new s.bK(h),u_color:new s.cb(h)})};class Ps{constructor(t,n,u,p){this.id=Ps.uniqueIdxCounter,Ps.uniqueIdxCounter++,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||p||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Ps.uniqueIdxCounter,Ps.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ps.uniqueIdxCounter=0;const nu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class od{constructor(t,n,u,p,g,x){this.length=n.length,this.attributes=u,this.itemSize=n.bytesPerElement,this.dynamicDraw=p,this.instanceCount=x,this.context=t;const C=t.gl;this.buffer=C.createBuffer(),t.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||g||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let u=0;u<this.attributes.length;u++){const p=n.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,n,u){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],x=n.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[nu[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,n,u){for(let p=0;p<this.attributes.length;p++){const g=n.attributes[this.attributes[p].name];g!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(g,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ls{constructor(t,n,u,p,g){this.context=t,this.width=n,this.height=u;const x=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new Ao(t,x)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new La(t,x):new ta(t,x))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class so{constructor(t,n){this.gl=t,this.clearColor=new Ep(this),this.clearDepth=new Jc(this),this.clearStencil=new Eo(this),this.colorMask=new Yu(this),this.depthMask=new Ku(this),this.stencilMask=new Ql(this),this.stencilFunc=new ec(this),this.stencilOp=new Xh(this),this.stencilTest=new rl(this),this.depthRange=new ys(this),this.depthTest=new ea(this),this.depthFunc=new Hr(this),this.blend=new Pa(this),this.blendFunc=new pa(this),this.blendColor=new io(this),this.blendEquation=new Wh(this),this.cullFace=new Ju(this),this.cullFaceSide=new Qu(this),this.frontFace=new es(this),this.program=new ur(this),this.activeTexture=new On(this),this.viewport=new no(this),this.bindFramebuffer=new Oa(this),this.bindRenderbuffer=new Yh(this),this.bindTexture=new ma(this),this.bindVertexBuffer=new Ap(this),this.bindElementBuffer=new Mp(this),this.bindVertexArrayOES=new eh(this),this.pixelStoreUnpack=new th(this),this.pixelStoreUnpackPremultiplyAlpha=new Ip(this),this.pixelStoreUnpackFlipY=new ih(this),this.options=n?Object.assign({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=n&&!!n.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,u){return new Ps(this,t,n,u)}createVertexBuffer(t,n,u,p,g){return new od(this,t,n,u,p,g)}createRenderbuffer(t,n,u){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,t,n,u),this.bindRenderbuffer.set(null),g}createFramebuffer(t,n,u,p){return new ls(this,t,n,u,p)}clear({color:t,depth:n,stencil:u,colorMask:p}){const g=this.gl;let x=0;t&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(p||[!0,!0,!0,!0])),n!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),u!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),g.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bn(t.blendFunction,zi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let _a;function _n(h,t,n,u,p,g,x){const C=h.context,P=C.gl,O=h.transform,k=h.getOrCreateProgram("collisionBox"),U=[];let F=0,Z=0;for(let ce=0;ce<u.length;ce++){const xe=u[ce],_e=t.getTile(xe),ge=_e.getBucket(n);if(!ge)continue;const ye=ff(xe,ge,O);let we=ye;p[0]===0&&p[1]===0||(we=h.translatePosMatrix(ye,_e,p,g));const Ae=x?ge.textCollisionBox:ge.iconCollisionBox,je=ge.collisionCircleArray;if(je.length>0){const Be=s.ad.mat4.create(),Qe=we;s.ad.mat4.mul(Be,ge.placementInvProjMatrix,O.glCoordMatrix),s.ad.mat4.mul(Be,Be,ge.placementViewportMatrix),U.push({circleArray:je,circleOffset:Z,transform:Qe,invTransform:Be,projection:ge.getProjection()}),F+=je.length/4,Z=F}Ae&&(h.terrain&&h.terrain.setupElevationDraw(_e,k),k.draw(h,P.LINES,Wt.disabled,xi.disabled,h.colorModeForRenderPass(),ci.disabled,sh(we,O,_e,ge.getProjection()),n.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,O.zoom,null,[Ae.collisionVertexBuffer,Ae.collisionVertexBufferExt]))}if(!x||!U.length)return;const Y=h.getOrCreateProgram("collisionCircle"),X=new s.cW;X.resize(4*F),X._trim();let J=0;for(const ce of U)for(let xe=0;xe<ce.circleArray.length/4;xe++){const _e=4*xe,ge=ce.circleArray[_e+0],ye=ce.circleArray[_e+1],we=ce.circleArray[_e+2],Ae=ce.circleArray[_e+3];X.emplace(J++,ge,ye,we,Ae,0),X.emplace(J++,ge,ye,we,Ae,1),X.emplace(J++,ge,ye,we,Ae,2),X.emplace(J++,ge,ye,we,Ae,3)}(!_a||_a.length<2*F)&&(_a=function(ce){const xe=2*ce,_e=new s.aV;_e.resize(xe),_e._trim();for(let ge=0;ge<xe;ge++){const ye=6*ge;_e.uint16[ye+0]=4*ge+0,_e.uint16[ye+1]=4*ge+1,_e.uint16[ye+2]=4*ge+2,_e.uint16[ye+3]=4*ge+2,_e.uint16[ye+4]=4*ge+3,_e.uint16[ye+5]=4*ge+0}return _e}(F));const ee=C.createIndexBuffer(_a,!0),oe=C.createVertexBuffer(X,s.cX.members,!0);for(const ce of U){const xe={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(fe=O).getCameraToCenterDistance(ce.projection),u_viewport_size:[fe.width,fe.height]};Y.draw(h,P.TRIANGLES,Wt.disabled,xi.disabled,h.colorModeForRenderPass(),ci.disabled,xe,n.id,oe,ee,s.b8.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,O.zoom)}var fe;oe.destroy(),ee.destroy()}const Ln=s.ad.mat4.create();function _r(h){const t=h._camera.getWorldToCamera(h.worldSize,1),n=s.ad.mat4.multiply([],t,h.globeMatrix);s.ad.mat4.invert(n,n);const u=[0,0,0],p=[0,1,0,0];return s.ad.vec4.transformMat4(p,p,n),u[0]=p[0],u[1]=p[1],u[2]=p[2],s.ad.vec3.normalize(u,u),u}function lh({width:h,height:t,anchor:n,textOffset:u,textScale:p},g){const{horizontalAlign:x,verticalAlign:C}=s.bD(n),P=-(x-.5)*h,O=-(C-.5)*t,k=s.bC(n,u);return new s.P((P/p+k[0])*g,(O/p+k[1])*g)}function cs(h,t,n,u,p,g,x,C,P,O,k){const U=h.text.placedSymbolArray,F=h.text.dynamicLayoutVertexArray,Z=h.icon.dynamicLayoutVertexArray,Y={},X=h.getProjection(),J=Hs(C,X,g),ee=g.elevation,oe=X.upVectorScale(C.canonical,g.center.lat,g.worldSize).metersToTile;F.clear();for(let fe=0;fe<U.length;fe++){const ce=U.get(fe),{tileAnchorX:xe,tileAnchorY:_e,numGlyphs:ge}=ce,ye=ce.hidden||!ce.crossTileID||h.allowVerticalPlacement&&!ce.placedOrientation?null:u[ce.crossTileID];if(ye){let we=0,Ae=0,je=0;if(ee){const Xe=ee?ee.getAtTileOffset(C,xe,_e):0,[st,Ge,rt]=X.upVector(C.canonical,xe,_e);we=Xe*st*oe,Ae=Xe*Ge*oe,je=Xe*rt*oe}let[Be,Qe,nt,dt]=Cs(ce.projectedAnchorX+we,ce.projectedAnchorY+Ae,ce.projectedAnchorZ+je,n?J:x);const Le=Gc(g.getCameraToCenterDistance(X),dt);let et=p.evaluateSizeForFeature(h.textSizeData,O,ce)*Le/s.bw;n&&(et*=h.tilePixelRatio/P);const Oe=lh(ye,et);n?({x:Be,y:Qe,z:nt}=X.projectTilePoint(xe+Oe.x,_e+Oe.y,C.canonical),[Be,Qe,nt]=Cs(Be+we,Qe+Ae,nt+je,x)):(t&&Oe._rotate(-g.angle),Be+=Oe.x,Qe+=Oe.y,nt=0);const tt=h.allowVerticalPlacement&&ce.placedOrientation===s.bq.vertical?Math.PI/2:0;for(let Xe=0;Xe<ge;Xe++)s.bt(F,Be,Qe,nt,tt);k&&ce.associatedIconIndex>=0&&(Y[ce.associatedIconIndex]={x:Be,y:Qe,z:nt,angle:tt})}else Js(ge,F)}if(k){Z.clear();const fe=h.icon.placedSymbolArray;for(let ce=0;ce<fe.length;ce++){const xe=fe.get(ce),{numGlyphs:_e}=xe,ge=Y[ce];if(xe.hidden||!ge)Js(_e,Z);else{const{x:ye,y:we,z:Ae,angle:je}=ge;for(let Be=0;Be<_e;Be++)s.bt(Z,ye,we,Ae,je)}}h.icon.dynamicLayoutVertexBuffer.updateData(Z)}h.text.dynamicLayoutVertexBuffer.updateData(F)}function hn(h,t,n,u,p,g,x={}){const C=n.paint.get("icon-translate"),P=n.paint.get("text-translate"),O=n.paint.get("icon-translate-anchor"),k=n.paint.get("text-translate-anchor"),U=n.layout.get("icon-rotation-alignment"),F=n.layout.get("text-rotation-alignment"),Z=n.layout.get("icon-pitch-alignment"),Y=n.layout.get("text-pitch-alignment"),X=n.layout.get("icon-keep-upright"),J=n.layout.get("text-keep-upright"),ee=n.paint.get("icon-color-saturation"),oe=n.paint.get("icon-color-contrast"),fe=n.paint.get("icon-color-brightness-min"),ce=n.paint.get("icon-color-brightness-max"),xe=n.layout.get("symbol-elevation-reference")==="sea",_e=h.context,ge=_e.gl,ye=h.transform,we=U==="map",Ae=F==="map",je=Z==="map",Be=Y==="map",Qe=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let nt=!1;const dt=h.depthModeForSublayer(0,Wt.ReadOnly),Le=[s.av(ye.center.lng),s.aC(ye.center.lat)],et=n.layout.get("text-variable-anchor"),Oe=ye.projection.name==="globe",tt=[],Xe=[0,-1,0];for(const st of u){const Ge=t.getTile(st),rt=Ge.getBucket(n);if(!rt||rt.projection.name==="mercator"&&Oe||rt.fullyClipped)continue;const St=rt.projection.name==="globe",Et=St?s.ag(ye.zoom):0,It=Hs(st,rt.getProjection(),ye),Vt=ye.calculatePixelsToTileUnitsMatrix(Ge),di=et&&rt.hasTextData(),Qt=rt.hasIconTextFit()&&di&&rt.hasIconData(),ui=rt.getProjection().createInversionMatrix(ye,st.canonical),li=Xi=>{ye.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||h.terrain)&&(Xi.push("DEPTH_D24"),Xi.push("DEPTH_OCCLUSION"))},Ui=()=>{const Xi=we&&n.layout.get("symbol-placement")!=="point",qi=[];li(qi);const jn=Xi||Qt,kn=n.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&je&&qi.push("PITCH_WITH_MAP_TERRAIN"),St&&(qi.push("PROJECTION_GLOBE_VIEW"),jn&&qi.push("PROJECTED_POS_ON_VIEWPORT")),kn>0&&qi.push("ICON_TRANSITION"),rt.icon.zOffsetVertexBuffer&&qi.push("Z_OFFSET"),ee===0&&oe===0&&fe===0&&ce===1||qi.push("COLOR_ADJUSTMENT"),rt.sdfIcons&&qi.push("RENDER_SDF");const fn=rt.icon.programConfigurations.get(n.id),Wn=h.getOrCreateProgram("symbol",{config:fn,defines:qi}),$r=Ge.imageAtlasTexture?Ge.imageAtlasTexture.size:[0,0],Xr=rt.iconSizeData,Ri=s.bp(Xr,ye.zoom),Sn=je||ye.pitch!==0,Wi=xr(It,Ge.tileID.canonical,je,we,ye,rt.getProjection(),Vt),$i=Hn(It,Ge.tileID.canonical,je,we,ye,rt.getProjection(),Vt),Rr=h.translatePosMatrix($i,Ge,C,O,!0),Rn=h.translatePosMatrix(It,Ge,C,O),ar=jn?Ln:Wi,na=we&&!je&&!Xi;let Dr=Xe;!Oe&&!ye.mercatorFromTransition||we||(Dr=_r(ye));const Yn=St?Dr:Xe,wr=n.getColorAdjustmentMatrix(ee,oe,fe,ce),hs=ul(Xr.kind,Ri,na,je,h,Rn,ar,Rr,xe,!1,$r,[0,0],!0,st,Et,Le,ui,Yn,rt.getProjection(),wr,kn),Wr=Ge.imageAtlasTexture?Ge.imageAtlasTexture:null,Na=n.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear,wa=rt.sdfIcons||h.options.rotating||h.options.zooming||Na||Sn?ge.LINEAR:ge.NEAREST,fo=rt.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,bc=h.terrain&&je&&Xi?s.ad.mat4.invert(s.ad.mat4.create(),Wi):Ln;if(Xi&&rt.icon){const Il=ye.elevation,xs=Il?Il.getAtTileOffsetFunc(st,ye.center.lat,ye.worldSize,rt.getProjection()):null,Md=cr(It,Ge.tileID.canonical,je,we,ye,rt.getProjection(),Vt);$o(rt,It,h,!1,Md,$i,je,X,xs,st)}return{program:Wn,buffers:rt.icon,uniformValues:hs,atlasTexture:Wr,atlasTextureIcon:null,atlasInterpolation:wa,atlasInterpolationIcon:null,isSDF:rt.sdfIcons,hasHalo:fo,tile:Ge,labelPlaneMatrixInv:bc}},sn=()=>{const Xi=Ae&&n.layout.get("symbol-placement")!=="point",qi=[],jn=Xi||et||Qt;h.terrainRenderModeElevated()&&Be&&qi.push("PITCH_WITH_MAP_TERRAIN"),St&&(qi.push("PROJECTION_GLOBE_VIEW"),jn&&qi.push("PROJECTED_POS_ON_VIEWPORT")),rt.text.zOffsetVertexBuffer&&qi.push("Z_OFFSET"),rt.iconsInText&&qi.push("RENDER_TEXT_AND_SYMBOL"),qi.push("RENDER_SDF"),li(qi);const kn=rt.text.programConfigurations.get(n.id),fn=h.getOrCreateProgram("symbol",{config:kn,defines:qi});let Wn,$r=[0,0],Xr=null;const Ri=rt.textSizeData;rt.iconsInText&&($r=Ge.imageAtlasTexture?Ge.imageAtlasTexture.size:[0,0],Xr=Ge.imageAtlasTexture?Ge.imageAtlasTexture:null,Wn=Be||ye.pitch!==0||h.options.rotating||h.options.zooming||Ri.kind==="composite"||Ri.kind==="camera"?ge.LINEAR:ge.NEAREST);const Sn=Ge.glyphAtlasTexture?Ge.glyphAtlasTexture.size:[0,0],Wi=n.layout.get("text-size-scale-range"),$i=s.ay(h.scaleFactor,Wi[0],Wi[1]),Rr=s.bp(Ri,ye.zoom,$i),Rn=xr(It,Ge.tileID.canonical,Be,Ae,ye,rt.getProjection(),Vt),ar=Hn(It,Ge.tileID.canonical,Be,Ae,ye,rt.getProjection(),Vt),na=h.translatePosMatrix(ar,Ge,P,k,!0),Dr=h.translatePosMatrix(It,Ge,P,k),Yn=jn?Ln:Rn,wr=Ae&&!Be&&!Xi;let hs=Xe;!Oe&&!ye.mercatorFromTransition||Ae||(hs=_r(ye));const Wr=ul(Ri.kind,Rr,wr,Be,h,Dr,Yn,na,xe,!0,Sn,$r,!0,st,Et,Le,ui,St?hs:Xe,rt.getProjection(),null,null,$i),Na=Ge.glyphAtlasTexture?Ge.glyphAtlasTexture:null,wa=ge.LINEAR,fo=n.paint.get("text-halo-width").constantOr(1)!==0,bc=h.terrain&&Be&&Xi?s.ad.mat4.invert(s.ad.mat4.create(),Rn):Ln;if(Xi&&rt.text){const Il=ye.elevation,xs=Il?Il.getAtTileOffsetFunc(st,ye.center.lat,ye.worldSize,rt.getProjection()):null,Md=cr(It,Ge.tileID.canonical,Be,Ae,ye,rt.getProjection(),Vt);$o(rt,It,h,!0,Md,ar,Be,J,xs,st)}return{program:fn,buffers:rt.text,uniformValues:Wr,atlasTexture:Na,atlasTextureIcon:Xr,atlasInterpolation:wa,atlasInterpolationIcon:Wn,isSDF:!0,hasHalo:fo,tile:Ge,labelPlaneMatrixInv:bc}},Si=rt.icon.segments.get().length,ii=rt.text.segments.get().length,bi=Si&&!x.onlyText?Ui():null,Ht=ii&&!x.onlyIcons?sn():null,At=n.paint.get("icon-opacity").constantOr(1),Ei=n.paint.get("text-opacity").constantOr(1);if(Qe&&rt.canOverlap){nt=!0;const Xi=At&&!x.onlyText?rt.icon.segments.get():[],qi=Ei&&!x.onlyIcons?rt.text.segments.get():[];for(const jn of Xi)tt.push({segments:new s.b8([jn]),sortKey:jn.sortKey,state:bi});for(const jn of qi)tt.push({segments:new s.b8([jn]),sortKey:jn.sortKey,state:Ht})}else x.onlyText||tt.push({segments:At?rt.icon.segments:new s.b8([]),sortKey:0,state:bi}),x.onlyIcons||tt.push({segments:Ei?rt.text.segments:new s.b8([]),sortKey:0,state:Ht})}nt&&tt.sort((st,Ge)=>st.sortKey-Ge.sortKey);for(const st of tt){const Ge=st.state;if(Ge)if(h.terrain?h.terrain.setupElevationDraw(Ge.tile,Ge.program,{useDepthForOcclusion:ye.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ge.labelPlaneMatrixInv}):h.setupDepthForOcclusion(ye.depthOcclusionForSymbolsAndCircles,Ge.program),_e.activeTexture.set(ge.TEXTURE0),Ge.atlasTexture&&Ge.atlasTexture.bind(Ge.atlasInterpolation,ge.CLAMP_TO_EDGE,!0),Ge.atlasTextureIcon&&(_e.activeTexture.set(ge.TEXTURE1),Ge.atlasTextureIcon&&Ge.atlasTextureIcon.bind(Ge.atlasInterpolationIcon,ge.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,Ge.program),Ge.hasHalo){const rt=Ge.uniformValues;rt.u_is_halo=1,zo(Ge.buffers,st.segments,n,h,Ge.program,dt,p,g,rt,2),rt.u_is_halo=0}else{if(Ge.isSDF){const rt=Ge.uniformValues;Ge.hasHalo&&(rt.u_is_halo=1,zo(Ge.buffers,st.segments,n,h,Ge.program,dt,p,g,rt,1)),rt.u_is_halo=0}zo(Ge.buffers,st.segments,n,h,Ge.program,dt,p,g,Ge.uniformValues,1)}}}function zo(h,t,n,u,p,g,x,C,P,O){const k=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,g,x,C,ci.disabled,P,n.id,h.layoutVertexBuffer,h.indexBuffer,t,n.paint,u.transform.zoom,h.programConfigurations.get(n.id),k,O)}function cc(h,t){const n=1<<h.canonical.z,u=(t.x*n-h.canonical.x-h.wrap*n)*s.ai,p=(t.y*n-h.canonical.y)*s.ai,g=s.d5(t.z,t.y);return s.ad.vec3.fromValues(u,p,g)}function dl(h,t,n,u,p){if(!n.layout||n.layout.get("fill-elevation-reference")==="none")return;const g=h.context.gl,x=new Wt(h.context.gl.LEQUAL,Wt.ReadWrite,h.depthRangeFor3D),C=new Wt(h.context.gl.GREATER,Wt.ReadWrite,h.depthRangeFor3D),P=function(Z){const Y=s.c4(Z.pitch);let X=.01;return Z.isOrthographic&&(X=s.ah(1e-4,X,s.c9(Y>=vt?1:Y/vt))),2*X}(h.transform),O=h.transform.getFreeCameraOptions().position,k="elevatedStructuresDepthReconstruct",U=h.getOrCreateProgram(k,{defines:["DEPTH_RECONSTRUCTION"]}),F=h.getOrCreateProgram(k);for(const Z of u){const Y=t.getTile(Z),X=Y.getBucket(n);if(!X)continue;const J=X.elevatedStructures;if(!J)continue;const ee=X.elevationBufferData.heightRange,oe=cc(Z.toUnwrapped(),O),fe=h.translatePosMatrix(Z.projMatrix,Y,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));let ce,xe,_e,ge;if(p==="initialize"){if(!ee||ee.min>=1||J.depthSegments.segments[0].primitiveLength===0)continue;ce=iu(fe,oe,P,1,0),xe=x,_e=J.depthSegments,ge=U}else if(p==="reset"){if(!ee||ee.min>=0||J.maskSegments.segments[0].primitiveLength===0)continue;ce=iu(fe,oe,0,0,1),xe=C,_e=J.maskSegments,ge=U}else if(p==="geometry"){if(J.depthSegments.segments[0].primitiveLength===0)continue;ce=iu(fe,oe,P,1,0),xe=x,_e=J.depthSegments,ge=F}ge.draw(h,g.TRIANGLES,xe,xi.disabled,zi.disabled,ci.disabled,ce,n.id,J.vertexBuffer,J.indexBuffer,_e,n.paint,h.transform.zoom)}}function ld(h,t,n){const{painter:u,sourceCache:p,layer:g,coords:x,colorMode:C,elevationType:P,terrainEnabled:O,pass:k}=h,U=u.context.gl,F=g.paint.get("fill-pattern");let Z=P;P!=="road"||t&&!O||(Z="none");const Y=Z==="road",X=new Wt(u.context.gl.LEQUAL,Wt.ReadWrite,u.depthRangeFor3D),J=F&&F.constantOr(1),ee=(oe,fe)=>{let ce,xe,_e,ge,ye;fe?(xe=J&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ce=U.LINES):(xe=J?"fillPattern":"fill",ce=U.TRIANGLES);for(const we of x){const Ae=p.getTile(we);if(J&&!Ae.patternsLoaded())continue;const je=Ae.getBucket(g);if(!je)continue;const Be=t?je.elevationBufferData:je.bufferData;if(Be.isEmpty())continue;u.prepareDrawTile();const Qe=Be.programConfigurations.get(g.id),nt=u.isTileAffectedByFog(we),dt=[],Le=[];Y&&(dt.push("ELEVATED_ROADS"),Le.push(Be.elevatedLayoutVertexBuffer));const et=u.getOrCreateProgram(xe,{config:Qe,overrideFog:nt,defines:dt});J&&(u.context.activeTexture.set(U.TEXTURE0),Ae.imageAtlasTexture&&Ae.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Qe.updatePaintBuffers());const Oe=F.constantOr(null);if(Oe&&Ae.imageAtlas){const st=Ae.imageAtlas,Ge=s.d0.from(Oe).getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),rt=st.patternPositions.get(Ge);rt&&Qe.setConstantPatternPositions(rt)}const tt=u.translatePosMatrix(we.projMatrix,Ae,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor")),Xe=g.paint.get("fill-emissive-strength");if(fe){ge=Be.lineIndexBuffer,ye=Be.lineSegments;const st=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];_e=xe==="fillOutlinePattern"&&J?ll(tt,Xe,u,Ae,st):rh(tt,Xe,st)}else ge=Be.indexBuffer,ye=Be.triangleSegments,_e=J?tu(tt,Xe,u,Ae):ol(tt,Xe);u.uploadCommonUniforms(u.context,et,we.toUnwrapped()),et.draw(u,ce,Z!=="none"?X:oe,n||u.stencilModeForClipping(we),C,ci.disabled,_e,g.id,Be.layoutVertexBuffer,ge,ye,g.paint,u.transform.zoom,Qe,Le)}};u.renderPass===k&&ee(u.depthModeForSublayer(1,u.renderPass==="opaque"?Wt.ReadWrite:Wt.ReadOnly),!1),Z==="none"&&u.renderPass==="translucent"&&g.paint.get("fill-antialias")&&ee(u.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,Wt.ReadOnly),!0)}function sr(h,t,n,u,p,g,x,C){n.resetLayerRenderingStats(h);const P=h.context,O=P.gl,k=h.transform,U=n.paint.get("fill-extrusion-pattern"),F=U.constantOr(1),Z=n.paint.get("fill-extrusion-opacity"),Y=h.style.enable3dLights(),X=n.paint.get(Y&&!F?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),J=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],ee=n.layout.get("fill-extrusion-edge-radius"),oe=ee>0&&!n.paint.get("fill-extrusion-rounded-roof"),fe=oe?0:ee,ce=k.projection.name==="globe"?s.d6():0,xe=k.projection.name==="globe",_e=xe?s.ag(k.zoom):0,ge=[s.av(k.center.lng),s.aC(k.center.lat)],ye=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",we=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(ye?null:n.lut).toArray01().slice(0,3),Ae=n.paint.get("fill-extrusion-flood-light-intensity"),je=n.paint.get("fill-extrusion-vertical-scale"),Be=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Qe=n.paint.get("fill-extrusion-height-alignment"),nt=n.paint.get("fill-extrusion-base-alignment"),dt=wo(h,n.paint.get("fill-extrusion-cutoff-fade-range")),Le=[];let et;xe&&Le.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&Le.push("FAUX_AO"),oe&&Le.push("ZERO_ROOF_RADIUS"),C&&Le.push("HAS_CENTROID"),Ae>0&&Le.push("FLOOD_LIGHT"),dt.shouldRenderCutoff&&Le.push("RENDER_CUTOFF"),Be&&Le.push("RENDER_WALL_MODE");const Oe=h.renderPass==="shadow",tt=h.shadowRenderer,Xe=Oe&&!!tt;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let st=[0,0,0];if(tt){const St=h.style.directionalLight,Et=h.style.ambientLight;St&&Et&&(st=Zl(h.style,St,Et)),Oe||(Le.push("RENDER_SHADOWS","DEPTH_TEXTURE"),tt.useNormalOffset&&Le.push("NORMAL_OFFSET")),et=Le.concat(["SHADOWS_SINGLE_CASCADE"])}const Ge=Xe?"fillExtrusionDepth":F?"fillExtrusionPattern":"fillExtrusion",rt=n.getLayerRenderingStats();for(const St of u){const Et=t.getTile(St),It=Et.getBucket(n);if(!It||It.projection.name!==k.projection.name)continue;let Vt=!1;tt&&(Vt=tt.getMaxCascadeForTile(St.toUnwrapped())===0);const di=h.isTileAffectedByFog(St),Qt=It.programConfigurations.get(n.id),ui=h.getOrCreateProgram(Ge,{config:Qt,defines:Vt?et:Le,overrideFog:di});if(h.terrain&&h.terrain.setupElevationDraw(Et,ui,{useMeterToDem:!0}),!It.centroidVertexBuffer){const Ht=ui.attributes.a_centroid_pos;Ht!==void 0&&O.vertexAttrib2f(Ht,0,0)}!Oe&&tt&&tt.setupShadows(Et.tileID.toUnwrapped(),ui,"vector-tile",Et.tileID.overscaledZ),F&&(h.context.activeTexture.set(O.TEXTURE0),Et.imageAtlasTexture&&Et.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Qt.updatePaintBuffers());const li=U.constantOr(null);if(li&&Et.imageAtlas){const Ht=Et.imageAtlas,At=s.d0.from(li).getPrimary().scaleSelf(s.q.devicePixelRatio),Ei=Ht.patternPositions.get(At.toString());Ei&&Qt.setConstantPatternPositions(Ei)}const Ui=n.paint.get("fill-extrusion-vertical-gradient"),sn=1/It.tileToMeter;let Si;if(Oe&&tt){if(ml(Et.tileID,It,h))continue;const Ht=tt.calculateShadowPassMatrixFromTile(Et.tileID.toUnwrapped());Si=rc(Ht,fe,sn,je,Qe,nt)}else{const Ht=h.translatePosMatrix(St.expandedProjMatrix,Et,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),At=k.projection.createInversionMatrix(k,St.canonical);Si=F?Co(Ht,h,Ui,Z,J,fe,sn,St,Et,ce,Qe,nt,_e,ge,At,we,je):id(Ht,h,Ui,Z,J,fe,sn,St,ce,Qe,nt,_e,ge,At,we,je,Ae,st)}h.uploadCommonUniforms(P,ui,St.toUnwrapped(),null,dt);let ii=It.segments;if(k.projection.name==="mercator"&&!Oe&&(ii=It.getVisibleSegments(Et.tileID,h.terrain,h.transform.getFrustum(0)),!ii.get().length))continue;if(rt)if(Oe)for(const Ht of ii.get())rt.numRenderedVerticesInShadowPass+=Ht.primitiveLength;else for(const Ht of ii.get())rt.numRenderedVerticesInTransparentPass+=Ht.primitiveLength;const bi=[];(h.terrain||C)&&bi.push(It.centroidVertexBuffer),xe&&bi.push(It.layoutVertexExtBuffer),Be&&bi.push(It.wallVertexBuffer),ui.draw(h,P.gl.TRIANGLES,p,g,x,ci.backCCW,Si,n.id,It.layoutVertexBuffer,It.indexBuffer,ii,n.paint,h.transform.zoom,Qt,bi)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function fl(h,t,n,u,p,g,x,C,P,O,k,U,F,Z,Y,X,J,ee,oe){const fe=h.context,ce=fe.gl,xe=h.transform,_e=h.transform.zoom,ge=[],ye=wo(h,n.paint.get("fill-extrusion-cutoff-fade-range"));O==="clear"?(ge.push("CLEAR_SUBPASS"),oe&&(ge.push("CLEAR_FROM_TEXTURE"),fe.activeTexture.set(ce.TEXTURE0),oe.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):O==="sdf"&&ge.push("SDF_SUBPASS"),J&&ge.push("HAS_CENTROID"),ye.shouldRenderCutoff&&ge.push("RENDER_CUTOFF");const we=n.layout.get("fill-extrusion-edge-radius"),Ae=(je,Be,Qe,nt,dt)=>{const Le=Be.programConfigurations.get(n.id),et=h.isTileAffectedByFog(je),Oe=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:Le,defines:ge,overrideFog:et}),tt=((st,Ge,rt,St,Et,It,Vt,di,Qt,ui,li)=>({u_matrix:Ge,u_opacity:rt,u_ao_pass:St?1:0,u_meter_to_tile:Et,u_ao:It,u_flood_light_intensity:Vt,u_flood_light_color:di,u_attenuation:Qt,u_edge_radius:ui,u_fb:0,u_fb_size:li,u_dynamic_offset:1}))(0,nt,k,P,dt,[U,F*dt],Z,Y,X,_e>=17?0:we*dt,oe?oe.size[0]:0),Xe=[];J&&Xe.push(Be.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(fe,Oe,je.toUnwrapped(),null,ye),Oe.draw(h,fe.gl.TRIANGLES,p,g,x,C,tt,n.id,Be.vertexBuffer,Be.indexBuffer,Qe,n.paint,_e,Le,Xe)};for(const je of u){const Be=t.getTile(je),Qe=Be.getBucket(n);if(!Qe||Qe.projection.name!==xe.projection.name||!Qe.groundEffect||Qe.groundEffect&&!Qe.groundEffect.hasData())continue;const nt=Qe.groundEffect,dt=1/Qe.tileToMeter;{const Le=h.translatePosMatrix(je.projMatrix,Be,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),et=nt.getDefaultSegment();Ae(je,nt,et,Le,dt)}if(ee)for(let Le=0;Le<4;Le++){const et=s.d7[Le](je),Oe=t.getTile(et);if(!Oe)continue;const tt=Oe.getBucket(n);if(!tt||tt.projection.name!==xe.projection.name||!tt.groundEffect||tt.groundEffect&&!tt.groundEffect.hasData())continue;const Xe=tt.groundEffect;let st,Ge;Le===0?(st=[-s.ai,0,0],Ge=1):Le===1?(st=[s.ai,0,0],Ge=0):Le===2?(st=[0,-s.ai,0],Ge=3):(st=[0,s.ai,0],Ge=2);const rt=Xe.regionSegments[Ge];if(!rt)continue;const St=new Float32Array(16);s.ad.mat4.translate(St,je.projMatrix,st),Ae(je,Xe,rt,h.translatePosMatrix(St,Be,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),dt)}}}function pl(h,t,n,u,p,g,x){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const C=g?g.findDEMTileFor(n):null;if(!(C&&C.dem||x))return;g&&C&&C.dem&&u.selfDEMTileTimestamp!==C.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=C.dem._timestamp);const P=ee=>new s.P(Math.ceil((ee+s.da)*s.db),0),O=ee=>{const oe=t.getSource().minzoom,fe=xe=>{const _e=t.getTileByID(xe);if(_e&&_e.hasData())return _e.getBucket(p)},ce=[0,-1,1];for(const xe of ce){if(ee.overscaledZ+xe<oe)continue;const _e=fe(ee.calculateScaledKey(ee.overscaledZ+xe));if(_e)return _e}},k=[0,0,0],U=(ee,oe)=>(k[0]=Math.min(ee.min.y,oe.min.y),k[1]=Math.max(ee.max.y,oe.max.y),k[2]=s.ai-oe.min.x>ee.max.x?oe.min.x-s.ai:ee.max.x,k),F=(ee,oe)=>(k[0]=Math.min(ee.min.x,oe.min.x),k[1]=Math.max(ee.max.x,oe.max.x),k[2]=s.ai-oe.min.y>ee.max.y?oe.min.y-s.ai:ee.max.y,k),Z=[(ee,oe)=>U(ee,oe),(ee,oe)=>U(oe,ee),(ee,oe)=>F(ee,oe),(ee,oe)=>F(oe,ee)],Y=(ee,oe,fe,ce,xe,_e,ge)=>{if(!g)return 0;const ye=[[_e?fe:ee,_e?ee:fe,0],[_e?fe:oe,_e?oe:fe,0]],we=ge<0?s.ai+ge:ge,Ae=[_e?we:(ee+oe)/2,_e?(ee+oe)/2:we,0];return fe===0&&ge<0||fe!==0&&ge>0?g.getForTilePoints(xe,[Ae],!0,ce):ye.push(Ae),g.getForTilePoints(n,ye,!0,C),Math.max(ye[0][2],ye[1][2],Ae[2])/g.exaggeration()};for(let ee=0;ee<4;ee++){const oe=u.borderFeatureIndices[ee];if(oe.length===0)continue;const fe=s.d7[ee](n),ce=O(fe);if(!(ce&&ce instanceof s.d8))continue;const xe=g?g.findDEMTileFor(fe):null;if(!(xe&&xe.dem||x)||(g&&xe&&xe.dem&&u.borderDEMTileTimestamp[ee]!==xe.dem._timestamp&&(u.borderDoneWithNeighborZ[ee]=-1,u.borderDEMTileTimestamp[ee]=xe.dem._timestamp),u.borderDoneWithNeighborZ[ee]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const _e=(ee<2?1:5)-ee,ge=ce.borderDoneWithNeighborZ[_e]!==u.canonical.z,ye=ce.borderFeatureIndices[_e];let we=0;if(u.canonical.z!==ce.canonical.z){for(const Ae of oe)u.showCentroid(u.featuresOnBorder[Ae]);if(ge)for(const Ae of ye)ce.showCentroid(ce.featuresOnBorder[Ae]);u.borderDoneWithNeighborZ[ee]=ce.canonical.z,ce.borderDoneWithNeighborZ[_e]=u.canonical.z}for(const Ae of oe){const je=u.featuresOnBorder[Ae],Be=u.centroidData[je.centroidDataIndex],Qe=je.borders[ee];let nt;for(;we<ye.length;){nt=ce.featuresOnBorder[ye[we]];const dt=nt.borders[_e];if(dt[1]>Qe[0]+3||dt[0]>Qe[0]-3)break;ce.showCentroid(nt),we++}if(nt&&we<ye.length){const dt=we;let Le=0;for(;!(nt.borders[_e][0]>Qe[1]-3)&&(Le++,++we!==ye.length);)nt=ce.featuresOnBorder[ye[we]];nt=ce.featuresOnBorder[ye[dt]];let et=!1;if(Le>=1){const Xe=nt.borders[_e];Math.abs(Qe[0]-Xe[0])<3&&Math.abs(Qe[1]-Xe[1])<3&&(Le=1,et=!0,we=dt+1)}else if(Le===0){u.showCentroid(je);continue}const Oe=ce.centroidData[nt.centroidDataIndex];x&&et&&(((X=Be).flags|(J=Oe).flags)&s.d9?(X.flags|=s.d9,J.flags|=s.d9):(X.flags&=~s.d9,J.flags&=~s.d9));const tt=je.intersectsCount()>1||nt.intersectsCount()>1;if(Le>1)we=dt,Be.centroidXY=Oe.centroidXY=new s.P(0,0);else if(xe&&xe.dem&&!tt){const Xe=Z[ee](Be,Oe),st=ee%2?s.ai-1:0,Ge=Y(Xe[0],Math.min(s.ai-1,Xe[1]),st,xe,fe,ee<2,Xe[2]);Be.centroidXY=Oe.centroidXY=P(Ge)}else tt?Be.centroidXY=Oe.centroidXY=new s.P(0,0):(Be.centroidXY=u.encodeBorderCentroid(je),Oe.centroidXY=ce.encodeBorderCentroid(nt));u.writeCentroidToBuffer(Be),ce.writeCentroidToBuffer(Oe)}else u.showCentroid(je)}u.borderDoneWithNeighborZ[ee]=ce.canonical.z,ce.borderDoneWithNeighborZ[_e]=u.canonical.z}var X,J;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(h)}const uc=[1,0,0],yt=[0,1,0],Lt=[0,0,1];function ml(h,t,n){const u=n.transform,p=n.shadowRenderer;if(!p)return!0;const g=h.toUnwrapped(),x=u.tileSize*p._cascades[n.currentShadowCascade].scale;let C=t.maxHeight;if(u.elevation){const X=u.elevation.getMinMaxForTile(h);X&&(C+=X.max)}const P=[...p.shadowDirection];P[2]=-P[2];const O=p.computeSimplifiedTileShadowVolume(g,C,x,P);if(!O)return!1;const k=[uc,yt,Lt,P,[P[0],0,P[2]],[0,P[1],P[2]]],U=u.projection.name==="globe",F=u.scaleZoom(x),Z=s.bR.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,F,!U),Y=p.getCurrentCascadeFrustum();return Z.intersectsPrecise(O.vertices,O.planes,k)===0||Y.intersectsPrecise(O.vertices,O.planes,k)===0}function Bn(h){return[h[0]*s.dc,h[1]*s.dc,h[2]*s.dc,0]}function Fe(h,t,n,u,p,g,x,C,P){const O=u.getSource(),k=n.globeSharedBuffers;if(!k)return;let U,F,Z;if(t&&(U=u.getTile(t)),O instanceof s.aK?(F=O.texture,Z=s.cJ(0,0,n.transform)):U&&t&&(F=U.texture,Z=s.cJ(t.canonical.z,t.canonical.x,n.transform)),!F||!Z)return;h||(Z=s.ad.mat4.scale(s.ad.mat4.create(),Z,[1,-1,1]));const Y=n.context,X=Y.gl,J=p.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR,ee=n.colorModeForDrapableLayerRenderPass(g),oe=x.defines;oe.push("GLOBE_POLES");const fe=new Wt(X.LEQUAL,Wt.ReadWrite,n.depthRangeFor3D),ce=Float32Array.from(n.transform.expandedFarZProjMatrix),xe=Float32Array.from(s.bc(s.cI(new s.bT(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),Y.activeTexture.set(X.TEXTURE0),F.bind(J,X.CLAMP_TO_EDGE),Y.activeTexture.set(X.TEXTURE1),F.bind(J,X.CLAMP_TO_EDGE),"useMipmap"in F&&Y.extTextureFilterAnisotropic&&n.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);const[_e,ge,ye,we]=t?k.getPoleBuffers(t.canonical.z,!1):k.getPoleBuffers(0,!0),Ae=p.paint.get("raster-elevation");let je;h?(je=_e,n.renderDefaultNorthPole=Ae!==0):(je=ge,n.renderDefaultSouthPole=Ae!==0);const Be=Bn(x.mix),Qe=((dt,Le,et,Oe,tt,Xe,st,Ge,rt,St,Et,It,Vt)=>rd(dt,Le,et,new Float32Array(16),new Float32Array(9),[0,0],Oe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Xe,[0,0],Ge,2,St,Et,It,1,0,Vt))(ce,xe,Z,s.ag(n.transform.zoom),0,p,0,Ae,0,Be,x.offset,x.range,g),nt=n.getOrCreateProgram("raster",{defines:oe});n.uploadCommonUniforms(Y,nt,null),nt.draw(n,X.TRIANGLES,fe,P,ee,C,Qe,p.id,je,ye,we)}function Os(h){const t=h._nearZ,n=h.projection.farthestPixelDistance(h),u=n-t,p=.2*h.height,g=t+p;return[t,n,(g-p-t)/u,(g-t)/u]}function gr(h,t,n,u){if(h)return t instanceof Ca&&h instanceof as?t.getTextureDescriptor(h,n,!0):{texture:h.texture,mix:Bn(u.mix),offset:u.offset,buffer:0,tileSize:1}}var ch=s.dd([{name:"a_index",type:"Int16",components:1}]);class hc{constructor(t,n,u,p){const g={width:u[0],height:u[1],data:null},x=t.gl;this.targetColorTexture=new s.T(t,g,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,g,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,p),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=n.width*n.height;this.particleTexture0=new s.T(this.context,n,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,n,u.RGBA8,{premultiply:!1,useMipmap:!1});const g=new s.de;g.reserve(p);for(let x=0;x<p;x++)g.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(g,ch.members,!0),this.particleSegment=s.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function uh(h,t,n){if(!h)return null;const u=t.getTextureDescriptor(h,n,!0);if(!u)return null;let{texture:p,mix:g,offset:x,tileSize:C,buffer:P,format:O}=u;if(!p||!O)return null;let k=!1;return O==="uint32"&&(k=!0,g[3]=0,g=Ot(s.df,g,[0,n.paint.get("raster-particle-max-speed")]),x=oc(s.df,x,[0,n.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[P/(C+2*P),C/(C+2*P)],tileSize:C,scalarData:k,scale:g,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function cd(h){const t=h._nearZ,n=h.projection.farthestPixelDistance(h),u=n-t,p=.2*h.height,g=t+p;return[t,n,(g-p-t)/u,(g-t)/u]}const Zs=new s.al(1,0,0,1),ud=new s.al(0,1,0,1),wf=new s.al(0,0,1,1),hd=new s.al(1,0,1,1),hh=new s.al(0,1,1,1);function Po(h,t,n,u,p,g,x){const C=h.context,P=h.transform,O=C.gl,k=P.projection.name==="globe",U=k?["PROJECTION_GLOBE_VIEW"]:[];let F=s.ad.mat4.clone(n.projMatrix);if(k&&s.ag(P.zoom)>0){const Be=s.bb(n.canonical,P),Qe=s.dg(Be);F=s.ad.mat4.multiply(new Float32Array(16),P.globeMatrix,Qe),s.ad.mat4.multiply(F,P.projMatrix,F)}const Z=s.ad.mat4.create();Z[12]+=2*p/(s.q.devicePixelRatio*P.width),Z[13]+=2*g/(s.q.devicePixelRatio*P.height),s.ad.mat4.multiply(F,Z,F);const Y=h.getOrCreateProgram("debug",{defines:U}),X=t.getTileByID(n.key);h.terrain&&h.terrain.setupElevationDraw(X,Y);const J=Wt.disabled,ee=xi.disabled,oe=h.colorModeForRenderPass(),fe="$debug";C.activeTexture.set(O.TEXTURE0),h.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),k?X._makeGlobeTileDebugBuffers(h.context,P):X._makeDebugTileBoundsBuffers(h.context,P.projection);const ce=X._tileDebugBuffer||h.debugBuffer,xe=X._tileDebugIndexBuffer||h.debugIndexBuffer,_e=X._tileDebugSegments||h.debugSegments;if(Y.draw(h,O.LINE_STRIP,J,ee,oe,ci.disabled,nd(F,u),fe,ce,xe,_e,null,null,null,[X._globeTileDebugBorderBuffer]),x){const Be=X.latestRawTileData,Qe=Math.floor((Be&&Be.byteLength||0)/1024);let nt=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(nt+=` => ${n.overscaledZ}`),nt+=` ${X.state}`,nt+=` ${Qe}kb`,function(dt,Le){dt.initDebugOverlayCanvas();const et=dt.debugOverlayCanvas,Oe=dt.context.gl,tt=dt.debugOverlayCanvas.getContext("2d");tt.clearRect(0,0,et.width,et.height),tt.shadowColor="white",tt.shadowBlur=2,tt.lineWidth=1.5,tt.strokeStyle="white",tt.textBaseline="top",tt.font="bold 36px Open Sans, sans-serif",tt.fillText(Le,5,5),tt.strokeText(Le,5,5),dt.debugOverlayTexture.update(et),dt.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(h,nt)}const ge=t.getTile(n).tileSize,ye=512/Math.min(ge,512)*(n.overscaledZ/P.zoom)*.5,we=X._tileDebugTextBuffer||h.debugBuffer,Ae=X._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,je=X._tileDebugTextSegments||h.debugSegments;Y.draw(h,O.TRIANGLES,J,ee,zi.alphaBlended,ci.disabled,nd(F,s.al.transparent,ye),fe,we,Ae,je,null,null,null,[X._globeTileDebugTextBuffer])}function dd(h,t,n,u){_l(h,0,t+n/2,h.transform.width,n,u)}function fd(h,t,n,u){_l(h,t-n/2,0,n,h.transform.height,u)}function _l(h,t,n,u,p,g){const x=h.context,C=x.gl;C.enable(C.SCISSOR_TEST),C.scissor(t*s.q.devicePixelRatio,n*s.q.devicePixelRatio,u*s.q.devicePixelRatio,p*s.q.devicePixelRatio),x.clear({color:g}),C.disable(C.SCISSOR_TEST)}const dh=s.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:gl}=dh;function ao(h,t,n,u){h.emplaceBack(t,n,u)}class Rp{constructor(t){this.vertexArray=new s.dh,this.indices=new s.aV,ao(this.vertexArray,-1,-1,1),ao(this.vertexArray,1,-1,1),ao(this.vertexArray,-1,1,1),ao(this.vertexArray,1,1,1),ao(this.vertexArray,-1,-1,-1),ao(this.vertexArray,1,-1,-1),ao(this.vertexArray,-1,1,-1),ao(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,gl),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.b8.simpleSegment(0,0,36,12)}}function Ir(h,t,n,u,p,g){const x=h.context.gl,C=t.paint.get("sky-atmosphere-color"),P=t.paint.get("sky-atmosphere-halo-color"),O=t.paint.get("sky-atmosphere-sun-intensity"),k=((U,F,Z,Y,X)=>({u_matrix_3f:U,u_sun_direction:F,u_sun_intensity:Z,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(s.ad.mat3.fromMat4(s.ad.mat3.create(),u),p,O,C,P);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),n.draw(h,x.TRIANGLES,Wt.disabled,xi.disabled,zi.unblended,ci.frontCW,k,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Dp=s.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ru{constructor(t){const n=new s.di;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const u=new s.aV;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,Dp.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=s.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Tn=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class nn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Tf{constructor(t){this.colorModeAlphaBlendedWriteRGB=new zi([1,Qs,1,Qs],s.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new zi([1,0,1,0],s.al.transparent,[!1,!1,!1,!0]),this.params=new nn,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ru(n);const u=this.params.sizeRange,p=this.params.intensityRange,g=function(k){const U=s.dl(30),F=[];for(let Z=0;Z<k;++Z){const Y=2*Math.PI*U(),X=Math.acos(1-2*U())-.5*Math.PI;F.push(s.ad.vec3.fromValues(Math.cos(X)*Math.cos(Y),Math.cos(X)*Math.sin(Y),Math.sin(X)))}return F}(this.params.starsCount),x=s.dl(300),C=new s.dj,P=new s.aV;let O=0;for(let k=0;k<g.length;++k){const U=s.ad.vec3.scale([],g[k],200),F=Math.max(0,1+.01*u*(1*x()-.5)),Z=Math.max(0,1+.01*p*(1*x()-.5));C.emplaceBack(U[0],U[1],U[2],-1,-1,F,Z),C.emplaceBack(U[0],U[1],U[2],1,-1,F,Z),C.emplaceBack(U[0],U[1],U[2],1,1,F,Z),C.emplaceBack(U[0],U[1],U[2],-1,1,F,Z),P.emplaceBack(O+0,O+1,O+2),P.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=n.createVertexBuffer(C,Tn.members),this.starsIdx=n.createIndexBuffer(P),this.starsSegments=s.b8.simpleSegment(0,0,C.length,P.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const u=t.context,p=u.gl,g=t.transform,x=new Wt(p.LEQUAL,Wt.ReadOnly,[0,1]),C=s.ag(g.zoom),P=t.style.getLut(n.scope),O=n.properties.get("color-use-theme")==="none",k=n.properties.get("color").toRenderColor(O?null:P).toArray01(),U=n.properties.get("high-color-use-theme")==="none",F=n.properties.get("high-color").toRenderColor(U?null:P).toArray01(),Z=n.properties.get("space-color-use-theme")==="none",Y=n.properties.get("space-color").toRenderColor(Z?null:P).toArray01PremultipliedAlpha(),X=5e-4,J=s.dk(n.properties.get("horizon-blend"),0,1,X,.25),ee=s.cD(t,u,g)&&J===X?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,oe=t.frameCounter/1e3%1,fe=s.ad.vec3.length(g.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(fe,2)-Math.pow(ee,2)),xe=Math.acos(ce/fe),_e=ge=>{const ye=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ge&&ye.push("ALPHA_PASS");const we=t.getOrCreateProgram("globeAtmosphere",{defines:ye}),Ae=((Be,Qe,nt,dt,Le,et,Oe,tt,Xe,st,Ge,rt)=>({u_frustum_tl:Be,u_frustum_tr:Qe,u_frustum_br:nt,u_frustum_bl:dt,u_horizon:Le,u_transition:et,u_fadeout_range:Oe,u_color:tt,u_high_color:Xe,u_space_color:st,u_temporal_offset:Ge,u_horizon_angle:rt}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,C,J,k,F,Y,oe,xe);t.uploadCommonUniforms(u,we);const je=this.atmosphereBuffer;je&&we.draw(t,p.TRIANGLES,x,xi.disabled,ge?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ci.backCW,Ae,ge?"atmosphere_glow_alpha":"atmosphere_glow",je.vertexBuffer,je.indexBuffer,je.segments)};_e(!1),_e(!0)}drawStars(t,n){const u=s.ay(n.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,g=p.gl,x=t.transform,C=t.getOrCreateProgram("stars"),P=s.ad.quat.identity([]);s.ad.quat.rotateX(P,P,-x._pitch),s.ad.quat.rotateZ(P,P,-x.angle),s.ad.quat.rotateX(P,P,s.ak(x._center.lat)),s.ad.quat.rotateY(P,P,-s.ak(x._center.lng));const O=s.ad.mat4.fromQuat(new Float32Array(16),P),k=s.ad.mat4.multiply([],x.starsProjMatrix,O),U=s.ad.mat3.fromMat4([],O),F=s.ad.mat3.invert([],U),Z=[0,1,0];s.ad.vec3.transformMat3(Z,Z,F),s.ad.vec3.scale(Z,Z,this.params.sizeMultiplier);const Y=[1,0,0];s.ad.vec3.transformMat3(Y,Y,F),s.ad.vec3.scale(Y,Y,this.params.sizeMultiplier);const X=(J=Z,ee=Y,oe=u,{u_matrix:Float32Array.from(k),u_up:J,u_right:ee,u_intensity_multiplier:oe});var J,ee,oe;t.uploadCommonUniforms(p,C),this.starsVx&&this.starsIdx&&C.draw(t,g.TRIANGLES,Wt.disabled,xi.disabled,this.colorModeAlphaBlendedWriteRGB,ci.disabled,X,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function oo(h,t){const n=[...h],u=t.cameraWorldSizeForFog/t.worldSize,p=s.ad.mat4.identity([]);return s.ad.mat4.scale(p,p,[u,u,1]),s.ad.mat4.multiply(n,p,n),s.ad.mat4.multiply(n,t.worldToFogMatrix,n),n}function dc(h,t,n,u,p){const g=n.material,x=u.context,{baseColorTexture:C,metallicRoughnessTexture:P}=g.pbrMetallicRoughness,{normalTexture:O,occlusionTexture:k,emissionTexture:U}=g;function F(Y,X,J){if(Y&&(h.push(X),x.activeTexture.set(x.gl.TEXTURE0+J),Y.gfxTexture)){const{minFilter:ee,magFilter:oe,wrapS:fe,wrapT:ce}=Y.sampler;Y.gfxTexture.bindExtraParam(ee,oe,fe,ce)}}F(C,"HAS_TEXTURE_u_baseColorTexture",Zn.BaseColor),F(P,"HAS_TEXTURE_u_metallicRoughnessTexture",Zn.MetallicRoughness),F(O,"HAS_TEXTURE_u_normalTexture",Zn.Normal),F(k,"HAS_TEXTURE_u_occlusionTexture",Zn.Occlusion),F(U,"HAS_TEXTURE_u_emissionTexture",Zn.Emission),p&&(p.texture||(p.texture=new s.dn(u.context,p.image,[p.image.height,p.image.height,p.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+Zn.LUT),p.texture&&p.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(h.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||h.push("DIFFUSE_SHADED");const Z=u.shadowRenderer;Z&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Z.useNormalOffset&&h.push("NORMAL_OFFSET"))}function lo(h,t,n,u,p,g){const x=n.paint.get("model-opacity").constantOr(1),C=t.context,P=new Wt(t.context.gl.LEQUAL,Wt.ReadWrite,t.depthRangeFor3D),O=t.transform,k=h.mesh,U=k.material,F=U.pbrMetallicRoughness,Z=t.style.fog;let Y;Y=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:s.ad.mat4.multiply([],u.zScaleMatrix,h.nodeModelMatrix),s.ad.mat4.multiply(Y,u.negCameraPosMatrix,Y);const X=s.ad.mat4.invert([],Y);s.ad.mat4.transpose(X,X);const J=n.paint.get("model-color-use-theme").constantOr("default")==="none",ee=n.paint.get("model-emissive-strength").constantOr(0),oe=lc(new Float32Array(h.worldViewProjection),new Float32Array(Y),new Float32Array(X),null,t,x,F.baseColorFactor.toRenderColor(null),U.emissiveFactor,F.metallicFactor,F.roughnessFactor,U,ee,n),fe={defines:[]},ce=[],xe=t.shadowRenderer;xe&&(xe.useNormalOffset=!1),dc(fe.defines,ce,k,t,J?null:n.lut);let _e=null;if(Z){const we=oo(h.nodeModelMatrix,t.transform);if(_e=new Float32Array(we),O.projection.name!=="globe"){const Ae=k.aabb.min,je=k.aabb.max,[Be,Qe]=Z.getOpacityForBounds(we,Ae[0],Ae[1],je[0],je[1]);fe.overrideFog=Be>=Ct||Qe>=Ct}}const ge=wo(t,n.paint.get("model-cutoff-fade-range"));ge.shouldRenderCutoff&&fe.defines.push("RENDER_CUTOFF");const ye=t.getOrCreateProgram("model",fe);t.uploadCommonUniforms(C,ye,null,_e,ge),t.renderPass!=="shadow"&&xe&&xe.setupShadowsFromMatrix(h.nodeModelMatrix,ye),ye.draw(t,C.gl.TRIANGLES,P,p,g,k.material.doubleSided?ci.disabled:ci.backCCW,oe,n.id,k.vertexBuffer,k.indexBuffer,k.segments,n.paint,t.transform.zoom,void 0,ce)}function fc(h,t,n,u,p,g,x){let C;C=h.projection.name==="globe"?s.dp(n,h):[...n],s.ad.mat4.multiply(C,C,t.matrix);const P=s.ad.mat4.multiply([],u,C);if(t.meshes)for(const O of t.meshes){if(O.material.alphaMode!=="BLEND"){x.push({mesh:O,depth:0,modelIndex:p,worldViewProjection:P,nodeModelMatrix:C});continue}const k=s.ad.vec3.transformMat4([],O.centroid,P);!h.isOrthographic&&k[2]<=0||g.push({mesh:O,depth:k[2],modelIndex:p,worldViewProjection:P,nodeModelMatrix:C})}if(t.children)for(const O of t.children)fc(h,O,n,u,p,g,x)}function su(h,t,n,u){const p=n.shadowRenderer;if(!p)return;const g=p.getShadowPassDepthMode(),x=p.getShadowPassColorMode(),C=p.calculateShadowPassMatrixFromMatrix(t),P=bf(C);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,g,xi.disabled,x,ci.backCCW,P,u.id,h.vertexBuffer,h.indexBuffer,h.segments,u.paint,n.transform.zoom,void 0,void 0)}function yl(h,t,n){const u=t.updateZoomBasedPaintProperties(),p=function(g,x,C){let P,O,k,U=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&U>0){const F=g.terrain,Z=F.findDEMTileFor(C);Z&&Z.dem?P=s.dr.create(F,C,Z):U=0}if(U===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),U===x.validForExaggeration&&(U===0||P&&P._demTile&&P._demTile.tileID===x.validForDEMTile.id&&P._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const F in x.instancesPerModel){const Z=x.instancesPerModel[F];for(let Y=0;Y<Z.instancedDataArray.length;++Y){const X=(P?U*P.getElevationAt(0|Z.instancedDataArray.float32[16*Y],0|Z.instancedDataArray.float32[16*Y+1],!0,!0):0)+Z.instancesEvaluatedElevation[Y];Z.instancedDataArray.float32[16*Y+6]=X,O=O?Math.min(x.terrainElevationMin,X):X,k=k?Math.max(x.terrainElevationMax,X):X}}return x.terrainElevationMin=O||0,x.terrainElevationMax=k||0,x.validForExaggeration=U,x.validForDEMTile=P&&P._demTile?{id:P._demTile.tileID,timestamp:P._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,t,n);(u||p)&&(t.uploaded=!1,t.upload(h.context))}const Ls={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.ce([0,0,0],[s.ai,s.ai,0])};function pd(h,t){const n=1<<h.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,g=h.canonical.x/n,x=(h.canonical.x+1)/n,C=h.canonical.y/n,P=(h.canonical.y+1)/n;let O=t._centerAltitude;if(p){const Z=p.getMinMaxForTile(h);Z&&Z.max>O&&(O=Z.max)}const k=s.ay(u.x,g,x)-u.x,U=s.ay(u.y,C,P)-u.y,F=s.bH(O,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(k*k+U*U+F*F))}function $s(h,t,n,u,p,g,x){const C=h.context,P=h.renderPass==="shadow",O=h.shadowRenderer,k=P&&O?O.getShadowPassDepthMode():new Wt(C.gl.LEQUAL,Wt.ReadWrite,h.depthRangeFor3D),U=h.isTileAffectedByFog(g);if(n.meshes)for(const F of n.meshes){const Z=["MODEL_POSITION_ON_GPU"],Y=[];let X,J,ee;u.instancedDataArray.length>20&&Z.push("INSTANCED_ARRAYS");const oe=wo(h,t.paint.get("model-cutoff-fade-range"));if(oe.shouldRenderCutoff&&Z.push("RENDER_CUTOFF"),P&&O)X=h.getOrCreateProgram("modelDepth",{defines:Z}),J=bf(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(n.matrix)),ee=O.getShadowPassColorMode();else{dc(Z,Y,F,h,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),X=h.getOrCreateProgram("model",{defines:Z,overrideFog:U});const ce=F.material,xe=ce.pbrMetallicRoughness,_e=t.paint.get("model-opacity").constantOr(1),ge=t.paint.get("model-emissive-strength").constantOr(0);J=lc(g.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,h,_e,xe.baseColorFactor.toRenderColor(null),ce.emissiveFactor,xe.metallicFactor,xe.roughnessFactor,ce,ge,t,p),O&&(x.shadowUniformsInitialized?X.setShadowUniformValues(C,O.getShadowUniformValues()):(O.setupShadows(g.toUnwrapped(),X,"model-tile",g.overscaledZ),x.shadowUniformsInitialized=!0)),ee=oe.shouldRenderCutoff||_e<1||ce.alphaMode!=="OPAQUE"?zi.alphaBlended:zi.unblended}h.uploadCommonUniforms(C,X,g.toUnwrapped(),null,oe);const fe=F.material.doubleSided?ci.disabled:ci.backCCW;if(u.instancedDataArray.length>20)Y.push(u.instancedDataBuffer),X.draw(h,C.gl.TRIANGLES,k,xi.disabled,ee,fe,J,t.id,F.vertexBuffer,F.indexBuffer,F.segments,t.paint,h.transform.zoom,void 0,Y,u.instancedDataArray.length);else{const ce=P?"u_instance":"u_normal_matrix";for(let xe=0;xe<u.instancedDataArray.length;++xe)J[ce]=new Float32Array(u.instancedDataArray.arrayBuffer,64*xe,16),X.draw(h,C.gl.TRIANGLES,k,xi.disabled,ee,fe,J,t.id,F.vertexBuffer,F.indexBuffer,F.segments,t.paint,h.transform.zoom,void 0,Y)}}if(n.children)for(const F of n.children)$s(h,t,F,u,p,g,x)}const ga=[1,-1,1];function fh(h,t,n,u){if(!n.modelManager)return!0;const p=n.modelManager;if(!n.shadowRenderer)return!0;const g=n.shadowRenderer,x=t.aabb;let C=!0,P=h.maxHeight;if(P===0){let k=0;for(const U in h.instancesPerModel){const F=p.getModel(U,u);F?k=Math.max(k,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):C=!1}P=h.maxScale*k*1.41+h.maxVerticalOffset,C&&(h.maxHeight=P)}x.max[2]=P,x.min[2]+=h.terrainElevationMin,x.max[2]+=h.terrainElevationMax,s.ad.vec3.transformMat4(x.min,x.min,t.tileMatrix),s.ad.vec3.transformMat4(x.max,x.max,t.tileMatrix);const O=x.intersects(g.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=O===2),O===0}function ph(h,t){const n=h.uniformValues.u_cutoff_params[0],u=h.uniformValues.u_cutoff_params[1],p=h.uniformValues.u_cutoff_params[2],g=h.uniformValues.u_cutoff_params[3];return u===n||g===p?1:s.ay(((t-n)/(u-n)-p)/(g-p),0,1)}function md(h,t,n,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();s.ad.mat4.multiply(p,p,h);const g=s.ad.vec4.fromValues(n.min[0],n.min[1],n.min[2],1);let x=s.ad.vec4.transformMat4(s.ad.vec4.create(),g,p),C=x,P=x;g[1]=n.max[1],x=s.ad.vec4.transformMat4(s.ad.vec4.create(),g,p),C=x[1]<C[1]?x:C,P=x[1]>P[1]?x:P,g[0]=n.max[0],x=s.ad.vec4.transformMat4(s.ad.vec4.create(),g,p),C=x[1]<C[1]?x:C,P=x[1]>P[1]?x:P,g[1]=n.min[1],x=s.ad.vec4.transformMat4(s.ad.vec4.create(),g,p),C=x[1]<C[1]?x:C,P=x[1]>P[1]?x:P;const O=s.ay(u[0],0,1),k=100*t.pixelsPerMeter*s.ay(u[1],0,1),U=s.ay(u[2],0,1),F=s.ad.vec4.lerp(s.ad.vec4.create(),C,P,O),Z=Math.tan(.5*t.fovX),Y=-F[2]*Z;if(k===0)return F[1]<-Math.abs(Y)?U:1;const X=(-Math.abs(Y)-F[1])/k,J=(oe,fe,ce)=>(1-ce)*oe+ce*fe,ee=s.ay(J(1,U,X),U,1);return J(1,ee,s.ay((t.pitch-20)/20,0,1))}class _d{}class vl{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,u){{const U=this._storage.get(n.id);if(U)return U.lastUsedFrameIdx=t,U.buf}const p=u.gl,g=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),x=new ArrayBuffer(g),C=new Int16Array(x);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const P=new s.dt;for(let U=0;U<g/2;U+=3){const F=C[U],Z=C[U+1],Y=C[U+2];P.emplaceBack(F,Z),P.emplaceBack(Z,Y),P.emplaceBack(Y,F)}const O=u.bindVertexArrayOES.current,k=new _d;return k.buf=new Ps(u,P),k.lastUsedFrameIdx=t,this._storage.set(n.id,k),u.bindVertexArrayOES.set(O),k.buf}update(t){for(const[n,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}class gd{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const co=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class yd{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class au{constructor(t,n){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...n,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...n,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const mh=s.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class vd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const x=new s.du,C=new s.aV;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(x,mh.members),this.vignetteIdx=t.context.createIndexBuffer(C)}const p=s.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const x={u_vignetteShape:(g={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:g.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,Wt.disabled,xi.disabled,zi.alphaBlended,ci.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,p)}var g}}class Fr{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const u=t.getFreeCameraOptions().position,p=u.toAltitude(),g=u.toLngLat(),x=s.ak(g.lng),C=s.ak(g.lat),P=t.pixelsPerMeter/n,O=x*s.dv,k=s.dv*Math.log(Math.tan(Math.PI/4+C/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+k,F=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+O)*P,this._accumulatedOffsetY+=U*P,this._accumulatedElevation+=F*P,this._offsetXPrev=O,this._offsetYPrev=k,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function xd(h,t){return[-(h[0]-Math.floor(h[0]/t)*t),-(h[1]-Math.floor(h[1]/t)*t),-(h[2]-Math.floor(h[2]/t)*t)]}function ou(h){const t=s.dl(1323123451230),n=[];for(let u=0;u<h;++u){const p=2*t()-1,g=2*t()-1,x=2*t()-1;n.push(s.ad.vec3.fromValues(p,g,x))}return n}function ks(h,t,n,u,p){const g=s.ay((p-n)/(u-n),0,1);return(1-g)*h+g*t}class _h{constructor(t){this._movement=new Fr,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new vd,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const p=u.starsProjMatrix,g=s.ad.quat.identity([]);s.ad.quat.rotateX(g,g,s.ak(90)-u._pitch),s.ad.quat.rotateZ(g,g,-u.angle);const x=s.ad.mat4.fromQuat(new Float32Array(16),g),C=s.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),P=s.ad.mat4.transpose([],C),O=s.ad.mat4.multiply([],P,x),k=Date.now()/1e3;return this._accumulatedTimeFromStart+=(k-this._prevTime)*n,this._prevTime=k,{projectionMatrix:p,modelviewMatrix:O}}}class gh extends _h{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new au(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const u=ou(this.particlesCount),p=new s.dw,g=new s.aV;let x=0;const C=s.dl(1323123451230);for(let P=0;P<u.length;++P){const O=u[P],k=[2*C()-1,C(),C(),C()];p.emplaceBack(O[0],O[1],O[2],-1,-1,...k),p.emplaceBack(O[0],O[1],O[2],1,-1,...k),p.emplaceBack(O[0],O[1],O[2],1,1,...k),p.emplaceBack(O[0],O[1],O[2],-1,1,...k),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=n.createVertexBuffer(p,co.members),this.particlesIdx=n.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(n.revealStart>u)return;const p=ks(0,1,n.revealStart,n.revealStart+n.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const g=structuredClone(this._params);let x=[-g.direction.x,g.direction.y,-100];s.ad.vec3.normalize(x,x);const C=structuredClone(this._vignetteParams);C.strength*=p,g.overrideStyleParameters||(g.intensity=t.style.rain.state.density,g.timeFactor=t.style.rain.state.intensity,g.color=structuredClone(t.style.rain.state.color),x=structuredClone(t.style.rain.state.direction),g.screenThinning.intensity=t.style.rain.state.centerThinning,g.dropletSizeX=t.style.rain.state.dropletSize[0],g.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],g.distortionStrength=100*t.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(t.style.rain.state.vignetteColor));const P=this.updateOnRender(t,g.timeFactor),O=t.context,k=O.gl,U=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(O,{width:t.width,height:t.height,data:null},k.RGBA8)),g.distortionStrength>0&&(O.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const F=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(O,F),O.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Z=[g.color.r,g.color.g,g.color.b,g.color.a],Y=(X,J)=>{const ee=xd(this._movement.getPosition(),X),oe=g.dropletSizeX,fe=g.dropletSizeX*g.dropletSizeYScale,ce=t.width/2,xe=t.height/2,_e=ks(0,g.screenThinning.start,0,1,g.screenThinning.intensity),ge=ks(.001,g.screenThinning.range,0,1,g.screenThinning.intensity),ye=ks(0,g.screenThinning.particleOffset,0,1,g.screenThinning.intensity),we=(Ae={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:g.velocityConeAperture,velocity:g.velocity,boxSize:X,rainDropletSize:[oe,fe],distortionStrength:g.distortionStrength,rainDirection:x,color:Z,screenSize:[U.width,U.height],thinningCenterPos:[ce,xe],thinningShape:[_e,ge,Math.pow(10,g.screenThinning.fadePower)],thinningAffectedRatio:g.screenThinning.affectedRatio,thinningParticleOffset:ye,shapeDirectionalPower:g.shapeDirPower,shapeNormalPower:g.shapeNormalPower,mode:J?0:1},{u_modelview:Float32Array.from(Ae.modelview),u_projection:Float32Array.from(Ae.projection),u_time:Ae.time,u_cam_pos:Ae.camPos,u_texScreen:0,u_velocityConeAperture:Ae.velocityConeAperture,u_velocity:Ae.velocity,u_boxSize:Ae.boxSize,u_rainDropletSize:Ae.rainDropletSize,u_distortionStrength:Ae.distortionStrength,u_rainDirection:Ae.rainDirection,u_color:Ae.color,u_screenSize:Ae.screenSize,u_thinningCenterPos:Ae.thinningCenterPos,u_thinningShape:Ae.thinningShape,u_thinningAffectedRatio:Ae.thinningAffectedRatio,u_thinningParticleOffset:Ae.thinningParticleOffset,u_shapeDirectionalPower:Ae.shapeDirectionalPower,u_shapeNormalPower:Ae.shapeNormalPower,u_mode:Ae.mode});var Ae;const je=Math.round(g.intensity*this.particlesCount),Be=s.b8.simpleSegment(0,0,4*je,2*je);F.draw(t,k.TRIANGLES,Wt.disabled,xi.disabled,zi.alphaBlended,ci.disabled,we,"rain_particles",this.particlesVx,this.particlesIdx,Be)};g.distortionStrength>0&&Y(g.boxSize,!0),Y(g.boxSize,!1),this._vignette.draw(t,C)}}const bd=s.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class pc extends _h{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new au(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const u=ou(this.particlesCount),p=new s.dx,g=new s.aV;let x=0;const C=s.dl(1323123451230);for(let P=0;P<u.length;++P){const O=u[P],k=C(),U=C(),F=C(),Z=[P/u.length,k,U,F],Y=[C(),C()];p.emplaceBack(O[0],O[1],O[2],-1,-1,...Z,...Y),p.emplaceBack(O[0],O[1],O[2],1,-1,...Z,...Y),p.emplaceBack(O[0],O[1],O[2],1,1,...Z,...Y),p.emplaceBack(O[0],O[1],O[2],-1,1,...Z,...Y),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=n.createVertexBuffer(p,bd.members),this.particlesIdx=n.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let u=[-n.direction.x,n.direction.y,-100];s.ad.vec3.normalize(u,u);const p=structuredClone(this._vignetteParams),g=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=t.transform.zoom;if(g.revealStart>x)return;const C=ks(0,1,g.revealStart,g.revealStart+g.revealRange,x);p.strength*=C,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const P=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const O=t.context,k=O.gl,U=t.transform,F=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(O,F),((Z,Y,X)=>{const J=xd(this._movement.getPosition(),Z),ee=U.width/2,oe=U.height/2,fe=ks(0,X.screenThinning.start,0,1,X.screenThinning.intensity),ce=ks(.001,X.screenThinning.range,0,1,X.screenThinning.intensity),xe=ks(0,X.screenThinning.particleOffset,0,1,X.screenThinning.intensity),_e=(ge={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:X.velocityConeAperture,velocity:X.velocity,horizontalOscillationRadius:X.horizontalOscillationRadius,horizontalOscillationRate:X.horizontalOscillationRate,boxSize:Z,billboardSize:1*X.billboardSize,simpleShapeParameters:[X.shapeFadeStart,X.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[ee,oe],thinningShape:[fe,ce,Math.pow(10,X.screenThinning.fadePower)],thinningAffectedRatio:X.screenThinning.affectedRatio,thinningParticleOffset:xe,color:[X.color.r,X.color.g,X.color.b,X.color.a],direction:u},{u_modelview:Float32Array.from(ge.modelview),u_projection:Float32Array.from(ge.projection),u_time:ge.time,u_cam_pos:ge.camPos,u_velocityConeAperture:ge.velocityConeAperture,u_velocity:ge.velocity,u_horizontalOscillationRadius:ge.horizontalOscillationRadius,u_horizontalOscillationRate:ge.horizontalOscillationRate,u_boxSize:ge.boxSize,u_billboardSize:ge.billboardSize,u_simpleShapeParameters:ge.simpleShapeParameters,u_screenSize:ge.screenSize,u_thinningCenterPos:ge.thinningCenterPos,u_thinningShape:ge.thinningShape,u_thinningAffectedRatio:ge.thinningAffectedRatio,u_thinningParticleOffset:ge.thinningParticleOffset,u_particleColor:ge.color,u_direction:ge.direction});var ge;const ye=Math.round(X.intensity*this.particlesCount),we=s.b8.simpleSegment(0,0,4*ye,2*ye);this.particlesVx&&this.particlesIdx&&F.draw(t,k.TRIANGLES,Wt.disabled,xi.disabled,zi.alphaBlended,ci.disabled,_e,"snow_particles",this.particlesVx,this.particlesIdx,we)})(n.boxSize,0,n),this._vignette.draw(t,p)}}const yh={symbol:function(h,t,n,u,p){if(h.renderPass!=="translucent")return;const g=xi.disabled,x=h.colorModeForRenderPass(),C=n.layout.get("text-variable-anchor"),P=n.layout.get("text-size-scale-range"),O=s.ay(h.scaleFactor,P[0],P[1]);C&&function(F,Z,Y,X,J,ee,oe,fe){const ce=Z.transform,xe=J==="map",_e=ee==="map";for(const ge of F){const ye=X.getTile(ge),we=ye.getBucket(Y);if(!we||!we.text||!we.text.segments.get().length)continue;const Ae=s.bp(we.textSizeData,ce.zoom,fe),je=Hs(ge,we.getProjection(),ce),Be=ce.calculatePixelsToTileUnitsMatrix(ye),Qe=xr(je,ye.tileID.canonical,_e,xe,ce,we.getProjection(),Be),nt=we.hasIconTextFit()&&we.hasIconData();if(Ae){const dt=Math.pow(2,ce.zoom-ye.tileID.overscaledZ);cs(we,xe,_e,oe,s.cY,ce,Qe,ge,dt,Ae,nt)}}}(u,h,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),p,O);const k=n.paint.get("icon-opacity").constantOr(1)!==0,U=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||U)?hn(h,t,n,u,g,x):(k&&hn(h,t,n,u,g,x,{onlyIcons:!0}),U&&hn(h,t,n,u,g,x,{onlyText:!0})),t.map.showCollisionBoxes&&(_n(h,t,n,u,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),_n(h,t,n,u,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,n,u){if(h.renderPass!=="translucent")return;const p=n.paint.get("circle-opacity"),g=n.paint.get("circle-stroke-width"),x=n.paint.get("circle-stroke-opacity"),C=n.layout.get("circle-sort-key").constantOr(1)!==void 0,P=n.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const O=h.context,k=O.gl,U=h.transform,F=h.depthModeForSublayer(0,Wt.ReadOnly),Z=xi.disabled,Y=h.colorModeForDrapableLayerRenderPass(P),X=U.projection.name==="globe",J=[s.av(U.center.lng),s.aC(U.center.lat)],ee=[];for(let fe=0;fe<u.length;fe++){const ce=u[fe],xe=t.getTile(ce),_e=xe.getBucket(n);if(!_e||_e.projection.name!==U.projection.name)continue;const ge=_e.programConfigurations.get(n.id),ye=s.cZ(n),we=h.isTileAffectedByFog(ce);X&&ye.push("PROJECTION_GLOBE_VIEW"),ye.push("DEPTH_D24"),h.terrain&&U.depthOcclusionForSymbolsAndCircles&&ye.push("DEPTH_OCCLUSION");const Ae=h.getOrCreateProgram("circle",{config:ge,defines:ye,overrideFog:we}),je=_e.layoutVertexBuffer,Be=_e.globeExtVertexBuffer,Qe=_e.indexBuffer,nt=U.projection.createInversionMatrix(U,ce.canonical),dt={programConfiguration:ge,program:Ae,layoutVertexBuffer:je,globeExtVertexBuffer:Be,indexBuffer:Qe,uniformValues:s.c_(h,ce,xe,nt,J,n),tile:xe};if(C){const Le=_e.segments.get();for(const et of Le)ee.push({segments:new s.b8([et]),sortKey:et.sortKey,state:dt})}else ee.push({segments:_e.segments,sortKey:0,state:dt})}C&&ee.sort((fe,ce)=>fe.sortKey-ce.sortKey);const oe={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const fe of ee){const{programConfiguration:ce,program:xe,layoutVertexBuffer:_e,globeExtVertexBuffer:ge,indexBuffer:ye,uniformValues:we,tile:Ae}=fe.state,je=fe.segments;h.terrain&&h.terrain.setupElevationDraw(Ae,xe,oe),h.uploadCommonUniforms(O,xe,Ae.tileID.toUnwrapped()),xe.draw(h,k.TRIANGLES,F,Z,Y,ci.disabled,we,n.id,_e,ye,je,n.paint,U.zoom,ce,[ge])}},heatmap:function(h,t,n,u){if(n.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const p=h.context,g=p.gl,x=xi.disabled,C=new zi([g.ONE,g.ONE,g.ONE,g.ONE],s.al.transparent,[!0,!0,!0,!0]);(function(Z,Y,X,J){const ee=Z.gl,oe=Y.width*J,fe=Y.height*J;Z.activeTexture.set(ee.TEXTURE1),Z.viewport.set([0,0,oe,fe]);let ce=X.heatmapFbo;if(!ce||ce&&(ce.width!==oe||ce.height!==fe)){ce&&ce.destroy();const xe=ee.createTexture();ee.bindTexture(ee.TEXTURE_2D,xe),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR),ce=X.heatmapFbo=Z.createFramebuffer(oe,fe,!0,null),function(_e,ge,ye,we,Ae,je){const Be=_e.gl;Be.texImage2D(Be.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?Be.RGBA16F:Be.RGBA,Ae,je,0,Be.RGBA,_e.extRenderToTextureHalfFloat?Be.HALF_FLOAT:Be.UNSIGNED_BYTE,null),we.colorAttachment.set(ye)}(Z,0,xe,ce,oe,fe)}else ee.bindTexture(ee.TEXTURE_2D,ce.colorAttachment.get()),Z.bindFramebuffer.set(ce.framebuffer)})(p,h,n,h.transform.projection.name==="globe"?.5:.25),p.clear({color:s.al.transparent});const P=h.transform,O=P.projection.name==="globe",k=O?["PROJECTION_GLOBE_VIEW"]:[],U=O?ci.frontCCW:ci.disabled,F=[s.av(P.center.lng),s.aC(P.center.lat)];for(let Z=0;Z<u.length;Z++){const Y=u[Z];if(t.hasRenderableParent(Y))continue;const X=t.getTile(Y),J=X.getBucket(n);if(!J||J.projection.name!==P.projection.name)continue;const ee=h.isTileAffectedByFog(Y),oe=J.programConfigurations.get(n.id),fe=h.getOrCreateProgram("heatmap",{config:oe,defines:k,overrideFog:ee}),{zoom:ce}=h.transform;h.terrain&&h.terrain.setupElevationDraw(X,fe),h.uploadCommonUniforms(p,fe,Y.toUnwrapped());const xe=P.projection.createInversionMatrix(P,Y.canonical);fe.draw(h,g.TRIANGLES,Wt.disabled,x,C,U,ac(h,Y,X,xe,F,ce,n.paint.get("heatmap-intensity")),n.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,n.paint,h.transform.zoom,oe,O?[J.globeExtVertexBuffer]:null)}p.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(p,g){const x=p.context,C=x.gl,P=g.heatmapFbo;if(!P)return;x.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,P.colorAttachment.get()),x.activeTexture.set(C.TEXTURE1);let O=g.colorRampTexture;O||(O=g.colorRampTexture=new s.T(x,g.colorRamp,C.RGBA8)),O.bind(C.LINEAR,C.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,C.TRIANGLES,Wt.disabled,xi.disabled,p.colorModeForRenderPass(),ci.disabled,((k,U,F,Z)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,g),g.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,g.paint,p.transform.zoom)}(h,n))},line:function(h,t,n,u){if(h.renderPass!=="translucent")return;const p=n.paint.get("line-opacity"),g=n.paint.get("line-width");if(p.constantOr(1)===0||g.constantOr(1)===0)return;const x=n.paint.get("line-emissive-strength"),C=n.paint.get("line-occlusion-opacity"),P=n.layout.get("line-elevation-reference"),O=n.layout.get("line-width-unit")==="meters",k=P==="sea",U=h.context,F=U.gl;if(n.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const Z=n.layout.get("line-cross-slope"),Y=Z!==void 0,X=Z<1,J=h.colorModeForDrapableLayerRenderPass(x),ee=h.terrain&&h.terrain.renderingToTexture,oe=ee?1:s.q.devicePixelRatio,fe=n.paint.get("line-dasharray"),ce=fe.constantOr(1),xe=n.layout.get("line-cap"),_e=fe.constantOr(null),ge=xe.constantOr(null),ye=n.paint.get("line-pattern"),we=ye.constantOr(1),Ae=ye.constantOr(null),je=n.paint.get("line-opacity").constantOr(1);let Be=!we&&je!==1||h.depthOcclusion&&C>0&&C<1;const Qe=n.paint.get("line-gradient"),nt=we?"linePattern":"line",dt=s.c$(n);let Le;if(ee&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(Be=!1),C!==0&&h.depthOcclusion){const Oe=n.paint._values["line-opacity"];Oe&&Oe.value&&Oe.value.kind==="constant"?Le=Oe.value:s.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}g.value.kind!=="constant"&&g.value.isLineProgressConstant===!1&&dt.push("VARIABLE_LINE_WIDTH");const et=(Oe,tt,Xe,st,Ge,rt)=>{for(const St of Oe){const Et=t.getTile(St);if(we&&!Et.patternsLoaded())continue;const It=Et.getBucket(n);if(!It||It.hasZOffset&&!Ge||!It.hasZOffset&&Ge)continue;h.prepareDrawTile();const Vt=It.programConfigurations.get(n.id),di=h.isTileAffectedByFog(St),Qt=h.getOrCreateProgram(nt,{config:Vt,defines:tt,overrideFog:di,overrideRtt:!Ge&&void 0});if(Ae&&Et.imageAtlas){const Ht=s.d0.from(Ae).getPrimary().scaleSelf(oe).toString(),At=Et.imageAtlas.patternPositions.get(Ht);At&&Vt.setConstantPatternPositions(At)}if(!we&&_e&&ge&&Et.lineAtlas){const Ht=Et.lineAtlas.getDash(_e,ge);Ht&&Vt.setConstantPatternPositions(Ht)}let[ui,li]=n.paint.get("line-trim-offset");(ge==="round"||ge==="square")&&ui!==li&&(ui===0&&(ui-=1),li===1&&(li+=1));const Ui=ee?St.projMatrix:null,sn=O?1/It.tileToMeter/s.at(Et,1,h.transform.zoom):1,Si=O?1/It.tileToMeter/s.at(Et,1,Math.floor(h.transform.zoom)):1,ii=we?s.d1(h,Et,n,Ui,oe,sn,Si,[ui,li]):s.d2(h,Et,n,Ui,It.lineClipsArray.length,oe,sn,Si,[ui,li]);if(Qe){const Ht=It.gradients[n.id];let At=Ht.texture;if(n.gradientVersion!==Ht.version){let Ei=256;if(n.stepInterpolant){const Xi=t.getSource().maxzoom,qi=St.canonical.z===Xi?Math.ceil(1<<h.transform.maxZoom-St.canonical.z):1;Ei=s.ay(s.d3(It.maxLineLength/s.ai*1024*qi),256,U.maxTextureSize)}Ht.gradient=s.d4({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:Ei,image:Ht.gradient||void 0,clips:It.lineClipsArray}),Ht.texture?Ht.texture.update(Ht.gradient):Ht.texture=new s.T(U,Ht.gradient,F.RGBA8),Ht.version=n.gradientVersion,At=Ht.texture}U.activeTexture.set(F.TEXTURE1),At.bind(n.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}ce&&(U.activeTexture.set(F.TEXTURE0),Et.lineAtlasTexture&&Et.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),Vt.updatePaintBuffers()),we&&(U.activeTexture.set(F.TEXTURE0),Et.imageAtlasTexture&&Et.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Vt.updatePaintBuffers()),Ge&&!k&&h.terrain.setupElevationDraw(Et,Qt),h.uploadCommonUniforms(U,Qt,St.toUnwrapped());const bi=Ht=>{Le!=null&&(Le.value=je*C),Qt.draw(h,F.TRIANGLES,Xe,Ht,J,ci.disabled,ii,n.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,n.paint,h.transform.zoom,Vt,[It.layoutVertexBuffer2,It.patternVertexBuffer,It.zOffsetVertexBuffer]),Le!=null&&(Le.value=je)};if(Be&&!Ge){const Ht=h.stencilModeForClipping(St).ref;Ht===0&&ee&&U.clear({stencil:0});const At={func:F.EQUAL,mask:255};ii.u_alpha_discard_threshold=.8,bi(new xi(At,Ht,255,F.KEEP,F.KEEP,F.INVERT)),ii.u_alpha_discard_threshold=0,bi(new xi(At,Ht,255,F.KEEP,F.KEEP,F.KEEP))}else ii.u_alpha_discard_threshold=Be&&Ge&&rt?.8:0,bi(Ge?st:h.stencilModeForClipping(St))}};if(n.hasNonElevatedBuckets){const Oe=!ee&&h.terrain;C!==0&&Oe?s.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):Oe?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):et(u,dt,h.depthModeForSublayer(0,Wt.ReadOnly),xi.disabled,!1,!0)}if(n.hasElevatedBuckets){dt.push("ELEVATED"),Y&&dt.push(X?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),k&&dt.push("ELEVATION_REFERENCE_SEA");const Oe=Be?h.stencilModeFor3D():xi.disabled,tt=new Wt(h.depthOcclusion?F.GREATER:F.LEQUAL,Wt.ReadOnly,h.depthRangeFor3D);h.forceTerrainMode=!0,et(u,dt,tt,Oe,!0,!0),Be&&et(u,dt,tt,Oe,!0,!1),h.forceTerrainMode=!1}Be&&(h.resetStencilClippingMasks(),ee&&U.clear({stencil:0})),C===0||h.depthOcclusion||ee||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,n,u){const p=n.paint.get("fill-color"),g=n.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const x=n.paint.get("fill-emissive-strength"),C=h.colorModeForDrapableLayerRenderPass(x),P=n.paint.get("fill-pattern"),O=h.opaquePassEnabledForLayer()&&!P.constantOr(1)&&p.constantOr(s.al.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";let k="none";n.layout.get("fill-elevation-reference")!=="none"?k="road":n.paint.get("fill-z-offset").constantOr(1)!==0&&(k="offset");const U=!(!h.terrain||!h.terrain.enabled),F={painter:h,sourceCache:t,layer:n,coords:u,colorMode:C,elevationType:k,terrainEnabled:U,pass:O};if(k!=="offset"){if(ld(F,!1),k==="road"){const Z=!U&&h.renderPass==="translucent";Z&&dl(h,t,n,u,"geometry"),ld(F,!0,xi.disabled),Z&&function(Y){const{painter:X,sourceCache:J,layer:ee,coords:oe,colorMode:fe}=Y,ce=X.context.gl,xe=new Wt(X.context.gl.LEQUAL,Wt.ReadOnly,X.depthRangeFor3D);for(const _e of oe){const ge=J.getTile(_e),ye=ge.getBucket(ee);if(!ye)continue;const we=ye.elevatedStructures;if(!we||!we.renderableSegments||we.renderableSegments.segments[0].primitiveLength===0)continue;X.prepareDrawTile();const Ae=ye.bufferData.programConfigurations.get(ee.id),je=X.isTileAffectedByFog(_e),Be=X.getOrCreateProgram("elevatedStructures",{config:Ae,overrideFog:je,defines:["NORMAL_OFFSET"]}),Qe={u_matrix:X.translatePosMatrix(_e.projMatrix,ge,ee.paint.get("fill-translate"),ee.paint.get("fill-translate-anchor"))};X.uploadCommonUniforms(X.context,Be,_e.toUnwrapped()),Be.draw(X,ce.TRIANGLES,xe,xi.disabled,fe,ci.backCCW,Qe,ee.id,we.vertexBuffer,we.indexBuffer,we.renderableSegments,ee.paint,X.transform.zoom,Ae,[we.vertexBufferNormal])}}(F)}}else ld(F,!1,h.stencilModeFor3D())},"fill-extrusion":function(h,t,n,u){const p=n.paint.get("fill-extrusion-opacity"),g=h.context,x=g.gl,C=h.terrain,P=C&&C.renderingToTexture;if(p===0)return;const O=h.conflationActive&&h.style.isLayerClipped(n,t.getSource()),k=h.style.order.indexOf(n.fqid);if(O&&function(U,F,Z,Y,X){for(const J of Y){const ee=F.getTile(J).getBucket(Z);ee&&(ee.updateReplacement(J,U.replacementSource,X),ee.uploadCentroid(U.context))}}(h,t,n,u,k),C||O)for(const U of u){const F=t.getTile(U).getBucket(n);F&&pl(h.context,t,U,F,n,C,O)}if(h.renderPass==="shadow"&&h.shadowRenderer){const U=h.shadowRenderer;if(C&&p<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const F=U.getShadowPassDepthMode(),Z=U.getShadowPassColorMode();sr(h,t,n,u,F,xi.disabled,Z,O)}else if(h.renderPass==="translucent"){const U=!n.paint.get("fill-extrusion-pattern").constantOr(1),F=n.paint.get("fill-extrusion-color").constantOr(s.al.white);if(!P&&F.a!==0){const Z=new Wt(h.context.gl.LEQUAL,Wt.ReadWrite,h.depthRangeFor3D);p===1&&U?sr(h,t,n,u,Z,xi.disabled,zi.unblended,O):(sr(h,t,n,u,Z,xi.disabled,zi.disabled,O),sr(h,t,n,u,Z,h.stencilModeFor3D(),h.colorModeForRenderPass(),O),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&U&&(!C&&h.transform.projection.name!=="globe"||P)){const Z=n.paint.get("fill-extrusion-opacity"),Y=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),J=n.paint.get("fill-extrusion-flood-light-intensity"),ee=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",oe=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(ee?null:n.lut).toArray01().slice(0,3),fe=Y>0&&X>0,ce=J>0,xe=(ge,ye,we)=>(1-we)*ge+we*ye,_e=ge=>{const ye=h.depthModeForSublayer(1,Wt.ReadOnly,x.LEQUAL,!0),we=n.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ae=xe(.1,3,we),je=h._showOverdrawInspector;if(!je){const Be=new xi({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Qe=new zi([x.ONE,x.ONE,x.ONE,x.ONE],s.al.transparent,[!1,!1,!1,!0],x.MIN);fl(h,t,n,u,ye,Be,Qe,ci.disabled,ge,"sdf",Z,Y,X,J,oe,Ae,O,!1)}{const Be=je?xi.disabled:new xi({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Qe=je?h.colorModeForRenderPass():new zi([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],s.al.transparent,[!0,!0,!0,!0]);fl(h,t,n,u,ye,Be,Qe,ci.disabled,ge,"color",Z,Y,X,J,oe,Ae,O,!1)}};if(P){const ge=(ye,we,Ae)=>{const je=h.depthModeForSublayer(1,Wt.ReadOnly,x.LEQUAL,!1),Be=n.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Qe=xe(.1,3,Be);{const nt=new zi([x.ONE,x.ONE,x.ONE,x.ONE],s.al.transparent,[!1,!1,!1,!0]);fl(h,t,n,u,je,xi.disabled,nt,ci.disabled,ye,"clear",Z,Y,X,J,oe,Qe,O,we)}{const nt=new xi({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),dt=new zi([x.ONE,x.ONE,x.ONE,x.ONE],s.al.transparent,[!1,!1,!1,!0],x.MIN);fl(h,t,n,u,je,nt,dt,ci.disabled,ye,"sdf",Z,Y,X,J,oe,Qe,O,we)}{const nt=ye?x.ZERO:x.ONE_MINUS_DST_ALPHA,dt=new xi({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Le=new zi([nt,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],s.al.transparent,[!0,!0,!0,!0]);fl(h,t,n,u,je,dt,Le,ci.disabled,ye,"color",Z,Y,X,J,oe,Qe,O,we)}{const nt=new zi([x.ONE,x.ONE,x.ONE,ye?x.ZERO:x.ONE],s.al.transparent,[!1,!1,!1,!0],ye?x.FUNC_ADD:x.MAX);fl(h,t,n,u,je,xi.disabled,nt,ci.disabled,ye,"clear",Z,Y,X,J,oe,Qe,O,we,Ae)}};if(fe||ce){let ye;if(h.prepareDrawTile(),C){const we=C.drapeBufferSize[0],Ae=C.drapeBufferSize[1];ye=C.framebufferCopyTexture,ye&&(!ye||ye.size[0]===we&&ye.size[1]===Ae)||(ye&&ye.destroy(),ye=C.framebufferCopyTexture=new s.T(g,new s.r({width:we,height:Ae}),x.RGBA8)),ye.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,we,Ae)}fe&&ge(!0,!1,ye),ce&&ge(!1,!0,ye)}}else fe&&_e(!0),ce&&_e(!1),(fe||ce)&&h.resetStencilClippingMasks()}}},hillshade:function(h,t,n,u){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const p=h.context,g=h.terrain&&h.terrain.renderingToTexture,[x,C]=h.renderPass!=="translucent"||g?[{},u]:h.stencilConfigForOverlap(u);for(const P of C){const O=t.getTile(P);if(O.needsHillshadePrepare&&h.renderPass==="offscreen")yf(h,O,n);else if(h.renderPass==="translucent"){const k=h.depthModeForSublayer(0,Wt.ReadOnly),U=n.paint.get("hillshade-emissive-strength"),F=h.colorModeForDrapableLayerRenderPass(U),Z=g&&h.terrain?h.terrain.stencilModeForRTTOverlap(P):x[P.overscaledZ];Kc(h,P,O,n,k,Z,F)}}p.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,n,u,p,g){if(h.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const x=h.transform.projection.name==="globe",C=n.paint.get("raster-elevation")!==0,P=C&&x;if(h.renderElevatedRasterBackface&&!P)return;const O=h.context,k=O.gl,U=t.getSource(),F=function(_e,ge,ye,we){const Ae=ge.paint.get("raster-color"),je=_e.type==="raster-array",Be=[],Qe=ge.paint.get("raster-resampling"),nt=ge.paint.get("raster-color-mix");let dt=ge.paint.get("raster-color-range");const Le=[nt[0],nt[1],nt[2],0],et=nt[3];let Oe=Qe==="nearest"?we.NEAREST:we.LINEAR;if(je&&(Be.push("RASTER_ARRAY"),Ae||Be.push("RASTER_COLOR"),Qe==="linear"&&Be.push("RASTER_ARRAY_LINEAR"),Oe=we.NEAREST,!dt&&_e.rasterLayers)){const tt=_e.rasterLayers.find(({id:Xe})=>Xe===ge.sourceLayer);tt&&tt.fields&&tt.fields.range&&(dt=tt.fields.range)}if(dt=dt||[0,1],Ae){Be.push("RASTER_COLOR"),ye.activeTexture.set(we.TEXTURE2),ge.updateColorRamp(dt);let tt=ge.colorRampTexture;tt||(tt=ge.colorRampTexture=new s.T(ye,ge.colorRamp,we.RGBA8)),tt.bind(we.LINEAR,we.CLAMP_TO_EDGE)}return{mix:Le,range:dt,offset:et,defines:Be,resampling:Oe}}(U,n,O,k);if(U instanceof s.aK&&!u.length&&!x)return;const Z=n.paint.get("raster-emissive-strength"),Y=h.colorModeForDrapableLayerRenderPass(Z),X=h.terrain&&h.terrain.renderingToTexture,J=!h.options.moving,ee=n.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(U instanceof s.aK&&!u.length&&(U.onNorthPole||U.onSouthPole)){const _e=C?h.stencilModeFor3D():xi.disabled;return void Fe(!!U.onNorthPole,null,h,t,n,Z,F,ci.disabled,_e)}if(!u.length)return;const[oe,fe]=U instanceof s.aK||X?[{},u]:h.stencilConfigForOverlap(u),ce=fe[fe.length-1].overscaledZ;P&&F.defines.push("PROJECTION_GLOBE_VIEW"),C&&F.defines.push("RENDER_CUTOFF");const xe=(_e,ge,ye)=>{for(const we of _e){const Ae=we.toUnwrapped(),je=t.getTile(we);if(X&&(!je||!je.hasData()))continue;O.activeTexture.set(k.TEXTURE0);const Be=gr(je,U,n,F);if(!Be||!Be.texture)continue;const{texture:Qe,mix:nt,offset:dt,tileSize:Le,buffer:et}=Be;let Oe,tt;X?(Oe=Wt.disabled,tt=we.projMatrix):C?(Oe=new Wt(k.LEQUAL,Wt.ReadWrite,h.depthRangeFor3D),tt=x?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(Ae,J)):(Oe=h.depthModeForSublayer(we.overscaledZ-ce,n.paint.get("raster-opacity")===1?Wt.ReadWrite:Wt.ReadOnly,k.LESS),tt=h.transform.calculateProjMatrix(Ae,J));const Xe=h.terrain&&X?h.terrain.stencilModeForRTTOverlap(we):oe[we.overscaledZ],st=g?0:n.paint.get("raster-fade-duration");je.registerFadeDuration(st);const Ge=t.findLoadedParent(we,0),rt=Jh(je,Ge,t,h.transform,st);let St,Et;h.terrain&&h.terrain.prepareDrawTile(),O.activeTexture.set(k.TEXTURE0),Qe.bind(ee,k.CLAMP_TO_EDGE),O.activeTexture.set(k.TEXTURE1),Ge?(Ge.texture&&Ge.texture.bind(ee,k.CLAMP_TO_EDGE),St=Math.pow(2,Ge.tileID.overscaledZ-je.tileID.overscaledZ),Et=[je.tileID.canonical.x*St%1,je.tileID.canonical.y*St%1]):Qe.bind(ee,k.CLAMP_TO_EDGE),"useMipmap"in Qe&&O.extTextureFilterAnisotropic&&h.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const It=h.transform;let Vt;const di=C?Os(It):[0,0,0,0];let Qt,ui,li,Ui,sn,Si=0;if(P&&U instanceof s.aK&&U.coordinates.length>3)Qt=Float32Array.from(s.bc(s.cI(new s.bT(0,0,0)))),ui=Float32Array.from(It.globeMatrix),li=Float32Array.from(s.cE(It)),Ui=[s.av(It.center.lng),s.aC(It.center.lat)],Vt=U.elevatedGlobePerspectiveTransform,sn=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(P){const At=s.cF(we.canonical);Si=s.cG(At.getCenter().lat),Qt=Float32Array.from(s.bc(s.cI(we.canonical))),ui=Float32Array.from(It.globeMatrix),li=Float32Array.from(s.cE(It)),Ui=[s.av(It.center.lng),s.aC(It.center.lat)],Vt=[0,0],sn=Float32Array.from(s.cH(we.canonical,At,Si,It.worldSize/It._pixelsPerMercatorPixel))}else Vt=U instanceof s.aK?U.perspectiveTransform:[0,0],Qt=new Float32Array(16),ui=new Float32Array(9),li=new Float32Array(16),Ui=[0,0],sn=new Float32Array(9);const ii=rd(tt,Qt,ui,li,sn,Et||[0,0],s.ag(h.transform.zoom),Ui,di,St||1,rt,n,Vt,C?n.paint.get("raster-elevation"):0,2,nt,dt,F.range,Le,et,Z),bi=h.isTileAffectedByFog(we),Ht=h.getOrCreateProgram("raster",{defines:F.defines,overrideFog:bi});if(h.uploadCommonUniforms(O,Ht,Ae),U instanceof s.aK){const At=U.elevatedGlobeVertexBuffer,Ei=U.elevatedGlobeIndexBuffer;if(X||!x)U.boundsBuffer&&U.boundsSegments&&Ht.draw(h,k.TRIANGLES,Oe,xi.disabled,Y,ci.disabled,ii,n.id,U.boundsBuffer,h.quadTriangleIndexBuffer,U.boundsSegments);else if(At&&Ei){const Xi=It.zoom<=s.c6?U.elevatedGlobeSegments:U.getSegmentsForLongitude(It.center.lng);Xi&&Ht.draw(h,k.TRIANGLES,Oe,xi.disabled,Y,ge,ii,n.id,At,Ei,Xi)}}else if(P){Oe=new Wt(k.LEQUAL,Wt.ReadOnly,h.depthRangeFor3D);const At=h.globeSharedBuffers;if(At){const[Ei,Xi,qi]=At.getGridBuffers(Si,!1);Ht.draw(h,k.TRIANGLES,Oe,ye||Xe,h.colorModeForRenderPass(),ge,ii,n.id,Ei,Xi,qi)}}else{const{tileBoundsBuffer:At,tileBoundsIndexBuffer:Ei,tileBoundsSegments:Xi}=h.getTileBoundsBuffers(je);Ht.draw(h,k.TRIANGLES,Oe,Xe,Y,ci.disabled,ii,n.id,At,Ei,Xi)}}if(!(U instanceof s.aK)&&P)for(const we of _e){const Ae=we.canonical.y===(1<<we.canonical.z)-1;we.canonical.y===0&&Fe(!0,we,h,t,n,Z,F,ge,ye||xi.disabled),Ae&&Fe(!1,we,h,t,n,Z,F,ge===ci.frontCW?ci.backCW:ci.frontCW,ye||xi.disabled)}};P?xe(fe,h.renderElevatedRasterBackface?ci.backCW:ci.frontCW,h.stencilModeFor3D()):xe(fe,ci.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,n,u,p,g){h.renderPass==="offscreen"&&function(x,C,P,O){if(!O.length)return;const k=x.context,U=k.gl,F=C.getSource();if(!(F instanceof Ca))return;const Z=Math.ceil(Math.sqrt(P.paint.get("raster-particle-count")));let Y=P.particlePositionRGBAImage;if(!Y||Y.width!==Z){const fe=function(ce){const xe=ce*ce,_e=new Uint8Array(4*xe),ge=function(we){return we|=0,we=Math.imul(2747636419^we,2654435769),we=Math.imul(we^we>>>16,2654435769),((we=Math.imul(we^we>>>16,2654435769))>>>0)/4294967296},ye=1/1.1;for(let we=0;we<xe;we++){const Ae=ye*(ge(2*we+0)+Nr),je=ye*(ge(2*we+1)+Nr),Be=255*Ae%1,Qe=255*je%1,nt=Be,dt=je-Qe/255,Le=Qe;_e[4*we+0]=255*(Ae-Be/255),_e[4*we+1]=255*nt,_e[4*we+2]=255*dt,_e[4*we+3]=255*Le}return _e}(Z);Y=P.particlePositionRGBAImage=new s.r({width:Z,height:Z},fe)}let X=P.particleFramebuffer;X?X.width!==Z&&(X.destroy(),X=P.particleFramebuffer=k.createFramebuffer(Z,Z,!0,null)):X=P.particleFramebuffer=k.createFramebuffer(Z,Z,!0,null);const J=[];for(const fe of O){const ce=C.getTile(fe);if(!(ce instanceof as))continue;const xe=uh(ce,F,P);if(!xe)continue;const _e=[ce.tileSize,ce.tileSize];let ge=P.tileFramebuffer;ge||(ge=P.tileFramebuffer=k.createFramebuffer(_e[0],_e[1],!0,null));let ye=ce.rasterParticleState;ye||(ye=ce.rasterParticleState=new hc(k,fe,_e,Y));const we=ye.update(P.lastInvalidatedAt);ye.particleTextureDimension!==Z&&ye.updateParticleTexture(fe,Y);const Ae=ye.targetColorTexture;ye.targetColorTexture=ye.backgroundColorTexture,ye.backgroundColorTexture=Ae;const je=ye.particleTexture0;ye.particleTexture0=ye.particleTexture1,ye.particleTexture1=je,J.push([fe,xe,ye,we])}if(J.length===0)return;const ee=s.q.now(),oe=P.previousDrawTimestamp?.001*(ee-P.previousDrawTimestamp):.0167;if(P.previousDrawTimestamp=ee,P.hasColorMap()){k.activeTexture.set(U.TEXTURE0+2);let fe=P.colorRampTexture;fe||(fe=P.colorRampTexture=new s.T(k,P.colorRamp,U.RGBA8)),fe.bind(U.LINEAR,U.CLAMP_TO_EDGE)}k.bindFramebuffer.set(P.tileFramebuffer.framebuffer),function(fe,ce,xe){const _e=fe.context,ge=_e.gl,ye=ce.tileFramebuffer;_e.activeTexture.set(ge.TEXTURE0);const we={u_texture:0,u_opacity:1.05*(je=ce.paint.get("raster-particle-fade-opacity-factor"))/(je+.05)},Ae=fe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var je;for(const Be of xe){const[,,Qe,nt]=Be;ye.colorAttachment.set(Qe.targetColorTexture.texture),_e.viewport.set([0,0,ye.width,ye.height]),_e.clear({color:s.al.transparent}),nt&&(Qe.backgroundColorTexture.bind(ge.NEAREST,ge.CLAMP_TO_EDGE),Ae.draw(fe,ge.TRIANGLES,Wt.disabled,xi.disabled,zi.alphaBlended,ci.disabled,we,ce.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments))}}(x,P,J),function(fe,ce,xe,_e){const ge=fe.context,ye=ge.gl,we=xe.tileFramebuffer,Ae=fe.transform.projection.name==="globe",je=xe.paint.get("raster-particle-max-speed");for(const Be of _e){const[Qe,nt,dt]=Be;ge.activeTexture.set(ye.TEXTURE0+0),nt.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),we.colorAttachment.set(dt.targetColorTexture.texture);const Le=fe.getOrCreateProgram("rasterParticleDraw",{defines:nt.defines,overrideFog:!1});ge.activeTexture.set(ye.TEXTURE0+1);const et=nt.scalarData?[]:[0,1,2,3].map(Xe=>s.d7[Xe](Qe));et.push(Qe);const Oe=Qe.canonical.x,tt=Qe.canonical.y;for(const Xe of et){const st=ce.getTile(Ae?Xe.wrapped():Xe);if(!st)continue;const Ge=st.rasterParticleState;if(!Ge)continue;const rt=Xe.canonical.x+(1<<Xe.canonical.z)*(Xe.wrap-Qe.wrap),St=Xe.canonical.y;Ge.particleTexture0.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const Et=ah(1,Ge.particleTexture0.size[0],[rt-Oe,St-tt],0,nt.texture.size,2,je,nt.textureOffset,nt.scale,nt.offset);Le.draw(fe,ye.POINTS,Wt.disabled,xi.disabled,zi.alphaBlended,ci.disabled,Et,xe.id,Ge.particleIndexBuffer,void 0,Ge.particleSegment)}}}(x,C,P,J),k.bindFramebuffer.set(P.particleFramebuffer.framebuffer),function(fe,ce,xe,_e){const ge=fe.context,ye=ge.gl,we=ce.paint.get("raster-particle-max-speed"),Ae=_e*ce.paint.get("raster-particle-speed-factor")*.15,je=function(Qe){return Math.pow(Qe,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Be=ce.particleFramebuffer;ge.viewport.set([0,0,Be.width,Be.height]);for(const Qe of xe){const[,nt,dt]=Qe;ge.activeTexture.set(ye.TEXTURE0+0),nt.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),ge.activeTexture.set(ye.TEXTURE0+1);const Le=dt.particleTexture0;Le.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const et=cl(1,Le.size[0],0,nt.texture.size,we,Ae,je,nt.textureOffset,nt.scale,nt.offset);Be.colorAttachment.set(dt.particleTexture1.texture),ge.clear({color:s.al.transparent}),fe.getOrCreateProgram("rasterParticleUpdate",{defines:nt.defines}).draw(fe,ye.TRIANGLES,Wt.disabled,xi.disabled,zi.unblended,ci.disabled,et,ce.id,fe.viewportBuffer,fe.quadTriangleIndexBuffer,fe.viewportSegments)}}(x,P,J,oe)}(h,t,n,u),h.renderPass==="translucent"&&(function(x,C,P,O,k){const U=x.context,F=U.gl,Z=C.getSource().tileSize,Y=5*(1-s.ae(s.bY,s.bY+1,x.transform.zoom))*Z+P.paint.get("raster-particle-elevation"),X=!x.options.moving,J=x.transform.projection.name==="globe";if(!O.length)return;const[ee,oe]=x.stencilConfigForOverlap(O),fe=[];J&&fe.push("PROJECTION_GLOBE_VIEW");const ce=x.stencilModeFor3D();for(const xe of oe){const _e=xe.toUnwrapped(),ge=C.getTile(xe);if(!ge.rasterParticleState)continue;const ye=ge.rasterParticleState,we=100;ge.registerFadeDuration(we);const Ae=C.findLoadedParent(xe,0),je=Jh(ge,Ae,C,x.transform,we);let Be,Qe;x.terrain&&x.terrain.prepareDrawTile(),U.activeTexture.set(F.TEXTURE0),ye.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),U.activeTexture.set(F.TEXTURE1),Ae&&Ae.rasterParticleState?(Ae.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Be=Math.pow(2,Ae.tileID.overscaledZ-ge.tileID.overscaledZ),Qe=[ge.tileID.canonical.x*Be%1,ge.tileID.canonical.y*Be%1]):ye.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const nt=J?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(_e,X),dt=x.transform,Le=cd(dt),et=s.cF(xe.canonical),Oe=s.cG(et.getCenter().lat);let tt,Xe,st,Ge,rt;J?(tt=Float32Array.from(s.bc(s.cI(xe.canonical))),Xe=Float32Array.from(dt.globeMatrix),st=Float32Array.from(s.cE(dt)),Ge=[s.av(dt.center.lng),s.aC(dt.center.lat)],rt=Float32Array.from(s.cH(xe.canonical,et,Oe,dt.worldSize/dt._pixelsPerMercatorPixel))):(tt=new Float32Array(16),Xe=new Float32Array(9),st=new Float32Array(16),Ge=[0,0],rt=new Float32Array(9));const St=Yt(nt,tt,Xe,st,rt,Qe||[0,0],s.ag(x.transform.zoom),Ge,Le,Be||1,je,Y),Et=x.isTileAffectedByFog(xe),It=x.getOrCreateProgram("rasterParticle",{defines:fe,overrideFog:Et});if(x.uploadCommonUniforms(U,It,_e),J){const Vt=new Wt(F.LEQUAL,Wt.ReadOnly,x.depthRangeFor3D),di=0,Qt=x.globeSharedBuffers;if(Qt){const[ui,li,Ui]=Qt.getGridBuffers(Oe,di!==0);It.draw(x,F.TRIANGLES,Vt,ce,zi.alphaBlended,x.renderElevatedRasterBackface?ci.frontCCW:ci.backCCW,St,P.id,ui,li,Ui)}}else{const Vt=x.depthModeForSublayer(0,Wt.ReadOnly),di=ee[xe.overscaledZ],{tileBoundsBuffer:Qt,tileBoundsIndexBuffer:ui,tileBoundsSegments:li}=x.getTileBoundsBuffers(ge);It.draw(x,F.TRIANGLES,Vt,di,zi.alphaBlended,ci.disabled,St,P.id,Qt,ui,li)}}x.resetStencilClippingMasks()}(h,t,n,u),h.style.map.triggerRepaint())},background:function(h,t,n,u){const p=n.paint.get("background-color"),g=n.paint.get("background-color-use-theme").constantOr("default")==="none",x=n.paint.get("background-opacity"),C=n.paint.get("background-emissive-strength"),P=n.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const O=h.context,k=O.gl,U=h.transform,F=U.tileSize,Z=n.paint.get("background-pattern");let Y;if(Z!==void 0&&(Z===null||(Y=h.imageManager.getPattern(s.I.from(Z.toString()),n.scope,h.style.getLut(n.scope)),!Y)))return;const X=!Z&&p.a===1&&x===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==X)return;const J=xi.disabled,ee=h.depthModeForSublayer(0,X==="opaque"?Wt.ReadWrite:Wt.ReadOnly),oe=h.colorModeForDrapableLayerRenderPass(C),fe=Z?"backgroundPattern":"background";let ce,xe=u;if(xe||(ce=h.getBackgroundTiles(),xe=Object.values(ce).map(_e=>_e.tileID)),Z&&(O.activeTexture.set(k.TEXTURE0),h.imageManager.bind(h.context,n.scope)),P){const _e=h.getOrCreateProgram(fe,{overrideFog:!1,overrideRtt:!0}),ge=new Float32Array(s.ad.mat4.identity([])),ye=new s.aH(0,0,0,0,0),we=Z?sd(ge,C,x,h,0,n.scope,Y,P,{tileID:ye,tileSize:F}):oh(ge,C,x,p.toRenderColor(g?null:n.lut));_e.draw(h,k.TRIANGLES,ee,J,oe,ci.disabled,we,n.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const _e of xe){const ge=h.isTileAffectedByFog(_e),ye=h.getOrCreateProgram(fe,{overrideFog:ge}),we=_e.toUnwrapped(),Ae=u?_e.projMatrix:h.transform.calculateProjMatrix(we);h.prepareDrawTile();const je=t?t.getTile(_e):ce?ce[_e.key]:new la(_e,F,U.zoom,h),Be=Z?sd(Ae,C,x,h,0,n.scope,Y,P,{tileID:_e,tileSize:F}):oh(Ae,C,x,p.toRenderColor(g?null:n.lut));h.uploadCommonUniforms(O,ye,we);const{tileBoundsBuffer:Qe,tileBoundsIndexBuffer:nt,tileBoundsSegments:dt}=h.getTileBoundsBuffers(je);ye.draw(h,k.TRIANGLES,ee,J,oe,ci.disabled,Be,n.id,Qe,nt,dt)}},sky:function(h,t,n){const u=h._atmosphere?s.ag(h.transform.zoom):1,p=n.paint.get("sky-opacity")*u;if(p===0)return;const g=h.context,x=n.paint.get("sky-type"),C=new Wt(g.gl.LEQUAL,Wt.ReadOnly,[0,1]),P=h.frameCounter/1e3%1;x==="atmosphere"?h.renderPass==="offscreen"?n.needsSkyboxCapture(h)&&(function(O,k,U,F){const Z=O.context,Y=Z.gl;let X=k.skyboxFbo;if(!X){X=k.skyboxFbo=Z.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new Rp(Z),k.skyboxTexture=Z.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,k.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let fe=0;fe<6;++fe)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(X.framebuffer),Z.viewport.set([0,0,32,32]);const J=k.getCenter(O,!0),ee=O.getOrCreateProgram("skyboxCapture"),oe=new Float64Array(16);s.ad.mat4.identity(oe),s.ad.mat4.rotateY(oe,oe,.5*-Math.PI),Ir(O,k,ee,oe,J,0),s.ad.mat4.identity(oe),s.ad.mat4.rotateY(oe,oe,.5*Math.PI),Ir(O,k,ee,oe,J,1),s.ad.mat4.identity(oe),s.ad.mat4.rotateX(oe,oe,.5*-Math.PI),Ir(O,k,ee,oe,J,2),s.ad.mat4.identity(oe),s.ad.mat4.rotateX(oe,oe,.5*Math.PI),Ir(O,k,ee,oe,J,3),s.ad.mat4.identity(oe),Ir(O,k,ee,oe,J,4),s.ad.mat4.identity(oe),s.ad.mat4.rotateY(oe,oe,Math.PI),Ir(O,k,ee,oe,J,5),Z.viewport.set([0,0,O.width,O.height])}(h,n),n.markSkyboxValid(h)):h.renderPass==="sky"&&function(O,k,U,F,Z){const Y=O.context,X=Y.gl,J=O.transform,ee=O.getOrCreateProgram("skybox");Y.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,k.skyboxTexture);const oe=((fe,ce,xe,_e,ge)=>({u_matrix:fe,u_sun_direction:ce,u_cubemap:0,u_opacity:_e,u_temporal_offset:ge}))(J.skyboxMatrix,k.getCenter(O,!1),0,F,Z);O.uploadCommonUniforms(Y,ee),ee.draw(O,X.TRIANGLES,U,xi.disabled,O.colorModeForRenderPass(),ci.backCW,oe,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(h,n,C,p,P):x==="gradient"&&h.renderPass==="sky"&&function(O,k,U,F,Z){const Y=O.context,X=Y.gl,J=O.transform,ee=O.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new Rp(Y)),Y.activeTexture.set(X.TEXTURE0);let oe=k.colorRampTexture;oe||(oe=k.colorRampTexture=new s.T(Y,k.colorRamp,X.RGBA8)),oe.bind(X.LINEAR,X.CLAMP_TO_EDGE);const fe=((ce,xe,_e,ge,ye)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:xe,u_radius:s.ak(_e),u_opacity:ge,u_temporal_offset:ye}))(J.skyboxMatrix,k.getCenter(O,!1),k.paint.get("sky-gradient-radius"),F,Z);O.uploadCommonUniforms(Y,ee),ee.draw(O,X.TRIANGLES,U,xi.disabled,O.colorModeForRenderPass(),ci.backCW,fe,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(h,n,C,p,P)},debug:function(h,t,n,u,p,g){for(let x=0;x<n.length;x++)if(p){const O=new s.al(u.r*.8,u.g*.8,u.b*.8,1);Po(h,t,n[x],u,-1,-1,g),Po(h,t,n[x],u,-1,1,g),Po(h,t,n[x],u,1,1,g),Po(h,t,n[x],u,1,-1,g),Po(h,t,n[x],O,0,0,g)}else Po(h,t,n[x],u,0,0,g)},custom:function(h,t,n,u){const p=h.context,g=n.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&n.isDraped(t)){if(h.renderPass==="offscreen"){const x=g.prerender;if(x){if(h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const C=h.transform.pointMerc;x.call(g,p.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.ag(h.transform.zoom),[C.x,C.y],h.transform.pixelsPerMeterRatio)}else x.call(g,p.gl,h.transform.customLayerMatrix());p.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const C=g.renderToTile;if(C){const P=u[0].canonical,O=new s.ac(P.x+u[0].wrap*(1<<P.z),P.y,P.z);p.setDepthMode(Wt.disabled),p.setStencilMode(xi.disabled),p.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),C.call(g,p.gl,O),p.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),p.setColorMode(h.colorModeForRenderPass()),p.setStencilMode(xi.disabled);const x=g.renderingMode==="3d"?new Wt(h.context.gl.LEQUAL,Wt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Wt.ReadOnly);if(p.setDepthMode(x),h.transform.projection.name==="globe"){const C=h.transform.pointMerc;g.render(p.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.ag(h.transform.zoom),[C.x,C.y],h.transform.pixelsPerMeterRatio)}else g.render(p.gl,h.transform.customLayerMatrix());p.setDirty(),h.setBaseState(),p.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,n,u){if(h.renderPass==="opaque")return;const p=n.paint.get("model-opacity").constantOr(1);if(p===0)return;const g=n.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!g||h.terrain&&p<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const x=h.shadowRenderer,C=n.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,C||(x.enabled=!1));const P=()=>{x&&(x.useNormalOffset=!0,C||(x.enabled=!0))},O=t.getSource();if(h.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(ee,oe,fe,ce,xe){const _e=ee.transform;if(_e.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${_e.projection.name} projection is not yet implemented`);const ge=_e.getFreeCameraOptions().position;if(!ee.modelManager)return;const ye=ee.modelManager;fe.modelManager=ye;const we=ee.shadowRenderer;if(!fe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ae=fe._unevaluatedLayout._values["model-id"],je=Object.assign({},fe.layout.get("model-id").parameters),Be=ee.style.order.indexOf(fe.fqid);for(const Qe of ce){const nt=oe.getTile(Qe).getBucket(fe);if(!nt||nt.projection.name!==_e.projection.name)continue;const dt=nt.getModelUris();dt&&!nt.modelsRequested&&(ye.addModelsFromBucket(dt,xe),nt.modelsRequested=!0);const Le=pd(Qe,_e);je.zoom=Le;const et=Ae.possiblyEvaluate(je);if(yl(ee,nt,Qe),Ls.shadowUniformsInitialized=!1,Ls.useSingleShadowCascade=!!we&&we.getMaxCascadeForTile(Qe.toUnwrapped())===0,ee.renderPass==="shadow"&&we){if(ee.currentShadowCascade===1&&nt.isInsideFirstShadowMapFrustum)continue;const Xe=_e.calculatePosMatrix(Qe.toUnwrapped(),_e.worldSize);if(Ls.tileMatrix.set(Xe),Ls.shadowTileMatrix=Float32Array.from(we.calculateShadowPassMatrixFromMatrix(Xe)),Ls.aabb.min.fill(0),Ls.aabb.max[0]=Ls.aabb.max[1]=s.ai,Ls.aabb.max[2]=0,fh(nt,Ls,ee,fe.scope))continue}const Oe=1<<Qe.canonical.z,tt=[((ge.x-Qe.wrap)*Oe-Qe.canonical.x)*s.ai,(ge.y*Oe-Qe.canonical.y)*s.ai,ge.z*Oe*s.ai];ee.conflationActive&&Object.keys(nt.instancesPerModel).length>0&&ee.style.isLayerClipped(fe,oe.getSource())&&nt.updateReplacement(Qe,ee.replacementSource,Be,xe)&&(nt.uploaded=!1,nt.upload(ee.context));for(let Xe in nt.instancesPerModel){const st=nt.instancesPerModel[Xe];st.features.length>0&&(Xe=et.evaluate(st.features[0].feature,{}));const Ge=ye.getModel(Xe,xe);if(Ge&&Ge.uploaded)for(const rt of Ge.nodes)$s(ee,fe,rt,st,tt,Qe,Ls)}}}(h,t,n,u,O.type==="vector"?n.scope:""),void P();if(!O.loaded())return;if(O.type==="batched-model")return function(ee,oe,fe,ce){fe.resetLayerRenderingStats(ee);const xe=ee.context,_e=ee.transform,ge=ee.style.fog,ye=ee.shadowRenderer;if(_e.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${_e.projection.name} projection is not yet implemented`);const we=ee.transform.getFreeCameraOptions().position,Ae=s.ad.vec3.scale([],[we.x,we.y,we.z],ee.transform.worldSize),je=s.ad.vec3.negate([],Ae),Be=s.ad.mat4.identity([]),Qe=s.dm(_e.center.lat,_e.zoom),nt=s.ad.mat4.fromScaling([],[1,1,1/Qe]);s.ad.mat4.translate(Be,Be,je);const dt=fe.paint.get("model-opacity").constantOr(1),Le=new Wt(xe.gl.LEQUAL,Wt.ReadWrite,ee.depthRangeFor3D),et=new Wt(xe.gl.LEQUAL,Wt.ReadOnly,ee.depthRangeFor3D),Oe=new s.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),tt=ee.renderPass==="shadow",Xe=tt&&ye?ye.getCurrentCascadeFrustum():_e.getFrustum(_e.scaleZoom(_e.worldSize)),st=fe.paint.get("model-front-cutoff"),Ge=st[2]<1,rt=wo(ee,fe.paint.get("model-cutoff-fade-range")),St=fe.getLayerRenderingStats();(function(Et,It,Vt,di){const Qt=Et.terrain?Et.terrain.exaggeration():0,ui=Et.transform.zoom;for(const li of di){const Ui=It.getTile(li).getBucket(Vt);Ui&&(Ui.setFilter(Vt.filter),Et.conflationActive&&Ui.updateReplacement(li,Et.replacementSource),Ui.evaluateScale(Et,Vt),Et.terrain&&Qt>0&&Ui.elevationUpdate(Et.terrain,Qt,li,Vt.source),Ui.needsReEvaluation(Et,ui,Vt)&&Ui.evaluate(Vt))}})(ee,oe,fe,ce),function(){let Et,It,Vt;Ge?(Et=ce.length-1,It=-1,Vt=-1):(Et=0,It=ce.length,Vt=1);const di=new Float64Array(16),Qt=s.ad.vec3.create(),ui=new s.P(0,0);for(let li=Et;li!==It;li+=Vt){const Ui=ce[li],sn=oe.getTile(Ui).getBucket(fe);if(!sn||!sn.uploaded)continue;let Si=!1;ye&&(Si=ye.getMaxCascadeForTile(Ui.toUnwrapped())===0);const ii=_e.calculatePosMatrix(Ui.toUnwrapped(),_e.worldSize),bi=sn.modelTraits;!tt&&Ge&&(s.ad.mat4.invert(di,ii),s.ad.vec3.transformMat4(Qt,Ae,di),ui.x=Qt[0],ui.y=Qt[1]);const Ht=[];sn.setFilter(fe.filter);for(const At of sn.getNodesInfo()){if(At.hiddenByReplacement||!At.node.meshes)continue;const Ei=At.node;let Xi=0;ee.terrain&&Ei.elevation&&(Xi=Ei.elevation*ee.terrain.exaggeration());const qi=(()=>{const $i=At.aabb;return Oe.min=[...$i.min],Oe.max=[...$i.max],Oe.min[2]+=Xi,Oe.max[2]+=Xi,s.ad.vec3.transformMat4(Oe.min,Oe.min,ii),s.ad.vec3.transformMat4(Oe.max,Oe.max,ii),Oe})(),jn=At.evaluatedScale;if(jn[0]<=1&&jn[1]<=1&&jn[2]<=1&&qi.intersects(Xe)===0)continue;if(!tt&&Ge){const $i=.16666666666666666;At.cameraCollisionOpacity=Ae[0]>qi.min[0]&&Ae[0]<qi.max[0]&&Ae[1]>qi.min[1]&&Ae[1]<qi.max[1]&&Ae[2]*Qe<qi.max[2]&&Ei.footprint&&s.bA(ui,Ei.footprint)?Math.max(At.cameraCollisionOpacity-$i,0):Math.min(1,At.cameraCollisionOpacity+$i)}const kn=[...ii],fn=Ei.anchor?Ei.anchor[0]:0,Wn=Ei.anchor?Ei.anchor[1]:0;s.ad.mat4.translate(kn,kn,[fn*(jn[0]-1),Wn*(jn[1]-1),Xi]),s.ad.vec3.exactEquals(jn,s.dq)||s.ad.mat4.scale(kn,kn,jn);const $r=s.ad.mat4.multiply([],kn,Ei.matrix),Xr=s.ad.mat4.multiply([],_e.expandedFarZProjMatrix,$r),Ri=s.ad.mat4.multiply([],_e.expandedFarZProjMatrix,kn),Sn=s.ad.vec4.transformMat4([],[fn,Wn,Xi,1],Xr)[2];Ei.hidden=!1;let Wi=dt;tt||(Ge&&(Wi*=At.cameraCollisionOpacity,Wi*=md(kn,_e,At.aabb,st)),Wi*=ph(rt,Sn)),Wi!==0?Ht.push({nodeInfo:At,depth:Sn,opacity:Wi,wvpForNode:Xr,wvpForTile:Ri,nodeModelMatrix:$r,tileModelMatrix:kn}):Ei.hidden=!0}tt||Ht.sort((At,Ei)=>!Ge||At.opacity===1&&Ei.opacity===1?At.depth<Ei.depth?-1:1:At.opacity===1?-1:Ei.opacity===1?1:At.depth>Ei.depth?-1:1);for(const At of Ht){const Ei=At.nodeInfo,Xi=Ei.node;let qi=s.ad.mat4.multiply([],nt,At.tileModelMatrix);s.ad.mat4.multiply(qi,Be,qi);const jn=s.ad.mat4.invert([],qi);s.ad.mat4.transpose(jn,jn),s.ad.mat4.scale(jn,jn,ga),qi=s.ad.mat4.multiply(qi,qi,Xi.matrix);const kn=ee.renderPass==="light-beam",fn=fe.paint.get("model-color-use-theme").constantOr("default")==="none",Wn=bi&s.ds.HasMapboxMeshFeatures,$r=Wn?0:Ei.evaluatedRMEA[0][2];for(let Xr=0;Xr<Xi.meshes.length;++Xr){const Ri=Xi.meshes[Xr],Sn=Xr===Xi.lightMeshIndex;let Wi=At.wvpForNode;if(Sn){if(!kn&&!ee.terrain&&ee.shadowRenderer){ee.currentLayer<ee.firstLightBeamLayer&&(ee.firstLightBeamLayer=ee.currentLayer);continue}Wi=At.wvpForTile}else if(kn)continue;const $i={defines:[]},Rr=[];if(!tt&&ye&&(ye.useNormalOffset=!!Ri.normalBuffer),dc($i.defines,Rr,Ri,ee,fn?null:fe.lut),Wn||$i.defines.push("DIFFUSE_SHADED"),Si&&$i.defines.push("SHADOWS_SINGLE_CASCADE"),St&&(tt?St.numRenderedVerticesInShadowPass+=Ri.vertexArray.length:St.numRenderedVerticesInTransparentPass+=Ri.vertexArray.length),tt){su(Ri,At.nodeModelMatrix,ee,fe);continue}let Rn=null;if(ge){const hs=oo(At.nodeModelMatrix,ee.transform);if(Rn=new Float32Array(hs),_e.projection.name!=="globe"){const Wr=Ri.aabb.min,Na=Ri.aabb.max,[wa,fo]=ge.getOpacityForBounds(hs,Wr[0],Wr[1],Na[0],Na[1]);$i.overrideFog=wa>=Ct||fo>=Ct}}const ar=Ri.material;let na;ar.occlusionTexture&&ar.occlusionTexture.offsetScale&&(na=ar.occlusionTexture.offsetScale,$i.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Dr=ee.getOrCreateProgram("model",$i);!tt&&ye&&ye.setupShadowsFromMatrix(At.tileModelMatrix,Dr,ye.useNormalOffset),ee.uploadCommonUniforms(xe,Dr,null,Rn);const Yn=ar.pbrMetallicRoughness;Yn.metallicFactor=.9,Yn.roughnessFactor=.5;const wr=lc(new Float32Array(Wi),new Float32Array(qi),new Float32Array(jn),new Float32Array(Xi.matrix),ee,At.opacity,Yn.baseColorFactor.toRenderColor(null),ar.emissiveFactor,Yn.metallicFactor,Yn.roughnessFactor,ar,$r,fe,[0,0,0],na);!Sn&&(Ei.hasTranslucentParts||At.opacity<1)&&Dr.draw(ee,xe.gl.TRIANGLES,Le,xi.disabled,zi.disabled,ci.backCCW,wr,fe.id,Ri.vertexBuffer,Ri.indexBuffer,Ri.segments,fe.paint,ee.transform.zoom,void 0,Rr),Dr.draw(ee,xe.gl.TRIANGLES,Sn?et:Le,xi.disabled,Sn||At.opacity<1||Ei.hasTranslucentParts?zi.alphaBlended:zi.unblended,ci.backCCW,wr,fe.id,Ri.vertexBuffer,Ri.indexBuffer,Ri.segments,fe.paint,ee.transform.zoom,void 0,Rr)}}}}()}(h,t,n,u),void P();if(O.type!=="model")return;const k=O.getModels(),U=[],F=h.transform.getFreeCameraOptions().position,Z=s.ad.vec3.scale([],[F.x,F.y,F.z],h.transform.worldSize);s.ad.vec3.negate(Z,Z);const Y=[],X=[];let J=0;for(const ee of k){const oe=n.paint.get("model-rotation").constantOr(null),fe=n.paint.get("model-scale").constantOr(null),ce=n.paint.get("model-translation").constantOr(null);ee.computeModelMatrix(h,oe,fe,ce,!0,!0,!1);const xe=s.ad.mat4.identity([]),_e=s.dm(ee.position.lat,h.transform.zoom),ge=s.ad.mat4.fromScaling([],[1,1,1/_e]);s.ad.mat4.translate(xe,xe,Z),U.push({zScaleMatrix:ge,negCameraPosMatrix:xe});for(const ye of ee.nodes)fc(h.transform,ye,ee.matrix,h.transform.expandedFarZProjMatrix,J,Y,X);J++}if(Y.sort((ee,oe)=>oe.depth-ee.depth),h.renderPass!=="shadow"){if(p===1)for(const ee of X)lo(ee,h,n,U[ee.modelIndex],xi.disabled,h.colorModeForRenderPass());else{for(const ee of X)lo(ee,h,n,U[ee.modelIndex],xi.disabled,zi.disabled);for(const ee of X)lo(ee,h,n,U[ee.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const ee of Y)lo(ee,h,n,U[ee.modelIndex],xi.disabled,h.colorModeForRenderPass());P()}else{for(const ee of X)su(ee.mesh,ee.nodeModelMatrix,h,n);for(const ee of Y)su(ee.mesh,ee.nodeModelMatrix,h,n);P()}}},wd={line:function(h,t,n){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const p of u){const g=t.getTile(p).getBucket(h);if(g&&(g.hasZOffset?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,t,n){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,u.type==="vector"?h.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const g of p)g.upload(n.context)},raster:function(h,t,n){const u=t.getSource();if(!(u instanceof Ca&&u.loaded()))return;const p=h.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const g=h.paint.get("raster-array-band")||u.getInitialBand(p);if(g==null)return;const x=t.getIds().map(C=>t.getTileByID(C));for(const C of x)C.updateNeeded(p,g)&&u.prepareTile(C,p,g)},"raster-particle":function(h,t,n){const u=t.getSource();if(!(u instanceof Ca&&u.loaded()))return;const p=h.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const g=h.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(g==null)return;const x=t.getIds().map(C=>t.getTileByID(C));for(const C of x)C.updateNeeded(p,g)&&u.prepareTile(C,p,g)}},vh={fill:dl};class xl{constructor(t,n,u,p,g){this.context=new so(t,n),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const P of x)this._debugParams.enabledLayers[P]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const P of x)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],P);this.occlusionParams=new gd(g),this.setup(),this.numSublayers=Is.maxUnderzooming+Is.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new To(this),this._wireframeDebugCache=new vl,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,C,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p}updateTerrain(t,n){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Qh(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,n),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=n.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const g=u+.78*(p-u);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Qh(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*s.q.devicePixelRatio,this.height=n*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,n=new s.b5;n.emplaceBack(0,0),n.emplaceBack(s.ai,0),n.emplaceBack(0,s.ai),n.emplaceBack(s.ai,s.ai),this.tileExtentBuffer=t.createVertexBuffer(n,s.b7.members),this.tileExtentSegments=s.b8.simpleSegment(0,0,4,2);const u=new s.b5;u.emplaceBack(0,0),u.emplaceBack(s.ai,0),u.emplaceBack(0,s.ai),u.emplaceBack(s.ai,s.ai),this.debugBuffer=t.createVertexBuffer(u,s.b7.members),this.debugSegments=s.b8.simpleSegment(0,0,4,5);const p=new s.b5;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,s.b7.members),this.viewportSegments=s.b8.simpleSegment(0,0,4,2);const g=new s.aU;g.emplaceBack(0,0,0,0),g.emplaceBack(s.ai,0,s.ai,0),g.emplaceBack(0,s.ai,0,s.ai),g.emplaceBack(s.ai,s.ai,s.ai,s.ai),this.mercatorBoundsBuffer=t.createVertexBuffer(g,s.ba.members),this.mercatorBoundsSegments=s.b8.simpleSegment(0,0,4,2);const x=new s.aV;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const C=new s.b6;for(const O of[0,1,3,2,0])C.emplaceBack(O);this.debugIndexBuffer=t.createIndexBuffer(C),this.emptyTexture=new s.T(t,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.ad.mat4.create();const P=this.context.gl;this.stencilClearMode=new xi({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Wt.disabled,this.stencilClearMode,zi.disabled,ci.disabled,ic(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,u){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const P of u)if(this._tileClippingMaskIDs[P.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=n.id;const p=this.context,g=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(zi.disabled),p.setDepthMode(Wt.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of u){const P=n.getTile(C),O=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:U,tileBoundsSegments:F}=this.getTileBoundsBuffers(P);x.draw(this,g.TRIANGLES,Wt.disabled,new xi({func:g.ALWAYS,mask:0},O,255,g.KEEP,g.KEEP,g.REPLACE),zi.disabled,ci.disabled,ic(C.projMatrix),"$clipping",k,U,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new xi({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new xi({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,u=t.sort((x,C)=>C.overscaledZ-x.overscaledZ),p=u[u.length-1].overscaledZ,g=u[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let C=0;C<g;C++)x[C+p]=new xi({func:n.GEQUAL,mask:255},C+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=g,[x,u]}return[{[p]:xi.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new zi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?zi.unblended:zi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new zi([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new s.al(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,u,p=!1){if(this.depthOcclusion)return new Wt(this.context.gl.GREATER,Wt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return Wt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Wt(u||this.context.gl.LEQUAL,n,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),g=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&u!==0&&(this.depthFBO=new ls(this.context,n,u,!1,"texture"),this.depthTexture=new s.T(this.context,{width:n,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,g),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,u,0,0,n,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,n)=>t+n/this._fpsHistory.length,0))}render(t,n){const u=s.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const p=this.style._mergedLayers,g=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(g).filter(Le=>{const et=p[Le];return!(et.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[et.type]});let C=x(),P=!1,O=!1;for(const Le of C){const et=p[Le];et.type==="circle"&&(P=!0),et.type==="symbol"&&(et.hasInitialOcclusionOpacityProperties?O=!0:P=!0)}let k=C.map(Le=>p[Le]);const U=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let F=0,Z=!1;for(const Le in U){const et=U[Le];et.used&&(et.prepare(this.context),et.getSource().usedInConflation&&++F)}let Y=!1;for(const Le of k)Le.isHidden(this.transform.zoom)||(Le.type==="clip"&&(Y=!0),this.prepareLayer(Le));const X={},J={},ee={},oe={},fe={};for(const Le in U){const et=U[Le];X[Le]=et.getVisibleCoordinates(),J[Le]=X[Le].slice().reverse(),ee[Le]=et.getVisibleCoordinates(!0).reverse(),oe[Le]=et.getShadowCasterCoordinates(),fe[Le]=et.sortCoordinatesByDistance(X[Le])}const ce=Le=>{const et=this.style.getLayerSourceCache(Le);return et&&et.used?et.getSource():null};if(F||Y||this._clippingActiveLastFrame){const Le=[],et=[];let Oe=0;for(const tt of k)this.isSourceForClippingOrConflation(tt,ce(tt))&&(Le.push(tt),et.push(Oe)),Oe++;if(Le&&(Y||Le.length>1)||this._clippingActiveLastFrame){Y=!1;const tt=[];for(let Xe=0;Xe<Le.length;Xe++){const st=Le[Xe],Ge=et[Xe],rt=this.style.getLayerSourceCache(st);if(!rt||!rt.used||!rt.getSource().usedInConflation&&st.type!=="clip")continue;let St=s.dA,Et=s.by.None;const It=[];let Vt=!0;if(st.type==="clip"){St=Ge;for(const di of st.layout.get("clip-layer-types"))Et|=di==="model"?s.by.Model:di==="symbol"?s.by.Symbol:s.by.FillExtrusion;for(const di of st.layout.get("clip-layer-scope"))It.push(di);st.isHidden(this.transform.zoom)?Vt=!1:Y=!0}Vt&&tt.push({layer:st.fqid,cache:rt,order:St,clipMask:Et,clipScope:It})}this.replacementSource.setSources(tt),Z=!0}}this._clippingActiveLastFrame=Y,Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Le=0;Le<k.length;Le++){const et=k[Le],Oe=et.cutoffRange();if(this.longestCutoffRange=Math.max(Oe,this.longestCutoffRange),Oe>0){const tt=ce(et);tt&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom)),et.minzoom&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom))}et.is3D(g)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Le),this._lastOcclusionLayer=Le)}const xe=this.style&&this.style.fog;xe?(this._fogVisible=xe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=xe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ee),this.opaquePassCutoff=0,C=x(),k=C.map(Le=>p[Le]));const _e=this._shadowRenderer;if(_e){_e.updateShadowParameters(this.transform,this.style.directionalLight);for(const Le in U)for(const et of X[Le]){let Oe={min:0,max:0};this.terrain&&(Oe=this.terrain.getMinMaxForTile(et)||Oe),_e.addShadowReceiver(et.toUnwrapped(),Oe.min,Oe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Tf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ye=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ge&&!this._snow&&(this._snow=new pc(this)),!ge&&this._snow&&(this._snow.destroy(),delete this._snow),ye&&!this._rain&&(this._rain=new gh(this)),!ye&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Ha.has(this.context.gl))return;this.renderPass="offscreen";for(const Le of k){const et=t.getLayerSourceCache(Le);if(!Le.hasOffscreenPass()||Le.isHidden(this.transform.zoom))continue;const Oe=et?J[et.id]:void 0;(Le.type==="custom"||Le.type==="raster"||Le.type==="raster-particle"||Le.isSky()||Oe&&Oe.length)&&this.renderLayer(this,et,Le,Oe)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,oe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const we=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ae=(()=>{if(n.showOverdrawInspector)return s.al.black;const Le=this.style.fog;if(Le&&this.transform.projection.supportsFog){const et=this.style.getLut(Le.scope);if(!we){const Oe=Le.properties.get("color-use-theme")==="none",tt=Le.properties.get("color").toRenderColor(Oe?null:et).toArray01();return new s.al(...tt)}if(we){const Oe=Le.properties.get("space-color-use-theme")==="none",tt=Le.properties.get("space-color").toRenderColor(Oe?null:et).toArray01();return new s.al(...tt)}}return s.al.transparent})();if(this.context.clear({color:Ae,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const Le=k[this.currentLayer],et=t.getLayerSourceCache(Le);if(Le.isSky())continue;const Oe=et?(Le.is3D(g)?fe:J)[et.id]:void 0;this._renderTileClippingMasks(Le,et,Oe),this.renderLayer(this,et,Le,Oe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const Le=k[this.currentLayer],et=t.getLayerSourceCache(Le);Le.isSky()&&this.renderLayer(this,et,Le,et?J[et.id]:void 0)}function je(Le,et){let Oe;return et&&(Oe=(Le.type==="symbol"?ee:Le.is3D(g)?fe:J)[et.id]),Oe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const Le=k[this.currentLayer];if(Le.type==="raster"||Le.type==="raster-particle"){const et=t.getLayerSourceCache(Le);this.renderLayer(this,et,Le,je(Le,et))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Be=0;_e&&(Be=_e.getShadowCastingLayerCount());let Qe=!1,nt=-1;for(let Le=0;Le<C.length;++Le){const et=k[Le];et.isHidden(this.transform.zoom)||et.is3D(g)&&(nt=Le)}O&&nt===-1&&(P=!0);let dt=!1;for(;this.currentLayer<C.length;){const Le=k[this.currentLayer],et=t.getLayerSourceCache(Le);if(Le.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Le)){if(Le.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!dt&&Le.is3D(g)&&!g){const Oe=this.currentLayer,tt=Xe=>{for(this.currentLayer=0;this.currentLayer<k.length;this.currentLayer++){const st=k[this.currentLayer];if(vh[st.type]){const Ge=this.style.getLayerSourceCache(st);vh[st.type](this,Ge,st,je(st,Ge),Xe)}}};tt("initialize"),tt("reset"),this.currentLayer=Oe,dt=!0}if(P&&!Qe&&this.terrain&&!this.transform.isOrthographic&&(Qe=!0,this.blitDepth()),O&&nt!==-1&&this.currentLayer===nt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Le,et,et?X[et.id]:void 0),this.renderLayer(this,et,Le,je(Le,et)),!this.terrain&&_e&&Be>0&&Le.hasShadowPass()&&--Be==0&&(_e.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Oe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Oe;this.currentLayer++){const tt=k[this.currentLayer];if(!tt.hasLightBeamPass())continue;const Xe=t.getLayerSourceCache(tt);this.renderLayer(this,Xe,tt,Xe?J[Xe.id]:void 0)}this.currentLayer=Oe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Oe=this.currentLayer;this.depthOcclusion=!0;for(const tt of this.layersWithOcclusionOpacity){this.currentLayer=tt;const Xe=k[this.currentLayer],st=t.getLayerSourceCache(Xe),Ge=st?J[st.id]:void 0;this.terrain||this._renderTileClippingMasks(Xe,st,st?X[st.id]:void 0),this.renderLayer(this,st,Xe,Ge)}this.depthOcclusion=!1,this.currentLayer=Oe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Le=null;k.forEach(et=>{const Oe=t.getLayerSourceCache(et);Oe&&!et.isHidden(this.transform.zoom)&&Oe.getVisibleCoordinates().length&&(!Le||Le.getSource().maxzoom<Oe.getSource().maxzoom)&&(Le=Oe)}),Le&&this.options.showTileBoundaries&&yh.debug(this,Le,Le.getVisibleCoordinates(),s.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&yh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Le){const et=Le.transform.padding;dd(Le,Le.transform.height-(et.top||0),3,Zs),dd(Le,et.bottom||0,3,ud),fd(Le,et.left||0,3,wf),fd(Le,Le.transform.width-(et.right||0),3,hd);const Oe=Le.transform.centerPoint;(function(tt,Xe,st,Ge){_l(tt,Xe-1,st-10,2,20,Ge),_l(tt,Xe-10,st-1,20,2,Ge)})(Le,Oe.x,Le.transform.height-Oe.y,hh)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:n}=this.transform.projection,u=!n||!n.includes(t.type);if(wd[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);wd[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,n,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||yh[u.type](t,n,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(n.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,u=n.createQuery();this.deferredRenderGpuTimeQueries.push(u),n.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const u in t){const p=t[u],g=this.context.extTimerQuery,x=g.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(p.query),n[u]=x}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let u=0;for(const p of t)u+=n.getQueryParameter(p,n.QUERY_RESULT)/1e6,n.deleteQuery(p);return u}translatePosMatrix(t,n,u,p,g){if(!u[0]&&!u[1])return t;const x=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){const O=Math.sin(x),k=Math.cos(x);u=[u[0]*k-u[1]*O,u[0]*O+u[1]*k]}const C=[g?u[0]:s.at(n,u[0],this.transform.zoom),g?u[1]:s.at(n,u[1],this.transform.zoom),0],P=new Float32Array(16);return s.ad.mat4.translate(P,t,C),P}saveTileTexture(t){const n=t.size[0],u=this._tileTextures[n];u?u.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,g=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(g.push("LIGHTING_3D_MODE"),g.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||g.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||g.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(g.push("TERRAIN"),this.linearFloatFilteringSupported()&&g.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&g.push("GLOBE"),!this._fogVisible||p||n!==void 0&&!n||g.push("FOG","FOG_DITHERING"),p&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}getOrCreateProgram(t,n){this.cache=this.cache||{};const u=n&&n.defines||[],p=n&&n.config,g=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(u),x=nc.cacheKey(Kl[t],t,g,p);return this.cache[x]||(this.cache[x]=new nc(this.context,t,Kl[t],p,ad[t],g)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const g=((x,C,P)=>{const O=x.properties.get("direction"),k=x.properties.get("color-use-theme")==="none",U=x.properties.get("color").toRenderColor(k?null:P.getLut(x.scope)).toArray01(),F=x.properties.get("intensity"),Z=C.properties.get("color-use-theme")==="none",Y=C.properties.get("color").toRenderColor(Z?null:P.getLut(C.scope)).toArray01(),X=C.properties.get("intensity"),J=[O.x,O.y,O.z],ee=s.cN(Y,X),oe=s.cN(U,F);return{u_lighting_ambient_color:ee,u_lighting_directional_dir:J,u_lighting_directional_color:oe,u_ground_radiance:eu(J,oe,ee)}})(u,p,this.style);n.setLightsUniformValues(t,g)}}}uploadCommonUniforms(t,n,u,p,g){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const C=x.getOpacity(this.transform.pitch),P=((O,k,U,F,Z,Y,X,J,ee,oe,fe,ce)=>{const xe=O.transform,_e=k.properties.get("color-use-theme")==="none",ge=k.properties.get("color").toRenderColor(_e?null:O.style.getLut(k.scope)).toArray01();ge[3]=F;const ye=O.frameCounter/1e3%1,[we,Ae]=k.properties.get("vertical-range");return{u_fog_matrix:U?xe.calculateFogTileMatrix(U):ce||O.identityMat,u_fog_range:k.getFovAdjustedRange(xe._fov),u_fog_color:ge,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(we,Ae),Ae],u_fog_temporal_offset:ye,u_frustum_tl:Z,u_frustum_tr:Y,u_frustum_br:X,u_frustum_bl:J,u_globe_pos:ee,u_globe_radius:oe,u_viewport:fe,u_globe_transition:s.ag(xe.zoom),u_is_globe:+(xe.projection.name==="globe")}})(this,x,u,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],p);n.setFogUniformValues(t,P)}g&&n.setCutoffUniformValues(t,g.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)n[p.key]=t[p.key]||new la(p,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,n){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=Ct||n[1]>=Ct}setupDepthForOcclusion(t,n,u){const p=this.context,g=p.gl,x=!!u;var C;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(g.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),p.activeTexture.set(g.TEXTURE0),x||n.setTerrainUniformValues(p,u)}}function lu(h,t){let n=!1,u=null;const p=()=>{u=null,n&&(h(),u=setTimeout(p,t),n=!1)};return()=>(n=!0,u||p(),u)}class cu{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=lu(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=Td(t);if(this._hashName){const u=this._hashName;let p=!1;const g=location.hash.slice(1).split("&").map(x=>{const C=x.split("=")[0];return C===u?(p=!0,`${C}=${n}`):x}).filter(x=>x);return p||g.push(`${u}=${n}`),`#${g.join("&")}`}return`#${n}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(n=u)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(u=>isNaN(u))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Td(h,t){const n=h.getCenter(),u=Math.round(100*h.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),x=Math.round(n.lng*g)/g,C=Math.round(n.lat*g)/g,P=h.getBearing(),O=h.getPitch();let k=t?`/${x}/${C}/${u}`:`${u}/${C}/${x}`;return(P||O)&&(k+="/"+Math.round(10*P)/10),O&&(k+=`/${Math.round(O)}`),k}const uu={linearity:.3,easing:s.dB(0,0,.3,1)},xh=s.l({deceleration:2500,maxSpeed:1400},uu),Sf=s.l({deceleration:20,maxSpeed:1400},uu),Ef=s.l({deceleration:1e3,maxSpeed:360},uu),zp=s.l({deceleration:1e3,maxSpeed:90},uu);class mc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=s.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)n.zoom+=g.zoomDelta||0,n.bearing+=g.bearingDelta||0,n.pitch+=g.pitchDelta||0,g.panDelta&&n.pan._add(g.panDelta),g.around&&(n.around=g.around),g.pinchAround&&(n.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(n.pan.mag()){const g=bl(n.pan.mag(),u,s.l({},xh,t||{}));p.offset=n.pan.mult(g.amount/n.pan.mag()),p.center=this._map.transform.center,Oo(p,g)}if(n.zoom){const g=bl(n.zoom,u,Sf);p.zoom=this._map.transform.zoom+g.amount,Oo(p,g)}if(n.bearing){const g=bl(n.bearing,u,Ef);p.bearing=this._map.transform.bearing+s.ay(g.amount,-179,179),Oo(p,g)}if(n.pitch){const g=bl(n.pitch,u,zp);p.pitch=this._map.transform.pitch+g.amount,Oo(p,g)}if(p.zoom||p.bearing){const g=n.pinchAround===void 0?n.around:n.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Oo(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function bl(h,t,n){const{maxSpeed:u,linearity:p,deceleration:g}=n,x=s.ay(h*p/(t/1e3),-u,u),C=Math.abs(x)/(g*p);return{easing:n.easing,duration:1e3*C,amount:x*(C/2)}}class ts extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u,p={}){const g=oi(n.getCanvasContainer(),u),x=n.unproject(g);super(t,s.l({point:g,lngLat:x,originalEvent:u},p)),this._defaultPrevented=!1,this.target=n}}class wl extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u){const p=t==="touchend"?u.changedTouches:u.touches,g=tn(n.getCanvasContainer(),p),x=g.map(P=>n.unproject(P)),C=g.reduce((P,O,k,U)=>P.add(O.div(U.length)),new s.P(0,0));super(t,{points:g,point:C,lngLats:x,lngLat:n.unproject(C),originalEvent:u}),this._defaultPrevented=!1}}class Af extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class Mf{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Af(this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new ts(t.type,this._map,t))}mouseup(t){this._map.fire(new ts(t.type,this._map,t))}preclick(t){const n=s.l({},t);n.type="preclick",this._map.fire(new ts(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new ts(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new ts(t.type,this._map,t))}mouseover(t){this._map.fire(new ts(t.type,this._map,t))}mouseout(t){this._map.fire(new ts(t.type,this._map,t))}touchstart(t){return this._firePreventable(new wl(t.type,this._map,t))}touchmove(t){this._map.fire(new wl(t.type,this._map,t))}touchend(t){this._map.fire(new wl(t.type,this._map,t))}touchcancel(t){this._map.fire(new wl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hu{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new ts(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ts("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ts(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pp{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&($t(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const u=n,p=this._startPos,g=this._lastPos;if(!p||!g||g.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=hi("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const x=Math.min(p.x,u.x),C=Math.max(p.x,u.x),P=Math.min(p.y,u.y),O=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${P}px)`,this._box.style.width=C-x+"px",this._box.style.height=O-P+"px")})}mouseupWindow(t,n){if(!this._active)return;const u=this._startPos,p=n;if(u&&t.button===0){if(this.reset(),Gt(),u.x!==p.x||u.y!==p.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),kt(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new s.A(t,{originalEvent:n}))}}function dn(h,t){const n={};for(let u=0;u<h.length;u++)n[h[u].identifier]=t[u];return n}class ka{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const g=new s.P(0,0);for(const x of p)g._add(x);return g.div(p.length)}(n),this.touches=dn(u,n)))}touchmove(t,n,u){if(this.aborted||!this.centroid)return;const p=dn(u,n);for(const g in this.touches){const x=p[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,n,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class uo{constructor(t){this.singleTap=new ka(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,u){this.singleTap.touchstart(t,n,u)}touchmove(t,n,u){this.singleTap.touchmove(t,n,u)}touchend(t,n,u){const p=this.singleTap.touchend(t,n,u);if(p){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Op{constructor(){this._zoomIn=new uo({numTouches:1,numTaps:2}),this._zoomOut=new uo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,u){this._zoomIn.touchstart(t,n,u),this._zoomOut.touchstart(t,n,u)}touchmove(t,n,u){this._zoomIn.touchmove(t,n,u),this._zoomOut.touchmove(t,n,u)}touchend(t,n,u){const p=this._zoomIn.touchend(t,n,u),g=this._zoomOut.touchend(t,n,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(p)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ya={0:1,2:2},Ba={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class yr{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const u=Jt(t);this._correctButton(t,u)&&(this._lastPoint=n,this._eventButton=u)}mousemoveWindow(t,n){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,g){const x=ya[g];return p.buttons===void 0||(p.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(u,n)}}mouseupWindow(t){this._lastPoint&&Jt(t)===this._eventButton&&(this._moved&&Gt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _c extends yr{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class va extends yr{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Ba[t.pitchRotateKey]:void 0}_correctButton(t,n){return this._pitchRotateKey?n===0&&t[this._pitchRotateKey]:n===0&&t.ctrlKey||n===2}_move(t,n){const u=.8*(n.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class gc extends yr{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Ba[t.pitchRotateKey]:void 0}_correctButton(t,n){return this._pitchRotateKey?n===0&&t[this._pitchRotateKey]:n===0&&t.ctrlKey||n===2}_move(t,n){const u=-.5*(n.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Qn{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),s.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,n,u){return this._calculateTransform(t,n,u)}touchmove(t,n,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!s.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,u)}}touchend(t,n,u){this._calculateTransform(t,n,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,u){u.length>0&&(this._active=!0);const p=dn(u,n),g=new s.P(0,0),x=new s.P(0,0);let C=0;for(const O in p){const k=p[O],U=this._touches[O];U&&(g._add(k),x._add(k.sub(U)),C++,p[O]=k)}if(this._touches=p,C<this._minTouches||!x.mag())return;const P=x.div(C);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(C),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=hi("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ia{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,u){return{}}touchstart(t,n,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[g,x]=p,C=xa(u,n,g),P=xa(u,n,x);if(!C||!P)return;const O=this._aroundCenter?null:C.add(P).div(2);return this._move([C,P],O,t)}touchend(t,n,u){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,x=xa(u,n,p),C=xa(u,n,g);x&&C||(this._active&&Gt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function xa(h,t,n){for(let u=0;u<h.length;u++)if(h[u].identifier===n)return t[u]}function Tl(h,t){return Math.log(h/t)/Math.LN2}class If extends ia{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Tl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Tl(this._distance,u),pinchAround:n}}}function Cf(h,t){return 180*h.angleWith(t)/Math.PI}class du extends ia{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Cf(this._vector,u),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=Cf(t,u);return Math.abs(p)<n}}function fu(h){return Math.abs(h.y)>Math.abs(h.x)}class Lp extends ia{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,fu(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,u){const p=this._lastPoints;if(!p)return;const g=t[0].sub(p[0]),x=t[1].sub(p[1]);return this._map._cooperativeGestures&&!s.dC()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(g,x,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5})}gestureBeginsVertically(t,n,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,g=n.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=t.y>0==n.y>0;return fu(t)&&fu(n)&&x}}const bh={panStep:100,bearingStep:15,pitchStep:10};class Sd{constructor(){const t=bh;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,u=0,p=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:C=>{const P=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:pu,zoom:n?Math.round(P)+n*(t.shiftKey?2:1):P,bearing:C.getBearing()+u*this._bearingStep,pitch:C.getPitch()+p*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:C.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function pu(h){return h*(2-h)}const yc=4.000244140625,ho=1/450;class Xn{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ho,s.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=s.q.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,n!==0&&n%yc==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=oi(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>yc?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&k!==0&&(k=1/k);const U=n(),F=Math.pow(2,U),Z=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(Z*k))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:n(),p=this._startZoom,g=this._easing;let x,C=!1;if(this._type==="wheel"&&p&&g){const O=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),k=g(O);x=s.ah(p,u,k),O<1?this._frameId||(this._frameId=!0):C=!0}else x=u,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let P=x-n();return P*this._lastDelta<0&&(P=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:P,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=s.dD;if(this._prevEase){const u=this._prevEase,p=(s.q.now()-u.start)/u.duration,g=u.easing(p+.01)-u.easing(p),x=.27/Math.sqrt(g*g+1e-4)*.01,C=Math.sqrt(.0729-x*x);n=s.dB(x,C,.25,1)}return this._prevEase={start:s.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=hi("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class dr{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lo{constructor(){this._tap=new uo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=n[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,n,u))}touchmove(t,n,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=n[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,n,u)}touchend(t,n,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,n,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kp{constructor(t,n,u){this._el=t,this._mousePan=n,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Bp{constructor(t,n,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Np{constructor(t,n,u,p){this._el=t,this._touchZoom=n,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vc=h=>h.zoom||h.drag||h.pitch||h.rotate;class Ed extends s.A{}class us{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const u=s.ad.vec3.sub([],n,t);this.radius=s.ad.vec3.length(u[2]<0?s.ad.vec3.div([],u,this.constants):[u[0],u[1],0])}projectRay(t){s.ad.vec3.div(t,t,this.constants),s.ad.vec3.normalize(t,t),s.ad.vec3.mul(t,t,this.constants);const n=s.ad.vec3.scale([],t,this.radius);if(n[2]>0){const u=s.ad.vec3.scale([],[0,0,1],s.ad.vec3.dot(n,[0,0,1])),p=s.ad.vec3.scale([],s.ad.vec3.normalize([],[n[0],n[1],0]),this.radius),g=s.ad.vec3.add([],n,s.ad.vec3.scale([],s.ad.vec3.sub([],s.ad.vec3.add([],p,u),n),2));n[0]=g[0],n[1]=g[1]}return n}}function xc(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Rf{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new mc(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new us,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),s.aQ(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,x]of this._listeners){const C=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(g,C,x)}}destroy(){for(const[t,n,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(n,p,u)}}_addDefaultHandlers(t){const n=this._map,u=n.getCanvasContainer();this._add("mapEvent",new Mf(n,t));const p=n.boxZoom=new Pp(n,t);this._add("boxZoom",p);const g=new Op,x=new Sl;n.doubleClickZoom=new dr(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const C=new Lo;this._add("tapDragZoom",C);const P=n.touchPitch=new Lp(n);this._add("touchPitch",P);const O=new va(t),k=new gc(t);n.dragRotate=new Bp(t,O,k),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const U=new _c(t),F=new Qn(n,t);n.dragPan=new kp(u,U,F),this._add("mousePan",U),this._add("touchPan",F,["touchZoom","touchRotate"]);const Z=new du,Y=new If;n.touchZoomRotate=new Np(u,Y,Z,C),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new hu(n));const X=n.scrollZoom=new Xn(n,this);this._add("scrollZoom",X,["mousePan"]);const J=n.keyboard=new Sd;this._add("keyboard",J);for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ee]&&n[ee].enable(t[ee])}_add(t,n,u){this._handlers.push({handlerName:t,handler:n,allowed:u}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,u){for(const p in t)if(p!==u&&(!n||n.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const u of t)this._el.contains(u.target)&&n.push(u);return n}handleEvent(t,n){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,g={needsRenderFrame:!1},x={},C={},P=t.touches?this._getMapTouches(t.touches):void 0,O=P?tn(this._el,P):u?void 0:oi(this._el,t);for(const{handlerName:F,handler:Z,allowed:Y}of this._handlers){if(!Z.isEnabled())continue;let X;this._blockedByActive(C,Y,F)?Z.reset():Z[n||t.type]&&(X=Z[n||t.type](t,O,P),this.mergeHandlerResult(g,x,X,F,p),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||Z.isActive())&&(C[F]=Z)}const k={};for(const F in this._previousActiveHandlers)C[F]||(k[F]=p);this._previousActiveHandlers=C,(Object.keys(k).length||xc(g))&&(this._changes.push([g,x,k]),this._triggerRenderFrame()),(Object.keys(C).length||xc(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=g;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(t,n,u,p,g){if(!u)return;s.l(t,u);const x={handlerName:p,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(n.zoom=x),u.panDelta!==void 0&&(n.drag=x),u.pitchDelta!==void 0&&(n.pitch=x),u.bearingDelta!==void 0&&(n.rotate=x)}_applyChanges(){const t={},n={},u={};for(const[p,g,x]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),s.l(n,g),s.l(u,x);this._updateMapTransform(t,n,u),this._changes=[]}_updateMapTransform(t,n,u){const p=this._map,g=p.transform,x=oe=>[oe.x,oe.y,oe.z];if((oe=>{const fe=this._eventsInProgress.drag;return fe&&!this._handlersById[fe.handlerName].isActive()})()&&!xc(t)){const oe=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),oe!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&p._stop(!0),!xc(t))return void this._fireEvents(n,u,!0);let{panDelta:C,zoomDelta:P,bearingDelta:O,pitchDelta:k,around:U,aroundCoord:F,pinchAround:Z}=t;g._isCameraConstrained&&(P>0&&(P=0),g._isCameraConstrained=!1),Z!==void 0&&(U=Z),(P||(oe=>n[oe]&&!this._eventsInProgress[oe])("drag"))&&U&&(this._dragOrigin=x(g.pointCoordinate3D(U)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",p._stop(!0),U=U||p.transform.centerPoint,O&&(g.bearing+=O),k&&(g.pitch+=k),g._updateCameraState();const Y=[0,0,0];if(C)if(g.projection.name==="mercator"){const oe=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(U).dir),fe=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(U.sub(C)).dir);Y[0]=fe[0]-oe[0],Y[1]=fe[1]-oe[1]}else{const oe=g.pointCoordinate(U);if(g.projection.name==="globe"){C=C.rotate(-g.angle);const fe=g._pixelsPerMercatorPixel/g.worldSize;Y[0]=-C.x*s.dE(s.aT(oe.y))*fe,Y[1]=-C.y*s.dE(g.center.lat)*fe}else{const fe=g.pointCoordinate(U.sub(C));oe&&fe&&(Y[0]=fe.x-oe.x,Y[1]=fe.y-oe.y)}}const X=g.zoom,J=[0,0,0];if(P){const oe=x(F||g.pointCoordinate3D(U)),fe={dir:s.ad.vec3.normalize([],s.ad.vec3.sub([],oe,g._camera.position))};if(fe.dir[2]<0){const ce=g.zoomDeltaToMovement(oe,P);s.ad.vec3.scale(J,fe.dir,ce)}}const ee=s.ad.vec3.add(Y,Y,J);g._translateCameraConstrained(ee),P&&Math.abs(g.zoom-X)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,u,!0)}_fireEvents(t,n,u){const p=vc(this._eventsInProgress),g=vc(t),x={};for(const k in t){const{originalEvent:U}=t[k];this._eventsInProgress[k]||(x[`${k}start`]=U),this._eventsInProgress[k]=t[k]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const k in x)this._fireEvent(k,x[k]);g&&this._fireEvent("move",g.originalEvent);for(const k in t){const{originalEvent:U}=t[k];this._fireEvent(k,U)}const C={};let P;for(const k in this._eventsInProgress){const{handlerName:U,originalEvent:F}=this._eventsInProgress[k];this._handlersById[U].isActive()||(delete this._eventsInProgress[k],P=n[U]||F,C[`${k}end`]=P)}for(const k in C)this._fireEvent(k,C[k]);const O=vc(this._eventsInProgress);if(u&&(p||g)&&!O){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;k?(U(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:P})):(this._map.fire(new s.A("moveend",{originalEvent:P})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new s.A(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Ed("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ad="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class El extends s.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,s.aQ(["_renderFrameCallback"],this)}getCenter(){return new s.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,u){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.l({offset:t},n),u)}panTo(t,n,u){return this.easeTo(s.l({center:t},n),u)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,u){return this.easeTo(s.l({zoom:t},n),u)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,u){return this.easeTo(s.l({bearing:t},n),u)}resetNorth(t,n){return this.rotateTo(0,s.l({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=s.aB.convert(t);const u=n&&n.bearing||0,p=n&&n.pitch||0,g=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,g,x,u,p,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return t==null?s.l({},n,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:s.l({},n,t)}_extendCameraOptions(t){return(t=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,n){const u=n.max[0]-n.min[0],p=n.max[1]-n.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,u,p,g,x){const C=t.clone(),P=this._extendCameraOptions(x);C.bearing=p,C.pitch=g;const O=s.bO.convert(n),k=s.bO.convert(u),U=.5*(O.lat+k.lat),F=.5*(O.lng+k.lng),Z=s.dF(U,F),Y=s.ad.vec3.normalize([],Z),X=s.ad.vec3.normalize([],s.ad.vec3.cross([],Y,[0,1,0])),J=s.ad.vec3.cross([],X,Y),ee=[X[0],X[1],X[2],0,J[0],J[1],J[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],oe=[Z,s.dF(O.lat,O.lng),s.dF(k.lat,O.lng),s.dF(k.lat,k.lng),s.dF(O.lat,k.lng),s.dF(U,O.lng),s.dF(U,k.lng),s.dF(O.lat,F),s.dF(k.lat,F)];let fe=s.ce.fromPoints(oe.map(Xe=>[s.ad.vec3.dot(X,Xe),s.ad.vec3.dot(J,Xe),s.ad.vec3.dot(Y,Xe)]));const ce=s.ad.vec3.transformMat4([],fe.center,ee);s.ad.vec3.squaredLength(ce)===0&&s.ad.vec3.set(ce,0,0,1),s.ad.vec3.normalize(ce,ce),s.ad.vec3.scale(ce,ce,s.az),C.center=s.dG(ce);const xe=C.getWorldToCameraMatrix(),_e=s.ad.mat4.invert(new Float64Array(16),xe);fe=s.ce.applyTransform(fe,s.ad.mat4.multiply([],xe,ee));const ge=this._extendAABB(fe,C,P,p);if(!ge)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=ge,s.ad.vec3.transformMat4(ce,ce,xe);const ye=.5*(fe.max[2]-fe.min[2]),we=this._minimumAABBFrustumDistance(C,fe),Ae=s.ad.vec3.scale([],[0,0,1],ye),je=s.ad.vec3.add(Ae,ce,Ae),Be=we+(C.pitch===0?0:s.ad.vec3.distance(ce,je)),Qe=C.globeCenterInViewSpace,nt=s.ad.vec3.sub([],ce,[Qe[0],Qe[1],Qe[2]]);s.ad.vec3.normalize(nt,nt),s.ad.vec3.scale(nt,nt,Be);const dt=s.ad.vec3.add([],ce,nt);s.ad.vec3.transformMat4(dt,dt,_e);const Le=s.dv/s.az,et=s.ad.vec3.length(dt),Oe=s.bH(Math.max(et*Le-s.dv,Number.EPSILON),0),tt=Math.min(C.zoomFromMercatorZAdjusted(Oe),P.maxZoom);return tt>.5*(s.c6+s.bY)?(C.setProjection({name:"mercator"}),C.zoom=tt,this._cameraForBounds(C,n,u,p,g,x)):{center:C.center,zoom:tt,bearing:p,pitch:g}}_extendAABB(t,n,u,p){const g=.5*((u.padding.left||0)+(u.padding.right||0)),x=.5*((u.padding.top||0)+(u.padding.bottom||0)),C=x,P=g,O=g,k=x,U=n.width-(P+O),F=n.height-(C+k),Z=s.ad.vec3.sub([],t.max,t.min),Y=Math.min(U/Z[0],F/Z[1]),X=Math.min(n.scaleZoom(n.scale*Y),u.maxZoom);if(isNaN(X))return null;const J=n.scale/n.zoomScale(X),ee=new s.ce([t.min[0]-P*J,t.min[1]-k*J,t.min[2]],[t.max[0]+O*J,t.max[1]+C*J,t.max[2]]),oe=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new s.P(u.offset.x,u.offset.y):s.P.convert(u.offset)).rotate(-s.ak(p));return ee.center[0]-=oe.x*J,ee.center[1]+=oe.y*J,ee}queryTerrainElevation(t,n){const u=this.transform.elevation;return u?(n=s.l({},{exaggerated:!0},n),u.getAtPoint(s.ac.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,u,p,g,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,u,p,g,x);const C=t.clone(),P=this._extendCameraOptions(x);C.bearing=p,C.pitch=g;const O=s.bO.convert(n),k=s.bO.convert(u),U=new s.bO(O.lng,k.lat),F=new s.bO(k.lng,O.lat),Z=C.project(O),Y=C.project(k),X=this.queryTerrainElevation(O),J=this.queryTerrainElevation(k),ee=this.queryTerrainElevation(U),oe=this.queryTerrainElevation(F),fe=[[Z.x,Z.y,Math.min(X||0,J||0,ee||0,oe||0)],[Y.x,Y.y,Math.max(X||0,J||0,ee||0,oe||0)]];let ce=s.ce.fromPoints(fe);const xe=C.getWorldToCameraMatrix(),_e=s.ad.mat4.invert(new Float64Array(16),xe);ce=s.ce.applyTransform(ce,xe);const ge=this._extendAABB(ce,C,P,p);if(!ge)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=ge;const ye=.5*s.ad.vec3.sub([],ce.max,ce.min)[2],we=this._minimumAABBFrustumDistance(C,ce),Ae=[0,0,1,0];s.ad.vec4.transformMat4(Ae,Ae,xe),s.ad.vec4.normalize(Ae,Ae);const je=s.ad.vec3.scale([],Ae,we+ye),Be=s.ad.vec3.add([],ce.center,je);s.ad.vec3.transformMat4(ce.center,ce.center,_e),s.ad.vec3.transformMat4(Be,Be,_e);const Qe=C.unproject(new s.P(ce.center[0],ce.center[1])),nt=s.dH(C.projection,Qe),dt=Math.pow(2,nt),Le=Math.min(C._zoomFromMercatorZ(Be[2]*C.pixelsPerMeter*dt/C.worldSize),P.maxZoom);return C.mercatorFromTransition&&Le<.5*(s.c6+s.bY)?(C.setProjection({name:"globe"}),C.zoom=Le,this._cameraForBounds(C,n,u,p,g,x)):{center:Qe,zoom:Le,bearing:p,pitch:g}}fitBounds(t,n,u){const p=this.cameraForBounds(t,n);return this._fitInternal(p,n,u)}fitScreenCoordinates(t,n,u,p,g){const x=s.P.convert(t),C=s.P.convert(n),P=new s.P(Math.min(x.x,C.x),Math.min(x.y,C.y)),O=new s.P(Math.max(x.x,C.x),Math.max(x.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,C))return this;const k=this.transform.pointLocation3D(P),U=this.transform.pointLocation3D(O),F=this.transform.pointLocation3D(new s.P(P.x,O.y)),Z=this.transform.pointLocation3D(new s.P(O.x,P.y)),Y=[Math.min(k.lng,U.lng,F.lng,Z.lng),Math.min(k.lat,U.lat,F.lat,Z.lat)],X=[Math.max(k.lng,U.lng,F.lng,Z.lng),Math.max(k.lat,U.lat,F.lat,Z.lat)],J=p&&p.pitch?p.pitch:this.getPitch(),ee=this._cameraForBounds(this.transform,Y,X,u,J,p);return this._fitInternal(ee,p,g)}_fitInternal(t,n,u){return t?(n=s.l(t,n)).linear?this.easeTo(n,u):this.flyTo(n,u):this}jumpTo(t,n){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,g=!1,x=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=s.bO.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(g=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(x=!0,u.pitch=+t.pitch);const C=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(C))if(t.retainPadding===!1){const P=u.clone();P.padding=C,u.setLocationAtPoint(u.center,P.centerPoint)}else u.padding=C;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new s.A("movestart",n)).fire(new s.A("move",n)),p&&this.fire(new s.A("zoomstart",n)).fire(new s.A("zoom",n)).fire(new s.A("zoomend",n)),g&&this.fire(new s.A("rotatestart",n)).fire(new s.A("rotate",n)).fire(new s.A("rotateend",n)),x&&this.fire(new s.A("pitchstart",n)).fire(new s.A("pitch",n)).fire(new s.A("pitchend",n)),this.fire(new s.A("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Ad),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const u=this.transform;if(!u.projection.supportsFreeCamera)return s.w(Ad),this;this.stop();const p=u.zoom,g=u.pitch,x=u.bearing;u.setFreeCameraOptions(t);const C=p!==u.zoom,P=g!==u.pitch,O=x!==u.bearing;return this.fire(new s.A("movestart",n)).fire(new s.A("move",n)),C&&this.fire(new s.A("zoomstart",n)).fire(new s.A("zoom",n)).fire(new s.A("zoomend",n)),O&&this.fire(new s.A("rotatestart",n)).fire(new s.A("rotate",n)).fire(new s.A("rotateend",n)),P&&this.fire(new s.A("pitchstart",n)).fire(new s.A("pitch",n)).fire(new s.A("pitchend",n)),this.fire(new s.A("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=s.l({offset:[0,0],duration:500,easing:s.dD},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),C=this.getPadding(),P="zoom"in t?+t.zoom:p,O="bearing"in t?this._normalizeBearing(t.bearing,g):g,k="pitch"in t?+t.pitch:x,U=this._extendPadding(t.padding),F=s.P.convert(t.offset);let Z,Y,X;if(u.projection.name==="globe"){const Ae=s.ac.fromLngLat(u.center),je=F.rotate(-u.angle);Ae.x+=je.x/u.worldSize,Ae.y+=je.y/u.worldSize;const Be=Ae.toLngLat(),Qe=s.bO.convert(t.center||Be);this._normalizeCenter(Qe),Z=u.centerPoint.add(je),Y=new s.P(Ae.x,Ae.y).mult(u.worldSize),X=new s.P(s.av(Qe.lng),s.aC(Qe.lat)).mult(u.worldSize).sub(Y)}else{Z=u.centerPoint.add(F);const Ae=u.pointLocation(Z),je=s.bO.convert(t.center||Ae);this._normalizeCenter(je),Y=u.project(Ae),X=u.project(je).sub(Y)}const J=u.zoomScale(P-p);let ee,oe;t.around&&(ee=s.bO.convert(t.around),oe=u.locationPoint(ee));const fe=this._zooming||P!==p,ce=this._rotating||g!==O,xe=this._pitching||k!==x,_e=!u.isPaddingEqual(U),ge=t.retainPadding===!1?u.clone():u,ye=Ae=>je=>{if(fe&&(Ae.zoom=s.ah(p,P,je)),ce&&(Ae.bearing=s.ah(g,O,je)),xe&&(Ae.pitch=s.ah(x,k,je)),_e&&(ge.interpolatePadding(C,U,je),Z=ge.centerPoint.add(F)),ee)Ae.setLocationAtPoint(ee,oe);else{const Be=Ae.zoomScale(Ae.zoom-p),Qe=P>p?Math.min(2,J):Math.max(.5,J),nt=Math.pow(Qe,1-je),dt=Ae.unproject(Y.add(X.mult(je*nt)).mult(Be));Ae.setLocationAtPoint(Ae.renderWorldCopies?dt.wrap():dt,Z)}return t.preloadOnly||this._fireMoveEvents(n),Ae};if(t.preloadOnly){const Ae=this._emulate(ye,t.duration,u);return this._preloadTiles(Ae),this}const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=ce,this._pitching=xe,this._padding=_e,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,we),this._ease(ye(u),Ae=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(n,Ae)},t),this}_prepareEase(t,n,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||u.moving||this.fire(new s.A("movestart",t)),this._zooming&&!u.zooming&&this.fire(new s.A("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new s.A("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new s.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.A("move",t)),this._zooming&&this.fire(new s.A("zoom",t)),this._rotating&&this.fire(new s.A("rotate",t)),this._pitching&&this.fire(new s.A("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new s.A("zoomend",t)),p&&this.fire(new s.A("rotateend",t)),g&&this.fire(new s.A("pitchend",t)),this.fire(new s.A("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const Xe=s.aA(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Xe,n)}this.stop(),t=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.dD},t);const u=this.transform,p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),C=this.getPadding(),P="zoom"in t?s.ay(+t.zoom,u.minZoom,u.maxZoom):p,O="bearing"in t?this._normalizeBearing(t.bearing,g):g,k="pitch"in t?+t.pitch:x,U=this._extendPadding(t.padding),F=u.zoomScale(P-p),Z=s.P.convert(t.offset);let Y=u.centerPoint.add(Z);const X=u.pointLocation(Y),J=s.bO.convert(t.center||X);this._normalizeCenter(J);const ee=u.project(X),oe=u.project(J).sub(ee);let fe=t.curve;const ce=Math.max(u.width,u.height),xe=ce/F,_e=oe.mag();if("minZoom"in t){const Xe=s.ay(Math.min(t.minZoom,p,P),u.minZoom,u.maxZoom),st=ce/u.zoomScale(Xe-p);fe=Math.sqrt(st/_e*2)}const ge=fe*fe;function ye(Xe){const st=(xe*xe-ce*ce+(Xe?-1:1)*ge*ge*_e*_e)/(2*(Xe?xe:ce)*ge*_e);return Math.log(Math.sqrt(st*st+1)-st)}function we(Xe){return(Math.exp(Xe)-Math.exp(-Xe))/2}function Ae(Xe){return(Math.exp(Xe)+Math.exp(-Xe))/2}const je=ye(0);let Be=function(Xe){return Ae(je)/Ae(je+fe*Xe)},Qe=function(Xe){return ce*((Ae(je)*(we(st=je+fe*Xe)/Ae(st))-we(je))/ge)/_e;var st},nt=(ye(1)-je)/fe;if(Math.abs(_e)<1e-6||!isFinite(nt)){if(Math.abs(ce-xe)<1e-6)return this.easeTo(t,n);const Xe=xe<ce?-1:1;nt=Math.abs(Math.log(xe/ce))/fe,Qe=function(){return 0},Be=function(st){return Math.exp(Xe*fe*st)}}t.duration="duration"in t?+t.duration:1e3*nt/("screenSpeed"in t?+t.screenSpeed/fe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const dt=g!==O,Le=k!==x,et=!u.isPaddingEqual(U),Oe=t.retainPadding===!1?u.clone():u,tt=Xe=>st=>{const Ge=st*nt,rt=1/Be(Ge);Xe.zoom=st===1?P:p+Xe.scaleZoom(rt),dt&&(Xe.bearing=s.ah(g,O,st)),Le&&(Xe.pitch=s.ah(x,k,st)),et&&(Oe.interpolatePadding(C,U,st),Y=Oe.centerPoint.add(Z));const St=st===1?J:Xe.unproject(ee.add(oe.mult(Qe(Ge))).mult(rt));return Xe.setLocationAtPoint(Xe.renderWorldCopies?St.wrap():St,Y),Xe._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),Xe};if(t.preloadOnly){const Xe=this._emulate(tt,t.duration,u);return this._preloadTiles(Xe),this}return this._zooming=!0,this._rotating=dt,this._pitching=Le,this._padding=et,this._prepareEase(n,!1),this._ease(tt(u),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,n)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,n,u){u.animate===!1||u.duration===0?(t(1),n()):(this._easeStart=s.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=s.bF(t,-180,180);const u=Math.abs(t-n);return Math.abs(t-360-n)<u&&(t-=360),Math.abs(t+360-n)<u&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const u=t.lng-n.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,u){const p=Math.ceil(15*n/1e3),g=[],x=t(u.clone());for(let C=0;C<=p;C++){const P=x(C/p);g.push(P.clone())}return g}_preloadTiles(t,n){}}class mu{constructor(t={}){this.options=t,s.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=hi("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=hi("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=hi("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=hi("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const u=n.reduce((p,g,x)=>(g.value&&(p+=`${g.key}=${g.value}${x<n.length-1?"&":""}`),p),"?");t.href=`${s.e.FEEDBACK_URL}/${u}#${Td(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const n=this._map.style._mergedSourceCaches;for(const p in n){const g=n[p];if(g.used){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((p,g)=>p.length-g.length),t=t.filter((p,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xs{constructor(){s.aQ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=hi("div","mapboxgl-ctrl");const n=hi("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const u=t[n].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class Bs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,u=n?this._queue.concat(n):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const u of n)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ko{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=s.cC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,u){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+u}}const Bo={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Al extends s.A{constructor(t,n,u,p){const{point:g,lngLat:x,originalEvent:C,target:P}=t;super(t.type,{point:g,lngLat:x,originalEvent:C,target:P}),this.preventDefault=()=>{t.preventDefault()},this.id=n,this.interaction=u,this.feature=p}}class wh{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=n.filter;let p=n.type;u&&this.filters.set(t,s.a_(u)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const g=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):g.size===0&&this.map.on(p,this.handleType),g.size===0&&this.interactionsByType.set(p,g),g.set(t,n),this.typeById.set(t,p)}get(t){const n=this.typeById.get(t);if(!n)return;const u=this.interactionsByType.get(n);return u?u.get(t):void 0}remove(t){const n=this.typeById.get(t);if(!n)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(n);u&&(u.delete(t),n==="mouseenter"||n==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(n,this.handleType))}queryTargets(t,n){const u=[];for(const[p,g]of n)g.target&&u.push({targetId:p,target:g.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const n=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());n.length&&(t.type="mouseenter",this.handleType(t,n));const u=new Map;for(const[p,{feature:g}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||u.set(g.id,g);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const n=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);n.length&&(t.type="mouseleave",this.handleType(t,n)),this.hoveredFeatures.clear()}handleType(t,n){const u=Array.from(this.interactionsByType.get(t.type)).reverse(),p=!!n;n=n||this.queryTargets(t.point,u);const g=t.type==="mouseenter";let x=!1;const C=new Set;for(const P of n){for(const[O,k]of u){if(!k.target)continue;const U=P.variants?P.variants[O]:null;if(U){for(const F of U){if(yo(F,P,C,O))continue;const Z=new s.cx(P,F),Y=Lu(F,P,O);p&&(Z.state=this.map.getFeatureState(Z));const X=g?this.prevHoveredFeatures.get(Y):null,J=new Al(t,O,k,Z),ee=X?X.stop:k.handler(J);if(g&&this.hoveredFeatures.set(Y,{feature:P,stop:ee}),ee!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(const[P,O]of u){const{handler:k,target:U}=O;if(!U&&k(new Al(t,P,O,null))!==!1)break}}}function rn(h,t){if(Array.isArray(h)&&Array.isArray(t)){const n=new Set(h),u=new Set(t);return n.size===u.size&&h.every(p=>u.has(p))}return s.bn(h,t)}const vs={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Df={showCompass:!0,showZoom:!0,visualizePitch:!1};class Jm{constructor(t,n,u=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new va({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new gc({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),$t()}move(t,n){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,n),g=p&&p.bearingDelta;if(g&&u.setBearing(u.getBearing()+g),this.mousePitch){const x=this.mousePitch.mousemoveWindow(t,n),C=x&&x.pitchDelta;C&&u.setPitch(u.getPitch()+C)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){kt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(s.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),oi(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,oi(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=tn(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=tn(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Th(h,t,n){if(h=new s.bO(h.lng,h.lat),t){const u=new s.bO(h.lng-360,h.lat),p=new s.bO(h.lng+360,h.lat),g=360*Math.ceil(Math.abs(h.lng-n.center.lng)/360),x=n.locationPoint3D(h).distSqr(t),C=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint3D(u).distSqr(t)<x&&(C||Math.abs(u.lng-n.center.lng)<g)?h=u:n.locationPoint3D(p).distSqr(t)<x&&(C||Math.abs(p.lng-n.center.lng)<g)&&(h=p)}for(;Math.abs(h.lng-n.center.lng)>180;){const u=n.locationPoint3D(h);if(u.x>=0&&u.y>=0&&u.x<=n.width&&u.y<=n.height)break;h.lng>n.center.lng?h.lng-=360:h.lng+=360}return h}const is={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Zr={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Cr extends s.E{constructor(t,n){super(),(t instanceof HTMLElement||n)&&(t=s.l({element:t},n)),s.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:u="center",color:p="#3FB1CE",scale:g=1,draggable:x=!1,clickTolerance:C=0,rotation:P=Zr.rotation,rotationAlignment:O=Zr.rotationAlignment,pitchAlignment:k=Zr.pitchAlignment,occludedOpacity:U=Zr.occludedOpacity,altitude:F=Zr.altitude}=t||{};this._anchor=u,this._color=p,this._scale=g,this._draggable=x,this._clickTolerance=C,this._rotation=P,this._rotationAlignment=O,this._pitchAlignment=k,this._occludedOpacity=U,this._altitude=F,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",X=>{X.preventDefault()}),this._element.addEventListener("mousedown",X=>{X.preventDefault()});const Z=this._element.classList;for(const X in is)Z.remove(`mapboxgl-marker-anchor-${X}`);Z.add(`mapboxgl-marker-anchor-${this._anchor}`);const Y=t&&t.className?t.className.trim().split(/\s+/):[];Z.add(...Y),this._popup=null}_createDefaultMarker(){const t=hi("div"),n=vi("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const u=vi("radialGradient",{id:"shadowGradient"},vi("defs",{},n));vi("stop",{offset:"10%","stop-opacity":.4},u),vi("stop",{offset:"100%","stop-opacity":.05},u),vi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n)}return vi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),vi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),vi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Zr.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,u=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,u=this._element;this._popup&&(n===u||u.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const u=t.unproject(n,this._altitude),p=t.getFreeCameraOptions();if(!p.position)return!1;const g=p.position.toLngLat();return g.distanceTo(u)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(n,this._altitude);let p;t._showingGlobe()&&s.dK(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${is[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,u=this.getPitchAlignment();if(!n||!t||u!=="map")return"";if(!n._showingGlobe()){const P=n.getPitch();return P?`rotateX(${P}deg)`:""}const p=s.c4(s.dL(n.transform,this._lngLat)),g=t.sub(s.dM(n.transform)),x=Math.abs(g.x)+Math.abs(g.y);if(x===0)return"";const C=p/x;return`rotateX(${-g.y*C}deg) rotateY(${g.x*C}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(n._showingGlobe()){const g=n.project(new s.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=n.project(new s.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(g);u=s.c4(Math.atan2(x.y,x.x))-90}else u=-n.getBearing();else if(p==="horizon"){const g=s.ae(4,6,n.getZoom()),x=s.dM(n.transform);x.y+=g*n.transform.height;const C=t.sub(x),P=s.c4(Math.atan2(C.y,C.x));u=(P>90?P-270:P+90)*(1-g)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=Th(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const g=this._clickTolerance||n._clickTolerance;if(t.point.dist(u)<g)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=n.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,u=this._pos;n&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Zr.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Zr.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Zr.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Zr.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ns={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},yn={maxWidth:100,unit:"metric"},zf={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ns={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Pf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ba(h=new s.P(0,0),t="bottom"){if(typeof h=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new s.P(0,h);case"top-left":return new s.P(n,n);case"top-right":return new s.P(-n,n);case"bottom":return new s.P(0,-h);case"bottom-left":return new s.P(n,-n);case"bottom-right":return new s.P(-n,-n);case"left":return new s.P(h,0);case"right":return new s.P(-h,0)}return new s.P(0,0)}return h instanceof s.P||Array.isArray(h)?s.P.convert(h):s.P.convert(h[t]||[0,0])}return{version:pe,supported:jt.supported,setRTLTextPlugin:s.dN,getRTLTextPluginStatus:s.dO,Map:class extends El{constructor(h){He.mark(Ce.create);const t=h;if((h=s.l({},vs,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&s.dI(window)&&(h.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Gu(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Bs,this._domRenderTaskQueue=new Bs,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aW(),this._locale=s.l({},Bo,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ko(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new Ss(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const n=document.getElementById(h.container);if(!n)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=n}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,s.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new yd),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Rf(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||s.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this.indoor=new Xl(this),h.hash&&(this._hash=new cu(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const n=h.bounds;n&&(this.resize(),this.fitBounds(n,s.l({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new mu({customAttribution:h.customAttribution})),this._logoControl=new Xs,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new s.A(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new s.A(`${n.dataType}dataloading`,n))}),this._interactions=new wh(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=h.onAdd(this);this._controls.push(h);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(n,u.firstChild):u.appendChild(n),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.A("movestart",h)).fire(new s.A("move",h)),this.fire(new s.A("resize",h)),t&&this.fire(new s.A("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(s.aB.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(t=>t==="auto"?navigator.language:t):h}setLanguage(h){const t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,t=h.projection.name;let n;t==="globe"&&h.zoom>=s.bY?(h.setMercatorFromTransition(),n=!0):t==="mercator"&&h.zoom<s.bY&&(h.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;return t=h.name==="globe"&&this.transform.zoom>=s.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,t){return this.transform.locationPoint3D(s.bO.convert(h),t)}unproject(h,t){return this.transform.pointLocation3D(s.P.convert(h),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,n){const u=p=>{let g=[];if(Array.isArray(t)){const x=t.filter(C=>this.getLayer(C));g=x.length?this.queryRenderedFeatures(p,{layers:x}):[]}else g=this.queryRenderedFeatures(p,{target:t});return g};if(h==="mouseenter"||h==="mouseover"){let p=!1;return{listener:n,targets:t,delegates:{mousemove:x=>{const C=u(x.point);C.length?p||(p=!0,n.call(this,new ts(h,this,x.originalEvent,{features:C}))):p=!1},mouseout:()=>{p=!1}}}}if(h==="mouseleave"||h==="mouseout"){let p=!1;return{listener:n,targets:t,delegates:{mousemove:C=>{u(C.point).length?p=!0:p&&(p=!1,n.call(this,new ts(h,this,C.originalEvent)))},mouseout:C=>{p&&(p=!1,n.call(this,new ts(h,this,C.originalEvent)))}}}}{const p=g=>{const x=u(g.point);x.length&&(g.features=x,n.call(this,g),delete g.features)};return{listener:n,targets:t,delegates:{[h]:p}}}}on(h,t,n){if(typeof t=="function"||n===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(h,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(h,t,n){if(typeof t=="function"||n===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(h,t,n);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(h,t,n){if(typeof t=="function"||n===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[h]:void 0;return u&&(p=>{for(let g=0;g<p.length;g++){const x=p[g];if(x.listener===n&&rn(x.targets,t)){for(const C in x.delegates)this.off(C,x.delegates[C]);return p.splice(g,1),this}}})(u),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(h===void 0||h instanceof s.P||Array.isArray(h)||t!==void 0||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!t){const g=this.style.queryRenderedFeatures(h,void 0,this.transform),x=this.style.queryRenderedFeatureset(h,void 0,this.transform);return g.concat(x)}let n=!0;if(t.target&&(n=this._isTargetValid(t.target),n&&!t.layers))return this.style.queryRenderedFeatureset(h,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const g of t.layers)if(!this._isValidId(g)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(h,t,this.transform)}let p=[];return u&&(p=p.concat(this.style.queryRenderedFeatures(h,t,this.transform))),n&&(p=p.concat(this.style.queryRenderedFeatureset(h,t,this.transform))),p}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}isPointOnSurface(h){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,t){return t=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,(n,u)=>{n?(s.w(`Unable to perform style diff: ${String(n.message||n.error||n)}. Rebuilding the style from scratch.`),this._updateStyle(h,t)):u&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const n=s.l({},t);t&&t.config&&(n.initialConfig=t.config,delete n.config),this.style=new da(this,n).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new da(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.cs(h)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const t of h)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,n)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:n=1,sdf:u=!1,stretchX:p,stretchY:g,content:x}={}){this._lazyInitEmptyStyle();const C=s.I.from(h);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:P,height:O,data:k}=s.q.getImageData(t);this.style.addImage(C,this.style.scope,{data:new s.r({width:P,height:O},k),pixelRatio:n,stretchX:p,stretchY:g,content:x,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:O}=t,k=t;this.style.addImage(C,this.style.scope,{data:new s.r({width:P,height:O},new Uint8Array(k.data)),pixelRatio:n,stretchX:p,stretchY:g,content:x,sdf:u,usvg:!1,version:0,userImage:k}),k.onAdd&&k.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();const n=s.I.from(h),u=this.style.getImage(n,this.style.scope);if(!u)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.q.getImageData(t):t,{width:g,height:x,data:C}=p;if(g===void 0||x===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||x!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${g}, ${x})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const P=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let O=!1;u.usvg?(u.data=new s.r({width:g,height:x},new Uint8Array(C)),u.usvg=!1,u.icon=void 0,O=!0):u.data.replace(C,P),this.style.updateImage(n,this.style.scope,u,O)}hasImage(h){return h?!!this.style&&!!this.style.getImage(s.I.from(h),this.style.scope):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(s.I.from(h),this.style.scope)}loadImage(h,t){s.o(this._requestManager.transformRequest(h,s.R.Image),(n,u)=>{t(n,u instanceof HTMLImageElement?s.q.getImageData(u):u)})}listImages(){return this.style.listImages().map(h=>h.name)}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){const t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,n){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,n),this._update(!0)):this}setFilter(h,t,n={}){return this._isValidId(h)?(this.style.setFilter(h,t,n),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,n,u={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,n,u),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,n,u={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,n,u),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,n){return this.style.setConfigProperty(h,t,n),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,t),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bO.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,u,p,g=this._container;for(;g&&(!u||!p);){const x=window.getComputedStyle(g).transform;x&&x!=="none"&&(n=x.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(u=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(p=n[3])),g=g.parentElement}this._containerWidth=u?Math.abs(h/u):h,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=hi("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=hi("div","mapboxgl-canvas-container",h);this._canvas=hi("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=hi("div","mapboxgl-control-container",h),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{u[p]=hi("div",`mapboxgl-ctrl-${p}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const n=s.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(h),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const h=s.l({},jt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(Za(t,!0),this.painter=new xl(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(t)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new s.A("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,u=s.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,k=this.transform.pitch,U=s.q.now(),F=new s.aa(O,{now:U,fadeDuration:g,pitch:k,transition:this.style.transition});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(u);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,He.mark(Ce.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const O=s.q.now()-u;p.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const k=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new s.A("gpu-timing-frame",{cpuTime:O,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const O=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(O);this.fire(new s.A("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(O);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:k}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(P||this._repaint)this.triggerRepaint();else{const O=this.idle();if(O&&(x=this._updateAverageElevation(u,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,He.mark(Ce.fullLoad),this._performanceMetricsCollection&&qn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){const n=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=h;const x=Math.abs(p-g);if(x>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(g),n(g);this._averageElevation.easeTo(g,h,300)}else if(x>1e-4)return this._averageElevation.jumpTo(g),n(g)}return!!this._averageElevation.isEasing(h)&&n(this._averageElevation.getValue(h))}_authenticate(){ue(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===fs||h.status===401)){const t=this.painter.context.gl;Za(t,!1),this._logoControl instanceof Xs&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Fi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Li(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,u=n.createFramebuffer();function p(g){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,g,0);const x=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,x),x}return n.bindFramebuffer(n.FRAMEBUFFER,u),this._canvasPixelComparison(p(h),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(h,t,n){let u=n[1]-n[0];const p=h.length/4;for(let g=0;g<t.length;g++){const x=t[g];let C=0;for(let P=0;P<x.length;P+=4)x[P]===h[P]&&x[P+1]===h[P+1]&&x[P+2]===h[P+2]&&x[P+3]===h[P+3]&&(C+=1);u+=(n[g+2]-n[g+1])*(1-C/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ha.delete(this.painter.context.gl),Ws.remove(),Tt.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=s.q.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(h){const t=this.style?this.style.getSourceCaches():[];return s.bl(t,(n,u)=>n._preloadTiles(h,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,t){s.dJ(h,t)}get version(){return pe}},NavigationControl:class{constructor(h={}){this.options=s.l({},Df,h),this._container=hi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),hi("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),hi("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=hi("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),n=t===h.getMaxZoom(),u=t===h.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Jm(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const n=hi("button",h,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(h,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",n),h.firstElementChild&&h.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends s.E{constructor(h={}){super();const t=navigator.geolocation;this.options=s.l({geolocation:t},ns,h),s.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=lu(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=hi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,h(n)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),n=h.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",h)),this._finish()}}_updateCamera(h){const t=new s.bO(h.coords.longitude,h.coords.latitude),n=h.coords.accuracy,u=this._map.getBearing(),p=s.l({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),p,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new s.bO(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=s.bH(1,h._center.lat)*h.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=hi("button","mapboxgl-ctrl-geolocate",this._container),hi("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=hi("div","mapboxgl-user-location"),this._dotElement.appendChild(hi("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(hi("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Cr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=hi("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:mu,ScaleControl:class{constructor(h={}){this.options=s.l({},yn,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,u=t._containerWidth/2-h/2,p=t.unproject([u,n]),g=t.unproject([u+h,n]),x=p.distanceTo(g);if(this.options.unit==="imperial"){const C=3.2808*x;C>5280?this._setScale(h,C/5280,"mile"):this._setScale(h,C,"foot")}else this.options.unit==="nautical"?this._setScale(h,x/1852,"nautical-mile"):x>=1e3?this._setScale(h,x/1e3,"kilometer"):this._setScale(h,x,"meter")}_setScale(h,t,n){this._map._requestDomTask(()=>{const u=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let C=g/x;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(P){const O=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*O)/O}(C),x*C}(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(u):`${u}&nbsp;${zf[n]}`,this._container.style.width=h*p+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=hi("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:s.w("Full screen control 'container' must be a DOM element.")),s.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=hi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=hi("button","mapboxgl-ctrl-fullscreen",this._controlContainer);hi("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(h){super(),this.options=s.l(Object.create(Ns),h),this._altitude=this.options.altitude,s.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=s.bO.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),n=document.createElement("body");let u;for(n.innerHTML=h;u=n.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=hi("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const n=this._closeButton=hi("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.innerHTML='<span aria-hidden="true">&#215;</span>',n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,u=this._pos;if(!t||!n||!u)return"bottom";const p=n.offsetWidth,g=n.offsetHeight,x=u.x<p/2,C=u.x>t.transform.width-p/2;if(u.y+h<g)return x?"top-left":C?"top-right":"top";if(u.y>t.transform.height-g){if(x)return"bottom-left";if(C)return"bottom-right"}return x?"left":C?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let u=this._container;if(u||(u=this._container=hi("div","mapboxgl-popup",t.getContainer()),this._tip=hi("div","mapboxgl-popup-tip",u),u.appendChild(n)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Th(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const p=this._pos=this._trackPointer&&h instanceof s.P?h:t.project(this._lngLat,this._altitude),g=ba(this.options.offset),x=this._anchor=this._getAnchor(g.y),C=ba(this.options.offset,x),P=p.add(C).round();t._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${is[x]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=s.dK(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Pf);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Cr,Style:da,LngLat:s.bO,LngLatBounds:s.aB,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:jh,Evented:s.E,config:s.e,prewarm:s.dP,clearPrewarmedResources:s.dQ,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(h){s.e.ACCESS_TOKEN=h},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(h){s.e.API_URL=h},get workerCount(){return s.dR.workerCount},set workerCount(h){s.dR.workerCount=h},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){s.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){s.dS(h)},get workerUrl(){return s.dT.workerUrl},set workerUrl(h){s.dT.workerUrl=h},get workerClass(){return s.dT.workerClass},set workerClass(h){s.dT.workerClass=h},get workerParams(){return s.dT.workerParams},set workerParams(h){s.dT.workerParams=h},get dracoUrl(){return s.dU()},set dracoUrl(h){s.dV(h)},get meshoptUrl(){return s.dW()},set meshoptUrl(h){s.dX(h)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var re=V;return re})}(ky)),ky.exports}var $3=Z3();const jw=ix($3);var Vo=63710088e-1,X3={centimeters:Vo*100,centimetres:Vo*100,degrees:360/(2*Math.PI),feet:Vo*3.28084,inches:Vo*39.37,kilometers:Vo/1e3,kilometres:Vo/1e3,meters:Vo,metres:Vo,miles:Vo/1609.344,millimeters:Vo*1e3,millimetres:Vo*1e3,nauticalmiles:Vo/1852,radians:1,yards:Vo*1.0936};function pS(b,m,S={}){const D={type:"Feature"};return(S.id===0||S.id)&&(D.id=S.id),S.bbox&&(D.bbox=S.bbox),D.properties=m||{},D.geometry=b,D}function W3(b,m,S={}){if(!b)throw new Error("coordinates is required");if(!Array.isArray(b))throw new Error("coordinates must be an Array");if(b.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Gw(b[0])||!Gw(b[1]))throw new Error("coordinates must contain numbers");return pS({type:"Point",coordinates:b},m,S)}function Y3(b,m,S={}){for(const V of b){if(V.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(V[V.length-1].length!==V[0].length)throw new Error("First and last Position are not equivalent.");for(let K=0;K<V[V.length-1].length;K++)if(V[V.length-1][K]!==V[0][K])throw new Error("First and last Position are not equivalent.")}return pS({type:"Polygon",coordinates:b},m,S)}function K3(b,m="kilometers"){const S=X3[m];if(!S)throw new Error(m+" units is invalid");return b/S}function qw(b){return b%(2*Math.PI)*180/Math.PI}function P0(b){return b%360*Math.PI/180}function Gw(b){return!isNaN(b)&&b!==null&&!Array.isArray(b)}function J3(b){if(!b)throw new Error("coord is required");if(!Array.isArray(b)){if(b.type==="Feature"&&b.geometry!==null&&b.geometry.type==="Point")return[...b.geometry.coordinates];if(b.type==="Point")return[...b.coordinates]}if(Array.isArray(b)&&b.length>=2&&!Array.isArray(b[0])&&!Array.isArray(b[1]))return[...b];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Q3(b,m,S,D={}){const V=J3(b),K=P0(V[0]),re=P0(V[1]),s=P0(S),pe=K3(m,D.units),Ce=Math.asin(Math.sin(re)*Math.cos(pe)+Math.cos(re)*Math.sin(pe)*Math.cos(s)),He=K+Math.atan2(Math.sin(s)*Math.sin(pe)*Math.cos(re),Math.cos(pe)-Math.sin(re)*Math.sin(Ce)),wt=qw(He),gt=qw(Ce);return W3([wt,gt],D.properties)}function mS(b,m,S={}){const D=S.steps||64,V=S.properties?S.properties:!Array.isArray(b)&&b.type==="Feature"&&b.properties?b.properties:{},K=[];for(let re=0;re<D;re++)K.push(Q3(b,m,re*-360/D,S).geometry.coordinates);return K.push(K[0]),Y3([K],V)}const eD=[{id:"hormuz",title:"Estreito de Hormuz",coordinates:[56,26]},{id:"malacca",title:"Estreito de Malaca",coordinates:[101,2.5]},{id:"suez",title:"Canal de Suez",coordinates:[32.5833,30.8333]},{id:"panama",title:"Canal do Panamá",coordinates:[-79.5,9]},{id:"gibraltar",title:"Estreito de Gibraltar",coordinates:[-5,36]}],tD=({map:b})=>{const[m,S]=Ii.useState(!1),D=()=>(console.log("Criando GeoJSON para chokepoints"),{type:"FeatureCollection",features:eD.map(re=>{const s=mS(re.coordinates,210,{steps:64,units:"kilometers"});return s.properties={id:re.id,title:re.title},s})}),V=()=>{if(!b||!b.loaded())return console.log("Mapa não está carregado para adicionar chokepoints"),!1;console.log("Adicionando chokepoints ao mapa");try{b.getLayer("chokepoints-fill")&&b.removeLayer("chokepoints-fill"),b.getLayer("chokepoints-outline")&&b.removeLayer("chokepoints-outline"),b.getLayer("chokepoints-labels")&&b.removeLayer("chokepoints-labels"),b.getSource("chokepoints-source")&&b.removeSource("chokepoints-source");const K=D();return b.addSource("chokepoints-source",{type:"geojson",data:K}),b.addLayer({id:"chokepoints-fill",type:"fill",source:"chokepoints-source",paint:{"fill-color":"rgba(255, 105, 180, 0.3)","fill-opacity":.6}}),b.addLayer({id:"chokepoints-outline",type:"line",source:"chokepoints-source",paint:{"line-color":"rgb(255, 105, 180)","line-width":1}}),b.addLayer({id:"chokepoints-labels",type:"symbol",source:"chokepoints-source",layout:{"text-field":["get","title"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12,"text-offset":[0,0],"text-anchor":"center"},paint:{"text-color":"#333333","text-halo-color":"#ffffff","text-halo-width":1}}),console.log("Chokepoints adicionados com sucesso!"),!0}catch(K){return console.error("Erro ao adicionar chokepoints:",K),!1}};return Ii.useEffect(()=>{console.log("MaritimeChokepoints montado. Map exists:",!!b);const K=()=>{console.log("Evento de mapa detectado, tentando adicionar chokepoints"),V()&&(console.log("Chokepoints inicializados com sucesso"),S(!0))};return b&&b.loaded()?(console.log("Mapa já está carregado, adicionando chokepoints imediatamente"),K()):b&&(console.log("Aguardando o carregamento do mapa..."),b.on("load",K)),b&&b.on("styledata",()=>{console.log("Estilo do mapa alterado, verificando chokepoints"),m&&!b.getLayer("chokepoints-fill")&&(console.log("Chokepoints perdidos após mudança de estilo, readicionando..."),V())}),()=>{console.log("Desmontando componente MaritimeChokepoints"),b&&(b.off("load",K),b.off("styledata"),b.loaded()&&(b.getLayer("chokepoints-labels")&&b.removeLayer("chokepoints-labels"),b.getLayer("chokepoints-outline")&&b.removeLayer("chokepoints-outline"),b.getLayer("chokepoints-fill")&&b.removeLayer("chokepoints-fill"),b.getSource("chokepoints-source")&&b.removeSource("chokepoints-source")))}},[b]),null},Om={countriesData:null,countriesCoordinates:null,lastFetched:{countriesData:null,countriesCoordinates:null}},iD=5*60*1e3,nD=()=>"https://vps58170.publiccloud.com.br",rD=b=>{const m=Om.lastFetched[b];return m&&Date.now()-m<iD&&Om[b]!==null},_S=async(b,m=!1)=>{const S=b.replace(".json","");if(!m&&rD(S))return console.log(`Using cached ${S}`),Om[S];const D=Date.now(),V=nD();try{const K=await fetch(`${V}/data/${b}?t=${D}`);if(!K.ok)throw new Error(`Failed to fetch ${b}: ${K.status} ${K.statusText}`);const re=await K.json();return console.log(`${S} loaded:`,Object.keys(re).length,"items"),Om[S]=re,Om.lastFetched[S]=Date.now(),re}catch(K){return console.error(`Error fetching ${b}:`,K),Om[S]||(S==="countriesCoordinates"?{customZoomLevels:{},countries:{}}:{})}},gS=async(b=!1)=>{try{const m=await _S("countriesData.json",b);return Vr.dispatch(vR(m)),m}catch(m){return console.error("Failed to load countries data:",m),{}}},yS=async(b=!1)=>{try{const m=await _S("countriesCoordinates.json",b);return Vr.dispatch(bx(m)),m}catch(m){return console.error("Failed to load countries coordinates:",m),{customZoomLevels:{},countries:{}}}},sD=(b,m,S)=>b?S!=null&&S.countries&&S.countries[b]?S.countries[b]:m&&m[b]&&m[b].coordinates?m[b].coordinates:(console.warn(`Country "${b}" not found, using default position`),[0,0]):[0,0],aD=()=>{const b=Ii.useRef(null),m=Ii.useRef(null),S=lf(),[D,V]=Ii.useState(!1),K=Ii.useRef(null),re=An(at=>at.game.myCountry),s=An(at=>at.game.countriesData),pe=An(at=>at.game.countriesCoordinates),Ce=An(at=>at.game.players),He=An(at=>at.game.selectedCountry),wt=()=>(Ce==null?void 0:Ce.filter(at=>typeof at=="object"?at.username!==sessionStorage.getItem("username"):typeof at=="string"?!at.startsWith(sessionStorage.getItem("username")):!1).map(at=>{var ni;return typeof at=="object"?at.country:((ni=at.match(/\((.*)\)/))==null?void 0:ni[1])||""}).filter(Boolean))||[];Ii.useEffect(()=>{if(m.current)return;const at="pk.eyJ1IjoibGVvcG9sZG9yZXplbmRlIiwiYSI6ImNqOG9zaXVyazA3anozNG8weTVrcnl4NDgifQ._89Jf3MABokdSiU0fqX84w";return jw.accessToken=at,console.log("Inicializando mapa..."),m.current=new jw.Map({container:b.current,style:"mapbox://styles/leopoldorezende/cklv3mqga2ki517m1zqftm5vp",center:[0,0],zoom:1.5,maxZoom:5.5,minZoom:1.2,projection:"globe",attributionControl:!1,logoPosition:"top-left",logo:!1}),m.current.on("style.load",()=>{console.log("Estilo do mapa carregado"),D&&setTimeout(()=>{vi()},500)}),m.current.on("load",()=>{console.log("Mapa totalmente carregado - inicializando camadas"),V(!0),gt(),jt()}),()=>{var ni;(ni=m.current)==null||ni.remove(),m.current=null}},[]),Ii.useEffect(()=>{D&&m.current&&re&&s&&s[re]&&(hi(re),S(Ow(re)),document.dispatchEvent(new CustomEvent("countrySelected",{detail:{country:re}})))},[D,re,s,S]),Ii.useEffect(()=>{D&&m.current&&He&&(K.current=He)},[D,Ce,He]);const gt=async()=>{try{const[at,ni]=await Promise.all([gS(),yS()]);ni&&S(bx(ni)),at&&m.current&&Xt(),vi()}catch(at){console.error("Erro ao carregar dados:",at)}};Ii.useEffect(()=>{D&&s&&m.current&&Xt()},[D,s,re,Ce]);const Xt=()=>{const at=m.current;at.getSource("countries")||at.addSource("countries",{type:"vector",url:"mapbox://mapbox.country-boundaries-v1"});const ni=wt();console.log("Países de outros jogadores:",ni);const qt=Object.keys(s||{}).filter(Oi=>Oi!==re&&!ni.includes(Oi));console.log("Países disponíveis sem jogadores:",qt);const $t=["case",["==",["get","name_en"],re],"rgba(255, 213, 0, 0.9)",["in",["get","name_en"],["literal",ni]],"rgba(105, 65, 217, 0.9)",["in",["get","name_en"],["literal",qt]],"rgba(255, 255, 255, 0.5)",["!",["in",["get","name_en"],["literal",Object.keys(s||{})]]],"rgba(90, 120, 120, .3)","rgba(30, 50, 70, 0)"],kt=["case",["==",["get","name_en"],re],"rgba(0, 0, 0, 0.8)",["in",["get","name_en"],["literal",ni]],"rgba(0, 0, 0, 0.8)",["in",["get","name_en"],["literal",qt]],"rgba(90, 120, 120, 1)",["in",["get","name_en"],["literal",qt]],"rgba(120, 120, 120, 0.8)","#ffffff"];at.getLayer("country-fills")?at.setPaintProperty("country-fills","fill-color",$t):at.addLayer({id:"country-fills",type:"fill",source:"countries","source-layer":"country_boundaries",filter:["all",["==",["get","disputed"],"false"],["any",["==","all",["get","worldview"]],["in","US",["get","worldview"]]]],paint:{"fill-color":$t,"fill-opacity":.9}}),at.getLayer("country-borders")?at.setPaintProperty("country-borders","line-color",kt):at.addLayer({id:"country-borders",type:"line",source:"countries","source-layer":"country_boundaries",filter:["all",["==",["get","disputed"],"false"],["any",["==","all",["get","worldview"]],["in","US",["get","worldview"]]]],layout:{},paint:{"line-color":kt,"line-width":1}},"country-fills"),setTimeout(()=>{vi()},500)},jt=()=>{m.current&&m.current.on("click",at=>{const ni=m.current.queryRenderedFeatures(at.point,{layers:["country-fills"]});if(ni.length>0){const qt=ni[0].properties.name_en;s!=null&&s[qt]&&(hi(qt),S(Ow(qt)),K.current=qt,document.dispatchEvent(new CustomEvent("countrySelected",{detail:{country:qt}})),Object.keys(s||{}).filter(kt=>{const Oi=wt();return kt!==re&&!Oi.includes(kt)}).includes(qt)&&qt!==re&&console.log(`País ${qt} disponível, o jogador pode solicitar a troca`))}})},hi=at=>{var $t;const ni=sD(at,s,pe);if(ni[0]===0&&ni[1]===0)return;const qt=(($t=pe.customZoomLevels)==null?void 0:$t[at])||4;m.current.flyTo({center:ni,zoom:qt,speed:.8,curve:1,essential:!0})},vi=()=>{if(!m.current||!m.current.loaded()){console.log("Mapa não está pronto para adicionar chokepoints");return}console.log("Adicionando chokepoints diretamente no MapView");const at=[{id:"hormuz",title:"Estreito de Hormuz",coordinates:[56,26]},{id:"malacca",title:"Estreito de Malaca",coordinates:[101,2.5]},{id:"suez",title:"Canal de Suez",coordinates:[32.5833,30.8333]},{id:"panama",title:"Canal do Panamá",coordinates:[-79.5,9]},{id:"gibraltar",title:"Estreito de Gibraltar",coordinates:[-5,36]}];try{m.current.getLayer("chokepoints-fill-direct")&&m.current.removeLayer("chokepoints-fill-direct"),m.current.getLayer("chokepoints-outline-direct")&&m.current.removeLayer("chokepoints-outline-direct"),m.current.getLayer("chokepoints-labels-direct")&&m.current.removeLayer("chokepoints-labels-direct"),m.current.getSource("chokepoints-source-direct")&&m.current.removeSource("chokepoints-source-direct");const ni=at.map(qt=>{const $t=mS(qt.coordinates,210,{steps:64,units:"kilometers"});return $t.properties={id:qt.id,title:qt.title},$t});m.current.addSource("chokepoints-source-direct",{type:"geojson",data:{type:"FeatureCollection",features:ni}}),m.current.addLayer({id:"chokepoints-fill-direct",type:"fill",source:"chokepoints-source-direct",paint:{"fill-color":"rgba(255, 105, 180, 0.3)","fill-opacity":.6}}),m.current.addLayer({id:"chokepoints-outline-direct",type:"line",source:"chokepoints-source-direct",paint:{"line-color":"rgba(255, 105, 180, 0.8)","line-width":1}}),m.current.addLayer({id:"chokepoints-labels-direct",type:"symbol",source:"chokepoints-source-direct",layout:{"text-field":["get","title"],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12,"text-offset":[0,0],"text-anchor":"center"},paint:{"text-color":"#333333","text-halo-color":"rgba(255, 255, 255, 0.7)","text-halo-width":1}}),console.log("Chokepoints adicionados diretamente com sucesso!")}catch(ni){console.error("Erro ao adicionar chokepoints diretamente:",ni)}};return de.jsxs("div",{className:"map-container",children:[de.jsx("div",{ref:b,className:"map"}),de.jsx(tD,{map:m.current})]})},oD=()=>{const b=lf(),m=An(oi=>oi.game.myCountry),S=An(oi=>oi.rooms.currentRoom),D=An(oi=>oi.rooms.rooms),V=An(oi=>oi.game.players),K=An(oi=>oi.game.countriesData),[re,s]=Ii.useState(!0),[pe,Ce]=Ii.useState(!0),[He,wt]=Ii.useState(!1),[gt,Xt]=Ii.useState(Date.now()),[jt,hi]=Ii.useState(!1);Ii.useEffect(()=>{const oi=setInterval(()=>{Xt(Date.now())},1e3);return()=>clearInterval(oi)},[]);const vi=oi=>{const tn=Math.floor(oi/1e3),Jt=Math.floor(tn/60),ei=tn%60;return`${Jt.toString().padStart(2,"0")}:${ei.toString().padStart(2,"0")}`},at=S?D.find(oi=>oi.name===S.name):null,ni=at!=null&&at.expiresAt?Math.max(0,at.expiresAt-gt):0;Ii.useEffect(()=>{at&&ni===0&&at.expiresAt>0&&!jt&&hi(!0)},[ni,at,jt]),Ii.useEffect(()=>{S&&(console.log("Current Room:",S),console.log("Room Data from list:",at),console.log("Expires At:",at==null?void 0:at.expiresAt),console.log("Current Time:",gt),console.log("Time Remaining:",ni))},[S,at,gt,ni]);const qt=()=>{if(!V)return{};const oi={};return V.forEach(tn=>{let Jt=null,ei=null;if(typeof tn=="object")Jt=tn.username,ei=tn.country;else if(typeof tn=="string"){const Vn=tn.match(/^(.*?)\s*\((.*)\)$/);Vn&&(Jt=Vn[1],ei=Vn[2])}Jt&&ei&&(oi[ei]=Jt)}),oi},$t=()=>{if(!K)return[];const oi=qt();return Object.keys(K).map(tn=>({name:tn,hasPlayer:!!oi[tn],playerName:oi[tn]||null})).sort((tn,Jt)=>tn.name.localeCompare(Jt.name))};Ii.useEffect(()=>{(async()=>{try{await gS();const tn=await yS();tn&&b(bx(tn)),wt(!0)}catch(tn){console.error("Erro ao carregar dados:",tn)}})(),S&&b({type:"socket/getRooms"})},[b,S]);const kt=()=>{b({type:"socket/leaveRoom"}),b({type:"rooms/leaveRoom"})},Oi=()=>{s(!re)},Gt=()=>{Ce(!pe)};return Ii.useEffect(()=>{const oi=document.getElementById("sideview"),tn=document.getElementById("sidetools");oi&&oi.classList.toggle("active",re),tn&&tn.classList.toggle("active",pe);const Jt=ei=>{if(window.innerWidth<=1200){const Vn=document.getElementById("sideview"),fs=document.getElementById("sidetools"),Ss=document.getElementById("btn-open-sideview"),mi=document.getElementById("btn-open-sidetools");re&&Vn&&!Vn.contains(ei.target)&&Ss&&!Ss.contains(ei.target)&&s(!1),pe&&fs&&!fs.contains(ei.target)&&mi&&!mi.contains(ei.target)&&Ce(!1)}};return document.addEventListener("mousedown",Jt),()=>{document.removeEventListener("mousedown",Jt)}},[re,pe]),Ii.useEffect(()=>{const oi=()=>{window.innerWidth<=1200&&(s(!1),Ce(!1))};return oi(),window.addEventListener("resize",oi),()=>window.removeEventListener("resize",oi)},[]),He?de.jsxs("div",{id:"game-screen",children:[S&&de.jsx("div",{className:"room-timer",children:de.jsx("div",{className:"timer-content",children:de.jsx("span",{className:`timer-value ${ni<=1e5?"timer-warning":""}`,children:vi(ni)})})}),de.jsx("div",{id:"map-container",children:de.jsx(aD,{})}),de.jsx("button",{id:"btn-open-sidetools",className:"map-control",onClick:Gt,children:de.jsx("span",{className:"material-icons",children:"sports_esports"})}),de.jsx("button",{id:"btn-open-sideview",className:"map-control",onClick:Oi,children:de.jsx("span",{className:"material-icons",children:"public"})}),de.jsx(G3,{onClose:Gt,isActive:pe,myCountry:m}),de.jsx(F3,{onExitRoom:kt,onClose:Oi,isActive:re}),jt&&de.jsx("div",{className:"timeup-popup-overlay",children:de.jsxs("div",{className:"timeup-popup",children:[de.jsx("div",{className:"timeup-popup-header",children:de.jsx("h2",{children:"Tempo Esgotado!"})}),de.jsxs("div",{className:"timeup-popup-content",children:[de.jsx("h3",{children:"Resultados da Partida"}),de.jsx("div",{className:"countries-list",children:$t().map((oi,tn)=>de.jsxs("div",{className:`country-item ${oi.hasPlayer?"with-player":"without-player"}`,children:[de.jsx("span",{className:"country-name",children:oi.name}),oi.hasPlayer&&de.jsx("span",{className:"player-indicator",title:oi.playerName,children:oi.playerName})]},tn))})]}),de.jsx("div",{className:"timeup-popup-footer",children:de.jsx("button",{className:"exit-room-btn",onClick:kt,children:"Sair da Partida"})})]})})]}):de.jsx("div",{id:"game-screen",className:"loading",children:de.jsxs("div",{className:"loading-container",children:[de.jsx("div",{className:"loading-spinner"}),de.jsx("p",{children:"Carregando dados do jogo..."})]})})};function lD(){const b=An(V=>V.auth.isAuthenticated),m=An(V=>V.rooms.currentRoom),S=lf();Ii.useEffect(()=>(zn.connect(),S({type:Eu.CONNECT}),()=>{}),[S]);const D=()=>b?m?de.jsx(oD,{}):de.jsx(L3,{}):de.jsx(O3,{});return de.jsx("div",{className:"app",children:D()})}yE.createRoot(document.getElementById("root")).render(de.jsx(uE.StrictMode,{children:de.jsx(PE,{store:Vr,children:de.jsx(lD,{})})}));
